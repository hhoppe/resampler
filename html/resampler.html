<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 12.0.2"/>
    <title>resampler API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>


        <h2>Contents</h2>
        <ul>
  <li><a href="#overview">Overview</a>
  <ul>
    <li><a href="#example-usage">Example usage</a></li>
  </ul></li>
</ul>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="variable" href="#ARRAYLIBS">ARRAYLIBS</a>
            </li>
            <li>
                    <a class="class" href="#Gridtype">Gridtype</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#DualGridtype">DualGridtype</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#PrimalGridtype">PrimalGridtype</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="variable" href="#GRIDTYPES">GRIDTYPES</a>
            </li>
            <li>
                    <a class="class" href="#Boundary">Boundary</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="variable" href="#BOUNDARIES">BOUNDARIES</a>
            </li>
            <li>
                    <a class="class" href="#Filter">Filter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#ImpulseFilter">ImpulseFilter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#BoxFilter">BoxFilter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#TrapezoidFilter">TrapezoidFilter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#TriangleFilter">TriangleFilter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#CubicFilter">CubicFilter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#CatmullRomFilter">CatmullRomFilter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#MitchellFilter">MitchellFilter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#SharpCubicFilter">SharpCubicFilter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#LanczosFilter">LanczosFilter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#GeneralizedHammingFilter">GeneralizedHammingFilter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#KaiserFilter">KaiserFilter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#BsplineFilter">BsplineFilter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#CardinalBsplineFilter">CardinalBsplineFilter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#OmomsFilter">OmomsFilter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#GaussianFilter">GaussianFilter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#NarrowBoxFilter">NarrowBoxFilter</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="variable" href="#FILTERS">FILTERS</a>
            </li>
            <li>
                    <a class="class" href="#Gamma">Gamma</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#IdentityGamma">IdentityGamma</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#PowerGamma">PowerGamma</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="class" href="#SrgbGamma">SrgbGamma</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="variable" href="#GAMMAS">GAMMAS</a>
            </li>
            <li>
                    <a class="function" href="#resize">resize</a>
            </li>
            <li>
                    <a class="function" href="#resize_in_numpy">resize_in_numpy</a>
            </li>
            <li>
                    <a class="function" href="#resize_in_tensorflow">resize_in_tensorflow</a>
            </li>
            <li>
                    <a class="function" href="#resize_in_torch">resize_in_torch</a>
            </li>
            <li>
                    <a class="function" href="#resample">resample</a>
            </li>
            <li>
                    <a class="function" href="#resample_affine">resample_affine</a>
            </li>
            <li>
                    <a class="function" href="#resize_using_resample">resize_using_resample</a>
            </li>
            <li>
                    <a class="function" href="#rotation_about_center_in_2d">rotation_about_center_in_2d</a>
            </li>
            <li>
                    <a class="function" href="#rotate_image_about_center">rotate_image_about_center</a>
            </li>
            <li>
                    <a class="function" href="#pil_image_resize">pil_image_resize</a>
            </li>
            <li>
                    <a class="function" href="#cv_resize">cv_resize</a>
            </li>
            <li>
                    <a class="function" href="#tf_image_resize">tf_image_resize</a>
            </li>
            <li>
                    <a class="function" href="#torch_nn_resize">torch_nn_resize</a>
            </li>
            <li>
                    <a class="function" href="#torchvision_resize">torchvision_resize</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
resampler    </h1>

                        <div class="docstring"><p>resampler: fast differentiable resizing and warping of arbitrary grids.</p>

<p><a href="https://hhoppe.com/">Hugues Hoppe</a>
&nbsp;&nbsp; Aug 2022.</p>

<p><a href="https://colab.research.google.com/github/hhoppe/resampler/blob/main/resampler_notebook.ipynb"><strong>[Open in Colab]</strong></a>
&nbsp;
<a href="https://www.kaggle.com/notebooks/welcome?src=https://github.com/hhoppe/resampler/blob/main/resampler_notebook.ipynb"><strong>[Kaggle]</strong></a>
&nbsp;
<a href="https://mybinder.org/v2/gh/hhoppe/resampler/main?filepath=resampler_notebook.ipynb"><strong>[MyBinder]</strong></a>
&nbsp;
<a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Fhhoppe%2Fresampler%2Fblob%2Fmain%2Fresampler_notebook.ipynb"><strong>[DeepNote]</strong></a>
&nbsp;
<a href="https://github.com/hhoppe/resampler"><strong>[GitHub source]</strong></a>
&nbsp;
<a href="https://hhoppe.github.io/resampler/"><strong>[API docs]</strong></a>
&nbsp;
<a href="https://pypi.org/project/resampler/"><strong>[PyPI package]</strong></a></p>

<p>The Python notebook <a href="a href=&quot;https://colab.research.google.com/github/hhoppe/resampler/blob/main/resampler_notebook.ipynb&quot;&gt;https://colab.research.google.com/github/hhoppe/resampler/blob/main/resampler_notebook.ipynb&lt;/a"><code>resampler_notebook.ipynb</code></a>
hosts the source code for the
<a href="https://pypi.org/project/resampler/"><code><a href="">resampler</a></code> package in PyPI</a>,
interleaved with documentation, usage examples, unit tests, and signal-processing experiments.</p>

<h1 id="overview">Overview</h1>

<p>The <code><a href="">resampler</a></code> library enables fast differentiable resizing and warping of arbitrary grids.
It supports:</p>

<ul>
<li><p>grids of arbitrary dimension (e.g., 1D audio, 2D images, 3D video, 4D batches of videos),
containing</p></li>
<li><p>sample values of arbitrary shape
(e.g., scalars, RGB colors, motion vectors, Jacobian matrices) and</p></li>
<li><p>arbitrary numeric type (integer, floating, and complex);</p></li>
<li><p>either <code>dual</code> ("half-integer") or <code>primal</code> <strong>grid-type</strong>
for each dimension;</p></li>
<li><p>many <strong>boundary</strong> rules,
specified per dimension, extensible via subclassing;</p></li>
<li><p>an extensible set of parameterized <strong>filter</strong> kernels,
selectable per dimension;</p></li>
<li><p>optional <strong>gamma</strong> transfer functions
for correct linear-space filtering;</p></li>
<li><p>prefiltering for accurate antialiasing when downsampling;</p></li>
<li><p>processing within several <strong>array libraries</strong>
(<code>numpy</code>, <code>tensorflow</code>, and <code>torch</code>);</p></li>
<li><p>efficient backpropagation of <strong>gradients</strong>
for both <code>tensorflow</code> and <code>torch</code>;</p></li>
<li><p>easy installation, without any native-code extension module, yet</p></li>
<li><p><strong>faster resizing</strong> than the C++ implementations
in <code>tf.image</code>, <code>torch.nn</code>, and <code>torchvision</code>.</p></li>
</ul>

<p>A key strategy is to build on existing sparse matrix representations and operations.</p>

<h2 id="example-usage">Example usage</h2>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="n">mediapy</span> <span class="n">resampler</span>
<span class="kn">import</span> <span class="nn">mediapy</span> <span class="k">as</span> <span class="nn">media</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">resampler</span>
</code></pre></div>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">array</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># 4x6 RGB image.</span>
<span class="n">upsampled</span> <span class="o">=</span> <span class="n"><a href="#resize">resampler.resize</a></span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">192</span><span class="p">))</span>  <span class="c1"># To 128x192 resolution.</span>
<span class="n">media</span><span class="o">.</span><span class="n">show_images</span><span class="p">({</span><span class="s1">&#39;4x6&#39;</span><span class="p">:</span> <span class="n">array</span><span class="p">,</span> <span class="s1">&#39;128x192&#39;</span><span class="p">:</span> <span class="n">upsampled</span><span class="p">},</span> <span class="n">height</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
</code></pre></div>

<blockquote>
  <p><img src="https://drive.google.com/uc?export=download&amp;id=1tXm7Z8_ILYpTOsW1a5Z4S-Dvd1vcn7Q5"/></p>
</blockquote>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="n">image</span> <span class="o">=</span> <span class="n">media</span><span class="o">.</span><span class="n">read_image</span><span class="p">(</span><span class="s1">&#39;https://github.com/hhoppe/data/raw/main/image.png&#39;</span><span class="p">)</span>
<span class="n">downsampled</span> <span class="o">=</span> <span class="n"><a href="#resize">resampler.resize</a></span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">))</span>
<span class="n">media</span><span class="o">.</span><span class="n">show_images</span><span class="p">({</span><span class="s1">&#39;128x128&#39;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span> <span class="s1">&#39;32x32&#39;</span><span class="p">:</span> <span class="n">downsampled</span><span class="p">},</span> <span class="n">height</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
</code></pre></div>

<blockquote>
  <p><img src="https://drive.google.com/uc?export=download&amp;id=1OiVNvszGZP3COh8mhI0dd2v00cMw2TA0"/></p>
</blockquote>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</code></pre></div>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">,</span> <span class="mf">8.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">]</span>  <span class="c1"># 4 source samples in 1D.</span>
<span class="n">new_dual</span> <span class="o">=</span> <span class="n"><a href="#resize">resampler.resize</a></span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="mi">32</span><span class="p">,))</span>  <span class="c1"># (default gridtype=&#39;dual&#39;) 8x resolution.</span>
<span class="n">new_primal</span> <span class="o">=</span> <span class="n"><a href="#resize">resampler.resize</a></span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="mi">25</span><span class="p">,),</span> <span class="n">gridtype</span><span class="o">=</span><span class="s1">&#39;primal&#39;</span><span class="p">)</span>  <span class="c1"># 8x resolution.</span>
<span class="n">_</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;gridtype dual&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">array</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_dual</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_dual</span><span class="p">),</span> <span class="n">new_dual</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;gridtype primal&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">array</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_primal</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">new_primal</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">new_primal</span><span class="p">,</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>

<blockquote>
  <p><img src="https://drive.google.com/uc?export=download&amp;id=1VGjyX2nvBKaWyGbrMt3g0Nd3G1YdtFjg"/></p>
</blockquote>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">batch_of_images</span> <span class="o">=</span> <span class="n">media</span><span class="o">.</span><span class="n">moving_circle</span><span class="p">((</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">)</span>
<span class="n">upsampled</span> <span class="o">=</span> <span class="n"><a href="#resize">resampler.resize</a></span><span class="p">(</span><span class="n">batch_of_images</span><span class="p">,</span> <span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">))</span>
<span class="n">spacer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">64</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">media</span><span class="o">.</span><span class="n">show_images</span><span class="p">([</span><span class="o">*</span><span class="n">batch_of_images</span><span class="p">,</span> <span class="n">spacer</span><span class="p">,</span> <span class="o">*</span><span class="n">upsampled</span><span class="p">],</span> <span class="n">border</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">64</span><span class="p">)</span>
</code></pre></div>

<blockquote>
  <p><img src="https://drive.google.com/uc?export=download&amp;id=1PLHu5mCpmb-_54ybvfr6kLUUTHD6l73t"/></p>
</blockquote>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="n">media</span><span class="o">.</span><span class="n">show_videos</span><span class="p">({</span><span class="s1">&#39;original&#39;</span><span class="p">:</span> <span class="n">batch_of_images</span><span class="p">,</span> <span class="s1">&#39;upsampled&#39;</span><span class="p">:</span> <span class="n">upsampled</span><span class="p">},</span> <span class="n">fps</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>

<blockquote>
  <p>original
  <img src="https://drive.google.com/uc?export=download&amp;id=1WCwwbgYZordX14-XvHiV2Gc_60I1KD39"/>
  upsampled
  <img src="https://drive.google.com/uc?export=download&amp;id=11Of3Gbv6p2BTxJD2rO0zAWEEv4w3BIe5"/></p>
</blockquote>

<p>Most examples above use the default
<code><a href="#resize">resize()</a></code> settings:</p>

<ul>
<li><code>gridtype='dual'</code> for both source and destination arrays,</li>
<li><code>boundary='auto'</code>
which uses <code>'reflect'</code> for upsampling and <code>'clamp'</code> for downsampling,</li>
<li><code>filter='lanczos3'</code>
(a <a href="https://en.wikipedia.org/wiki/Lanczos_resampling">Lanczos</a> kernel with radius 3),</li>
<li><code>gamma=None</code> which by default uses the <code>'power2'</code>
transfer function for the <code>uint8</code> image in the second example,</li>
<li><code>scale=1.0, translate=0.0</code> (no domain transformation),</li>
<li>default <code>precision</code> and output <code>dtype</code>.</li>
</ul>

<p><strong>Advanced usage:</strong></p>

<p>Map an image to a wider grid using custom <code>scale</code> and <code>translate</code> vectors,
with horizontal <code>'reflect'</code> and vertical <code>'natural'</code> boundary rules,
providing a constant value for the exterior,
using different filters (Lanczos and O-MOMS) in the two dimensions,
disabling gamma correction, performing computations in double-precision,
and returning an output array in single-precision:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="n">new</span> <span class="o">=</span> <span class="n"><a href="#resize">resampler.resize</a></span><span class="p">(</span>
    <span class="n">image</span><span class="p">,</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">512</span><span class="p">),</span> <span class="n">boundary</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;natural&#39;</span><span class="p">,</span> <span class="s1">&#39;reflect&#39;</span><span class="p">),</span> <span class="n">cval</span><span class="o">=</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">),</span>
    <span class="nb">filter</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;lanczos3&#39;</span><span class="p">,</span> <span class="s1">&#39;omoms5&#39;</span><span class="p">),</span> <span class="n">gamma</span><span class="o">=</span><span class="s1">&#39;identity&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span>
    <span class="n">translate</span><span class="o">=</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">),</span> <span class="n">precision</span><span class="o">=</span><span class="s1">&#39;float64&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
<span class="n">media</span><span class="o">.</span><span class="n">show_images</span><span class="p">({</span><span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span> <span class="s1">&#39;new&#39;</span><span class="p">:</span> <span class="n">new</span><span class="p">})</span>
</code></pre></div>

<blockquote>
  <p><img src="https://drive.google.com/uc?export=download&amp;id=1WUsrghao2Py9hSCPWfinVYg6Lga55h1X"/></p>
</blockquote>

<p>Warp an image by transforming it using
<a href="https://en.wikipedia.org/wiki/Polar_coordinate_system">polar coordinates</a>:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="n">shape</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
<span class="n">yx</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="n">shape</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># [-0.5, 0.5]^2</span>
<span class="n">radius</span><span class="p">,</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">yx</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">*</span><span class="n">yx</span><span class="p">)</span>
<span class="n">angle</span> <span class="o">+=</span> <span class="p">(</span><span class="mf">0.8</span> <span class="o">-</span> <span class="n">radius</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="mf">0.6</span>
<span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">radius</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">*</span> <span class="n">radius</span><span class="p">))</span> <span class="o">+</span> <span class="mf">0.5</span>
<span class="n">resampled</span> <span class="o">=</span> <span class="n"><a href="#resample">resampler.resample</a></span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="s1">&#39;constant&#39;</span><span class="p">)</span>
<span class="n">media</span><span class="o">.</span><span class="n">show_images</span><span class="p">({</span><span class="s1">&#39;image&#39;</span><span class="p">:</span> <span class="n">image</span><span class="p">,</span> <span class="s1">&#39;resampled&#39;</span><span class="p">:</span> <span class="n">resampled</span><span class="p">})</span>
</code></pre></div>

<blockquote>
  <p><img src="https://drive.google.com/uc?export=download&amp;id=1vqnNGeAw5uTNvMEt8hzQY3uXOJugMtJY"/></p>
</blockquote>

<p><strong>Limitations:</strong></p>

<ul>
<li>Filters are assumed to be <a href="https://en.wikipedia.org/wiki/Separable_filter">separable</a>.
For rotation equivariance (e.g., bandlimit the signal uniformly in all directions),
it would be nice to support the (non-separable) 2D rotationally symmetric
<a href="https://en.wikipedia.org/wiki/Sombrero_function">sombrero function</a>
$f(\textbf{x}) = \text{jinc}(\|\textbf{x}\|)$,
where $\text{jinc}(r) = 2J_1(\pi r)/(\pi r)$.
(The Fourier transform of a circle
<a href="https://en.wikipedia.org/wiki/Airy_disk">involves the first-order Bessel function of the first kind</a>.)</li>
</ul>
</div>

                        <input id="resampler-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="resampler-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="sd">&quot;&quot;&quot;resampler: fast differentiable resizing and warping of arbitrary grids.</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="sd">.. include:: ../README.md</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="n">__docformat__</span> <span class="o">=</span> <span class="s1">&#39;google&#39;</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a><span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.3.0&#39;</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="n">__version_info__</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">__version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="kn">import</span> <span class="nn">dataclasses</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="kn">import</span> <span class="nn">functools</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="kn">import</span> <span class="nn">math</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="kn">import</span> <span class="nn">typing</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">import</span> <span class="nn">scipy.interpolate</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="kn">import</span> <span class="nn">scipy.linalg</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="kn">import</span> <span class="nn">scipy.ndimage</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="kn">import</span> <span class="nn">scipy.sparse.linalg</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="k">try</span><span class="p">:</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a>  <span class="kn">import</span> <span class="nn">numba</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="k">except</span> <span class="ne">ModuleNotFoundError</span><span class="p">:</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a>  <span class="k">pass</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="n">_DType</span> <span class="o">=</span> <span class="n">Any</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="n">_NDArray</span> <span class="o">=</span> <span class="n">Any</span>  <span class="c1"># To document np.ndarray[Any, Any] without enforcement.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="n">_TensorflowTensor</span> <span class="o">=</span> <span class="n">Any</span>  <span class="c1"># To document tf.Tensor without enforcement.</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="n">_TorchTensor</span> <span class="o">=</span> <span class="n">Any</span>  <span class="c1"># To document torch.Tensor without enforcement.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="n">_Array</span> <span class="o">=</span> <span class="n">Any</span>  <span class="c1"># To document any array class supported by _Arraylib.</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="k">def</span> <span class="nf">_check_eq</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a>  <span class="sd">&quot;&quot;&quot;If the two values or arrays are not equal, raise an exception with a useful message.&quot;&quot;&quot;</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a>  <span class="n">equal</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="k">else</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">equal</span><span class="p">:</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">a</span><span class="si">!r}</span><span class="s1"> == </span><span class="si">{</span><span class="n">b</span><span class="si">!r}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a><span class="k">def</span> <span class="nf">_real_precision</span><span class="p">(</span><span class="n">dtype</span><span class="p">:</span> <span class="n">_DType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_DType</span><span class="p">:</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>  <span class="sd">&quot;&quot;&quot;Return the type of the real part of a complex number.&quot;&quot;&quot;</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">dtype</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a><span class="k">def</span> <span class="nf">_get_precision</span><span class="p">(</span><span class="n">precision</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dtypes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_DType</span><span class="p">],</span> <span class="n">weight_dtypes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_DType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">_DType</span><span class="p">:</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>  <span class="sd">&quot;&quot;&quot;Return dtype based on desired precision or on data and weight types.&quot;&quot;&quot;</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>  <span class="n">precision</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">precision</span> <span class="k">if</span> <span class="n">precision</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>                       <span class="n">np</span><span class="o">.</span><span class="n">find_common_type</span><span class="p">([],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="o">*</span><span class="n">dtypes</span><span class="p">,</span> <span class="o">*</span><span class="n">weight_dtypes</span><span class="p">]))</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inexact</span><span class="p">):</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Precision </span><span class="si">{</span><span class="n">precision</span><span class="si">}</span><span class="s1"> is not floating or complex.&#39;</span><span class="p">)</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>  <span class="n">check_complex</span> <span class="o">=</span> <span class="p">[</span><span class="n">precision</span><span class="p">,</span> <span class="o">*</span><span class="n">dtypes</span><span class="p">]</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>  <span class="n">is_complex</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complexfloating</span><span class="p">)</span> <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">check_complex</span><span class="p">]</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">is_complex</span><span class="p">))</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Types </span><span class="si">{</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span> <span class="k">for</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="n">check_complex</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>                     <span class="s1">&#39; must be all real or all complex.&#39;</span><span class="p">)</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>  <span class="k">return</span> <span class="n">precision</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a><span class="k">def</span> <span class="nf">_sinc</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>  <span class="sd">&quot;&quot;&quot;Return the value `np.sinc(x)` but improved to:</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a><span class="sd">  (1) ignore underflow that occurs at 0.0 for np.float32, and</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a><span class="sd">  (2) output exact zero for integer input values.</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>  <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>  <span class="n">x_is_scalar</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>  <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">under</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sinc</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>    <span class="n">result</span><span class="p">[</span><span class="n">x</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>    <span class="n">result</span><span class="p">[</span><span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>    <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="k">if</span> <span class="n">x_is_scalar</span> <span class="k">else</span> <span class="n">result</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a><span class="k">def</span> <span class="nf">_is_symmetric</span><span class="p">(</span><span class="n">matrix</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">tol</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>  <span class="sd">&quot;&quot;&quot;Return True if the sparse matrix is symmetric.&quot;&quot;&quot;</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>  <span class="n">norm</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">matrix</span> <span class="o">-</span> <span class="n">matrix</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>  <span class="k">return</span> <span class="n">norm</span> <span class="o">&lt;=</span> <span class="n">tol</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a><span class="k">def</span> <span class="nf">_spline_filter1d</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>  <span class="sd">&quot;&quot;&quot;Wrapper to use &#39;grid-wrap&#39; if scipy is a recent version.&quot;&quot;&quot;</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>  <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;wrap&#39;</span><span class="p">:</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>    <span class="n">scipy_version</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">scipy</span><span class="o">.</span><span class="n">__version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">))</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>    <span class="n">mode</span> <span class="o">=</span> <span class="s1">&#39;grid-wrap&#39;</span> <span class="k">if</span> <span class="n">scipy_version</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;wrap&#39;</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>  <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">spline_filter1d</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a><span class="k">def</span> <span class="nf">_cache_sampled_1d_function</span><span class="p">(</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>    <span class="n">xmin</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">xmax</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3_600</span><span class="p">,</span> <span class="n">enable</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">_NDArray</span><span class="p">]],</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">_NDArray</span><span class="p">]]:</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>  <span class="sd">&quot;&quot;&quot;Function decorator to linearly interpolate cached function values.&quot;&quot;&quot;</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>  <span class="c1"># Speed unchanged up to num_samples=12_000, then slow decrease until 100_000.</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>  <span class="k">def</span> <span class="nf">wrap_it</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">_NDArray</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">_NDArray</span><span class="p">]:</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">enable</span><span class="p">:</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>      <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>      <span class="k">def</span> <span class="nf">original_func</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>        <span class="n">_check_eq</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>      <span class="k">return</span> <span class="n">original_func</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>    <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">num_samples</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">num_samples</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>    <span class="n">samples_func</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">samples_func</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]]</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>    <span class="k">def</span> <span class="nf">interpolate_using_cached_samples</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>      <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;exact&#39;</span><span class="p">:</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>        <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>      <span class="n">index_float</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">dx</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">num_samples</span><span class="p">)</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>      <span class="n">index</span> <span class="o">=</span> <span class="n">index_float</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>      <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;nearest&#39;</span><span class="p">:</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>        <span class="k">return</span> <span class="n">samples_func</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>      <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>        <span class="n">frac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">index_float</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">frac</span><span class="p">)</span> <span class="o">*</span> <span class="n">samples_func</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+</span> <span class="n">frac</span> <span class="o">*</span> <span class="n">samples_func</span><span class="p">[</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">mode</span><span class="si">}</span><span class="s1"> is not one of: exact, nearest, linear.&#39;</span><span class="p">)</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>    <span class="k">return</span> <span class="n">interpolate_using_cached_samples</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>  <span class="k">return</span> <span class="n">wrap_it</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="k">class</span> <span class="nc">_DownsampleIn2dUsingBoxFilter</span><span class="p">:</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>  <span class="sd">&quot;&quot;&quot;Fast 2D box-filter downsampling using cached numba-jitted functions.&quot;&quot;&quot;</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>    <span class="c1"># Downsampling function for params (dtype, block_height, block_width, ch).</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_jitted_function</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="n">_DType</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">_NDArray</span><span class="p">],</span> <span class="n">_NDArray</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>    <span class="k">assert</span> <span class="s1">&#39;numba&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a>    <span class="k">assert</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a>    <span class="n">_check_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>    <span class="n">dtype</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">dtype</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a>    <span class="n">a</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">array</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a>    <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">ch</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>    <span class="n">new_height</span><span class="p">,</span> <span class="n">new_width</span> <span class="o">=</span> <span class="n">shape</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>    <span class="k">if</span> <span class="n">height</span> <span class="o">%</span> <span class="n">new_height</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">width</span> <span class="o">%</span> <span class="n">new_width</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Shape </span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1"> not a multiple of </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>    <span class="n">block_height</span><span class="p">,</span> <span class="n">block_width</span> <span class="o">=</span> <span class="n">height</span> <span class="o">//</span> <span class="n">new_height</span><span class="p">,</span> <span class="n">width</span> <span class="o">//</span> <span class="n">new_width</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>  <span class="c1"># pylint: disable=too-many-branches</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>      <span class="n">new_height</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="n">block_height</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>      <span class="n">new_width</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="n">block_width</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>      <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">new_height</span><span class="p">,</span> <span class="n">new_width</span><span class="p">,</span> <span class="n">ch</span><span class="p">),</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>      <span class="n">totals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>      <span class="n">scale</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">block_height</span> <span class="o">*</span> <span class="n">block_width</span><span class="p">))</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>      <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">new_height</span><span class="p">):</span>  <span class="c1"># pylint: disable=too-many-nested-blocks</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">new_width</span><span class="p">):</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>          <span class="c1"># y2, x2 = y * block_height, x * block_width ?</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>          <span class="k">if</span> <span class="n">ch</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># All the branches involve compile-time constants.</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>            <span class="n">total</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>            <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">block_height</span><span class="p">):</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>              <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">block_width</span><span class="p">):</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>                <span class="n">total</span> <span class="o">+=</span> <span class="n">array</span><span class="p">[</span><span class="n">y</span> <span class="o">*</span> <span class="n">block_height</span> <span class="o">+</span> <span class="n">yy</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">block_width</span> <span class="o">+</span> <span class="n">xx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>            <span class="n">result</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span> <span class="o">*</span> <span class="n">scale</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>          <span class="k">elif</span> <span class="n">ch</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>            <span class="n">total0</span> <span class="o">=</span> <span class="n">total1</span> <span class="o">=</span> <span class="n">total2</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>            <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">block_height</span><span class="p">):</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>              <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">block_width</span><span class="p">):</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>                <span class="c1"># pixel = array[y2 + yy, x2 + xx] ?</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>                <span class="n">total0</span> <span class="o">+=</span> <span class="n">array</span><span class="p">[</span><span class="n">y</span> <span class="o">*</span> <span class="n">block_height</span> <span class="o">+</span> <span class="n">yy</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">block_width</span> <span class="o">+</span> <span class="n">xx</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>                <span class="n">total1</span> <span class="o">+=</span> <span class="n">array</span><span class="p">[</span><span class="n">y</span> <span class="o">*</span> <span class="n">block_height</span> <span class="o">+</span> <span class="n">yy</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">block_width</span> <span class="o">+</span> <span class="n">xx</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>                <span class="n">total2</span> <span class="o">+=</span> <span class="n">array</span><span class="p">[</span><span class="n">y</span> <span class="o">*</span> <span class="n">block_height</span> <span class="o">+</span> <span class="n">yy</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">block_width</span> <span class="o">+</span> <span class="n">xx</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>            <span class="n">result</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">total0</span> <span class="o">*</span> <span class="n">scale</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>            <span class="n">result</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">total1</span> <span class="o">*</span> <span class="n">scale</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>            <span class="n">result</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">total2</span> <span class="o">*</span> <span class="n">scale</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>          <span class="k">elif</span> <span class="n">block_height</span> <span class="o">*</span> <span class="n">block_width</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="p">:</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ch</span><span class="p">):</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a>              <span class="n">totals</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a>            <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">block_height</span><span class="p">):</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a>              <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">block_width</span><span class="p">):</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a>                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ch</span><span class="p">):</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a>                  <span class="n">totals</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">+=</span> <span class="n">array</span><span class="p">[</span><span class="n">y</span> <span class="o">*</span> <span class="n">block_height</span> <span class="o">+</span> <span class="n">yy</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">block_width</span> <span class="o">+</span> <span class="n">xx</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ch</span><span class="p">):</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>              <span class="n">result</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">totals</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">*</span> <span class="n">scale</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>          <span class="k">else</span><span class="p">:</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">ch</span><span class="p">):</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>              <span class="n">total</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a>              <span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">block_height</span><span class="p">):</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>                <span class="k">for</span> <span class="n">xx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">block_width</span><span class="p">):</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a>                  <span class="n">total</span> <span class="o">+=</span> <span class="n">array</span><span class="p">[</span><span class="n">y</span> <span class="o">*</span> <span class="n">block_height</span> <span class="o">+</span> <span class="n">yy</span><span class="p">,</span> <span class="n">x</span> <span class="o">*</span> <span class="n">block_width</span> <span class="o">+</span> <span class="n">xx</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a>              <span class="n">result</span><span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">total</span> <span class="o">*</span> <span class="n">scale</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a>      <span class="k">return</span> <span class="n">result</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>    <span class="n">signature</span> <span class="o">=</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">block_height</span><span class="p">,</span> <span class="n">block_width</span><span class="p">,</span> <span class="n">ch</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>    <span class="n">jitted_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jitted_function</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">signature</span><span class="p">)</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">jitted_function</span><span class="p">:</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a>      <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Creating numba jit-wrapper for </span><span class="si">{</span><span class="n">signature</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a>      <span class="n">jitted_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_jitted_function</span><span class="p">[</span><span class="n">signature</span><span class="p">]</span> <span class="o">=</span> <span class="n">numba</span><span class="o">.</span><span class="n">njit</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">jitted_function</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>    <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">result</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="n">_downsample_in_2d_using_box_filter</span> <span class="o">=</span> <span class="n">_DownsampleIn2dUsingBoxFilter</span><span class="p">()</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="k">class</span> <span class="nc">_Arraylib</span><span class="p">:</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>  <span class="sd">&quot;&quot;&quot;Abstract base class for abstraction of array libraries.&quot;&quot;&quot;</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>  <span class="n">arraylib</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>  <span class="sd">&quot;&quot;&quot;Name of array library (e.g., &#39;numpy&#39;, &#39;tensorflow&#39;, &#39;torch&#39;).&quot;&quot;&quot;</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a>  <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>  <span class="nd">@staticmethod</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>  <span class="k">def</span> <span class="nf">recognize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>    <span class="sd">&quot;&quot;&quot;Return True if `array` is recognized by this array library.&quot;&quot;&quot;</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>  <span class="k">def</span> <span class="nf">numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a>    <span class="sd">&quot;&quot;&quot;Return a `numpy` version of this array.&quot;&quot;&quot;</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a>  <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_DType</span><span class="p">:</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>    <span class="sd">&quot;&quot;&quot;Return the numpy dtype of the array.&quot;&quot;&quot;</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>  <span class="k">def</span> <span class="nf">astype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>    <span class="sd">&quot;&quot;&quot;Return the array with values cast as numpy dtype.&quot;&quot;&quot;</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>  <span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">low</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">high</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a>    <span class="sd">&quot;&quot;&quot;Return the array with values clipped to the range [low, high].&quot;&quot;&quot;</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a>  <span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>    <span class="sd">&quot;&quot;&quot;Return a new array with values squared.&quot;&quot;&quot;</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>  <span class="k">def</span> <span class="nf">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>    <span class="sd">&quot;&quot;&quot;Return a new array with values square-rooted.&quot;&quot;&quot;</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a>  <span class="k">def</span> <span class="nf">gather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>    <span class="sd">&quot;&quot;&quot;Return `table[array]`.&quot;&quot;&quot;</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>  <span class="k">def</span> <span class="nf">where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">if_true</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">if_false</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>    <span class="sd">&quot;&quot;&quot;Return `where(array, if_true, if_false)`.&quot;&quot;&quot;</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a>  <span class="k">def</span> <span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a>    <span class="sd">&quot;&quot;&quot;Return the array with its axes permuted.&quot;&quot;&quot;</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>  <span class="k">def</span> <span class="nf">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arrays</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">_Array</span><span class="p">],</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>    <span class="sd">&quot;&quot;&quot;Return the concatenation of arrays; uses self only to determine arraylib!&quot;&quot;&quot;</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="k">class</span> <span class="nc">_NumpyArraylib</span><span class="p">(</span><span class="n">_Arraylib</span><span class="p">):</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>  <span class="sd">&quot;&quot;&quot;Numpy implementation of the array abstraction.&quot;&quot;&quot;</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">arraylib</span><span class="o">=</span><span class="s1">&#39;numpy&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>  <span class="nd">@staticmethod</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>  <span class="k">def</span> <span class="nf">recognize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>    <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>  <span class="k">def</span> <span class="nf">numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>  <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_DType</span><span class="p">:</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>  <span class="k">def</span> <span class="nf">astype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>  <span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">low</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">high</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>  <span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>  <span class="k">def</span> <span class="nf">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>  <span class="k">def</span> <span class="nf">gather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>    <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>    <span class="k">return</span> <span class="n">table</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>  <span class="k">def</span> <span class="nf">where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">if_true</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">if_false</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>    <span class="n">condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">if_true</span><span class="p">,</span> <span class="n">if_false</span><span class="p">)</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>  <span class="k">def</span> <span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">axes</span><span class="p">))</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>  <span class="k">def</span> <span class="nf">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arrays</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">_Array</span><span class="p">],</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a><span class="k">class</span> <span class="nc">_TensorflowArraylib</span><span class="p">(</span><span class="n">_Arraylib</span><span class="p">):</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>  <span class="sd">&quot;&quot;&quot;Tensorflow implementation of the array abstraction.&quot;&quot;&quot;</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">arraylib</span><span class="o">=</span><span class="s1">&#39;tensorflow&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>  <span class="nd">@staticmethod</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>  <span class="k">def</span> <span class="nf">recognize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>    <span class="c1"># Eager: tensorflow.python.framework.ops.Tensor</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>    <span class="c1"># Non-eager: tensorflow.python.ops.resource_variable_ops.ResourceVariable</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="vm">__module__</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;tensorflow.&#39;</span><span class="p">)</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>  <span class="k">def</span> <span class="nf">numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>  <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_DType</span><span class="p">:</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">as_numpy_dtype</span><span class="p">)</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>  <span class="k">def</span> <span class="nf">astype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>  <span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">low</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">high</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>    <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>      <span class="n">array</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">clip_by_value</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>  <span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>  <span class="k">def</span> <span class="nf">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>  <span class="k">def</span> <span class="nf">gather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>    <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>    <span class="k">if</span> <span class="n">_arr_dtype</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">):</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>      <span class="n">indices</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>  <span class="k">def</span> <span class="nf">where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">if_true</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">if_false</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>    <span class="n">condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">if_true</span><span class="p">,</span> <span class="n">if_false</span><span class="p">)</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>  <span class="k">def</span> <span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">perm</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="n">axes</span><span class="p">))</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>  <span class="k">def</span> <span class="nf">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arrays</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">_Array</span><span class="p">],</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>    <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="k">class</span> <span class="nc">_TorchArraylib</span><span class="p">(</span><span class="n">_Arraylib</span><span class="p">):</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>  <span class="sd">&quot;&quot;&quot;Torch implementation of the array abstraction.&quot;&quot;&quot;</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>    <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">arraylib</span><span class="o">=</span><span class="s1">&#39;torch&#39;</span><span class="p">,</span> <span class="n">array</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">array</span><span class="p">))</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>  <span class="nd">@staticmethod</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>  <span class="k">def</span> <span class="nf">recognize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>    <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="vm">__module__</span> <span class="o">==</span> <span class="s1">&#39;torch&#39;</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>  <span class="k">def</span> <span class="nf">numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>  <span class="k">def</span> <span class="nf">dtype</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_DType</span><span class="p">:</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>    <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>    <span class="n">numpy_type</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>        <span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>        <span class="n">torch</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>        <span class="n">torch</span><span class="o">.</span><span class="n">complex64</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>        <span class="n">torch</span><span class="o">.</span><span class="n">complex128</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>        <span class="n">torch</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>  <span class="c1"># No uint16, uint32, uint64.</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>        <span class="n">torch</span><span class="o">.</span><span class="n">int16</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>        <span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>        <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>    <span class="p">}[</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">]</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">numpy_type</span><span class="p">)</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>  <span class="k">def</span> <span class="nf">astype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>    <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>    <span class="n">torch_type</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">complex128</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">complex128</span><span class="p">,</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span>  <span class="c1"># No uint16, uint32, uint64.</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">int16</span><span class="p">,</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">,</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>    <span class="p">}[</span><span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">type</span><span class="p">]</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">torch_type</span><span class="p">)</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>  <span class="k">def</span> <span class="nf">clip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">low</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">high</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">_arr_astype</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span> <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">array</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>    <span class="k">return</span> <span class="n">array</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>  <span class="k">def</span> <span class="nf">square</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">square</span><span class="p">()</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>  <span class="k">def</span> <span class="nf">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>  <span class="k">def</span> <span class="nf">gather</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>    <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>    <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">table</span><span class="p">)[</span><span class="n">indices</span><span class="o">.</span><span class="n">type</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">int64</span><span class="p">)]</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>  <span class="k">def</span> <span class="nf">where</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">if_true</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">if_false</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>    <span class="n">condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">array</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>    <span class="k">return</span> <span class="n">if_true</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">if_false</span><span class="p">)</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>  <span class="k">def</span> <span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>    <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">axes</span><span class="p">))</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>  <span class="k">def</span> <span class="nf">concatenate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">arrays</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">_Array</span><span class="p">],</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>    <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">arrays</span><span class="p">),</span> <span class="n">axis</span><span class="p">)</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a><span class="k">def</span> <span class="nf">_as_arr</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Arraylib</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>  <span class="sd">&quot;&quot;&quot;Return array wrapped as an `_Arraylib` for dispatch of functions.&quot;&quot;&quot;</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>  <span class="k">for</span> <span class="n">class_</span> <span class="ow">in</span> <span class="n">ARRAYLIBS</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>    <span class="k">if</span> <span class="n">class_</span><span class="o">.</span><span class="n">recognize</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>      <span class="k">return</span> <span class="n">class_</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>  <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>      <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">array</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s1"> unrecognized by </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">ARRAYLIBS</span><span class="p">)</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a><span class="k">def</span> <span class="nf">_arr_arraylib</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>  <span class="sd">&quot;&quot;&quot;Return the name of the arraylib representing the array.&quot;&quot;&quot;</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>  <span class="k">return</span> <span class="n">_as_arr</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">arraylib</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a><span class="k">def</span> <span class="nf">_arr_numpy</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>  <span class="sd">&quot;&quot;&quot;Return a `numpy` version of this array.&quot;&quot;&quot;</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>  <span class="k">return</span> <span class="n">_as_arr</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="k">def</span> <span class="nf">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_DType</span><span class="p">:</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>  <span class="sd">&quot;&quot;&quot;Return the numpy dtype of the array.&quot;&quot;&quot;</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>  <span class="k">return</span> <span class="n">_as_arr</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span><span class="p">()</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a><span class="k">def</span> <span class="nf">_arr_astype</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>  <span class="sd">&quot;&quot;&quot;Return the array with values cast as numpy dtype.&quot;&quot;&quot;</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>  <span class="k">return</span> <span class="n">_as_arr</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a><span class="k">def</span> <span class="nf">_arr_clip</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">low</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">high</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>  <span class="sd">&quot;&quot;&quot;Return the array with values clipped to the range [low, high].&quot;&quot;&quot;</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>  <span class="k">return</span> <span class="n">_as_arr</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a><span class="k">def</span> <span class="nf">_arr_square</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>  <span class="sd">&quot;&quot;&quot;Return a new array with values squared.&quot;&quot;&quot;</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>  <span class="k">return</span> <span class="n">_as_arr</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">square</span><span class="p">()</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a><span class="k">def</span> <span class="nf">_arr_sqrt</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>  <span class="sd">&quot;&quot;&quot;Return a new array with values square-rooted.&quot;&quot;&quot;</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>  <span class="k">return</span> <span class="n">_as_arr</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">sqrt</span><span class="p">()</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a><span class="k">def</span> <span class="nf">_arr_gather</span><span class="p">(</span><span class="n">table</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">indices</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>  <span class="sd">&quot;&quot;&quot;Return `table[indices]`.&quot;&quot;&quot;</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>  <span class="k">return</span> <span class="n">_as_arr</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a><span class="k">def</span> <span class="nf">_arr_where</span><span class="p">(</span><span class="n">condition</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">if_true</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">if_false</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>  <span class="sd">&quot;&quot;&quot;Return `where(condition, if_true, if_false)`.&quot;&quot;&quot;</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>  <span class="k">return</span> <span class="n">_as_arr</span><span class="p">(</span><span class="n">condition</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">if_true</span><span class="p">,</span> <span class="n">if_false</span><span class="p">)</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a><span class="k">def</span> <span class="nf">_arr_transpose</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">axes</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>  <span class="sd">&quot;&quot;&quot;Return the array with its axes permuted.&quot;&quot;&quot;</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>  <span class="k">return</span> <span class="n">_as_arr</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a><span class="k">def</span> <span class="nf">_arr_concatenate</span><span class="p">(</span><span class="n">arrays</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>  <span class="sd">&quot;&quot;&quot;Return the concatenation of arrays.&quot;&quot;&quot;</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>  <span class="k">return</span> <span class="n">_as_arr</span><span class="p">(</span><span class="n">arrays</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">arrays</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a><span class="k">def</span> <span class="nf">_arr_swapaxes</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">axis0</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">axis1</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>  <span class="sd">&quot;&quot;&quot;Return the array with its axes swapped.&quot;&quot;&quot;</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>  <span class="n">ndim</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>  <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">axis0</span> <span class="o">&lt;</span> <span class="n">ndim</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">axis1</span> <span class="o">&lt;</span> <span class="n">ndim</span><span class="p">,</span> <span class="p">(</span><span class="n">axis0</span><span class="p">,</span> <span class="n">axis1</span><span class="p">,</span> <span class="n">ndim</span><span class="p">)</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>  <span class="n">axes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">ndim</span><span class="p">))</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>  <span class="n">axes</span><span class="p">[</span><span class="n">axis0</span><span class="p">]</span> <span class="o">=</span> <span class="n">axis1</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>  <span class="n">axes</span><span class="p">[</span><span class="n">axis1</span><span class="p">]</span> <span class="o">=</span> <span class="n">axis0</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>  <span class="k">return</span> <span class="n">_arr_transpose</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">axes</span><span class="p">)</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a><span class="k">def</span> <span class="nf">_make_array</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">arraylib</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>  <span class="sd">&quot;&quot;&quot;Create an array defined in the library `arraylib`.&quot;&quot;&quot;</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>  <span class="k">return</span> <span class="n">ARRAYLIBS</span><span class="p">[</span><span class="n">arraylib</span><span class="p">](</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">array</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a><span class="n">ARRAYLIBS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>    <span class="s1">&#39;numpy&#39;</span><span class="p">:</span> <span class="n">_NumpyArraylib</span><span class="p">,</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>    <span class="s1">&#39;tensorflow&#39;</span><span class="p">:</span> <span class="n">_TensorflowArraylib</span><span class="p">,</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>    <span class="s1">&#39;torch&#39;</span><span class="p">:</span> <span class="n">_TorchArraylib</span><span class="p">,</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a><span class="p">}</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="sd">&quot;&quot;&quot;Supported array libraries (&#39;numpy&#39;, &#39;tensorflow&#39;, and &#39;torch&#39;).&quot;&quot;&quot;</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a><span class="k">def</span> <span class="nf">_block_shape_with_min_size</span><span class="p">(</span><span class="n">shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">],</span> <span class="n">min_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>                               <span class="n">compact</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>  <span class="sd">&quot;&quot;&quot;Return shape of block (of size at least `min_size`) to subdivide shape.&quot;&quot;&quot;</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">min_size</span><span class="p">:</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Shape </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s1"> smaller than min_size </span><span class="si">{</span><span class="n">min_size</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>  <span class="k">if</span> <span class="n">compact</span><span class="p">:</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>    <span class="n">root</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">min_size</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))))</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>    <span class="n">block_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">shape</span><span class="p">,</span> <span class="n">root</span><span class="p">)</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)):</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>      <span class="k">if</span> <span class="n">block_shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">block_shape</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">min_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>        <span class="n">block_shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>      <span class="k">if</span> <span class="n">block_shape</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">min_size</span><span class="p">:</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>        <span class="n">block_shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>    <span class="n">block_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>      <span class="k">if</span> <span class="n">block_shape</span><span class="o">.</span><span class="n">prod</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">min_size</span><span class="p">:</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>        <span class="n">block_shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">min_size</span> <span class="o">/</span> <span class="n">block_shape</span><span class="o">.</span><span class="n">prod</span><span class="p">()))</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>  <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">block_shape</span><span class="p">)</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a><span class="k">def</span> <span class="nf">_array_split</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num_sections</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>  <span class="sd">&quot;&quot;&quot;Split `array` into `num_sections` along `axis`.&quot;&quot;&quot;</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>  <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">axis</span> <span class="o">&lt;</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>  <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">num_sections</span> <span class="o">&lt;=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>  <span class="k">if</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>    <span class="n">split</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">num_sections</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>  <span class="c1"># Numpy-specific.</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>    <span class="c1"># Adapted from https://github.com/numpy/numpy/blob/main/numpy/lib/shape_base.py#L739-L792.</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>    <span class="n">num_total</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>    <span class="n">num_each</span><span class="p">,</span> <span class="n">num_extra</span> <span class="o">=</span> <span class="nb">divmod</span><span class="p">(</span><span class="n">num_total</span><span class="p">,</span> <span class="n">num_sections</span><span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>    <span class="n">section_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">num_extra</span> <span class="o">*</span> <span class="p">[</span><span class="n">num_each</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">num_sections</span> <span class="o">-</span> <span class="n">num_extra</span><span class="p">)</span> <span class="o">*</span> <span class="p">[</span><span class="n">num_each</span><span class="p">]</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>    <span class="n">div_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">section_sizes</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>    <span class="n">split</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>    <span class="n">tmp</span> <span class="o">=</span> <span class="n">_arr_swapaxes</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_sections</span><span class="p">):</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>      <span class="n">split</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_arr_swapaxes</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="n">div_points</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span><span class="n">div_points</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">axis</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>  <span class="k">return</span> <span class="n">split</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="k">def</span> <span class="nf">_split_array_into_blocks</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">block_shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>                             <span class="n">start_axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>  <span class="sd">&quot;&quot;&quot;Split an array into nested lists of blocks of size at most block_shape.&quot;&quot;&quot;</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>  <span class="c1"># See https://stackoverflow.com/a/50305924.  (If the block_shape is known to</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>  <span class="c1"># exactly partition the array, see https://stackoverflow.com/a/16858283.)</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">block_shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span><span class="p">:</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Block ndim </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">block_shape</span><span class="p">)</span><span class="si">}</span><span class="s1"> &gt; array ndim </span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>  <span class="k">if</span> <span class="n">start_axis</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">block_shape</span><span class="p">):</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>    <span class="k">return</span> <span class="n">array</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>  <span class="n">num_sections</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">start_axis</span><span class="p">]</span> <span class="o">/</span> <span class="n">block_shape</span><span class="p">[</span><span class="n">start_axis</span><span class="p">])</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>  <span class="n">split</span> <span class="o">=</span> <span class="n">_array_split</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">start_axis</span><span class="p">,</span> <span class="n">num_sections</span><span class="p">)</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>  <span class="k">return</span> <span class="p">[</span><span class="n">_split_array_into_blocks</span><span class="p">(</span><span class="n">split_a</span><span class="p">,</span> <span class="n">block_shape</span><span class="p">,</span> <span class="n">start_axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">split_a</span> <span class="ow">in</span> <span class="n">split</span><span class="p">]</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a><span class="k">def</span> <span class="nf">_map_function_over_blocks</span><span class="p">(</span><span class="n">blocks</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Any</span><span class="p">],</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>  <span class="sd">&quot;&quot;&quot;Apply `func` to each block in the nested lists of blocks.&quot;&quot;&quot;</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>    <span class="k">return</span> <span class="p">[</span><span class="n">_map_function_over_blocks</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">func</span><span class="p">)</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">]</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>  <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">blocks</span><span class="p">)</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a><span class="k">def</span> <span class="nf">_merge_array_from_blocks</span><span class="p">(</span><span class="n">blocks</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>  <span class="sd">&quot;&quot;&quot;Merge an array from nested lists of array blocks.&quot;&quot;&quot;</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>  <span class="c1"># More general than np.block() because the blocks can have additional dims.</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">blocks</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>    <span class="n">new_blocks</span> <span class="o">=</span> <span class="p">[</span><span class="n">_merge_array_from_blocks</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">axis</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">]</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>    <span class="k">return</span> <span class="n">_arr_concatenate</span><span class="p">(</span><span class="n">new_blocks</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>  <span class="k">return</span> <span class="n">blocks</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a><span class="k">class</span> <span class="nc">Gridtype</span><span class="p">:</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>  <span class="sd">&quot;&quot;&quot;Abstract base class for grid-types such as &#39;dual&#39; and &#39;primal&#39;.</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a><span class="sd">  In resampling operations, the grid-type may be specified separately as `src_gridtype` for the</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a><span class="sd">  source domain and `dst_gridtype` for the destination domain.  Moreover, the grid-type may be</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a><span class="sd">  specified per domain dimension.</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a><span class="sd">  Examples:</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a><span class="sd">    `resize(source, shape, gridtype=&#39;primal&#39;)`  # Sets both src and dst.</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a><span class="sd">    `resize(source, shape, src_gridtype=[&#39;dual&#39;, &#39;primal&#39;],</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="sd">           dst_gridtype=&#39;dual&#39;)`  # Source is dual in dim0 and primal in dim1.</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>  <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>  <span class="sd">&quot;&quot;&quot;Gridtype name.&quot;&quot;&quot;</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>  <span class="k">def</span> <span class="nf">min_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>    <span class="sd">&quot;&quot;&quot;Return the necessary minimum number of grid samples.&quot;&quot;&quot;</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>  <span class="k">def</span> <span class="nf">size_in_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>    <span class="sd">&quot;&quot;&quot;Return the size of the domain in units of inter-sample spacing.&quot;&quot;&quot;</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>  <span class="k">def</span> <span class="nf">point_from_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>    <span class="sd">&quot;&quot;&quot;Return [0.0, 1.0] coordinates given [0, size - 1] indices.&quot;&quot;&quot;</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>  <span class="k">def</span> <span class="nf">index_from_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>    <span class="sd">&quot;&quot;&quot;Return location x given coordinates [0.0, 1.0], where x == 0.0 is the</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a><span class="sd">    first grid sample and x == size - 1.0 is the last grid sample.&quot;&quot;&quot;</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>  <span class="k">def</span> <span class="nf">reflect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>    <span class="sd">&quot;&quot;&quot;Map integer sample indices to interior ones using boundary reflection.&quot;&quot;&quot;</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>  <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>    <span class="sd">&quot;&quot;&quot;Map integer sample indices to interior ones using wrapping.&quot;&quot;&quot;</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>  <span class="k">def</span> <span class="nf">reflect_clamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>    <span class="sd">&quot;&quot;&quot;Map integer sample indices to interior ones using reflect-clamp.&quot;&quot;&quot;</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="k">class</span> <span class="nc">DualGridtype</span><span class="p">(</span><span class="n">Gridtype</span><span class="p">):</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>  <span class="sd">&quot;&quot;&quot;Samples are at the center of cells in a uniform partition of the domain.</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a><span class="sd">  For a unit-domain dimension with N samples, each sample 0 &lt;= i &lt;= N has position (i + 0.5) / N,</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a><span class="sd">  e.g., [0.125, 0.375, 0.625, 0.875] for N = 4.</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;dual&#39;</span><span class="p">)</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>  <span class="k">def</span> <span class="nf">min_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>    <span class="k">return</span> <span class="mi">1</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>  <span class="k">def</span> <span class="nf">size_in_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>    <span class="k">return</span> <span class="n">size</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>  <span class="k">def</span> <span class="nf">point_from_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="n">size</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>  <span class="k">def</span> <span class="nf">index_from_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>    <span class="k">return</span> <span class="n">point</span> <span class="o">*</span> <span class="n">size</span> <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>  <span class="k">def</span> <span class="nf">reflect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">index</span><span class="p">)</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>  <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>  <span class="k">def</span> <span class="nf">reflect_clamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="p">),</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a><span class="k">class</span> <span class="nc">PrimalGridtype</span><span class="p">(</span><span class="n">Gridtype</span><span class="p">):</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>  <span class="sd">&quot;&quot;&quot;Samples are at the vertices of cells in a uniform partition of the domain.</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a><span class="sd">  For a unit-domain dimension with N samples, each sample 0 &lt;= i &lt;= N has position i / (N - 1),</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a><span class="sd">  e.g., [0, 1/3, 2/3, 1] for N = 4.</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;primal&#39;</span><span class="p">)</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>  <span class="k">def</span> <span class="nf">min_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>    <span class="k">return</span> <span class="mi">2</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>  <span class="k">def</span> <span class="nf">size_in_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>    <span class="k">return</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>  <span class="k">def</span> <span class="nf">point_from_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>    <span class="k">return</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>  <span class="k">def</span> <span class="nf">index_from_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>    <span class="k">return</span> <span class="n">point</span> <span class="o">*</span> <span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>  <span class="k">def</span> <span class="nf">reflect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">index</span><span class="p">)</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>  <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>  <span class="k">def</span> <span class="nf">reflect_clamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a><span class="n">GRIDTYPES</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>    <span class="s1">&#39;dual&#39;</span><span class="p">:</span> <span class="n">DualGridtype</span><span class="p">(),</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>    <span class="s1">&#39;primal&#39;</span><span class="p">:</span> <span class="n">PrimalGridtype</span><span class="p">(),</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a><span class="p">}</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a><span class="sd">&quot;&quot;&quot;Shortcut names for some predefined grid types, specified per dimension.</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a><span class="sd">The two entries are &#39;dual&#39; and &#39;primal&#39;.&quot;&quot;&quot;</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a><span class="k">def</span> <span class="nf">_get_gridtypes</span><span class="p">(</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>    <span class="n">gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">],</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>    <span class="n">src_gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]]],</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>    <span class="n">dst_gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]]],</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>    <span class="n">src_ndim</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dst_ndim</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Gridtype</span><span class="p">],</span> <span class="n">List</span><span class="p">[</span><span class="n">Gridtype</span><span class="p">]]:</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>  <span class="sd">&quot;&quot;&quot;Return per-dim source and destination grid types given all parameters.&quot;&quot;&quot;</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>  <span class="k">if</span> <span class="n">gridtype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">src_gridtype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dst_gridtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>    <span class="n">gridtype</span> <span class="o">=</span> <span class="s1">&#39;dual&#39;</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>  <span class="k">if</span> <span class="n">gridtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>    <span class="k">if</span> <span class="n">src_gridtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot have both gridtype and src_gridtype.&#39;</span><span class="p">)</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>    <span class="k">if</span> <span class="n">dst_gridtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot have both gridtype and dst_gridtype.&#39;</span><span class="p">)</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>    <span class="n">src_gridtype</span> <span class="o">=</span> <span class="n">dst_gridtype</span> <span class="o">=</span> <span class="n">gridtype</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>  <span class="n">src_gridtype2</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">)</span> <span class="k">else</span> <span class="n">GRIDTYPES</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>                   <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">src_gridtype</span><span class="p">),</span> <span class="n">src_ndim</span><span class="p">)]</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>  <span class="n">dst_gridtype2</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">)</span> <span class="k">else</span> <span class="n">GRIDTYPES</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>                   <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dst_gridtype</span><span class="p">),</span> <span class="n">dst_ndim</span><span class="p">)]</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>  <span class="k">return</span> <span class="n">src_gridtype2</span><span class="p">,</span> <span class="n">dst_gridtype2</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a><span class="k">class</span> <span class="nc">RemapCoordinates</span><span class="p">:</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>  <span class="sd">&quot;&quot;&quot;Abstract base class for modifying the specified coordinates prior to evaluating the</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">  reconstruction kernels.&quot;&quot;&quot;</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>    <span class="k">pass</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a><span class="k">class</span> <span class="nc">NoRemapCoordinates</span><span class="p">(</span><span class="n">RemapCoordinates</span><span class="p">):</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>  <span class="sd">&quot;&quot;&quot;The coordinates are not remapped.&quot;&quot;&quot;</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>    <span class="k">return</span> <span class="n">point</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="k">class</span> <span class="nc">MirrorRemapCoordinates</span><span class="p">(</span><span class="n">RemapCoordinates</span><span class="p">):</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>  <span class="sd">&quot;&quot;&quot;The coordinates are reflected across the domain boundaries so that they lie in the unit</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">  interval.  The resulting function is continuous but not smooth across the boundaries.&quot;&quot;&quot;</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>    <span class="n">point</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">)</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">point</span> <span class="o">&gt;=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span> <span class="o">-</span> <span class="n">point</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a><span class="k">class</span> <span class="nc">TileRemapCoordinates</span><span class="p">(</span><span class="n">RemapCoordinates</span><span class="p">):</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>  <span class="sd">&quot;&quot;&quot;The coordinates are mapped to the unit interval using a &quot;modulo 1.0&quot; operation.  The resulting</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="sd">  function is generally discontinuous across the domain boundaries.&quot;&quot;&quot;</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="k">class</span> <span class="nc">ExtendSamples</span><span class="p">:</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>  <span class="sd">&quot;&quot;&quot;Abstract base class for replacing references to grid samples exterior to the unit domain by</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a><span class="sd">  affine combinations of interior sample(s) and possibly the constant value (cval).&quot;&quot;&quot;</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>  <span class="n">uses_cval</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>  <span class="sd">&quot;&quot;&quot;True if some exterior samples are defined in terms of `cval`, i.e., if the computed weight</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="sd">  is non-affine.&quot;&quot;&quot;</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>               <span class="n">gridtype</span><span class="p">:</span> <span class="n">Gridtype</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_NDArray</span><span class="p">,</span> <span class="n">_NDArray</span><span class="p">]:</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>    <span class="sd">&quot;&quot;&quot;Detect references to exterior samples, i.e., entries of `index` that lie outside the</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a><span class="sd">    interval [0, size), and update these indices (and possibly their associated weights) to</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="sd">    reference only interior samples.  Return `new_index, new_weight`.&quot;&quot;&quot;</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a><span class="k">class</span> <span class="nc">ReflectExtendSamples</span><span class="p">(</span><span class="n">ExtendSamples</span><span class="p">):</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>  <span class="sd">&quot;&quot;&quot;Find the interior sample by reflecting across domain boundaries.&quot;&quot;&quot;</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>               <span class="n">gridtype</span><span class="p">:</span> <span class="n">Gridtype</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_NDArray</span><span class="p">,</span> <span class="n">_NDArray</span><span class="p">]:</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>    <span class="n">index</span> <span class="o">=</span> <span class="n">gridtype</span><span class="o">.</span><span class="n">reflect</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>    <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a><span class="k">class</span> <span class="nc">WrapExtendSamples</span><span class="p">(</span><span class="n">ExtendSamples</span><span class="p">):</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>  <span class="sd">&quot;&quot;&quot;Wrap the interior samples periodically.  For a &#39;primal&#39; grid, the last</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a><span class="sd">  sample is ignored as its value is replaced by the first sample.&quot;&quot;&quot;</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>               <span class="n">gridtype</span><span class="p">:</span> <span class="n">Gridtype</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_NDArray</span><span class="p">,</span> <span class="n">_NDArray</span><span class="p">]:</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>    <span class="n">index</span> <span class="o">=</span> <span class="n">gridtype</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>    <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a><span class="k">class</span> <span class="nc">ClampExtendSamples</span><span class="p">(</span><span class="n">ExtendSamples</span><span class="p">):</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>  <span class="sd">&quot;&quot;&quot;Use the nearest interior sample.&quot;&quot;&quot;</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>               <span class="n">gridtype</span><span class="p">:</span> <span class="n">Gridtype</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_NDArray</span><span class="p">,</span> <span class="n">_NDArray</span><span class="p">]:</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>    <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>    <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a><span class="k">class</span> <span class="nc">ReflectClampExtendSamples</span><span class="p">(</span><span class="n">ExtendSamples</span><span class="p">):</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>  <span class="sd">&quot;&quot;&quot;Extend the grid samples from [0, 1] into [-1, 0] using reflection and then define grid</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a><span class="sd">  samples outside [-1, 1] as that of the nearest sample.&quot;&quot;&quot;</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>               <span class="n">gridtype</span><span class="p">:</span> <span class="n">Gridtype</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_NDArray</span><span class="p">,</span> <span class="n">_NDArray</span><span class="p">]:</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>    <span class="n">index</span> <span class="o">=</span> <span class="n">gridtype</span><span class="o">.</span><span class="n">reflect_clamp</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>    <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a><span class="k">class</span> <span class="nc">BorderExtendSamples</span><span class="p">(</span><span class="n">ExtendSamples</span><span class="p">):</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>  <span class="sd">&quot;&quot;&quot;Let all exterior samples have the constant value (`cval`).&quot;&quot;&quot;</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">uses_cval</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>               <span class="n">gridtype</span><span class="p">:</span> <span class="n">Gridtype</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_NDArray</span><span class="p">,</span> <span class="n">_NDArray</span><span class="p">]:</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>    <span class="n">low</span> <span class="o">=</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>    <span class="n">weight</span><span class="p">[</span><span class="n">low</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>    <span class="n">index</span><span class="p">[</span><span class="n">low</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>    <span class="n">high</span> <span class="o">=</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">size</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>    <span class="n">weight</span><span class="p">[</span><span class="n">high</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>    <span class="n">index</span><span class="p">[</span><span class="n">high</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>    <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="k">class</span> <span class="nc">ValidExtendSamples</span><span class="p">(</span><span class="n">ExtendSamples</span><span class="p">):</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>  <span class="sd">&quot;&quot;&quot;Assign all domain samples weight 1 and all outside samples weight 0.</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a><span class="sd">  Compute a weighted reconstruction and divide by the reconstructed weight.&quot;&quot;&quot;</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">uses_cval</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>               <span class="n">gridtype</span><span class="p">:</span> <span class="n">Gridtype</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_NDArray</span><span class="p">,</span> <span class="n">_NDArray</span><span class="p">]:</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>    <span class="n">low</span> <span class="o">=</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>    <span class="n">weight</span><span class="p">[</span><span class="n">low</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>    <span class="n">index</span><span class="p">[</span><span class="n">low</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>    <span class="n">high</span> <span class="o">=</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">size</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>    <span class="n">weight</span><span class="p">[</span><span class="n">high</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>    <span class="n">index</span><span class="p">[</span><span class="n">high</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>    <span class="n">sum_weight</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>    <span class="n">nonzero_sum</span> <span class="o">=</span> <span class="n">sum_weight</span> <span class="o">!=</span> <span class="mf">0.0</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>    <span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">sum_weight</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">out</span><span class="o">=</span><span class="n">weight</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">nonzero_sum</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>    <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a><span class="k">class</span> <span class="nc">LinearExtendSamples</span><span class="p">(</span><span class="n">ExtendSamples</span><span class="p">):</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>  <span class="sd">&quot;&quot;&quot;Linearly extrapolate beyond boundary samples.&quot;&quot;&quot;</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>               <span class="n">gridtype</span><span class="p">:</span> <span class="n">Gridtype</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_NDArray</span><span class="p">,</span> <span class="n">_NDArray</span><span class="p">]:</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>    <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>      <span class="n">index</span> <span class="o">=</span> <span class="n">gridtype</span><span class="o">.</span><span class="n">reflect</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>      <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>    <span class="c1"># For each boundary, define new columns in index and weight arrays to represent the last and</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>    <span class="c1"># next-to-last samples.  When we later construct the sparse resize matrix, we will sum the</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>    <span class="c1"># duplicate index entries.</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>    <span class="n">low</span> <span class="o">=</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>    <span class="n">high</span> <span class="o">=</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">size</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="o">*</span><span class="n">weight</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">weight</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">weight</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">index</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>    <span class="n">w</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>    <span class="n">w</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">index</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>    <span class="n">w</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>    <span class="n">w</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>    <span class="n">weight</span><span class="p">[</span><span class="n">low</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>    <span class="n">index</span><span class="p">[</span><span class="n">low</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>    <span class="n">weight</span><span class="p">[</span><span class="n">high</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>    <span class="n">index</span><span class="p">[</span><span class="n">high</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>    <span class="n">w</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>    <span class="n">weight</span> <span class="o">=</span> <span class="n">w</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>    <span class="n">new_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">index</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>    <span class="n">new_index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>    <span class="c1"># Let matrix (including zero values) be banded.</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>    <span class="n">new_index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>    <span class="n">index</span> <span class="o">=</span> <span class="n">new_index</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>    <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a><span class="k">class</span> <span class="nc">QuadraticExtendSamples</span><span class="p">(</span><span class="n">ExtendSamples</span><span class="p">):</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>  <span class="sd">&quot;&quot;&quot;Quadratically extrapolate beyond boundary samples.&quot;&quot;&quot;</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>               <span class="n">gridtype</span><span class="p">:</span> <span class="n">Gridtype</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_NDArray</span><span class="p">,</span> <span class="n">_NDArray</span><span class="p">]:</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>    <span class="c1"># [Keys 1981] suggests this as x[-1] = 3*x[0] - 3*x[1] + x[2], calling it &quot;cubic precision&quot;,</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>    <span class="c1"># but it seems just quadratic.</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>    <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>      <span class="n">index</span> <span class="o">=</span> <span class="n">gridtype</span><span class="o">.</span><span class="n">reflect</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>      <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>    <span class="n">low</span> <span class="o">=</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>    <span class="n">high</span> <span class="o">=</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="n">size</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>    <span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="o">*</span><span class="n">weight</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">weight</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">weight</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">index</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>    <span class="n">w</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">1.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>    <span class="n">w</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="o">-</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>    <span class="n">w</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">low</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">index</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>    <span class="n">w</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>    <span class="n">w</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="o">-</span><span class="n">x</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>    <span class="n">w</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(((</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">1.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">where</span><span class="o">=</span><span class="n">high</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>    <span class="n">weight</span><span class="p">[</span><span class="n">low</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>    <span class="n">index</span><span class="p">[</span><span class="n">low</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>    <span class="n">weight</span><span class="p">[</span><span class="n">high</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>    <span class="n">index</span><span class="p">[</span><span class="n">high</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>    <span class="n">w</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>    <span class="n">weight</span> <span class="o">=</span> <span class="n">w</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>    <span class="n">new_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">w</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">index</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>    <span class="n">new_index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">index</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>    <span class="c1"># Let matrix (including zero values) be banded.</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>    <span class="n">new_index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>        <span class="n">w</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="o">-</span><span class="mi">6</span><span class="p">:]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">3</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>    <span class="n">index</span> <span class="o">=</span> <span class="n">new_index</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>    <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a><span class="k">class</span> <span class="nc">OverrideExteriorValue</span><span class="p">:</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>  <span class="sd">&quot;&quot;&quot;Abstract base class to set the value outside some domain extent to a</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a><span class="sd">  constant value (`cval`).&quot;&quot;&quot;</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>  <span class="n">boundary_antialiasing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>  <span class="sd">&quot;&quot;&quot;Antialias the pixel values adjacent to the boundary of the extent.&quot;&quot;&quot;</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>  <span class="n">uses_cval</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>  <span class="sd">&quot;&quot;&quot;Modify some weights to introduce references to `cval` constant value.&quot;&quot;&quot;</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>    <span class="sd">&quot;&quot;&quot;For all `point` outside some extent, modify the weight to be zero.&quot;&quot;&quot;</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>  <span class="k">def</span> <span class="nf">override_using_signed_distance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>                                     <span class="n">signed_distance</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>    <span class="sd">&quot;&quot;&quot;Reduce sample weights for &quot;outside&quot; values based on the signed distance function,</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a><span class="sd">    to effectively assign the constant value `cval`.&quot;&quot;&quot;</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>    <span class="n">all_points_inside_domain</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">signed_distance</span> <span class="o">&lt;=</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>    <span class="k">if</span> <span class="n">all_points_inside_domain</span><span class="p">:</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>      <span class="k">return</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_antialiasing</span> <span class="ow">and</span> <span class="nb">min</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>      <span class="c1"># For discontinuous coordinate mappings, we may need to somehow ignore</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>      <span class="c1"># the large finite differences computed across the map discontinuities.</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>      <span class="n">gradient</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">gradient</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>      <span class="n">gradient_norm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_2d</span><span class="p">(</span><span class="n">gradient</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>      <span class="n">signed_distance_in_samples</span> <span class="o">=</span> <span class="n">signed_distance</span> <span class="o">/</span> <span class="p">(</span><span class="n">gradient_norm</span> <span class="o">+</span> <span class="mf">1e-20</span><span class="p">)</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>      <span class="c1"># Opacity is in linear space, which is correct if Gamma is set.</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>      <span class="n">opacity</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">-</span> <span class="n">signed_distance_in_samples</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>      <span class="n">weight</span> <span class="o">*=</span> <span class="n">opacity</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>      <span class="n">is_outside</span> <span class="o">=</span> <span class="n">signed_distance</span> <span class="o">&gt;</span> <span class="mf">0.0</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>      <span class="n">weight</span><span class="p">[</span><span class="n">is_outside</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="mf">0.0</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a><span class="k">class</span> <span class="nc">NoOverrideExteriorValue</span><span class="p">(</span><span class="n">OverrideExteriorValue</span><span class="p">):</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>  <span class="sd">&quot;&quot;&quot;The function value is not overridden.&quot;&quot;&quot;</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>    <span class="k">pass</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="k">class</span> <span class="nc">UnitDomainOverrideExteriorValue</span><span class="p">(</span><span class="n">OverrideExteriorValue</span><span class="p">):</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>  <span class="sd">&quot;&quot;&quot;Values outside the unit interval [0, 1] are replaced by constant `cval`.&quot;&quot;&quot;</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">uses_cval</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>    <span class="n">signed_distance</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">point</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.5</span>  <span class="c1"># Boundaries at 0.0 and 1.0.</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">override_using_signed_distance</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">signed_distance</span><span class="p">)</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a><span class="k">class</span> <span class="nc">PlusMinusOneOverrideExteriorValue</span><span class="p">(</span><span class="n">OverrideExteriorValue</span><span class="p">):</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>  <span class="sd">&quot;&quot;&quot;Values outside the interval [-1, 1] are replaced by the constant `cval`.&quot;&quot;&quot;</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">uses_cval</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>    <span class="n">signed_distance</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">point</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0</span>  <span class="c1"># Boundaries at -1.0 and 1.0.</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">override_using_signed_distance</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">point</span><span class="p">,</span> <span class="n">signed_distance</span><span class="p">)</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="k">class</span> <span class="nc">Boundary</span><span class="p">:</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>  <span class="sd">&quot;&quot;&quot;Domain boundary rules.  These define the reconstruction over the source domain near and beyond</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a><span class="sd">  the domain boundaries.  The rules may be specified separately for each domain dimension.&quot;&quot;&quot;</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>  <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>  <span class="sd">&quot;&quot;&quot;Boundary rule name.&quot;&quot;&quot;</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>  <span class="n">coord_remap</span><span class="p">:</span> <span class="n">RemapCoordinates</span> <span class="o">=</span> <span class="n">NoRemapCoordinates</span><span class="p">()</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>  <span class="sd">&quot;&quot;&quot;Modify specified coordinates prior to evaluating the reconstruction kernels.&quot;&quot;&quot;</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>  <span class="n">extend_samples</span><span class="p">:</span> <span class="n">ExtendSamples</span> <span class="o">=</span> <span class="n">ReflectExtendSamples</span><span class="p">()</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>  <span class="sd">&quot;&quot;&quot;Define the value of each grid sample outside the unit domain as an affine combination of</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a><span class="sd">  interior sample(s) and possibly the constant value (cval).&quot;&quot;&quot;</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>  <span class="n">override_value</span><span class="p">:</span> <span class="n">OverrideExteriorValue</span> <span class="o">=</span> <span class="n">NoOverrideExteriorValue</span><span class="p">()</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>  <span class="sd">&quot;&quot;&quot;Set the value outside some extent to a constant value (cval).&quot;&quot;&quot;</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>  <span class="n">uses_cval</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>  <span class="sd">&quot;&quot;&quot;True if weights may be non-affine, involving the constant value (cval).&quot;&quot;&quot;</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>  <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">uses_cval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extend_samples</span><span class="o">.</span><span class="n">uses_cval</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">override_value</span><span class="o">.</span><span class="n">uses_cval</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>  <span class="k">def</span> <span class="nf">preprocess_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>    <span class="sd">&quot;&quot;&quot;Modify coordinates prior to evaluating the filter kernels.&quot;&quot;&quot;</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>    <span class="c1"># Antialiasing across the tile boundaries may be feasible but seems hard.</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>    <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_remap</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>    <span class="k">return</span> <span class="n">point</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>  <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>            <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">gridtype</span><span class="p">:</span> <span class="n">Gridtype</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_NDArray</span><span class="p">,</span> <span class="n">_NDArray</span><span class="p">]:</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>    <span class="sd">&quot;&quot;&quot;Replace exterior samples by combinations of interior samples.&quot;&quot;&quot;</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>    <span class="n">index</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extend_samples</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">gridtype</span><span class="p">)</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">override_reconstruction</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>    <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>  <span class="k">def</span> <span class="nf">override_reconstruction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>    <span class="sd">&quot;&quot;&quot;For points outside an extent, modify weight to zero to assign `cval`.&quot;&quot;&quot;</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">override_value</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a><span class="n">_OFTUSED_BOUNDARIES</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>    <span class="s1">&#39;reflect&#39;</span><span class="p">:</span>  <span class="c1"># (a.k.a. reflected, symm, symmetric, mirror, grid-mirror.)</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>        <span class="n">Boundary</span><span class="p">(</span><span class="s1">&#39;reflect&#39;</span><span class="p">,</span> <span class="n">extend_samples</span><span class="o">=</span><span class="n">ReflectExtendSamples</span><span class="p">()),</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>    <span class="s1">&#39;wrap&#39;</span><span class="p">:</span>  <span class="c1"># (a.k.a. periodic, repeat, grid-wrap.)</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>        <span class="n">Boundary</span><span class="p">(</span><span class="s1">&#39;wrap&#39;</span><span class="p">,</span> <span class="n">extend_samples</span><span class="o">=</span><span class="n">WrapExtendSamples</span><span class="p">()),</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>    <span class="s1">&#39;tile&#39;</span><span class="p">:</span>  <span class="c1"># (a.k.a. wrap.)</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>        <span class="n">Boundary</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="n">coord_remap</span><span class="o">=</span><span class="n">TileRemapCoordinates</span><span class="p">(),</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>                 <span class="n">extend_samples</span><span class="o">=</span><span class="n">ReflectExtendSamples</span><span class="p">()),</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>    <span class="s1">&#39;clamp&#39;</span><span class="p">:</span>  <span class="c1"># (a.k.a. clamped, nearest, edge, clamp-to-edge.)</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>        <span class="n">Boundary</span><span class="p">(</span><span class="s1">&#39;clamp&#39;</span><span class="p">,</span> <span class="n">extend_samples</span><span class="o">=</span><span class="n">ClampExtendSamples</span><span class="p">()),</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>    <span class="s1">&#39;border&#39;</span><span class="p">:</span>  <span class="c1"># (a.k.a. grid-constant.)</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>        <span class="n">Boundary</span><span class="p">(</span><span class="s1">&#39;border&#39;</span><span class="p">,</span> <span class="n">extend_samples</span><span class="o">=</span><span class="n">BorderExtendSamples</span><span class="p">()),</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>    <span class="s1">&#39;natural&#39;</span><span class="p">:</span>  <span class="c1"># (a.k.a. IgnoreOutside, renormalize.)</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>        <span class="n">Boundary</span><span class="p">(</span><span class="s1">&#39;natural&#39;</span><span class="p">,</span> <span class="n">extend_samples</span><span class="o">=</span><span class="n">ValidExtendSamples</span><span class="p">(),</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>                 <span class="n">override_value</span><span class="o">=</span><span class="n">UnitDomainOverrideExteriorValue</span><span class="p">()),</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>    <span class="s1">&#39;linear_constant&#39;</span><span class="p">:</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>        <span class="n">Boundary</span><span class="p">(</span><span class="s1">&#39;linear_constant&#39;</span><span class="p">,</span> <span class="n">extend_samples</span><span class="o">=</span><span class="n">LinearExtendSamples</span><span class="p">(),</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>                 <span class="n">override_value</span><span class="o">=</span><span class="n">UnitDomainOverrideExteriorValue</span><span class="p">()),</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>    <span class="s1">&#39;quadratic_constant&#39;</span><span class="p">:</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>        <span class="n">Boundary</span><span class="p">(</span><span class="s1">&#39;quadratic_constant&#39;</span><span class="p">,</span> <span class="n">extend_samples</span><span class="o">=</span><span class="n">QuadraticExtendSamples</span><span class="p">(),</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>                 <span class="n">override_value</span><span class="o">=</span><span class="n">UnitDomainOverrideExteriorValue</span><span class="p">()),</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a><span class="p">}</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a><span class="sd">&quot;&quot;&quot;A useful subset of `BOUNDARIES` for visualization in figures.&quot;&quot;&quot;</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a><span class="n">_ADDITIONAL_BOUNDARIES</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>    <span class="s1">&#39;reflect_clamp&#39;</span><span class="p">:</span>  <span class="c1"># (a.k.a. mirror-clamp-to-edge)</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>        <span class="n">Boundary</span><span class="p">(</span><span class="s1">&#39;reflect_clamp&#39;</span><span class="p">,</span> <span class="n">extend_samples</span><span class="o">=</span><span class="n">ReflectClampExtendSamples</span><span class="p">()),</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>    <span class="s1">&#39;constant&#39;</span><span class="p">:</span>  <span class="c1"># (a.k.a. constant, reflect-constant.)</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>        <span class="n">Boundary</span><span class="p">(</span><span class="s1">&#39;constant&#39;</span><span class="p">,</span> <span class="n">extend_samples</span><span class="o">=</span><span class="n">ReflectExtendSamples</span><span class="p">(),</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>                 <span class="n">override_value</span><span class="o">=</span><span class="n">UnitDomainOverrideExteriorValue</span><span class="p">()),</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>    <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>        <span class="n">Boundary</span><span class="p">(</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">extend_samples</span><span class="o">=</span><span class="n">LinearExtendSamples</span><span class="p">()),</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>    <span class="s1">&#39;quadratic&#39;</span><span class="p">:</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>        <span class="n">Boundary</span><span class="p">(</span><span class="s1">&#39;quadratic&#39;</span><span class="p">,</span> <span class="n">extend_samples</span><span class="o">=</span><span class="n">QuadraticExtendSamples</span><span class="p">()),</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a><span class="p">}</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a><span class="n">BOUNDARIES</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Boundary</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">_OFTUSED_BOUNDARIES</span><span class="p">,</span> <span class="o">**</span><span class="n">_ADDITIONAL_BOUNDARIES</span><span class="p">}</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a><span class="sd">&quot;&quot;&quot;Shortcut names for some predefined boundary rules.</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a><span class="sd">Examples include: &#39;reflect&#39;, &#39;wrap&#39;, &#39;tile&#39;, &#39;clamp&#39;, &#39;border&#39;, etc.&quot;&quot;&quot;</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a><span class="k">class</span> <span class="nc">Filter</span><span class="p">:</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>  <span class="sd">&quot;&quot;&quot;Abstract base class for filter kernel functions.</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a><span class="sd">  Each kernel is assumed to be zero-phase filter, i.e., to be symmetric in a support</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a><span class="sd">  interval [-radius, radius].  (Some sites instead define kernels over the interval [0, N]</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a><span class="sd">  where N = 2 * radius.)</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a><span class="sd">  Portions of this code are adapted from the C++ library in</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a><span class="sd">  https://github.com/hhoppe/Mesh-processing-library/blob/master/libHh/Filter.cpp</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a><span class="sd">  See also http://hhoppe.com/proj/filtering/.</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>  <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>  <span class="sd">&quot;&quot;&quot;Filter kernel name.&quot;&quot;&quot;</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>  <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>  <span class="sd">&quot;&quot;&quot;Max absolute value of x for which self(x) is nonzero.&quot;&quot;&quot;</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>  <span class="n">interpolating</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>  <span class="sd">&quot;&quot;&quot;True if self(0) == 1.0 and self(i) == 0.0 for all nonzero integers i.&quot;&quot;&quot;</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>  <span class="n">continuous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>  <span class="sd">&quot;&quot;&quot;True if the kernel function has C^0 continuity.&quot;&quot;&quot;</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>  <span class="n">partition_of_unity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>  <span class="sd">&quot;&quot;&quot;True if the convolution of the kernel with a Dirac comb reproduces the</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a><span class="sd">  unity function.&quot;&quot;&quot;</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>  <span class="n">unit_integral</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>  <span class="sd">&quot;&quot;&quot;True if the integral of the kernel function is 1.&quot;&quot;&quot;</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>  <span class="n">requires_digital_filter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>  <span class="sd">&quot;&quot;&quot;True if the filter needs a pre/post digital filter for interpolation.&quot;&quot;&quot;</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>    <span class="sd">&quot;&quot;&quot;Return evaluation of filter kernel at locations x.&quot;&quot;&quot;</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a><span class="k">class</span> <span class="nc">ImpulseFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>  <span class="sd">&quot;&quot;&quot;See https://en.wikipedia.org/wiki/Dirac_delta_function.&quot;&quot;&quot;</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;impulse&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1e-20</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">partition_of_unity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;The Impulse is infinitely narrow, so cannot be directly evaluated.&#39;</span><span class="p">)</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a><span class="k">class</span> <span class="nc">BoxFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>  <span class="sd">&quot;&quot;&quot;See https://en.wikipedia.org/wiki/Box_function.</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a><span class="sd">  The kernel function has value 1.0 over the half-open interval [-.5, .5).</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>    <span class="c1"># An alternative definition is symmetric with values 0.5 at the endpoints:</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>    <span class="c1"># x = np.abs(x)</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>    <span class="c1"># return np.where(x &lt; 0.5, 1.0, np.where(x == 0.5, 0.5, 0.0))</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a><span class="k">class</span> <span class="nc">TrapezoidFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>  <span class="sd">&quot;&quot;&quot;Filter for antialiased &quot;area-based&quot; filtering.</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a><span class="sd">  Args:</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a><span class="sd">    radius: Specifies the support [-radius, radius] of filter, where 0.5 &lt; radius &lt;= 1.0.</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a><span class="sd">      The special case `radius = None` is a placeholder that indicates that the filter will be</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a><span class="sd">      replaced by a trapezoid of the appropriate radius (based on scaling) for correct</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a><span class="sd">      antialiasing in both minification and magnification.</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a><span class="sd">  This filter is similar to the BoxFilter but with linearly sloped sides.  It has value 1.0</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a><span class="sd">  in the interval abs(x) &lt;= 1.0 - radius and decreases linearly to value 0.0 in the interval</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a><span class="sd">  1.0 - radius &lt;= abs(x) &lt;= radius, always with value 0.5 at x = 0.5.</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>    <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;trapezoid&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>      <span class="k">return</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.5</span> <span class="o">&lt;</span> <span class="n">radius</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Radius </span><span class="si">{</span><span class="n">radius</span><span class="si">}</span><span class="s1"> is outside the range (0.5, 1.0].&#39;</span><span class="p">)</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;trapezoid_</span><span class="si">{</span><span class="n">radius</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">)</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>    <span class="k">assert</span> <span class="mf">0.5</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">&lt;=</span> <span class="mf">1.0</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>    <span class="k">return</span> <span class="p">((</span><span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.25</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a><span class="k">class</span> <span class="nc">TriangleFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>  <span class="sd">&quot;&quot;&quot;See https://en.wikipedia.org/wiki/Triangle_function.</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a><span class="sd">  Also known as the hat or tent function.  It is used for piecewise-linear</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a><span class="sd">  (or bilinear, or trilinear, ...) interpolation.</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;triangle&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>    <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a><span class="k">class</span> <span class="nc">CubicFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>  <span class="sd">&quot;&quot;&quot;Family of cubic filters parameterized by two scalar parameters.</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a><span class="sd">  Args:</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a><span class="sd">    b: first scalar parameter.</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a><span class="sd">    c: second scalar parameter.</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a><span class="sd">  See https://en.wikipedia.org/wiki/Mitchell%E2%80%93Netravali_filters and</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a><span class="sd">  https://doi.org/10.1145/378456.378514.</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">  [D. P. Mitchell and A. N. Netravali. Reconstruction filters in computer graphics.</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">  Computer Graphics (Proceedings of ACM SIGGRAPH 1988), 22(4):221-228, 1988.]</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a><span class="sd">  - The filter has quadratic precision iff b + 2 * c == 1.</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a><span class="sd">  - The filter is interpolating iff b == 0.</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a><span class="sd">  - (b=1, c=0) is the (non-interpolating) cubic B-spline basis;</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a><span class="sd">  - (b=1/3, c=1/3) is the Mitchell filter;</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a><span class="sd">  - (b=0, c=0.5) is the Catmull-Rom spline (which has cubic precision);</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a><span class="sd">  - (b=0, c=0.75) is the &quot;sharper cubic&quot; used in Photoshop and OpenCV.</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;cubic_b</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1">_c</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">name</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">interpolating</span><span class="o">=</span><span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>    <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>    <span class="n">f3</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">9</span><span class="o">/</span><span class="mi">6</span><span class="o">*</span><span class="n">b</span> <span class="o">-</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">b</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>    <span class="n">g3</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g0</span> <span class="o">=</span> <span class="o">-</span><span class="n">b</span><span class="o">/</span><span class="mi">6</span> <span class="o">-</span> <span class="n">c</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span> <span class="o">-</span> <span class="mi">8</span><span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="mi">8</span><span class="o">/</span><span class="mi">6</span><span class="o">*</span><span class="n">b</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">c</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>    <span class="c1"># (np.polynomial.polynomial.polyval(x, [f0, 0, f2, f3]) is almost</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>    <span class="c1"># twice as slow; see also https://stackoverflow.com/questions/24065904)</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>    <span class="n">v01</span> <span class="o">=</span> <span class="p">((</span><span class="n">f3</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">f2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">f0</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>    <span class="n">v12</span> <span class="o">=</span> <span class="p">((</span><span class="n">g3</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">g2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">g1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">g0</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">v01</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">v12</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a><span class="k">class</span> <span class="nc">CatmullRomFilter</span><span class="p">(</span><span class="n">CubicFilter</span><span class="p">):</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>  <span class="sd">&quot;&quot;&quot;Cubic filter with cubic precision.  Also known as Keys filter.</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a><span class="sd">  [E. Catmull, R. Rom.  A class of local interpolating splines.  Computer aided geometric</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a><span class="sd">  design, 1974]</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a><span class="sd">  [Wikipedia](https://en.wikipedia.org/wiki/Cubic_Hermite_spline#Catmull%E2%80%93Rom_spline)</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a><span class="sd">  [R. G. Keys.  Cubic convolution interpolation for digital image processing.</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a><span class="sd">  IEEE Trans. on Acoustics, Speech, and Signal Processing, 29(6), 1981.]</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a><span class="sd">  https://ieeexplore.ieee.org/document/1163711/.</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a><span class="k">class</span> <span class="nc">MitchellFilter</span><span class="p">(</span><span class="n">CubicFilter</span><span class="p">):</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>  <span class="sd">&quot;&quot;&quot;See https://doi.org/10.1145/378456.378514.</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a><span class="sd">  [D. P. Mitchell and A. N. Netravali.  Reconstruction filters in computer graphics.  Computer</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a><span class="sd">  Graphics (Proceedings of ACM SIGGRAPH 1988), 22(4):221-228, 1988.]</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mitchell&#39;</span><span class="p">)</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a><span class="k">class</span> <span class="nc">SharpCubicFilter</span><span class="p">(</span><span class="n">CubicFilter</span><span class="p">):</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>  <span class="sd">&quot;&quot;&quot;Cubic filter that is sharper than Catmull-Rom filter.</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a><span class="sd">  Used by some tools including OpenCV and Photoshop.</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a><span class="sd">  See https://en.wikipedia.org/wiki/Mitchell%E2%80%93Netravali_filters and</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a><span class="sd">  http://entropymine.com/resamplescope/notes/photoshop/.</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sharpcubic&#39;</span><span class="p">)</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a><span class="k">class</span> <span class="nc">LanczosFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>  <span class="sd">&quot;&quot;&quot;High-quality filter: sinc function modulated by a sinc window.</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a><span class="sd">  Args:</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a><span class="sd">    radius: Specifies support window [-radius, radius] over which filter is nonzero.</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a><span class="sd">    sampled: If True, use a discretized approximation for improved speed.</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a><span class="sd">  See https://en.wikipedia.org/wiki/Lanczos_kernel.</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sampled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;lanczos_</span><span class="si">{</span><span class="n">radius</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">partition_of_unity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>                     <span class="n">unit_integral</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>    <span class="nd">@_cache_sampled_1d_function</span><span class="p">(</span><span class="n">xmin</span><span class="o">=-</span><span class="n">radius</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="n">sampled</span><span class="p">)</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>    <span class="k">def</span> <span class="nf">_eval</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>      <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>      <span class="c1"># Note that window[n] = sinc(2*n/N - 1), with 0 &lt;= n &lt;= N.</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>      <span class="c1"># But, x = n - N/2, or equivalently, n = x + N/2, with -N/2 &lt;= x &lt;= N/2.</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>      <span class="n">window</span> <span class="o">=</span> <span class="n">_sinc</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">radius</span><span class="p">)</span>  <span class="c1"># Zero-phase function w_0(x).</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">radius</span><span class="p">,</span> <span class="n">_sinc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">window</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">_eval</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a><span class="k">class</span> <span class="nc">GeneralizedHammingFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>  <span class="sd">&quot;&quot;&quot;Sinc function modulated by a Hamming window.</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a><span class="sd">  Args:</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a><span class="sd">    radius: Specifies support window [-radius, radius] over which filter is nonzero.</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a><span class="sd">    a0: Scalar parameter, where 0.0 &lt; a0 &lt; 1.0.  The case of a0=0.5 is the Hann filter.</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a><span class="sd">  See https://en.wikipedia.org/wiki/Window_function#Hann_and_Hamming_windows,</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a><span class="sd">  and hamming() in https://github.com/scipy/scipy/blob/master/scipy/signal/windows/windows.py.</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a><span class="sd">  Generalized version of np.hamming() and np.hanning().</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">a0</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>        <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;hamming_</span><span class="si">{</span><span class="n">radius</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>        <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>        <span class="n">partition_of_unity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># 1:1.00242  av=1.00188  sd=0.00052909</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>        <span class="n">unit_integral</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>       <span class="c1"># 1.00188</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>    <span class="p">)</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>    <span class="k">assert</span> <span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">a0</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">a0</span> <span class="o">=</span> <span class="n">a0</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>    <span class="c1"># Note that window[n] = a0 - (1 - a0) * cos(2 * pi * n / N), 0 &lt;= n &lt;= N.</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>    <span class="c1"># With n = x + N/2, we get the zero-phase function w_0(x):</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>    <span class="n">window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a0</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">_sinc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">window</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a><span class="k">class</span> <span class="nc">KaiserFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>  <span class="sd">&quot;&quot;&quot;Sinc function modulated by a Kaiser-Bessel window.</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a><span class="sd">  See https://en.wikipedia.org/wiki/Kaiser_window, and example use in:</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a><span class="sd">  [Karras et al. 20201.  Alias-free generative adversarial networks.</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a><span class="sd">  https://arxiv.org/pdf/2106.12423.pdf].</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a><span class="sd">  Use np.kaiser()?</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a><span class="sd">  Args:</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a><span class="sd">    radius: Value L/2 in the definition.  It may be fractional for a (digital) resizing filter</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a><span class="sd">      (sample spacing s != 1) with an even number of samples (dual grid), e.g., Eq. (6)</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a><span class="sd">      in [Karras et al. 2021] --- this effects the precise shape of the window function.</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a><span class="sd">    beta: Determines the trade-off between main-lobe width and side-lobe level.</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a><span class="sd">    sampled: If True, use a discretized approximation for improved speed.</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sampled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>    <span class="k">assert</span> <span class="n">beta</span> <span class="o">&gt;=</span> <span class="mf">0.0</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;kaiser_</span><span class="si">{</span><span class="n">radius</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">partition_of_unity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>                     <span class="n">unit_integral</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>    <span class="nd">@_cache_sampled_1d_function</span><span class="p">(</span><span class="n">xmin</span><span class="o">=-</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">radius</span><span class="p">),</span> <span class="n">xmax</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">radius</span><span class="p">),</span> <span class="n">enable</span><span class="o">=</span><span class="n">sampled</span><span class="p">)</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>    <span class="k">def</span> <span class="nf">_eval</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>      <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>      <span class="n">window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">i0</span><span class="p">(</span><span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">radius</span><span class="p">))</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">i0</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">radius</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">_sinc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">window</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">_eval</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a><span class="k">class</span> <span class="nc">BsplineFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>  <span class="sd">&quot;&quot;&quot;B-spline of a non-negative degree.</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a><span class="sd">  Args:</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a><span class="sd">    degree: The polynomial degree of the B-spline segments.</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a><span class="sd">      - With `degree=0`, it is like `BoxFilter` except with f(0.5) = f(-0.5) = 0.</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a><span class="sd">      - With `degree=1`, it is identical to `TriangleFilter`.</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a><span class="sd">      - With `degree &gt;= 2`, it is no longer interpolating.</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a><span class="sd">  See [Carl de Boor.  A practical guide to splines.  Springer, 2001.]</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a><span class="sd">  https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.BSpline.html</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">degree</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>    <span class="k">if</span> <span class="n">degree</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Bspline of degree </span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s1"> is invalid.&#39;</span><span class="p">)</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>    <span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;bspline</span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">interpolating</span><span class="o">=</span><span class="p">(</span><span class="n">degree</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>    <span class="n">t</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">bspline</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">BSpline</span><span class="o">.</span><span class="n">basis_element</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bspline</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a><span class="k">class</span> <span class="nc">CardinalBsplineFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>  <span class="sd">&quot;&quot;&quot;Interpolating B-spline, achieved with aid of digital pre or post filter.</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a><span class="sd">  Args:</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a><span class="sd">    degree: The polynomial degree of the B-spline segments.</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a><span class="sd">    sampled: If True, use a discretized approximation for improved speed.</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a><span class="sd">  See [Hou and Andrews.  Cubic splines for image interpolation and digital filtering, 1978] and</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a><span class="sd">  [Unser et al.  Fast B-spline transforms for continuous image representation and interpolation,</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a><span class="sd">  1991].</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">degree</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sampled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>    <span class="k">if</span> <span class="n">degree</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Bspline of degree </span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s1"> is invalid.&#39;</span><span class="p">)</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>    <span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;cardinal</span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">requires_digital_filter</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>    <span class="n">t</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>    <span class="n">bspline</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">BSpline</span><span class="o">.</span><span class="n">basis_element</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>    <span class="nd">@_cache_sampled_1d_function</span><span class="p">(</span><span class="n">xmin</span><span class="o">=-</span><span class="n">radius</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="n">sampled</span><span class="p">)</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>    <span class="k">def</span> <span class="nf">_eval</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>      <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">radius</span><span class="p">,</span> <span class="n">bspline</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">radius</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">_eval</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a><span class="k">class</span> <span class="nc">OmomsFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>  <span class="sd">&quot;&quot;&quot;OMOMS interpolating filter, with aid of digital pre or post filter.</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a><span class="sd">  Args:</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a><span class="sd">    degree: The polynomial degree of the filter segments.</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a><span class="sd">  Optimal MOMS (maximal-order-minimal-support) function; see [Blu and Thevenaz, MOMS: Maximal-order</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a><span class="sd">  interpolation of minimal support, 2001].</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a><span class="sd">  https://infoscience.epfl.ch/record/63074/files/blu0101.pdf</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">degree</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a>    <span class="k">if</span> <span class="n">degree</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Degree </span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s1"> not supported.&#39;</span><span class="p">)</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;omoms</span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="p">(</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">requires_digital_filter</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">=</span> <span class="n">degree</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a>      <span class="n">v01</span> <span class="o">=</span> <span class="p">((</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">3</span><span class="o">/</span><span class="mi">42</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">26</span><span class="o">/</span><span class="mi">42</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a>      <span class="n">v12</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mi">7</span><span class="o">/</span><span class="mi">42</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">85</span><span class="o">/</span><span class="mi">42</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">58</span><span class="o">/</span><span class="mi">42</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a>      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">v01</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">v12</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a>      <span class="n">v01</span> <span class="o">=</span> <span class="p">((((</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">12</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">5</span><span class="o">/</span><span class="mi">99</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">9</span><span class="o">/</span><span class="mi">22</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">792</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">229</span><span class="o">/</span><span class="mi">440</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a>      <span class="n">v12</span> <span class="o">=</span> <span class="p">((((</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">3</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">505</span><span class="o">/</span><span class="mi">396</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">83</span><span class="o">/</span><span class="mi">44</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1351</span><span class="o">/</span><span class="mi">1584</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">839</span><span class="o">/</span><span class="mi">2640</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a>      <span class="n">v23</span> <span class="o">=</span> <span class="p">((((</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">120</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">299</span><span class="o">/</span><span class="mi">396</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">101</span><span class="o">/</span><span class="mi">44</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">27811</span><span class="o">/</span><span class="mi">7920</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">5707</span><span class="o">/</span><span class="mi">2640</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a>      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">v01</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">v12</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">v23</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)))</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a>    <span class="k">raise</span> <span class="ne">AssertionError</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a><span class="k">class</span> <span class="nc">GaussianFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a>  <span class="sd">&quot;&quot;&quot;See https://en.wikipedia.org/wiki/Gaussian_function.</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a><span class="sd">  Args:</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a><span class="sd">    standard_deviation: Sets the Gaussian $\sigma$.  The default value is 1.25/3.0, which</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a><span class="sd">      creates a kernel that is as-close-as-possible to a partition of unity.</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a>  <span class="n">DEFAULT_STANDARD_DEVIATION</span> <span class="o">=</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="mf">3.0</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a>  <span class="sd">&quot;&quot;&quot;This value creates a kernel that is as-close-as-possible to a partition of unity; see</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a><span class="sd">  mesh_processing/test/GridOp_test.cpp: `0.93503:1.06497     av=1           sd=0.0459424`.</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a><span class="sd">  Another possibility is 0.5, as suggested on p. 4 of [Ken Turkowski.  Filters for common</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a><span class="sd">  resampling tasks, 1990] for kernels with a support of 3 pixels.</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a><span class="sd">  https://cadxfem.org/inf/ResamplingFilters.pdf</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">standard_deviation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_STANDARD_DEVIATION</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;gaussian_</span><span class="si">{</span><span class="n">standard_deviation</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a>                     <span class="n">radius</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mf">8.0</span> <span class="o">*</span> <span class="n">standard_deviation</span><span class="p">),</span>  <span class="c1"># Sufficiently large.</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a>                     <span class="n">interpolating</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a>                     <span class="n">partition_of_unity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">standard_deviation</span> <span class="o">=</span> <span class="n">standard_deviation</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>    <span class="n">sdv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard_deviation</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a>    <span class="n">v0r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">sdv</span><span class="p">)</span> <span class="o">/</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span> <span class="o">*</span> <span class="n">sdv</span><span class="p">)</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">v0r</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a><span class="k">class</span> <span class="nc">NarrowBoxFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>  <span class="sd">&quot;&quot;&quot;Compact footprint, used for visualization of grid sample location.</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a><span class="sd">  Args:</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a><span class="sd">    radius: Support [-radius, radius] of the narrow box function, with default value 0.199.</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.199</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;narrowbox&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unit_integral</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>                     <span class="n">partition_of_unity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>    <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>    <span class="n">magnitude</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="o">-</span><span class="n">radius</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">radius</span><span class="p">),</span> <span class="n">magnitude</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a><span class="n">FILTERS</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>    <span class="s1">&#39;impulse&#39;</span><span class="p">:</span> <span class="n">ImpulseFilter</span><span class="p">(),</span>  <span class="c1"># a.k.a. &#39;nearest&#39;</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>    <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="n">BoxFilter</span><span class="p">(),</span>  <span class="c1"># non-antialiased box, e.g. ImageMagick box.</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a>    <span class="s1">&#39;trapezoid&#39;</span><span class="p">:</span> <span class="n">TrapezoidFilter</span><span class="p">(),</span>  <span class="c1"># &quot;area&quot; antialiasing, e.g., cv.INTER_AREA</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a>    <span class="s1">&#39;triangle&#39;</span><span class="p">:</span> <span class="n">TriangleFilter</span><span class="p">(),</span>  <span class="c1"># a.k.a. &#39;linear&#39;  (&#39;bilinear&#39; in 2D)</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a>    <span class="s1">&#39;cubic&#39;</span><span class="p">:</span> <span class="n">CatmullRomFilter</span><span class="p">(),</span>  <span class="c1"># a.k.a. &#39;catmullrom&#39;, &#39;keys&#39;, &#39;bicubic&#39;.</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a>    <span class="s1">&#39;sharpcubic&#39;</span><span class="p">:</span> <span class="n">SharpCubicFilter</span><span class="p">(),</span>  <span class="c1"># cv.INTER_CUBIC, torch &#39;bicubic&#39;.</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a>    <span class="s1">&#39;lanczos3&#39;</span><span class="p">:</span> <span class="n">LanczosFilter</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a>    <span class="s1">&#39;lanczos5&#39;</span><span class="p">:</span> <span class="n">LanczosFilter</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>  <span class="c1"># optionally: sampled=False</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a>    <span class="s1">&#39;lanczos10&#39;</span><span class="p">:</span> <span class="n">LanczosFilter</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">10</span><span class="p">),</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a>    <span class="s1">&#39;cardinal3&#39;</span><span class="p">:</span> <span class="n">CardinalBsplineFilter</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a>    <span class="s1">&#39;cardinal5&#39;</span><span class="p">:</span> <span class="n">CardinalBsplineFilter</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a>    <span class="s1">&#39;omoms3&#39;</span><span class="p">:</span> <span class="n">OmomsFilter</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a>    <span class="s1">&#39;omoms5&#39;</span><span class="p">:</span> <span class="n">OmomsFilter</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a>    <span class="s1">&#39;hamming3&#39;</span><span class="p">:</span> <span class="n">GeneralizedHammingFilter</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mi">25</span><span class="o">/</span><span class="mi">46</span><span class="p">),</span>  <span class="c1"># (a0 = ~0.54)</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a>    <span class="s1">&#39;kaiser3&#39;</span><span class="p">:</span> <span class="n">KaiserFilter</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">7.12</span><span class="p">),</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a>    <span class="s1">&#39;gaussian&#39;</span><span class="p">:</span> <span class="n">GaussianFilter</span><span class="p">(),</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a>    <span class="s1">&#39;bspline3&#39;</span><span class="p">:</span> <span class="n">BsplineFilter</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a>    <span class="s1">&#39;mitchell&#39;</span><span class="p">:</span> <span class="n">MitchellFilter</span><span class="p">(),</span>  <span class="c1"># a.k.a. &#39;mitchellcubic&#39;</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>    <span class="s1">&#39;narrowbox&#39;</span><span class="p">:</span> <span class="n">NarrowBoxFilter</span><span class="p">(),</span>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a><span class="p">}</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a><span class="sd">&quot;&quot;&quot;Shortcut names for some predefined filter kernels.  These include &#39;impulse&#39;, &#39;box&#39;, &#39;trapezoid&#39;,</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a><span class="sd">&#39;triangle&#39;, &#39;cubic&#39;, &#39;lanczos3&#39;, &#39;lanczos5&#39;, etc.&quot;&quot;&quot;</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a><span class="n">OTHER_FILTERS</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a>    <span class="s1">&#39;hann3&#39;</span><span class="p">:</span> <span class="n">GeneralizedHammingFilter</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a>    <span class="s1">&#39;lanczos4&#39;</span><span class="p">:</span> <span class="n">LanczosFilter</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a><span class="p">}</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a><span class="k">def</span> <span class="nf">_get_filter</span><span class="p">(</span><span class="nb">filter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Filter</span><span class="p">:</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>  <span class="sd">&quot;&quot;&quot;Return a `Filter`, which can be specified as a name string key in `FILTERS`.&quot;&quot;&quot;</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>  <span class="k">return</span> <span class="nb">filter</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">filter</span><span class="p">,</span> <span class="n">Filter</span><span class="p">)</span> <span class="k">else</span> <span class="n">FILTERS</span><span class="p">[</span><span class="nb">filter</span><span class="p">]</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a><span class="k">def</span> <span class="nf">_to_float_01</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a>  <span class="sd">&quot;&quot;&quot;Scale uint to the range [0.0, 1.0], and clip float to [0.0, 1.0].&quot;&quot;&quot;</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a>  <span class="n">array_dtype</span> <span class="o">=</span> <span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a>  <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a>  <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a>  <span class="k">if</span> <span class="n">array_dtype</span> <span class="ow">in</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">):</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a>    <span class="k">if</span> <span class="n">_arr_arraylib</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;numpy&#39;</span><span class="p">:</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a>      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">array_dtype</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a>    <span class="k">return</span> <span class="n">_arr_astype</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">array_dtype</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a>  <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">array_dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)</span>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a>  <span class="k">return</span> <span class="n">_arr_clip</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a><span class="k">def</span> <span class="nf">_from_float</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a>  <span class="sd">&quot;&quot;&quot;Convert a float in range [0.0, 1.0] to uint or float type.&quot;&quot;&quot;</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a>  <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a>  <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>  <span class="k">if</span> <span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">):</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a>    <span class="k">return</span> <span class="n">_arr_astype</span><span class="p">(</span><span class="n">array</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a>  <span class="k">if</span> <span class="n">dtype</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">:</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>    <span class="k">return</span> <span class="n">_arr_astype</span><span class="p">(</span><span class="n">array</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>  <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>  <span class="k">return</span> <span class="n">_arr_astype</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a><span class="k">class</span> <span class="nc">Gamma</span><span class="p">:</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>  <span class="sd">&quot;&quot;&quot;Abstract base class for transfer functions on sample values.</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a><span class="sd">  Image/video content is often stored using a color component transfer function.</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a><span class="sd">  See https://en.wikipedia.org/wiki/Gamma_correction.</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a><span class="sd">  Converts between integer types and [0.0, 1.0] internal value range.</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a>  <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a>  <span class="sd">&quot;&quot;&quot;Name of component transfer function.&quot;&quot;&quot;</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a>  <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a>    <span class="sd">&quot;&quot;&quot;Decode source sample values into floating-point, possibly nonlinearly.</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a><span class="sd">    Uint source values are mapped to the range [0.0, 1.0].</span>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>  <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>    <span class="sd">&quot;&quot;&quot;Encode float signal into destination samples, possibly nonlinearly.</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a><span class="sd">    Uint destination values are mapped from the range [0.0, 1.0].</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a><span class="k">class</span> <span class="nc">IdentityGamma</span><span class="p">(</span><span class="n">Gamma</span><span class="p">):</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a>  <span class="sd">&quot;&quot;&quot;Identity component transfer function.&quot;&quot;&quot;</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;identity&#39;</span><span class="p">)</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a>  <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a>    <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a>    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inexact</span><span class="p">)</span>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">unsignedinteger</span><span class="p">):</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a>      <span class="k">return</span> <span class="n">_to_float_01</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a>    <span class="k">return</span> <span class="n">_arr_astype</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a>  <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a>    <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a>    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unsignedinteger</span><span class="p">):</span>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>      <span class="k">return</span> <span class="n">_from_float</span><span class="p">(</span><span class="n">_arr_clip</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>      <span class="k">return</span> <span class="n">_arr_astype</span><span class="p">(</span><span class="n">array</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a>    <span class="k">return</span> <span class="n">_arr_astype</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a><span class="k">class</span> <span class="nc">PowerGamma</span><span class="p">(</span><span class="n">Gamma</span><span class="p">):</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>  <span class="sd">&quot;&quot;&quot;Gamma correction using a power function.&quot;&quot;&quot;</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">power</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;power_</span><span class="si">{</span><span class="n">power</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="n">power</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a>  <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>    <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a>    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a>    <span class="k">if</span> <span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a>      <span class="n">decode_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a>      <span class="k">return</span> <span class="n">_arr_gather</span><span class="p">(</span><span class="n">decode_table</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">_to_float_01</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>    <span class="k">return</span> <span class="n">_arr_square</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">array</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">power</span>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>  <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">_arr_clip</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">_arr_sqrt</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">array</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="p">)</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a>    <span class="k">return</span> <span class="n">_from_float</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a><span class="k">class</span> <span class="nc">SrgbGamma</span><span class="p">(</span><span class="n">Gamma</span><span class="p">):</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>  <span class="sd">&quot;&quot;&quot;Gamma correction using sRGB; see https://en.wikipedia.org/wiki/SRGB.&quot;&quot;&quot;</span>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;srgb&#39;</span><span class="p">)</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a>  <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>    <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a>    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a>    <span class="k">if</span> <span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a>      <span class="n">decode_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a>      <span class="k">return</span> <span class="n">_arr_gather</span><span class="p">(</span><span class="n">decode_table</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">_to_float_01</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a>    <span class="k">return</span> <span class="n">_arr_where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.04045</span><span class="p">,</span> <span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.055</span><span class="p">)</span><span class="o">**</span><span class="mf">2.4</span><span class="p">,</span> <span class="n">x</span> <span class="o">/</span> <span class="mf">12.92</span><span class="p">)</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a>  <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">_arr_clip</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a>    <span class="c1"># Unfortunately, exponentiation is slow, and np.digitize() is even slower.</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">_arr_where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0031308</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">2.4</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.055</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.055</span> <span class="o">-</span> <span class="mf">1e-17</span><span class="p">),</span> <span class="n">x</span> <span class="o">*</span> <span class="mf">12.92</span><span class="p">)</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a>    <span class="k">return</span> <span class="n">_from_float</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a><span class="n">GAMMAS</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a>    <span class="s1">&#39;identity&#39;</span><span class="p">:</span> <span class="n">IdentityGamma</span><span class="p">(),</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a>    <span class="s1">&#39;power2&#39;</span><span class="p">:</span> <span class="n">PowerGamma</span><span class="p">(</span><span class="mf">2.0</span><span class="p">),</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a>    <span class="s1">&#39;power22&#39;</span><span class="p">:</span> <span class="n">PowerGamma</span><span class="p">(</span><span class="mf">2.2</span><span class="p">),</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a>    <span class="s1">&#39;srgb&#39;</span><span class="p">:</span> <span class="n">SrgbGamma</span><span class="p">(),</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a><span class="p">}</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a><span class="sd">&quot;&quot;&quot;Shortcut names for some predefined gamma-correction schemes.  These include &#39;identity&#39;,</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a><span class="sd">&#39;power2&#39;, &#39;power22&#39;, and &#39;srgb&#39;.&quot;&quot;&quot;</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a><span class="k">def</span> <span class="nf">_get_src_dst_gamma</span><span class="p">(</span><span class="n">gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">],</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a>                       <span class="n">src_gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">],</span> <span class="n">dst_gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">],</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a>                       <span class="n">src_dtype</span><span class="p">:</span> <span class="n">_DType</span><span class="p">,</span> <span class="n">dst_dtype</span><span class="p">:</span> <span class="n">_DType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Gamma</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">]:</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a>  <span class="k">if</span> <span class="n">gamma</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">src_gamma</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">dst_gamma</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a>    <span class="n">src_uint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">src_dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unsignedinteger</span><span class="p">)</span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a>    <span class="n">dst_uint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dst_dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unsignedinteger</span><span class="p">)</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a>    <span class="k">if</span> <span class="n">src_uint</span> <span class="ow">and</span> <span class="n">dst_uint</span><span class="p">:</span>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a>      <span class="c1"># The default might ideally be &#39;srgb&#39; but that conversion is costlier.</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a>      <span class="n">gamma</span> <span class="o">=</span> <span class="s1">&#39;power2&#39;</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a>    <span class="k">elif</span> <span class="ow">not</span> <span class="n">src_uint</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">dst_uint</span><span class="p">:</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a>      <span class="n">gamma</span> <span class="o">=</span> <span class="s1">&#39;identity&#39;</span>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Gamma must be specified given that source is&#39;</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a>                       <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">src_dtype</span><span class="si">}</span><span class="s1"> and destination is </span><span class="si">{</span><span class="n">dst_dtype</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a>  <span class="k">if</span> <span class="n">gamma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a>    <span class="k">if</span> <span class="n">src_gamma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot specify both gamma and src_gamma.&#39;</span><span class="p">)</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a>    <span class="k">if</span> <span class="n">dst_gamma</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Cannot specify both gamma and dst_gamma.&#39;</span><span class="p">)</span>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a>    <span class="n">src_gamma</span> <span class="o">=</span> <span class="n">dst_gamma</span> <span class="o">=</span> <span class="n">gamma</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a>  <span class="k">assert</span> <span class="n">src_gamma</span> <span class="ow">and</span> <span class="n">dst_gamma</span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a>  <span class="n">src_gamma</span> <span class="o">=</span> <span class="n">src_gamma</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">src_gamma</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">)</span> <span class="k">else</span> <span class="n">GAMMAS</span><span class="p">[</span><span class="n">src_gamma</span><span class="p">]</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a>  <span class="n">dst_gamma</span> <span class="o">=</span> <span class="n">dst_gamma</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dst_gamma</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">)</span> <span class="k">else</span> <span class="n">GAMMAS</span><span class="p">[</span><span class="n">dst_gamma</span><span class="p">]</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a>  <span class="k">return</span> <span class="n">src_gamma</span><span class="p">,</span> <span class="n">dst_gamma</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a><span class="k">def</span> <span class="nf">_create_resize_matrix</span><span class="p">(</span>      <span class="c1"># pylint: disable=too-many-statements</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a>    <span class="n">src_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a>    <span class="n">dst_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a>    <span class="n">src_gridtype</span><span class="p">:</span> <span class="n">Gridtype</span><span class="p">,</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a>    <span class="n">dst_gridtype</span><span class="p">:</span> <span class="n">Gridtype</span><span class="p">,</span>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a>    <span class="n">boundary</span><span class="p">:</span> <span class="n">Boundary</span><span class="p">,</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a>    <span class="nb">filter</span><span class="p">:</span> <span class="n">Filter</span><span class="p">,</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a>    <span class="n">prefilter</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Filter</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a>    <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a>    <span class="n">translate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">_DType</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a>    <span class="n">arraylib</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a>  <span class="sd">&quot;&quot;&quot;Compute affine weights for 1D resampling from `src_size` to `dst_size`.</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a><span class="sd">  Compute a sparse matrix in which each row expresses a destination sample value as a combination</span>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a><span class="sd">  of source sample values depending on the boundary rule.  If the combination is non-affine,</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a><span class="sd">  the remainder (returned as `cval_weight`) is the contribution of the special constant value</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a><span class="sd">  (cval) defined outside the domain.</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a><span class="sd">  Args:</span>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a><span class="sd">    src_size: The number of samples within the source 1D domain.</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a><span class="sd">    dst_size: The number of samples within the destination 1D domain.</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a><span class="sd">    src_gridtype: Placement of the samples in the source domain grid.</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a><span class="sd">    dst_gridtype: Placement of the output samples in the destination domain grid.</span>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a><span class="sd">    boundary: The reconstruction boundary rule.</span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a><span class="sd">    filter: The reconstruction kernel (used for upsampling/magnification).</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a><span class="sd">    prefilter: The prefilter kernel (used for downsampling/minification).  If it is None, `filter`</span>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a><span class="sd">      is used.</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a><span class="sd">    scale: Scaling factor applied when mapping the source domain onto the destination domain.</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a><span class="sd">    translate: Offset applied when mapping the scaled source domain onto the destination domain.</span>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a><span class="sd">    dtype: Precision of computed resize matrix entries.</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a><span class="sd">    arraylib: Representation of output.  Must be an element of ARRAYLIBS.</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a><span class="sd">  Returns:</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a><span class="sd">    sparse_matrix: Matrix whose rows express output sample values as affine combinations of the</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a><span class="sd">      source sample values.</span>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a><span class="sd">    cval_weight: Optional vector expressing the additional contribution of the constant value</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a><span class="sd">      (`cval`) to the combination in each row of `sparse_matrix`.  It equals one minus the sum of</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a><span class="sd">      the weights in each matrix row.</span>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a>  <span class="k">if</span> <span class="n">src_size</span> <span class="o">&lt;</span> <span class="n">src_gridtype</span><span class="o">.</span><span class="n">min_size</span><span class="p">():</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Source size </span><span class="si">{</span><span class="n">src_size</span><span class="si">}</span><span class="s1"> is too small for resize.&#39;</span><span class="p">)</span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a>  <span class="k">if</span> <span class="n">dst_size</span> <span class="o">&lt;</span> <span class="n">dst_gridtype</span><span class="o">.</span><span class="n">min_size</span><span class="p">():</span>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Destination size </span><span class="si">{</span><span class="n">dst_size</span><span class="si">}</span><span class="s1"> is too small for resize.&#39;</span><span class="p">)</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a>  <span class="n">prefilter</span> <span class="o">=</span> <span class="nb">filter</span> <span class="k">if</span> <span class="n">prefilter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">prefilter</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a>  <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a>  <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a>  <span class="n">scaling</span> <span class="o">=</span> <span class="n">dst_gridtype</span><span class="o">.</span><span class="n">size_in_samples</span><span class="p">(</span><span class="n">dst_size</span><span class="p">)</span> <span class="o">/</span> <span class="n">src_gridtype</span><span class="o">.</span><span class="n">size_in_samples</span><span class="p">(</span><span class="n">src_size</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a>  <span class="n">is_minification</span> <span class="o">=</span> <span class="n">scaling</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>  <span class="nb">filter</span> <span class="o">=</span> <span class="n">prefilter</span> <span class="k">if</span> <span class="n">is_minification</span> <span class="k">else</span> <span class="nb">filter</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>  <span class="k">if</span> <span class="nb">filter</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;trapezoid&#39;</span><span class="p">:</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>    <span class="nb">filter</span> <span class="o">=</span> <span class="n">TrapezoidFilter</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="n">scaling</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">scaling</span><span class="p">)))</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>  <span class="n">radius</span> <span class="o">=</span> <span class="nb">filter</span><span class="o">.</span><span class="n">radius</span>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>  <span class="n">num_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">scaling</span><span class="p">)</span> <span class="k">if</span> <span class="n">is_minification</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>  <span class="n">dst_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dst_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>  <span class="c1"># Destination sample locations in unit domain [0, 1].</span>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>  <span class="n">dst_position</span> <span class="o">=</span> <span class="n">dst_gridtype</span><span class="o">.</span><span class="n">point_from_index</span><span class="p">(</span><span class="n">dst_index</span><span class="p">,</span> <span class="n">dst_size</span><span class="p">)</span>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a>  <span class="n">src_position</span> <span class="o">=</span> <span class="p">(</span><span class="n">dst_position</span> <span class="o">-</span> <span class="n">translate</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a>  <span class="n">src_position</span> <span class="o">=</span> <span class="n">boundary</span><span class="o">.</span><span class="n">preprocess_coordinates</span><span class="p">(</span><span class="n">src_position</span><span class="p">)</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a>  <span class="c1"># Sample positions mapped back to source unit domain [0, 1].</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a>  <span class="n">src_float_index</span> <span class="o">=</span> <span class="n">src_gridtype</span><span class="o">.</span><span class="n">index_from_point</span><span class="p">(</span><span class="n">src_position</span><span class="p">,</span> <span class="n">src_size</span><span class="p">)</span>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a>  <span class="n">src_first_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">src_float_index</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span> <span class="k">if</span> <span class="n">num_samples</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a>                             <span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">num_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a>  <span class="n">sample_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a>  <span class="n">src_index</span> <span class="o">=</span> <span class="n">src_first_index</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">sample_index</span>  <span class="c1"># (dst_size, num_samples)</span>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>  <span class="k">def</span> <span class="nf">get_weight_matrix</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a>    <span class="k">if</span> <span class="nb">filter</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;impulse&#39;</span><span class="p">:</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a>      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">src_index</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a>    <span class="k">if</span> <span class="n">is_minification</span><span class="p">:</span>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a>      <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">src_float_index</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">src_index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">))</span> <span class="o">*</span> <span class="n">scaling</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a>      <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">scaling</span>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a>    <span class="c1"># Either same size or magnification.</span>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">src_float_index</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">src_index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a>    <span class="k">return</span> <span class="nb">filter</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a>  <span class="n">weight</span> <span class="o">=</span> <span class="n">get_weight_matrix</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a>  <span class="k">if</span> <span class="nb">filter</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;narrowbox&#39;</span> <span class="ow">and</span> <span class="p">(</span><span class="n">is_minification</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">filter</span><span class="o">.</span><span class="n">partition_of_unity</span><span class="p">):</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a>    <span class="n">weight</span> <span class="o">=</span> <span class="n">weight</span> <span class="o">/</span> <span class="n">weight</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a>  <span class="n">src_index</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">boundary</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">src_index</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">src_position</span><span class="p">,</span> <span class="n">src_size</span><span class="p">,</span> <span class="n">src_gridtype</span><span class="p">)</span>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="n">dst_size</span><span class="p">,</span> <span class="n">src_size</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a>  <span class="n">uses_cval</span> <span class="o">=</span> <span class="n">boundary</span><span class="o">.</span><span class="n">uses_cval</span> <span class="ow">or</span> <span class="nb">filter</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;narrowbox&#39;</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a>  <span class="n">cval_weight</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">weight</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="k">if</span> <span class="n">uses_cval</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a>  <span class="c1"># Create the sparse resize matrix.</span>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a>  <span class="k">if</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;numpy&#39;</span><span class="p">:</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>    <span class="k">def</span> <span class="nf">numpy_create_sparse_matrix</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a>      <span class="n">data</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a>      <span class="n">row_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dst_size</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">src_index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a>      <span class="n">col_ind</span> <span class="o">=</span> <span class="n">src_index</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a>      <span class="n">nonzero</span> <span class="o">=</span> <span class="n">data</span> <span class="o">!=</span> <span class="mf">0.0</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a>      <span class="n">data</span><span class="p">,</span> <span class="n">row_ind</span><span class="p">,</span> <span class="n">col_ind</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">nonzero</span><span class="p">],</span> <span class="n">row_ind</span><span class="p">[</span><span class="n">nonzero</span><span class="p">],</span> <span class="n">col_ind</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a>      <span class="c1"># Note: csr_matrix automatically reorders and merges duplicate indices.</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a>      <span class="k">return</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">row_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a>    <span class="n">resize_matrix</span> <span class="o">=</span> <span class="n">numpy_create_sparse_matrix</span><span class="p">()</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a>  <span class="k">elif</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;tensorflow&#39;</span><span class="p">:</span>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a>    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a>    <span class="k">def</span> <span class="nf">tensorflow_create_sparse_matrix</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">_TensorflowTensor</span><span class="p">:</span>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a>      <span class="n">linearized</span> <span class="o">=</span> <span class="p">(</span><span class="n">src_index</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">src_index</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">src_size</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a>      <span class="n">values</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a>      <span class="c1"># Remove the zero weights.</span>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a>      <span class="n">nonzero</span> <span class="o">=</span> <span class="n">values</span> <span class="o">!=</span> <span class="mf">0.0</span>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a>      <span class="n">linearized</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">linearized</span><span class="p">[</span><span class="n">nonzero</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a>      <span class="c1"># Sort and merge the duplicate indices.</span>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a>      <span class="n">unique</span><span class="p">,</span> <span class="n">unique_inverse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">linearized</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a>      <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">linearized</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a>      <span class="n">row_ind</span> <span class="o">=</span> <span class="n">unique_inverse</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a>      <span class="n">col_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">linearized</span><span class="p">))</span>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a>      <span class="n">shape2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">linearized</span><span class="p">)</span>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a>      <span class="n">csr</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">row_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="n">shape2</span><span class="p">)</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a>      <span class="n">merged_values</span> <span class="o">=</span> <span class="n">csr</span> <span class="o">*</span> <span class="n">values</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a>      <span class="n">merged_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">unique</span> <span class="o">//</span> <span class="n">src_size</span><span class="p">,</span> <span class="n">unique</span> <span class="o">%</span> <span class="n">src_size</span><span class="p">))</span>
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a>      <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">SparseTensor</span><span class="p">(</span><span class="n">merged_indices</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">merged_values</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a>    <span class="n">resize_matrix</span> <span class="o">=</span> <span class="n">tensorflow_create_sparse_matrix</span><span class="p">()</span>
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a>    <span class="k">if</span> <span class="n">cval_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a>      <span class="n">cval_weight</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">cval_weight</span><span class="p">)</span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a>  <span class="k">elif</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;torch&#39;</span><span class="p">:</span>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a>    <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a>    <span class="k">def</span> <span class="nf">torch_create_sparse_matrix</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a>      <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dst_size</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">src_index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a>                           <span class="n">src_index</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a>      <span class="n">values</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a>      <span class="c1"># Remove the zero weights, then coalesce the duplicate indices.</span>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a>      <span class="n">nonzero</span> <span class="o">=</span> <span class="n">values</span> <span class="o">!=</span> <span class="mf">0.0</span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a>      <span class="n">indices</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">nonzero</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">nonzero</span><span class="p">]</span>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a>      <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">sparse_coo_tensor</span><span class="p">(</span><span class="n">indices</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">coalesce</span><span class="p">()</span>  <span class="c1"># type: ignore[arg-type]</span>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a>    <span class="n">resize_matrix</span> <span class="o">=</span> <span class="n">torch_create_sparse_matrix</span><span class="p">()</span>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a>    <span class="k">if</span> <span class="n">cval_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a>      <span class="n">cval_weight</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">cval_weight</span><span class="p">)</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a>    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">arraylib</span><span class="si">}</span><span class="s1"> is unrecognized.&#39;</span><span class="p">)</span>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a>  <span class="k">return</span> <span class="n">resize_matrix</span><span class="p">,</span> <span class="n">cval_weight</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a>
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a><span class="k">def</span> <span class="nf">_best_order_in_which_to_process_dimensions</span><span class="p">(</span>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a>    <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dst_shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a>  <span class="sd">&quot;&quot;&quot;Return the best order in which to process dimensions when resizing `array` to `dst_shape`.</span>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a><span class="sd">  For numpy: (1) a dimension with small scaling (especially minification) gets priority, and</span>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a><span class="sd">             (2) timings show preference to resizing dimensions with larger strides first.</span>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a><span class="sd">  For tensorflow: process dimension 1 first iff dimension 0 is upsampling.</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a><span class="sd">  For torch: same as numpy.</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a>  <span class="c1"># The optimal ordering might be related to the logic in np.einsum_path().  (Unfortunately,</span>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a>  <span class="c1"># np.einsum() does not support the sparse multiplications that we require here.)</span>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a>  <span class="n">src_shape</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">dst_shape</span><span class="p">)]</span>
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a>  <span class="n">arraylib</span> <span class="o">=</span> <span class="n">_arr_arraylib</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a>  <span class="n">strides</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">strides</span> <span class="k">if</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;numpy&#39;</span> <span class="k">else</span>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a>                            <span class="nb">list</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dst_shape</span><span class="p">))))</span> <span class="k">if</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;tensorflow&#39;</span> <span class="k">else</span>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a>                            <span class="n">array</span><span class="o">.</span><span class="n">stride</span><span class="p">()</span> <span class="k">if</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;torch&#39;</span> <span class="k">else</span>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a>                            <span class="mi">1</span><span class="o">/</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a>  <span class="n">largest_stride_dim</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">src_shape</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">dim</span><span class="p">:</span> <span class="n">strides</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a>  <span class="k">def</span> <span class="nf">priority</span><span class="p">(</span><span class="n">dim</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a>    <span class="n">scaling</span> <span class="o">=</span> <span class="n">dst_shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">/</span> <span class="n">src_shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a>    <span class="k">if</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;numpy&#39;</span><span class="p">:</span>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a>      <span class="k">return</span> <span class="n">scaling</span> <span class="o">*</span> <span class="p">((</span><span class="mf">0.49</span> <span class="k">if</span> <span class="n">scaling</span> <span class="o">&lt;</span> <span class="mf">1.0</span> <span class="k">else</span> <span class="mf">0.65</span><span class="p">)</span> <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="n">largest_stride_dim</span> <span class="k">else</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a>    <span class="k">if</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;tensorflow&#39;</span><span class="p">:</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a>      <span class="k">return</span> <span class="mf">2.0</span> <span class="k">if</span> <span class="n">scaling</span> <span class="o">&gt;</span> <span class="mf">1.0</span> <span class="ow">and</span> <span class="n">dim</span> <span class="o">==</span> <span class="n">largest_stride_dim</span> <span class="k">else</span> <span class="mf">1.0</span>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a>    <span class="k">if</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;torch&#39;</span><span class="p">:</span>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a>      <span class="k">return</span> <span class="n">scaling</span> <span class="o">*</span> <span class="p">((</span><span class="mf">0.49</span> <span class="k">if</span> <span class="n">scaling</span> <span class="o">&lt;</span> <span class="mf">1.0</span> <span class="k">else</span> <span class="mf">0.65</span><span class="p">)</span> <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="n">largest_stride_dim</span> <span class="k">else</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a>    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">arraylib</span><span class="si">}</span><span class="s1"> is unrecognized.&#39;</span><span class="p">)</span>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a>  <span class="n">dim_order</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">src_shape</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="n">priority</span><span class="p">)</span>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a>  <span class="k">return</span> <span class="n">dim_order</span>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a><span class="k">def</span> <span class="nf">_apply_potential_digital_filter_1d</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-statements</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a>    <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">gridtype</span><span class="p">:</span> <span class="n">Gridtype</span><span class="p">,</span> <span class="n">boundary</span><span class="p">:</span> <span class="n">Boundary</span><span class="p">,</span> <span class="n">cval</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="n">Filter</span><span class="p">,</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a>    <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">compute_backward</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a>  <span class="sd">&quot;&quot;&quot;Apply inverse convolution to the specified dimension of the array.</span>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a><span class="sd">  Find the array coefficients such that convolution with the (continuous) filter (given</span>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a><span class="sd">  gridtype and boundary) interpolates the original array values.</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="nb">filter</span><span class="o">.</span><span class="n">requires_digital_filter</span><span class="p">:</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a>    <span class="k">return</span> <span class="n">array</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a>  <span class="n">arraylib</span> <span class="o">=</span> <span class="n">_arr_arraylib</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a>  <span class="k">if</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;tensorflow&#39;</span><span class="p">:</span>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a>    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a>    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a>      <span class="k">return</span> <span class="n">_apply_potential_digital_filter_1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">gridtype</span><span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a>    <span class="k">def</span> <span class="nf">backward</span><span class="p">(</span><span class="n">grad_output</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a>      <span class="k">return</span> <span class="n">_apply_potential_digital_filter_1d</span><span class="p">(</span><span class="n">grad_output</span><span class="p">,</span> <span class="n">gridtype</span><span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a>                                                <span class="n">axis</span><span class="p">,</span> <span class="n">compute_backward</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a>    <span class="nd">@tf</span><span class="o">.</span><span class="n">custom_gradient</span>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a>    <span class="k">def</span> <span class="nf">inverse_convolution</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TensorflowTensor</span><span class="p">:</span>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a>      <span class="n">y</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">numpy_function</span><span class="p">(</span><span class="n">forward</span><span class="p">,</span> <span class="p">[</span><span class="n">x</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a>      <span class="k">def</span> <span class="nf">grad</span><span class="p">(</span><span class="n">dy</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TensorflowTensor</span><span class="p">:</span>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a>        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">numpy_function</span><span class="p">(</span><span class="n">backward</span><span class="p">,</span> <span class="p">[</span><span class="n">dy</span><span class="p">],</span> <span class="n">x</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a>      <span class="k">return</span> <span class="n">y</span><span class="p">,</span> <span class="n">grad</span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a>    <span class="k">return</span> <span class="n">inverse_convolution</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>  <span class="k">if</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;torch&#39;</span><span class="p">:</span>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a>    <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a>    <span class="k">class</span> <span class="nc">InverseConvolution</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">autograd</span><span class="o">.</span><span class="n">Function</span><span class="p">):</span>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>      <span class="sd">&quot;&quot;&quot;Differentiable wrapper for _apply_potential_digital_filter_1d.&quot;&quot;&quot;</span>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a>      <span class="nd">@staticmethod</span>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a>      <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">unused_ctx</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>  <span class="c1"># type: ignore[override]</span>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">_apply_potential_digital_filter_1d</span><span class="p">(</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a>            <span class="n">x</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">gridtype</span><span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">axis</span><span class="p">))</span>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a>      <span class="nd">@staticmethod</span>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a>      <span class="k">def</span> <span class="nf">backward</span><span class="p">(</span><span class="n">unused_ctx</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">grad_output</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span><span class="p">:</span>  <span class="c1"># type: ignore[override]</span>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a>        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">_apply_potential_digital_filter_1d</span><span class="p">(</span>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a>            <span class="n">grad_output</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">gridtype</span><span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a>            <span class="n">axis</span><span class="p">,</span> <span class="n">compute_backward</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a>    <span class="k">return</span> <span class="n">InverseConvolution</span><span class="p">()</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>  <span class="c1"># type: ignore[no-untyped-call]</span>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a>  <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inexact</span><span class="p">)</span>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a>  <span class="n">cval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cval</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a>  <span class="c1"># Use faster code if compatible dtype, gridtype, boundary, and filter:</span>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a>  <span class="k">if</span> <span class="p">(</span><span class="nb">filter</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;cardinal3&#39;</span><span class="p">,</span> <span class="s1">&#39;cardinal5&#39;</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a>      <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complexfloating</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a>          <span class="n">boundary</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;reflect&#39;</span> <span class="ow">or</span> <span class="p">(</span><span class="n">gridtype</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dual&#39;</span> <span class="ow">and</span> <span class="n">boundary</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;wrap&#39;</span><span class="p">))):</span>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a>    <span class="n">order</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">filter</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="s1">&#39;cardinal&#39;</span><span class="p">):])</span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a>    <span class="n">mode</span> <span class="o">=</span> <span class="p">({</span><span class="s1">&#39;dual&#39;</span><span class="p">:</span> <span class="s1">&#39;reflect&#39;</span><span class="p">,</span> <span class="s1">&#39;primal&#39;</span><span class="p">:</span> <span class="s1">&#39;mirror&#39;</span><span class="p">}[</span><span class="n">gridtype</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a>            <span class="k">if</span> <span class="n">boundary</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;reflect&#39;</span> <span class="k">else</span> <span class="s1">&#39;wrap&#39;</span><span class="p">)</span>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a>    <span class="c1"># compute_backward=True is same: matrix is symmetric and cval is unused.</span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a>    <span class="k">return</span> <span class="n">_spline_filter1d</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a>  <span class="n">array_dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a>  <span class="n">l</span> <span class="o">=</span> <span class="n">original_l</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">filter</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a>  <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">l</span><span class="p">,</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">array</span><span class="o">.</span><span class="n">real</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a>  <span class="n">values</span> <span class="o">=</span> <span class="nb">filter</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a>  <span class="n">size</span> <span class="o">=</span> <span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a>  <span class="n">src_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">size</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span> <span class="o">-</span> <span class="n">l</span>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a>  <span class="n">weight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">size</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)),</span> <span class="n">values</span><span class="p">)</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a>  <span class="n">src_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a>  <span class="n">src_index</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="n">boundary</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">src_index</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">src_position</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">gridtype</span><span class="p">)</span>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a>  <span class="k">if</span> <span class="n">gridtype</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;primal&#39;</span> <span class="ow">and</span> <span class="n">boundary</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;wrap&#39;</span><span class="p">:</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a>    <span class="c1"># Overwrite redundant last row to preserve unreferenced last sample and thereby make the</span>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a>    <span class="c1"># matrix non-singular.</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a>    <span class="n">src_index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">src_index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a>    <span class="n">weight</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">weight</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a>  <span class="n">bandwidth</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">src_index</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">size</span><span class="p">)[:,</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a>  <span class="n">is_banded</span> <span class="o">=</span> <span class="n">bandwidth</span> <span class="o">&lt;=</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># Add one for quadratic boundary and l == 1.</span>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a>  <span class="c1"># Currently, matrix is always banded unless boundary.name == &#39;wrap&#39;.</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a>  <span class="n">data</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a>  <span class="n">row_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">src_index</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a>  <span class="n">col_ind</span> <span class="o">=</span> <span class="n">src_index</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a>  <span class="n">matrix</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">((</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="n">row_ind</span><span class="p">,</span> <span class="n">col_ind</span><span class="p">)),</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">size</span><span class="p">))</span>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a>  <span class="k">if</span> <span class="n">compute_backward</span><span class="p">:</span>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a>    <span class="n">matrix</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">T</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a>  <span class="k">if</span> <span class="n">boundary</span><span class="o">.</span><span class="n">uses_cval</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">compute_backward</span><span class="p">:</span>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a>    <span class="n">cval_weight</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">))[:,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a>    <span class="k">if</span> <span class="n">array_dim</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># Handle the case that we have array_flat.</span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a>      <span class="n">cval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">cval</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">array_dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">size</span> <span class="o">//</span> <span class="n">cval</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a>    <span class="n">array_dim</span> <span class="o">=</span> <span class="n">array_dim</span> <span class="o">-</span> <span class="n">cval_weight</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="n">array_dim</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span> <span class="o">*</span> <span class="n">cval</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a>  <span class="k">if</span> <span class="n">is_banded</span><span class="p">:</span>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a>    <span class="n">matrix</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">todia</span><span class="p">()</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a>    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">offsets</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># Consecutive, often [-l, l].</span>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a>    <span class="n">l</span><span class="p">,</span> <span class="n">u</span> <span class="o">=</span> <span class="o">-</span><span class="n">matrix</span><span class="o">.</span><span class="n">offsets</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">matrix</span><span class="o">.</span><span class="n">offsets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a>    <span class="k">assert</span> <span class="n">l</span> <span class="o">&lt;=</span> <span class="n">original_l</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">u</span> <span class="o">&lt;=</span> <span class="n">original_l</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="p">,</span> <span class="n">u</span><span class="p">,</span> <span class="n">original_l</span><span class="p">)</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a>    <span class="n">options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">check_finite</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">overwrite_ab</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">overwrite_b</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a>    <span class="k">if</span> <span class="n">_is_symmetric</span><span class="p">(</span><span class="n">matrix</span><span class="p">):</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a>      <span class="n">array_dim</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solveh_banded</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="n">l</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">array_dim</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>      <span class="n">array_dim</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve_banded</span><span class="p">((</span><span class="n">l</span><span class="p">,</span> <span class="n">u</span><span class="p">),</span> <span class="n">matrix</span><span class="o">.</span><span class="n">data</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">array_dim</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a>    <span class="n">lu</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">splu</span><span class="p">(</span><span class="n">matrix</span><span class="o">.</span><span class="n">tocsc</span><span class="p">(),</span> <span class="n">permc_spec</span><span class="o">=</span><span class="s1">&#39;NATURAL&#39;</span><span class="p">)</span>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a>    <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="n">s</span> <span class="o">&lt;=</span> <span class="n">size</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">(</span><span class="n">lu</span><span class="o">.</span><span class="n">L</span><span class="o">.</span><span class="n">nnz</span><span class="p">,</span> <span class="n">lu</span><span class="o">.</span><span class="n">U</span><span class="o">.</span><span class="n">nnz</span><span class="p">))</span>  <span class="c1"># Sparse.</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a>    <span class="n">array_dim</span> <span class="o">=</span> <span class="n">lu</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">array_dim</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a>  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">array_dim</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a>
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a><span class="k">def</span> <span class="nf">resize</span><span class="p">(</span>                     <span class="c1"># pylint: disable=too-many-branches disable=too-many-statements</span>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a>    <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a>    <span class="n">shape</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a>    <span class="n">gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a>    <span class="n">src_gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a>    <span class="n">dst_gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a>    <span class="n">boundary</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Boundary</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Boundary</span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a>    <span class="n">cval</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a>    <span class="nb">filter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;lanczos3&#39;</span><span class="p">,</span>
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a>    <span class="n">prefilter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a>    <span class="n">gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a>    <span class="n">src_gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a>    <span class="n">dst_gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a>    <span class="n">scale</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a>    <span class="n">translate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a>    <span class="n">precision</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a>    <span class="n">dim_order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a>    <span class="n">internal_torch_contiguous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a>  <span class="sd">&quot;&quot;&quot;Resample a grid of sample values onto a grid of different resolution.</span>
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a>
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a><span class="sd">  The source `array` may be an array-like, `np.ndarray`, `tf.Tensor`, or `torch.Tensor`.  The</span>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a><span class="sd">  array is interpreted as a grid with `len(shape)` domain coordinate dimensions, where each</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a><span class="sd">  grid sample value has shape `array.shape[len(shape):]`.</span>
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a>
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a><span class="sd">  For example:</span>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a>
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a><span class="sd">  - A grayscale image has `array.shape = height, width` and resizing it with `len(shape) == 2`</span>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a><span class="sd">    produces a new image of scalar values.</span>
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a><span class="sd">  - An RGB image has `array.shape = height, width, 3` and resizing it with `len(shape) == 2`</span>
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a><span class="sd">    produces a new image of RGB values.</span>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a><span class="sd">  - An 3D grid of 3x3 Jacobians has `array.shape = Z, Y, X, 3, 3` and resizing it with</span>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a><span class="sd">    `len(shape) == 3` produces a new 3D grid of Jacobians.</span>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a><span class="sd">  This function also allows scaling and translation from the source domain to the output domain</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a><span class="sd">  through the parameters `scale` and `translate`.  For more general transforms, see `resample`.</span>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a>
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a><span class="sd">  Args:</span>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a><span class="sd">    array: Grid of source sample values.  It must be an array-like object from a library in</span>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a><span class="sd">      `ARRAYLIBS`.  The array must have numeric type.  Its first `len(shape)` dimensions are the</span>
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a><span class="sd">      domain coordinate dimensions.  Each grid dimension must be at least 1 for a `dual` grid or</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a><span class="sd">      at least 2 for a `primal` grid.</span>
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a><span class="sd">    shape: The number of grid samples in each coordinate dimension of the output array.  The source</span>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a><span class="sd">      `array` must have at least as many dimensions as `len(shape)`.</span>
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a><span class="sd">    gridtype: Placement of samples on both the source and output domain grids, specified as either</span>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a><span class="sd">      a name in `GRIDTYPES` or a `Gridtype` instance.  The default is &#39;dual&#39;.</span>
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a><span class="sd">    src_gridtype: Placement of the samples in the source domain grid for each dimension.</span>
</span><span id="L-2017"><a href="#L-2017"><span class="linenos">2017</span></a><span class="sd">      Parameters `gridtype` and `src_gridtype` cannot both be set.</span>
</span><span id="L-2018"><a href="#L-2018"><span class="linenos">2018</span></a><span class="sd">    dst_gridtype: Placement of the samples in the output domain grid for each dimension.</span>
</span><span id="L-2019"><a href="#L-2019"><span class="linenos">2019</span></a><span class="sd">      Parameters `gridtype` and `dst_gridtype` cannot both be set.</span>
</span><span id="L-2020"><a href="#L-2020"><span class="linenos">2020</span></a><span class="sd">    boundary: The reconstruction boundary rule for each dimension in `shape`, specified as either</span>
</span><span id="L-2021"><a href="#L-2021"><span class="linenos">2021</span></a><span class="sd">      a name in `BOUNDARIES` or a `Boundary` instance.  The special value &#39;auto&#39; uses &#39;reflect&#39;</span>
</span><span id="L-2022"><a href="#L-2022"><span class="linenos">2022</span></a><span class="sd">      for upsampling and &#39;clamp&#39; for downsampling.</span>
</span><span id="L-2023"><a href="#L-2023"><span class="linenos">2023</span></a><span class="sd">    cval: Constant value used beyond the samples by some boundary rules.  It must be broadcastable</span>
</span><span id="L-2024"><a href="#L-2024"><span class="linenos">2024</span></a><span class="sd">      onto `array.shape[len(shape):]`.</span>
</span><span id="L-2025"><a href="#L-2025"><span class="linenos">2025</span></a><span class="sd">    filter: The reconstruction kernel for each dimension in `shape`, specified as either a filter</span>
</span><span id="L-2026"><a href="#L-2026"><span class="linenos">2026</span></a><span class="sd">      name in `FILTERS` or a `Filter` instance.  It is used during upsampling (i.e., magnification).</span>
</span><span id="L-2027"><a href="#L-2027"><span class="linenos">2027</span></a><span class="sd">    prefilter: The prefilter kernel for each dimension in `shape`, specified as either a filter</span>
</span><span id="L-2028"><a href="#L-2028"><span class="linenos">2028</span></a><span class="sd">      name in `FILTERS` or a `Filter` instance.  It is used during downsampling</span>
</span><span id="L-2029"><a href="#L-2029"><span class="linenos">2029</span></a><span class="sd">      (i.e., minification).  If None, it inherits the value of `filter`.</span>
</span><span id="L-2030"><a href="#L-2030"><span class="linenos">2030</span></a><span class="sd">    gamma: Component transfer functions (e.g., gamma correction) applied when reading samples from</span>
</span><span id="L-2031"><a href="#L-2031"><span class="linenos">2031</span></a><span class="sd">      `array` and when creating output grid samples.  It is specified as either a name in `GAMMAS`</span>
</span><span id="L-2032"><a href="#L-2032"><span class="linenos">2032</span></a><span class="sd">      or a `Gamma` instance.  If both `array.dtype` and `dtype` are `uint`, the default is `power2`.</span>
</span><span id="L-2033"><a href="#L-2033"><span class="linenos">2033</span></a><span class="sd">      If both are non-`uint`, the default is `identity`.  Otherwise, `gamma` or</span>
</span><span id="L-2034"><a href="#L-2034"><span class="linenos">2034</span></a><span class="sd">      `src_gamma`/`dst_gamma` must be set.   Gamma correction assumes that float values are in the</span>
</span><span id="L-2035"><a href="#L-2035"><span class="linenos">2035</span></a><span class="sd">      range [0.0, 1.0].</span>
</span><span id="L-2036"><a href="#L-2036"><span class="linenos">2036</span></a><span class="sd">    src_gamma: Component transfer function used to &quot;decode&quot; `array` samples.</span>
</span><span id="L-2037"><a href="#L-2037"><span class="linenos">2037</span></a><span class="sd">      Parameters `gamma` and `src_gamma` cannot both be set.</span>
</span><span id="L-2038"><a href="#L-2038"><span class="linenos">2038</span></a><span class="sd">    dst_gamma: Component transfer function used to &quot;encode&quot; the output samples.</span>
</span><span id="L-2039"><a href="#L-2039"><span class="linenos">2039</span></a><span class="sd">      Parameters `gamma` and `dst_gamma` cannot both be set.</span>
</span><span id="L-2040"><a href="#L-2040"><span class="linenos">2040</span></a><span class="sd">    scale: Scaling factor applied to each dimension of the source domain when it is mapped onto</span>
</span><span id="L-2041"><a href="#L-2041"><span class="linenos">2041</span></a><span class="sd">      the destination domain.</span>
</span><span id="L-2042"><a href="#L-2042"><span class="linenos">2042</span></a><span class="sd">    translate: Offset applied to each dimension of the scaled source domain when it is mapped onto</span>
</span><span id="L-2043"><a href="#L-2043"><span class="linenos">2043</span></a><span class="sd">      the destination domain.</span>
</span><span id="L-2044"><a href="#L-2044"><span class="linenos">2044</span></a><span class="sd">    precision: Inexact precision of intermediate computations.  If None, it is determined based</span>
</span><span id="L-2045"><a href="#L-2045"><span class="linenos">2045</span></a><span class="sd">      on `array.dtype` and `dtype`.</span>
</span><span id="L-2046"><a href="#L-2046"><span class="linenos">2046</span></a><span class="sd">    dtype: Desired data type of the output array.  If None, it is taken to be `array.dtype`.</span>
</span><span id="L-2047"><a href="#L-2047"><span class="linenos">2047</span></a><span class="sd">      If it is a uint type, the intermediate float values are rescaled from the [0.0, 1.0] range</span>
</span><span id="L-2048"><a href="#L-2048"><span class="linenos">2048</span></a><span class="sd">      to the uint range.</span>
</span><span id="L-2049"><a href="#L-2049"><span class="linenos">2049</span></a><span class="sd">    dim_order: Override the automatically selected order in which the grid dimensions are resized.</span>
</span><span id="L-2050"><a href="#L-2050"><span class="linenos">2050</span></a><span class="sd">      Must contain a permutation of `range(len(shape))`.</span>
</span><span id="L-2051"><a href="#L-2051"><span class="linenos">2051</span></a>
</span><span id="L-2052"><a href="#L-2052"><span class="linenos">2052</span></a><span class="sd">  Returns:</span>
</span><span id="L-2053"><a href="#L-2053"><span class="linenos">2053</span></a><span class="sd">    An array of the same class (`np.ndarray`, `tf.Tensor`, or `torch.Tensor`) as the source `array`,</span>
</span><span id="L-2054"><a href="#L-2054"><span class="linenos">2054</span></a><span class="sd">    with shape `shape + array.shape[len(shape):]` and data type `dtype`.</span>
</span><span id="L-2055"><a href="#L-2055"><span class="linenos">2055</span></a>
</span><span id="L-2056"><a href="#L-2056"><span class="linenos">2056</span></a><span class="sd">  &gt;&gt;&gt; result = resize([1.0, 4.0, 5.0], shape=(4,))</span>
</span><span id="L-2057"><a href="#L-2057"><span class="linenos">2057</span></a><span class="sd">  &gt;&gt;&gt; assert np.allclose(result, [0.74240461, 2.88088827, 4.68647155, 5.02641199])</span>
</span><span id="L-2058"><a href="#L-2058"><span class="linenos">2058</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-2059"><a href="#L-2059"><span class="linenos">2059</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span><span id="L-2060"><a href="#L-2060"><span class="linenos">2060</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-2061"><a href="#L-2061"><span class="linenos">2061</span></a>  <span class="n">arraylib</span> <span class="o">=</span> <span class="n">_arr_arraylib</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-2062"><a href="#L-2062"><span class="linenos">2062</span></a>  <span class="n">array_dtype</span> <span class="o">=</span> <span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-2063"><a href="#L-2063"><span class="linenos">2063</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">array_dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
</span><span id="L-2064"><a href="#L-2064"><span class="linenos">2064</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Type </span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s1"> is not numeric.&#39;</span><span class="p">)</span>
</span><span id="L-2065"><a href="#L-2065"><span class="linenos">2065</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2066"><a href="#L-2066"><span class="linenos">2066</span></a>  <span class="n">array_ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2067"><a href="#L-2067"><span class="linenos">2067</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">array_ndim</span><span class="p">:</span>
</span><span id="L-2068"><a href="#L-2068"><span class="linenos">2068</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Shape </span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1"> cannot be resized to </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="L-2069"><a href="#L-2069"><span class="linenos">2069</span></a>  <span class="n">src_shape</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)]</span>
</span><span id="L-2070"><a href="#L-2070"><span class="linenos">2070</span></a>  <span class="n">src_gridtype2</span><span class="p">,</span> <span class="n">dst_gridtype2</span> <span class="o">=</span> <span class="n">_get_gridtypes</span><span class="p">(</span>
</span><span id="L-2071"><a href="#L-2071"><span class="linenos">2071</span></a>      <span class="n">gridtype</span><span class="p">,</span> <span class="n">src_gridtype</span><span class="p">,</span> <span class="n">dst_gridtype</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
</span><span id="L-2072"><a href="#L-2072"><span class="linenos">2072</span></a>  <span class="n">boundary2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">boundary</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
</span><span id="L-2073"><a href="#L-2073"><span class="linenos">2073</span></a>  <span class="n">cval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">cval</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">):])</span>
</span><span id="L-2074"><a href="#L-2074"><span class="linenos">2074</span></a>  <span class="n">prefilter</span> <span class="o">=</span> <span class="nb">filter</span> <span class="k">if</span> <span class="n">prefilter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">prefilter</span>
</span><span id="L-2075"><a href="#L-2075"><span class="linenos">2075</span></a>  <span class="n">filter2</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_filter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">filter</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))]</span>
</span><span id="L-2076"><a href="#L-2076"><span class="linenos">2076</span></a>  <span class="n">prefilter2</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_filter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">prefilter</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))]</span>
</span><span id="L-2077"><a href="#L-2077"><span class="linenos">2077</span></a>  <span class="n">dtype</span> <span class="o">=</span> <span class="n">array_dtype</span> <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-2078"><a href="#L-2078"><span class="linenos">2078</span></a>  <span class="n">src_gamma2</span><span class="p">,</span> <span class="n">dst_gamma2</span> <span class="o">=</span> <span class="n">_get_src_dst_gamma</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">src_gamma</span><span class="p">,</span> <span class="n">dst_gamma</span><span class="p">,</span> <span class="n">array_dtype</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-2079"><a href="#L-2079"><span class="linenos">2079</span></a>  <span class="n">scale2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scale</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
</span><span id="L-2080"><a href="#L-2080"><span class="linenos">2080</span></a>  <span class="n">translate2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">translate</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
</span><span id="L-2081"><a href="#L-2081"><span class="linenos">2081</span></a>  <span class="k">del</span> <span class="n">src_gridtype</span><span class="p">,</span> <span class="n">dst_gridtype</span><span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">prefilter</span>
</span><span id="L-2082"><a href="#L-2082"><span class="linenos">2082</span></a>  <span class="k">del</span> <span class="n">src_gamma</span><span class="p">,</span> <span class="n">dst_gamma</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">translate</span>
</span><span id="L-2083"><a href="#L-2083"><span class="linenos">2083</span></a>  <span class="n">precision</span> <span class="o">=</span> <span class="n">_get_precision</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="p">[</span><span class="n">array_dtype</span><span class="p">,</span> <span class="n">dtype</span><span class="p">],</span> <span class="p">[])</span>
</span><span id="L-2084"><a href="#L-2084"><span class="linenos">2084</span></a>  <span class="n">weight_precision</span> <span class="o">=</span> <span class="n">_real_precision</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span>
</span><span id="L-2085"><a href="#L-2085"><span class="linenos">2085</span></a>  <span class="k">if</span> <span class="n">dim_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2086"><a href="#L-2086"><span class="linenos">2086</span></a>    <span class="n">dim_order</span> <span class="o">=</span> <span class="n">_best_order_in_which_to_process_dimensions</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
</span><span id="L-2087"><a href="#L-2087"><span class="linenos">2087</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="L-2088"><a href="#L-2088"><span class="linenos">2088</span></a>    <span class="n">dim_order</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">dim_order</span><span class="p">)</span>
</span><span id="L-2089"><a href="#L-2089"><span class="linenos">2089</span></a>    <span class="k">if</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dim_order</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))):</span>
</span><span id="L-2090"><a href="#L-2090"><span class="linenos">2090</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dim_order</span><span class="si">}</span><span class="s1"> not a permutation of </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)))</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="L-2091"><a href="#L-2091"><span class="linenos">2091</span></a>
</span><span id="L-2092"><a href="#L-2092"><span class="linenos">2092</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">src_gamma2</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
</span><span id="L-2093"><a href="#L-2093"><span class="linenos">2093</span></a>
</span><span id="L-2094"><a href="#L-2094"><span class="linenos">2094</span></a>  <span class="n">can_use_fast_box_downsampling</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2095"><a href="#L-2095"><span class="linenos">2095</span></a>      <span class="s1">&#39;numba&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span> <span class="ow">and</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;numpy&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">array_ndim</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="L-2096"><a href="#L-2096"><span class="linenos">2096</span></a>      <span class="nb">all</span><span class="p">(</span><span class="n">src</span> <span class="o">&gt;</span> <span class="n">dst</span> <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">src_shape</span><span class="p">,</span> <span class="n">shape</span><span class="p">))</span> <span class="ow">and</span>
</span><span id="L-2097"><a href="#L-2097"><span class="linenos">2097</span></a>      <span class="nb">all</span><span class="p">(</span><span class="n">src</span> <span class="o">%</span> <span class="n">dst</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">src_shape</span><span class="p">,</span> <span class="n">shape</span><span class="p">))</span> <span class="ow">and</span>
</span><span id="L-2098"><a href="#L-2098"><span class="linenos">2098</span></a>      <span class="nb">all</span><span class="p">(</span><span class="n">gridtype</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dual&#39;</span> <span class="k">for</span> <span class="n">gridtype</span> <span class="ow">in</span> <span class="n">src_gridtype2</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="L-2099"><a href="#L-2099"><span class="linenos">2099</span></a>      <span class="nb">all</span><span class="p">(</span><span class="n">gridtype</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dual&#39;</span> <span class="k">for</span> <span class="n">gridtype</span> <span class="ow">in</span> <span class="n">dst_gridtype2</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="L-2100"><a href="#L-2100"><span class="linenos">2100</span></a>      <span class="nb">all</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="s1">&#39;trapezoid&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">prefilter2</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="L-2101"><a href="#L-2101"><span class="linenos">2101</span></a>      <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">scale2</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">translate2</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">))</span>
</span><span id="L-2102"><a href="#L-2102"><span class="linenos">2102</span></a>  <span class="k">if</span> <span class="n">can_use_fast_box_downsampling</span><span class="p">:</span>
</span><span id="L-2103"><a href="#L-2103"><span class="linenos">2103</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">_downsample_in_2d_using_box_filter</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">shape</span><span class="p">))</span>
</span><span id="L-2104"><a href="#L-2104"><span class="linenos">2104</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">dst_gamma2</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-2105"><a href="#L-2105"><span class="linenos">2105</span></a>    <span class="k">return</span> <span class="n">array</span>
</span><span id="L-2106"><a href="#L-2106"><span class="linenos">2106</span></a>
</span><span id="L-2107"><a href="#L-2107"><span class="linenos">2107</span></a>  <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dim_order</span><span class="p">:</span>
</span><span id="L-2108"><a href="#L-2108"><span class="linenos">2108</span></a>    <span class="n">skip_resize_on_this_dim</span> <span class="o">=</span> <span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">==</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="ow">and</span> <span class="n">scale2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span> <span class="ow">and</span>
</span><span id="L-2109"><a href="#L-2109"><span class="linenos">2109</span></a>                               <span class="n">translate2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">interpolating</span><span class="p">)</span>
</span><span id="L-2110"><a href="#L-2110"><span class="linenos">2110</span></a>    <span class="k">if</span> <span class="n">skip_resize_on_this_dim</span><span class="p">:</span>
</span><span id="L-2111"><a href="#L-2111"><span class="linenos">2111</span></a>      <span class="k">continue</span>
</span><span id="L-2112"><a href="#L-2112"><span class="linenos">2112</span></a>
</span><span id="L-2113"><a href="#L-2113"><span class="linenos">2113</span></a>    <span class="n">is_minification</span> <span class="o">=</span> <span class="p">(</span><span class="n">dst_gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">size_in_samples</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span> <span class="o">/</span>
</span><span id="L-2114"><a href="#L-2114"><span class="linenos">2114</span></a>                       <span class="n">src_gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">size_in_samples</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]))</span> <span class="o">*</span> <span class="n">scale2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
</span><span id="L-2115"><a href="#L-2115"><span class="linenos">2115</span></a>    <span class="n">boundary_dim</span> <span class="o">=</span> <span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
</span><span id="L-2116"><a href="#L-2116"><span class="linenos">2116</span></a>    <span class="k">if</span> <span class="n">boundary_dim</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
</span><span id="L-2117"><a href="#L-2117"><span class="linenos">2117</span></a>      <span class="n">boundary_dim</span> <span class="o">=</span> <span class="s1">&#39;clamp&#39;</span> <span class="k">if</span> <span class="n">is_minification</span> <span class="k">else</span> <span class="s1">&#39;reflect&#39;</span>
</span><span id="L-2118"><a href="#L-2118"><span class="linenos">2118</span></a>    <span class="n">boundary_dim</span> <span class="o">=</span> <span class="n">boundary_dim</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">boundary_dim</span><span class="p">,</span> <span class="n">Boundary</span><span class="p">)</span> <span class="k">else</span> <span class="n">BOUNDARIES</span><span class="p">[</span><span class="n">boundary_dim</span><span class="p">]</span>
</span><span id="L-2119"><a href="#L-2119"><span class="linenos">2119</span></a>    <span class="n">resize_matrix</span><span class="p">,</span> <span class="n">cval_weight</span> <span class="o">=</span> <span class="n">_create_resize_matrix</span><span class="p">(</span>
</span><span id="L-2120"><a href="#L-2120"><span class="linenos">2120</span></a>        <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
</span><span id="L-2121"><a href="#L-2121"><span class="linenos">2121</span></a>        <span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
</span><span id="L-2122"><a href="#L-2122"><span class="linenos">2122</span></a>        <span class="n">src_gridtype</span><span class="o">=</span><span class="n">src_gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
</span><span id="L-2123"><a href="#L-2123"><span class="linenos">2123</span></a>        <span class="n">dst_gridtype</span><span class="o">=</span><span class="n">dst_gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
</span><span id="L-2124"><a href="#L-2124"><span class="linenos">2124</span></a>        <span class="n">boundary</span><span class="o">=</span><span class="n">boundary_dim</span><span class="p">,</span>
</span><span id="L-2125"><a href="#L-2125"><span class="linenos">2125</span></a>        <span class="nb">filter</span><span class="o">=</span><span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
</span><span id="L-2126"><a href="#L-2126"><span class="linenos">2126</span></a>        <span class="n">prefilter</span><span class="o">=</span><span class="n">prefilter2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
</span><span id="L-2127"><a href="#L-2127"><span class="linenos">2127</span></a>        <span class="n">scale</span><span class="o">=</span><span class="n">scale2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
</span><span id="L-2128"><a href="#L-2128"><span class="linenos">2128</span></a>        <span class="n">translate</span><span class="o">=</span><span class="n">translate2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
</span><span id="L-2129"><a href="#L-2129"><span class="linenos">2129</span></a>        <span class="n">dtype</span><span class="o">=</span><span class="n">weight_precision</span><span class="p">,</span>
</span><span id="L-2130"><a href="#L-2130"><span class="linenos">2130</span></a>        <span class="n">arraylib</span><span class="o">=</span><span class="n">arraylib</span><span class="p">)</span>
</span><span id="L-2131"><a href="#L-2131"><span class="linenos">2131</span></a>
</span><span id="L-2132"><a href="#L-2132"><span class="linenos">2132</span></a>    <span class="k">def</span> <span class="nf">potential_pre_digital_filter</span><span class="p">(</span><span class="n">array_flat</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-2133"><a href="#L-2133"><span class="linenos">2133</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">is_minification</span><span class="p">:</span>
</span><span id="L-2134"><a href="#L-2134"><span class="linenos">2134</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">_apply_potential_digital_filter_1d</span><span class="p">(</span>
</span><span id="L-2135"><a href="#L-2135"><span class="linenos">2135</span></a>            <span class="n">array_flat</span><span class="p">,</span> <span class="n">src_gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">boundary_dim</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
</span><span id="L-2136"><a href="#L-2136"><span class="linenos">2136</span></a>      <span class="k">return</span> <span class="n">array_flat</span>
</span><span id="L-2137"><a href="#L-2137"><span class="linenos">2137</span></a>
</span><span id="L-2138"><a href="#L-2138"><span class="linenos">2138</span></a>    <span class="k">def</span> <span class="nf">potential_post_digital_filter</span><span class="p">(</span><span class="n">array_flat</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-2139"><a href="#L-2139"><span class="linenos">2139</span></a>      <span class="k">if</span> <span class="n">is_minification</span><span class="p">:</span>  <span class="c1"># use prefilter2[dim]?</span>
</span><span id="L-2140"><a href="#L-2140"><span class="linenos">2140</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">_apply_potential_digital_filter_1d</span><span class="p">(</span>
</span><span id="L-2141"><a href="#L-2141"><span class="linenos">2141</span></a>            <span class="n">array_flat</span><span class="p">,</span> <span class="n">dst_gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">boundary_dim</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
</span><span id="L-2142"><a href="#L-2142"><span class="linenos">2142</span></a>      <span class="k">return</span> <span class="n">array_flat</span>
</span><span id="L-2143"><a href="#L-2143"><span class="linenos">2143</span></a>
</span><span id="L-2144"><a href="#L-2144"><span class="linenos">2144</span></a>    <span class="k">if</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;numpy&#39;</span><span class="p">:</span>
</span><span id="L-2145"><a href="#L-2145"><span class="linenos">2145</span></a>
</span><span id="L-2146"><a href="#L-2146"><span class="linenos">2146</span></a>      <span class="k">def</span> <span class="nf">resize_numpy_dim</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-2147"><a href="#L-2147"><span class="linenos">2147</span></a>        <span class="c1"># Because np.ndarray supports strides, np.moveaxis() and np.permute() are constant-time.</span>
</span><span id="L-2148"><a href="#L-2148"><span class="linenos">2148</span></a>        <span class="c1"># However, ndarray.reshape() often creates a copy of the array if the data is</span>
</span><span id="L-2149"><a href="#L-2149"><span class="linenos">2149</span></a>        <span class="c1"># non-contiguous, e.g. dim=1 in an RGB image.</span>
</span><span id="L-2150"><a href="#L-2150"><span class="linenos">2150</span></a>        <span class="n">array_dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-2151"><a href="#L-2151"><span class="linenos">2151</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">array_dim</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2152"><a href="#L-2152"><span class="linenos">2152</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">potential_pre_digital_filter</span><span class="p">(</span><span class="n">array_flat</span><span class="p">)</span>
</span><span id="L-2153"><a href="#L-2153"><span class="linenos">2153</span></a>
</span><span id="L-2154"><a href="#L-2154"><span class="linenos">2154</span></a>        <span class="c1"># The dot() calls scipy.sparse._sparsetools.csr_matvecs() in</span>
</span><span id="L-2155"><a href="#L-2155"><span class="linenos">2155</span></a>        <span class="c1"># https://github.com/scipy/scipy/blob/master/scipy/sparse/sparsetools/csr.h</span>
</span><span id="L-2156"><a href="#L-2156"><span class="linenos">2156</span></a>        <span class="c1"># which iteratively calls the LEVEL 1 BLAS function axpy().</span>
</span><span id="L-2157"><a href="#L-2157"><span class="linenos">2157</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">resize_matrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">array_flat</span><span class="p">)</span>
</span><span id="L-2158"><a href="#L-2158"><span class="linenos">2158</span></a>        <span class="k">if</span> <span class="n">cval_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2159"><a href="#L-2159"><span class="linenos">2159</span></a>          <span class="n">cval_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">cval</span><span class="p">,</span> <span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2160"><a href="#L-2160"><span class="linenos">2160</span></a>          <span class="n">array_flat</span> <span class="o">+=</span> <span class="n">cval_weight</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">cval_flat</span>
</span><span id="L-2161"><a href="#L-2161"><span class="linenos">2161</span></a>
</span><span id="L-2162"><a href="#L-2162"><span class="linenos">2162</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">potential_post_digital_filter</span><span class="p">(</span><span class="n">array_flat</span><span class="p">)</span>
</span><span id="L-2163"><a href="#L-2163"><span class="linenos">2163</span></a>        <span class="n">array_dim</span> <span class="o">=</span> <span class="n">array_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array_flat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-2164"><a href="#L-2164"><span class="linenos">2164</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">array_dim</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
</span><span id="L-2165"><a href="#L-2165"><span class="linenos">2165</span></a>
</span><span id="L-2166"><a href="#L-2166"><span class="linenos">2166</span></a>      <span class="n">array</span> <span class="o">=</span> <span class="n">resize_numpy_dim</span><span class="p">()</span>
</span><span id="L-2167"><a href="#L-2167"><span class="linenos">2167</span></a>
</span><span id="L-2168"><a href="#L-2168"><span class="linenos">2168</span></a>    <span class="k">elif</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;tensorflow&#39;</span><span class="p">:</span>
</span><span id="L-2169"><a href="#L-2169"><span class="linenos">2169</span></a>
</span><span id="L-2170"><a href="#L-2170"><span class="linenos">2170</span></a>      <span class="k">def</span> <span class="nf">resize_tensorflow_dim</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">_TensorflowTensor</span><span class="p">:</span>
</span><span id="L-2171"><a href="#L-2171"><span class="linenos">2171</span></a>        <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-2172"><a href="#L-2172"><span class="linenos">2172</span></a>        <span class="c1"># Because tf.Tensor does not support strides, tf.transpose() returns a</span>
</span><span id="L-2173"><a href="#L-2173"><span class="linenos">2173</span></a>        <span class="c1"># new permuted tensor.  However, tf.reshape() is always efficient.</span>
</span><span id="L-2174"><a href="#L-2174"><span class="linenos">2174</span></a>        <span class="n">perm</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">array_ndim</span><span class="p">))</span>
</span><span id="L-2175"><a href="#L-2175"><span class="linenos">2175</span></a>        <span class="n">array_dim</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span>
</span><span id="L-2176"><a href="#L-2176"><span class="linenos">2176</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array_dim</span><span class="p">,</span> <span class="p">[</span><span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-2177"><a href="#L-2177"><span class="linenos">2177</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">potential_pre_digital_filter</span><span class="p">(</span><span class="n">array_flat</span><span class="p">)</span>
</span><span id="L-2178"><a href="#L-2178"><span class="linenos">2178</span></a>
</span><span id="L-2179"><a href="#L-2179"><span class="linenos">2179</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">sparse_dense_matmul</span><span class="p">(</span><span class="n">resize_matrix</span><span class="p">,</span> <span class="n">array_flat</span><span class="p">)</span>
</span><span id="L-2180"><a href="#L-2180"><span class="linenos">2180</span></a>        <span class="k">if</span> <span class="n">cval_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2181"><a href="#L-2181"><span class="linenos">2181</span></a>          <span class="n">cval_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">cval</span><span class="p">,</span> <span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2182"><a href="#L-2182"><span class="linenos">2182</span></a>          <span class="n">array_flat</span> <span class="o">+=</span> <span class="n">cval_weight</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">cval_flat</span>
</span><span id="L-2183"><a href="#L-2183"><span class="linenos">2183</span></a>
</span><span id="L-2184"><a href="#L-2184"><span class="linenos">2184</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">potential_post_digital_filter</span><span class="p">(</span><span class="n">array_flat</span><span class="p">)</span>
</span><span id="L-2185"><a href="#L-2185"><span class="linenos">2185</span></a>        <span class="n">array_dim</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array_flat</span><span class="p">,</span> <span class="p">[</span><span class="n">array_flat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
</span><span id="L-2186"><a href="#L-2186"><span class="linenos">2186</span></a>        <span class="n">perm</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">array_ndim</span><span class="p">))</span>
</span><span id="L-2187"><a href="#L-2187"><span class="linenos">2187</span></a>        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">array_dim</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span>
</span><span id="L-2188"><a href="#L-2188"><span class="linenos">2188</span></a>
</span><span id="L-2189"><a href="#L-2189"><span class="linenos">2189</span></a>      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">array_dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complexfloating</span><span class="p">):</span>
</span><span id="L-2190"><a href="#L-2190"><span class="linenos">2190</span></a>        <span class="n">resize_matrix</span> <span class="o">=</span> <span class="n">resize_matrix</span><span class="o">.</span><span class="n">with_values</span><span class="p">(</span><span class="n">_arr_astype</span><span class="p">(</span><span class="n">resize_matrix</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">array_dtype</span><span class="p">))</span>
</span><span id="L-2191"><a href="#L-2191"><span class="linenos">2191</span></a>        <span class="k">if</span> <span class="n">cval_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2192"><a href="#L-2192"><span class="linenos">2192</span></a>          <span class="n">cval_weight</span> <span class="o">=</span> <span class="n">_arr_astype</span><span class="p">(</span><span class="n">cval_weight</span><span class="p">,</span> <span class="n">array_dtype</span><span class="p">)</span>
</span><span id="L-2193"><a href="#L-2193"><span class="linenos">2193</span></a>      <span class="n">array</span> <span class="o">=</span> <span class="n">resize_tensorflow_dim</span><span class="p">()</span>
</span><span id="L-2194"><a href="#L-2194"><span class="linenos">2194</span></a>
</span><span id="L-2195"><a href="#L-2195"><span class="linenos">2195</span></a>    <span class="k">elif</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;torch&#39;</span><span class="p">:</span>
</span><span id="L-2196"><a href="#L-2196"><span class="linenos">2196</span></a>
</span><span id="L-2197"><a href="#L-2197"><span class="linenos">2197</span></a>      <span class="k">def</span> <span class="nf">resize_torch_dim</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">_TorchTensor</span><span class="p">:</span>
</span><span id="L-2198"><a href="#L-2198"><span class="linenos">2198</span></a>        <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-2199"><a href="#L-2199"><span class="linenos">2199</span></a>        <span class="c1"># No sparse complex: https://github.com/pytorch/pytorch/issues/50690.</span>
</span><span id="L-2200"><a href="#L-2200"><span class="linenos">2200</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">array_dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complexfloating</span><span class="p">)</span>
</span><span id="L-2201"><a href="#L-2201"><span class="linenos">2201</span></a>        <span class="n">array_dim</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-2202"><a href="#L-2202"><span class="linenos">2202</span></a>        <span class="n">array_flat</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="n">array_dim</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2203"><a href="#L-2203"><span class="linenos">2203</span></a>        <span class="k">if</span> <span class="n">internal_torch_contiguous</span><span class="p">:</span>  <span class="c1"># Greatly improves timings in some cases.</span>
</span><span id="L-2204"><a href="#L-2204"><span class="linenos">2204</span></a>          <span class="n">array_flat</span> <span class="o">=</span> <span class="n">array_flat</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
</span><span id="L-2205"><a href="#L-2205"><span class="linenos">2205</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">potential_pre_digital_filter</span><span class="p">(</span><span class="n">array_flat</span><span class="p">)</span>
</span><span id="L-2206"><a href="#L-2206"><span class="linenos">2206</span></a>
</span><span id="L-2207"><a href="#L-2207"><span class="linenos">2207</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">resize_matrix</span><span class="p">,</span> <span class="n">array_flat</span><span class="p">)</span>
</span><span id="L-2208"><a href="#L-2208"><span class="linenos">2208</span></a>        <span class="k">if</span> <span class="n">cval_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2209"><a href="#L-2209"><span class="linenos">2209</span></a>          <span class="n">cval_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">cval</span><span class="p">,</span> <span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2210"><a href="#L-2210"><span class="linenos">2210</span></a>          <span class="n">array_flat</span> <span class="o">+=</span> <span class="n">cval_weight</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">cval_flat</span>
</span><span id="L-2211"><a href="#L-2211"><span class="linenos">2211</span></a>
</span><span id="L-2212"><a href="#L-2212"><span class="linenos">2212</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">potential_post_digital_filter</span><span class="p">(</span><span class="n">array_flat</span><span class="p">)</span>
</span><span id="L-2213"><a href="#L-2213"><span class="linenos">2213</span></a>        <span class="n">array_dim</span> <span class="o">=</span> <span class="n">array_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array_flat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-2214"><a href="#L-2214"><span class="linenos">2214</span></a>        <span class="k">return</span> <span class="n">array_dim</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
</span><span id="L-2215"><a href="#L-2215"><span class="linenos">2215</span></a>
</span><span id="L-2216"><a href="#L-2216"><span class="linenos">2216</span></a>      <span class="n">array</span> <span class="o">=</span> <span class="n">resize_torch_dim</span><span class="p">()</span>
</span><span id="L-2217"><a href="#L-2217"><span class="linenos">2217</span></a>
</span><span id="L-2218"><a href="#L-2218"><span class="linenos">2218</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2219"><a href="#L-2219"><span class="linenos">2219</span></a>      <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">arraylib</span><span class="si">}</span><span class="s1"> is unrecognized.&#39;</span><span class="p">)</span>
</span><span id="L-2220"><a href="#L-2220"><span class="linenos">2220</span></a>
</span><span id="L-2221"><a href="#L-2221"><span class="linenos">2221</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">dst_gamma2</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-2222"><a href="#L-2222"><span class="linenos">2222</span></a>  <span class="k">return</span> <span class="n">array</span>
</span><span id="L-2223"><a href="#L-2223"><span class="linenos">2223</span></a>
</span><span id="L-2224"><a href="#L-2224"><span class="linenos">2224</span></a>
</span><span id="L-2225"><a href="#L-2225"><span class="linenos">2225</span></a><span class="n">_original_resize</span> <span class="o">=</span> <span class="n">resize</span>
</span><span id="L-2226"><a href="#L-2226"><span class="linenos">2226</span></a>
</span><span id="L-2227"><a href="#L-2227"><span class="linenos">2227</span></a>
</span><span id="L-2228"><a href="#L-2228"><span class="linenos">2228</span></a><span class="k">def</span> <span class="nf">resize_in_numpy</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-2229"><a href="#L-2229"><span class="linenos">2229</span></a>  <span class="sd">&quot;&quot;&quot;Just like `resize()` but asserts that the source is a numpy array.&quot;&quot;&quot;</span>
</span><span id="L-2230"><a href="#L-2230"><span class="linenos">2230</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="n">_arr_arraylib</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span>
</span><span id="L-2231"><a href="#L-2231"><span class="linenos">2231</span></a>  <span class="k">return</span> <span class="n">_original_resize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-2232"><a href="#L-2232"><span class="linenos">2232</span></a>
</span><span id="L-2233"><a href="#L-2233"><span class="linenos">2233</span></a>
</span><span id="L-2234"><a href="#L-2234"><span class="linenos">2234</span></a><span class="k">def</span> <span class="nf">resize_in_tensorflow</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-2235"><a href="#L-2235"><span class="linenos">2235</span></a>  <span class="sd">&quot;&quot;&quot;Evaluate the `resize()` operation using Tensorflow&#39;s Tensor representation and operations.</span>
</span><span id="L-2236"><a href="#L-2236"><span class="linenos">2236</span></a>
</span><span id="L-2237"><a href="#L-2237"><span class="linenos">2237</span></a><span class="sd">  Args:</span>
</span><span id="L-2238"><a href="#L-2238"><span class="linenos">2238</span></a><span class="sd">    array: Grid of source samples, represented as a numpy array.</span>
</span><span id="L-2239"><a href="#L-2239"><span class="linenos">2239</span></a><span class="sd">    *args: Parameters for `resize()`.</span>
</span><span id="L-2240"><a href="#L-2240"><span class="linenos">2240</span></a><span class="sd">    **kwargs: Parameters for `resize()`.</span>
</span><span id="L-2241"><a href="#L-2241"><span class="linenos">2241</span></a>
</span><span id="L-2242"><a href="#L-2242"><span class="linenos">2242</span></a><span class="sd">  Returns:</span>
</span><span id="L-2243"><a href="#L-2243"><span class="linenos">2243</span></a><span class="sd">    A numpy array.</span>
</span><span id="L-2244"><a href="#L-2244"><span class="linenos">2244</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-2245"><a href="#L-2245"><span class="linenos">2245</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="n">_arr_arraylib</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span>
</span><span id="L-2246"><a href="#L-2246"><span class="linenos">2246</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">_make_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">arraylib</span><span class="o">=</span><span class="s1">&#39;tensorflow&#39;</span><span class="p">)</span>
</span><span id="L-2247"><a href="#L-2247"><span class="linenos">2247</span></a>  <span class="k">return</span> <span class="n">_original_resize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="L-2248"><a href="#L-2248"><span class="linenos">2248</span></a>
</span><span id="L-2249"><a href="#L-2249"><span class="linenos">2249</span></a>
</span><span id="L-2250"><a href="#L-2250"><span class="linenos">2250</span></a><span class="k">def</span> <span class="nf">resize_in_torch</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-2251"><a href="#L-2251"><span class="linenos">2251</span></a>  <span class="sd">&quot;&quot;&quot;Evaluate the `resize()` operation using Torch&#39;s Tensor representation and operations.</span>
</span><span id="L-2252"><a href="#L-2252"><span class="linenos">2252</span></a>
</span><span id="L-2253"><a href="#L-2253"><span class="linenos">2253</span></a><span class="sd">  Args:</span>
</span><span id="L-2254"><a href="#L-2254"><span class="linenos">2254</span></a><span class="sd">    array: Grid of source samples, represented as a numpy array.</span>
</span><span id="L-2255"><a href="#L-2255"><span class="linenos">2255</span></a><span class="sd">    *args: Parameters for `resize()`.</span>
</span><span id="L-2256"><a href="#L-2256"><span class="linenos">2256</span></a><span class="sd">    **kwargs: Parameters for `resize()`.</span>
</span><span id="L-2257"><a href="#L-2257"><span class="linenos">2257</span></a>
</span><span id="L-2258"><a href="#L-2258"><span class="linenos">2258</span></a><span class="sd">  Returns:</span>
</span><span id="L-2259"><a href="#L-2259"><span class="linenos">2259</span></a><span class="sd">    A numpy array.</span>
</span><span id="L-2260"><a href="#L-2260"><span class="linenos">2260</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-2261"><a href="#L-2261"><span class="linenos">2261</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="n">_arr_arraylib</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span>
</span><span id="L-2262"><a href="#L-2262"><span class="linenos">2262</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">_make_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">arraylib</span><span class="o">=</span><span class="s1">&#39;torch&#39;</span><span class="p">)</span>
</span><span id="L-2263"><a href="#L-2263"><span class="linenos">2263</span></a>  <span class="k">return</span> <span class="n">_original_resize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span><span id="L-2264"><a href="#L-2264"><span class="linenos">2264</span></a>
</span><span id="L-2265"><a href="#L-2265"><span class="linenos">2265</span></a>
</span><span id="L-2266"><a href="#L-2266"><span class="linenos">2266</span></a><span class="n">_MAX_BLOCK_SIZE_RECURSING</span> <span class="o">=</span> <span class="o">-</span><span class="mi">999</span>  <span class="c1"># Special value to indicate re-invocation on partitioned blocks.</span>
</span><span id="L-2267"><a href="#L-2267"><span class="linenos">2267</span></a>
</span><span id="L-2268"><a href="#L-2268"><span class="linenos">2268</span></a>
</span><span id="L-2269"><a href="#L-2269"><span class="linenos">2269</span></a><span class="k">def</span> <span class="nf">resample</span><span class="p">(</span>                   <span class="c1"># pylint: disable=too-many-branches disable=too-many-statements</span>
</span><span id="L-2270"><a href="#L-2270"><span class="linenos">2270</span></a>    <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span>
</span><span id="L-2271"><a href="#L-2271"><span class="linenos">2271</span></a>    <span class="n">coords</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-2272"><a href="#L-2272"><span class="linenos">2272</span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="L-2273"><a href="#L-2273"><span class="linenos">2273</span></a>    <span class="n">gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;dual&#39;</span><span class="p">,</span>
</span><span id="L-2274"><a href="#L-2274"><span class="linenos">2274</span></a>    <span class="n">boundary</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Boundary</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Boundary</span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
</span><span id="L-2275"><a href="#L-2275"><span class="linenos">2275</span></a>    <span class="n">cval</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="L-2276"><a href="#L-2276"><span class="linenos">2276</span></a>    <span class="nb">filter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;lanczos3&#39;</span><span class="p">,</span>
</span><span id="L-2277"><a href="#L-2277"><span class="linenos">2277</span></a>    <span class="n">prefilter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2278"><a href="#L-2278"><span class="linenos">2278</span></a>    <span class="n">gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2279"><a href="#L-2279"><span class="linenos">2279</span></a>    <span class="n">src_gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2280"><a href="#L-2280"><span class="linenos">2280</span></a>    <span class="n">dst_gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2281"><a href="#L-2281"><span class="linenos">2281</span></a>    <span class="n">jacobian</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2282"><a href="#L-2282"><span class="linenos">2282</span></a>    <span class="n">precision</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2283"><a href="#L-2283"><span class="linenos">2283</span></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2284"><a href="#L-2284"><span class="linenos">2284</span></a>    <span class="n">max_block_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40_000</span><span class="p">,</span>
</span><span id="L-2285"><a href="#L-2285"><span class="linenos">2285</span></a>    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2286"><a href="#L-2286"><span class="linenos">2286</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-2287"><a href="#L-2287"><span class="linenos">2287</span></a>  <span class="sd">&quot;&quot;&quot;Interpolate a grid of source samples at specified unit-domain coordinates.</span>
</span><span id="L-2288"><a href="#L-2288"><span class="linenos">2288</span></a>
</span><span id="L-2289"><a href="#L-2289"><span class="linenos">2289</span></a><span class="sd">  The last dimension of `coords` contains unit-domain coordinates at which to interpolate the</span>
</span><span id="L-2290"><a href="#L-2290"><span class="linenos">2290</span></a><span class="sd">  domain grid samples in `array`.</span>
</span><span id="L-2291"><a href="#L-2291"><span class="linenos">2291</span></a>
</span><span id="L-2292"><a href="#L-2292"><span class="linenos">2292</span></a><span class="sd">  The number of coordinates (`coords.shape[-1]`) determines how to interpret `array`: its first</span>
</span><span id="L-2293"><a href="#L-2293"><span class="linenos">2293</span></a><span class="sd">  `coords.shape[-1]` dimensions define the grid, and the remaining dimensions describe each grid</span>
</span><span id="L-2294"><a href="#L-2294"><span class="linenos">2294</span></a><span class="sd">  sample (scalar, vector, tensor).</span>
</span><span id="L-2295"><a href="#L-2295"><span class="linenos">2295</span></a>
</span><span id="L-2296"><a href="#L-2296"><span class="linenos">2296</span></a><span class="sd">  Concretely, the grid has shape `array.shape[:coords.shape[-1]]` and each grid sample has shape</span>
</span><span id="L-2297"><a href="#L-2297"><span class="linenos">2297</span></a><span class="sd">  `array.shape[coords.shape[-1]:]`.</span>
</span><span id="L-2298"><a href="#L-2298"><span class="linenos">2298</span></a>
</span><span id="L-2299"><a href="#L-2299"><span class="linenos">2299</span></a><span class="sd">  Examples include:</span>
</span><span id="L-2300"><a href="#L-2300"><span class="linenos">2300</span></a>
</span><span id="L-2301"><a href="#L-2301"><span class="linenos">2301</span></a><span class="sd">  - Resample a grayscale image with `array.shape = height, width` onto a new grayscale image with</span>
</span><span id="L-2302"><a href="#L-2302"><span class="linenos">2302</span></a><span class="sd">    `new.shape = height2, width2` by using `coords.shape = height2, width2, 2`.</span>
</span><span id="L-2303"><a href="#L-2303"><span class="linenos">2303</span></a>
</span><span id="L-2304"><a href="#L-2304"><span class="linenos">2304</span></a><span class="sd">  - Resample an RGB image with `array.shape = height, width, 3` onto a new RGB image with</span>
</span><span id="L-2305"><a href="#L-2305"><span class="linenos">2305</span></a><span class="sd">    `new.shape = height2, width2, 3` by using `coords.shape = height2, width2, 2`.</span>
</span><span id="L-2306"><a href="#L-2306"><span class="linenos">2306</span></a>
</span><span id="L-2307"><a href="#L-2307"><span class="linenos">2307</span></a><span class="sd">  - Sample an RGB image at `num` 2D points along a line segment by using `coords.shape = num, 2`.</span>
</span><span id="L-2308"><a href="#L-2308"><span class="linenos">2308</span></a>
</span><span id="L-2309"><a href="#L-2309"><span class="linenos">2309</span></a><span class="sd">  - Sample an RGB image at a single 2D point by using `coords.shape = (2,)`.</span>
</span><span id="L-2310"><a href="#L-2310"><span class="linenos">2310</span></a>
</span><span id="L-2311"><a href="#L-2311"><span class="linenos">2311</span></a><span class="sd">  - Sample a 3D grid of 3x3 Jacobians with `array.shape = nz, ny, nx, 3, 3` along a 2D plane by</span>
</span><span id="L-2312"><a href="#L-2312"><span class="linenos">2312</span></a><span class="sd">    using `coords.shape = height, width, 3`.</span>
</span><span id="L-2313"><a href="#L-2313"><span class="linenos">2313</span></a>
</span><span id="L-2314"><a href="#L-2314"><span class="linenos">2314</span></a><span class="sd">  - Map a grayscale image through a color map by using `array.shape = 256, 3` and</span>
</span><span id="L-2315"><a href="#L-2315"><span class="linenos">2315</span></a><span class="sd">    `coords.shape = height, width`.</span>
</span><span id="L-2316"><a href="#L-2316"><span class="linenos">2316</span></a>
</span><span id="L-2317"><a href="#L-2317"><span class="linenos">2317</span></a><span class="sd">  Args:</span>
</span><span id="L-2318"><a href="#L-2318"><span class="linenos">2318</span></a><span class="sd">    array: Grid of source sample values.  It must be an array-like object from a library in</span>
</span><span id="L-2319"><a href="#L-2319"><span class="linenos">2319</span></a><span class="sd">      `ARRAYLIBS`.  The array must have numeric type.  The coordinate dimensions appear first, and</span>
</span><span id="L-2320"><a href="#L-2320"><span class="linenos">2320</span></a><span class="sd">      each grid sample may have an arbitrary shape.  Each grid dimension must be at least 1 for</span>
</span><span id="L-2321"><a href="#L-2321"><span class="linenos">2321</span></a><span class="sd">      a `dual` grid or at least 2 for a `primal` grid.</span>
</span><span id="L-2322"><a href="#L-2322"><span class="linenos">2322</span></a><span class="sd">    coords: Grid of points at which to resample `array`.  The point coordinates are in the last</span>
</span><span id="L-2323"><a href="#L-2323"><span class="linenos">2323</span></a><span class="sd">      dimension of `coords`.  The domain associated with the source grid is a unit hypercube,</span>
</span><span id="L-2324"><a href="#L-2324"><span class="linenos">2324</span></a><span class="sd">      i.e. with a range [0, 1] on each coordinate dimension.  The output grid has shape</span>
</span><span id="L-2325"><a href="#L-2325"><span class="linenos">2325</span></a><span class="sd">      `coords.shape[:-1]` and each of its grid samples has shape `array.shape[coords.shape[-1]:]`.</span>
</span><span id="L-2326"><a href="#L-2326"><span class="linenos">2326</span></a><span class="sd">    gridtype: Placement of the samples in the source domain grid for each dimension, specified as</span>
</span><span id="L-2327"><a href="#L-2327"><span class="linenos">2327</span></a><span class="sd">      either a name in `GRIDTYPES` or a `Gridtype` instance.</span>
</span><span id="L-2328"><a href="#L-2328"><span class="linenos">2328</span></a><span class="sd">    boundary: The reconstruction boundary rule for each dimension in `coords.shape[-1]`, specified</span>
</span><span id="L-2329"><a href="#L-2329"><span class="linenos">2329</span></a><span class="sd">      as either a name in `BOUNDARIES` or a `Boundary` instance.  The special value &#39;auto&#39; uses</span>
</span><span id="L-2330"><a href="#L-2330"><span class="linenos">2330</span></a><span class="sd">      &#39;reflect&#39; for upsampling and &#39;clamp&#39; for downsampling.</span>
</span><span id="L-2331"><a href="#L-2331"><span class="linenos">2331</span></a><span class="sd">    cval: Constant value used beyond the samples by some boundary rules.  It must be broadcastable</span>
</span><span id="L-2332"><a href="#L-2332"><span class="linenos">2332</span></a><span class="sd">      onto the shape `array.shape[coords.shape[-1]:]`.</span>
</span><span id="L-2333"><a href="#L-2333"><span class="linenos">2333</span></a><span class="sd">    filter: The reconstruction kernel for each dimension in `coords.shape[-1]`, specified as either</span>
</span><span id="L-2334"><a href="#L-2334"><span class="linenos">2334</span></a><span class="sd">      a filter name in `FILTERS` or a `Filter` instance.</span>
</span><span id="L-2335"><a href="#L-2335"><span class="linenos">2335</span></a><span class="sd">    prefilter: The prefilter kernel for each dimension in `coords.shape[:-1]`, specified as either</span>
</span><span id="L-2336"><a href="#L-2336"><span class="linenos">2336</span></a><span class="sd">      a filter name in `FILTERS` or a `Filter` instance.  It is used during downsampling</span>
</span><span id="L-2337"><a href="#L-2337"><span class="linenos">2337</span></a><span class="sd">      (i.e., minification).  If None, it inherits the value of `filter`.</span>
</span><span id="L-2338"><a href="#L-2338"><span class="linenos">2338</span></a><span class="sd">    gamma: Component transfer functions (e.g., gamma correction) applied when reading samples</span>
</span><span id="L-2339"><a href="#L-2339"><span class="linenos">2339</span></a><span class="sd">      from `array` and when creating output grid samples.  It is specified as either a name in</span>
</span><span id="L-2340"><a href="#L-2340"><span class="linenos">2340</span></a><span class="sd">      `GAMMAS` or a `Gamma` instance.  If both `array.dtype` and `dtype` are `uint`, the default</span>
</span><span id="L-2341"><a href="#L-2341"><span class="linenos">2341</span></a><span class="sd">      is `power2`.  If both are non-`uint`, the default is `identity`.  Otherwise, `gamma` or</span>
</span><span id="L-2342"><a href="#L-2342"><span class="linenos">2342</span></a><span class="sd">      `src_gamma`/`dst_gamma` must be set.   Gamma correction assumes that float values are in the</span>
</span><span id="L-2343"><a href="#L-2343"><span class="linenos">2343</span></a><span class="sd">      range [0.0, 1.0].</span>
</span><span id="L-2344"><a href="#L-2344"><span class="linenos">2344</span></a><span class="sd">    src_gamma: Component transfer function used to &quot;decode&quot; `array` samples.</span>
</span><span id="L-2345"><a href="#L-2345"><span class="linenos">2345</span></a><span class="sd">      Parameters `gamma` and `src_gamma` cannot both be set.</span>
</span><span id="L-2346"><a href="#L-2346"><span class="linenos">2346</span></a><span class="sd">    dst_gamma: Component transfer function used to &quot;encode&quot; the output samples.</span>
</span><span id="L-2347"><a href="#L-2347"><span class="linenos">2347</span></a><span class="sd">      Parameters `gamma` and `dst_gamma` cannot both be set.</span>
</span><span id="L-2348"><a href="#L-2348"><span class="linenos">2348</span></a><span class="sd">    jacobian: Optional array, which must be broadcastable onto the shape</span>
</span><span id="L-2349"><a href="#L-2349"><span class="linenos">2349</span></a><span class="sd">      `coords.shape[:-1] + (coords.shape[-1], coords.shape[-1])`, storing for each point in the</span>
</span><span id="L-2350"><a href="#L-2350"><span class="linenos">2350</span></a><span class="sd">      output grid the Jacobian matrix of the map from the unit output domain to the unit source</span>
</span><span id="L-2351"><a href="#L-2351"><span class="linenos">2351</span></a><span class="sd">      domain.  If omitted, it is estimated by computing finite differences on `coords`.</span>
</span><span id="L-2352"><a href="#L-2352"><span class="linenos">2352</span></a><span class="sd">    precision: Inexact precision of intermediate computations.  If None, it is determined based on</span>
</span><span id="L-2353"><a href="#L-2353"><span class="linenos">2353</span></a><span class="sd">      `array.dtype`, `coords.dtype`, and `dtype`.</span>
</span><span id="L-2354"><a href="#L-2354"><span class="linenos">2354</span></a><span class="sd">    dtype: Desired data type of the output array.  If None, it is taken to be `array.dtype`.</span>
</span><span id="L-2355"><a href="#L-2355"><span class="linenos">2355</span></a><span class="sd">      If it is a uint type, the intermediate float values are rescaled from the [0.0, 1.0] range</span>
</span><span id="L-2356"><a href="#L-2356"><span class="linenos">2356</span></a><span class="sd">      to the uint range.</span>
</span><span id="L-2357"><a href="#L-2357"><span class="linenos">2357</span></a><span class="sd">    max_block_size: If nonzero, maximum number of grid points in `coords` before the resampling</span>
</span><span id="L-2358"><a href="#L-2358"><span class="linenos">2358</span></a><span class="sd">      evaluation gets partitioned into smaller blocks for reduced memory usage and better caching.</span>
</span><span id="L-2359"><a href="#L-2359"><span class="linenos">2359</span></a><span class="sd">    debug: Show internal information.</span>
</span><span id="L-2360"><a href="#L-2360"><span class="linenos">2360</span></a>
</span><span id="L-2361"><a href="#L-2361"><span class="linenos">2361</span></a><span class="sd">  Returns:</span>
</span><span id="L-2362"><a href="#L-2362"><span class="linenos">2362</span></a><span class="sd">    A new sample grid of shape `coords.shape[:-1]`, represented as an array of shape</span>
</span><span id="L-2363"><a href="#L-2363"><span class="linenos">2363</span></a><span class="sd">    `coords.shape[:-1] + array.shape[coords.shape[-1]:]`, of the same array library type as</span>
</span><span id="L-2364"><a href="#L-2364"><span class="linenos">2364</span></a><span class="sd">    the source array.</span>
</span><span id="L-2365"><a href="#L-2365"><span class="linenos">2365</span></a>
</span><span id="L-2366"><a href="#L-2366"><span class="linenos">2366</span></a><span class="sd">  For reference, the identity resampling for a scalar-valued grid with the default grid-type</span>
</span><span id="L-2367"><a href="#L-2367"><span class="linenos">2367</span></a><span class="sd">  &#39;dual&#39; is:</span>
</span><span id="L-2368"><a href="#L-2368"><span class="linenos">2368</span></a>
</span><span id="L-2369"><a href="#L-2369"><span class="linenos">2369</span></a><span class="sd">  &gt;&gt;&gt; array = np.random.rand(5, 7, 3)</span>
</span><span id="L-2370"><a href="#L-2370"><span class="linenos">2370</span></a><span class="sd">  &gt;&gt;&gt; coords = (np.moveaxis(np.indices(array.shape), 0, -1) + 0.5) / array.shape</span>
</span><span id="L-2371"><a href="#L-2371"><span class="linenos">2371</span></a><span class="sd">  &gt;&gt;&gt; new_array = resample(array, coords)</span>
</span><span id="L-2372"><a href="#L-2372"><span class="linenos">2372</span></a><span class="sd">  &gt;&gt;&gt; assert np.allclose(new_array, array)</span>
</span><span id="L-2373"><a href="#L-2373"><span class="linenos">2373</span></a>
</span><span id="L-2374"><a href="#L-2374"><span class="linenos">2374</span></a><span class="sd">  It is more efficient to use the function `resize` for the special case where the `coords` are</span>
</span><span id="L-2375"><a href="#L-2375"><span class="linenos">2375</span></a><span class="sd">  obtained as simple scaling and translation of a new regular grid over the source domain:</span>
</span><span id="L-2376"><a href="#L-2376"><span class="linenos">2376</span></a>
</span><span id="L-2377"><a href="#L-2377"><span class="linenos">2377</span></a><span class="sd">  &gt;&gt;&gt; scale, translate, new_shape = (1.1, 1.2), (0.1, -0.2), (6, 8)</span>
</span><span id="L-2378"><a href="#L-2378"><span class="linenos">2378</span></a><span class="sd">  &gt;&gt;&gt; coords = (np.moveaxis(np.indices(new_shape), 0, -1) + 0.5) / new_shape</span>
</span><span id="L-2379"><a href="#L-2379"><span class="linenos">2379</span></a><span class="sd">  &gt;&gt;&gt; coords = (coords - translate) / scale</span>
</span><span id="L-2380"><a href="#L-2380"><span class="linenos">2380</span></a><span class="sd">  &gt;&gt;&gt; resampled = resample(array, coords)</span>
</span><span id="L-2381"><a href="#L-2381"><span class="linenos">2381</span></a><span class="sd">  &gt;&gt;&gt; resized = resize(array, new_shape, scale=scale, translate=translate)</span>
</span><span id="L-2382"><a href="#L-2382"><span class="linenos">2382</span></a><span class="sd">  &gt;&gt;&gt; assert np.allclose(resampled, resized)</span>
</span><span id="L-2383"><a href="#L-2383"><span class="linenos">2383</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-2384"><a href="#L-2384"><span class="linenos">2384</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span><span id="L-2385"><a href="#L-2385"><span class="linenos">2385</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-2386"><a href="#L-2386"><span class="linenos">2386</span></a>  <span class="n">arraylib</span> <span class="o">=</span> <span class="n">_arr_arraylib</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-2387"><a href="#L-2387"><span class="linenos">2387</span></a>  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2388"><a href="#L-2388"><span class="linenos">2388</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
</span><span id="L-2389"><a href="#L-2389"><span class="linenos">2389</span></a>  <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
</span><span id="L-2390"><a href="#L-2390"><span class="linenos">2390</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
</span><span id="L-2391"><a href="#L-2391"><span class="linenos">2391</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Type </span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s1"> is not numeric.&#39;</span><span class="p">)</span>
</span><span id="L-2392"><a href="#L-2392"><span class="linenos">2392</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">):</span>
</span><span id="L-2393"><a href="#L-2393"><span class="linenos">2393</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Type </span><span class="si">{</span><span class="n">coords</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s1"> is not floating.&#39;</span><span class="p">)</span>
</span><span id="L-2394"><a href="#L-2394"><span class="linenos">2394</span></a>  <span class="n">array_ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2395"><a href="#L-2395"><span class="linenos">2395</span></a>  <span class="k">if</span> <span class="n">coords</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">array_ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2396"><a href="#L-2396"><span class="linenos">2396</span></a>    <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-2397"><a href="#L-2397"><span class="linenos">2397</span></a>  <span class="n">grid_ndim</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2398"><a href="#L-2398"><span class="linenos">2398</span></a>  <span class="n">grid_shape</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="n">grid_ndim</span><span class="p">]</span>
</span><span id="L-2399"><a href="#L-2399"><span class="linenos">2399</span></a>  <span class="n">sample_shape</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">grid_ndim</span><span class="p">:]</span>
</span><span id="L-2400"><a href="#L-2400"><span class="linenos">2400</span></a>  <span class="n">resampled_ndim</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="L-2401"><a href="#L-2401"><span class="linenos">2401</span></a>  <span class="n">resampled_shape</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2402"><a href="#L-2402"><span class="linenos">2402</span></a>  <span class="k">if</span> <span class="n">grid_ndim</span> <span class="o">&gt;</span> <span class="n">array_ndim</span><span class="p">:</span>
</span><span id="L-2403"><a href="#L-2403"><span class="linenos">2403</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are more coordinate dimensions (</span><span class="si">{</span><span class="n">grid_ndim</span><span class="si">}</span><span class="s1">) in&#39;</span>
</span><span id="L-2404"><a href="#L-2404"><span class="linenos">2404</span></a>                     <span class="sa">f</span><span class="s1">&#39; coords </span><span class="si">{</span><span class="n">coords</span><span class="si">}</span><span class="s1"> than in array.shape </span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="L-2405"><a href="#L-2405"><span class="linenos">2405</span></a>  <span class="n">gridtype2</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">)</span> <span class="k">else</span> <span class="n">GRIDTYPES</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>
</span><span id="L-2406"><a href="#L-2406"><span class="linenos">2406</span></a>               <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gridtype</span><span class="p">),</span> <span class="n">grid_ndim</span><span class="p">)]</span>
</span><span id="L-2407"><a href="#L-2407"><span class="linenos">2407</span></a>  <span class="n">boundary2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">boundary</span><span class="p">),</span> <span class="n">grid_ndim</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="L-2408"><a href="#L-2408"><span class="linenos">2408</span></a>  <span class="n">cval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">cval</span><span class="p">,</span> <span class="n">sample_shape</span><span class="p">)</span>
</span><span id="L-2409"><a href="#L-2409"><span class="linenos">2409</span></a>  <span class="n">prefilter</span> <span class="o">=</span> <span class="nb">filter</span> <span class="k">if</span> <span class="n">prefilter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">prefilter</span>
</span><span id="L-2410"><a href="#L-2410"><span class="linenos">2410</span></a>  <span class="n">filter2</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_filter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">filter</span><span class="p">),</span> <span class="n">grid_ndim</span><span class="p">)]</span>
</span><span id="L-2411"><a href="#L-2411"><span class="linenos">2411</span></a>  <span class="n">prefilter2</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_filter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">prefilter</span><span class="p">),</span> <span class="n">resampled_ndim</span><span class="p">)]</span>
</span><span id="L-2412"><a href="#L-2412"><span class="linenos">2412</span></a>  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-2413"><a href="#L-2413"><span class="linenos">2413</span></a>  <span class="n">src_gamma2</span><span class="p">,</span> <span class="n">dst_gamma2</span> <span class="o">=</span> <span class="n">_get_src_dst_gamma</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">src_gamma</span><span class="p">,</span> <span class="n">dst_gamma</span><span class="p">,</span> <span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="L-2414"><a href="#L-2414"><span class="linenos">2414</span></a>  <span class="k">del</span> <span class="n">gridtype</span><span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">prefilter</span><span class="p">,</span> <span class="n">src_gamma</span><span class="p">,</span> <span class="n">dst_gamma</span>
</span><span id="L-2415"><a href="#L-2415"><span class="linenos">2415</span></a>  <span class="k">if</span> <span class="n">jacobian</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2416"><a href="#L-2416"><span class="linenos">2416</span></a>    <span class="n">jacobian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">jacobian</span><span class="p">,</span> <span class="n">resampled_shape</span> <span class="o">+</span> <span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2417"><a href="#L-2417"><span class="linenos">2417</span></a>  <span class="n">precision</span> <span class="o">=</span> <span class="n">_get_precision</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="p">[</span><span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">dtype</span><span class="p">],</span> <span class="p">[</span><span class="n">coords</span><span class="o">.</span><span class="n">dtype</span><span class="p">])</span>
</span><span id="L-2418"><a href="#L-2418"><span class="linenos">2418</span></a>  <span class="n">weight_precision</span> <span class="o">=</span> <span class="n">_real_precision</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span>
</span><span id="L-2419"><a href="#L-2419"><span class="linenos">2419</span></a>  <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">weight_precision</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-2420"><a href="#L-2420"><span class="linenos">2420</span></a>  <span class="n">is_minification</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Current limitation; no prefiltering!</span>
</span><span id="L-2421"><a href="#L-2421"><span class="linenos">2421</span></a>  <span class="k">assert</span> <span class="n">max_block_size</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">max_block_size</span> <span class="o">==</span> <span class="n">_MAX_BLOCK_SIZE_RECURSING</span>
</span><span id="L-2422"><a href="#L-2422"><span class="linenos">2422</span></a>  <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_ndim</span><span class="p">):</span>
</span><span id="L-2423"><a href="#L-2423"><span class="linenos">2423</span></a>    <span class="k">if</span> <span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
</span><span id="L-2424"><a href="#L-2424"><span class="linenos">2424</span></a>      <span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;clamp&#39;</span> <span class="k">if</span> <span class="n">is_minification</span> <span class="k">else</span> <span class="s1">&#39;reflect&#39;</span>
</span><span id="L-2425"><a href="#L-2425"><span class="linenos">2425</span></a>    <span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">Boundary</span><span class="p">)</span> <span class="k">else</span>
</span><span id="L-2426"><a href="#L-2426"><span class="linenos">2426</span></a>                      <span class="n">BOUNDARIES</span><span class="p">[</span><span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">]])</span>
</span><span id="L-2427"><a href="#L-2427"><span class="linenos">2427</span></a>
</span><span id="L-2428"><a href="#L-2428"><span class="linenos">2428</span></a>  <span class="k">if</span> <span class="n">max_block_size</span> <span class="o">!=</span> <span class="n">_MAX_BLOCK_SIZE_RECURSING</span><span class="p">:</span>
</span><span id="L-2429"><a href="#L-2429"><span class="linenos">2429</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">src_gamma2</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
</span><span id="L-2430"><a href="#L-2430"><span class="linenos">2430</span></a>    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_ndim</span><span class="p">):</span>
</span><span id="L-2431"><a href="#L-2431"><span class="linenos">2431</span></a>      <span class="k">assert</span> <span class="ow">not</span> <span class="n">is_minification</span>
</span><span id="L-2432"><a href="#L-2432"><span class="linenos">2432</span></a>      <span class="n">array</span> <span class="o">=</span> <span class="n">_apply_potential_digital_filter_1d</span><span class="p">(</span>
</span><span id="L-2433"><a href="#L-2433"><span class="linenos">2433</span></a>          <span class="n">array</span><span class="p">,</span> <span class="n">gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">cval</span><span class="p">,</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="n">dim</span><span class="p">)</span>
</span><span id="L-2434"><a href="#L-2434"><span class="linenos">2434</span></a>
</span><span id="L-2435"><a href="#L-2435"><span class="linenos">2435</span></a>  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">resampled_shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_block_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-2436"><a href="#L-2436"><span class="linenos">2436</span></a>    <span class="n">block_shape</span> <span class="o">=</span> <span class="n">_block_shape_with_min_size</span><span class="p">(</span><span class="n">resampled_shape</span><span class="p">,</span> <span class="n">max_block_size</span><span class="p">)</span>
</span><span id="L-2437"><a href="#L-2437"><span class="linenos">2437</span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="L-2438"><a href="#L-2438"><span class="linenos">2438</span></a>      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;(resample: splitting coords into blocks </span><span class="si">{</span><span class="n">block_shape</span><span class="si">}</span><span class="s1">).&#39;</span><span class="p">)</span>
</span><span id="L-2439"><a href="#L-2439"><span class="linenos">2439</span></a>    <span class="n">coord_blocks</span> <span class="o">=</span> <span class="n">_split_array_into_blocks</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">block_shape</span><span class="p">)</span>
</span><span id="L-2440"><a href="#L-2440"><span class="linenos">2440</span></a>
</span><span id="L-2441"><a href="#L-2441"><span class="linenos">2441</span></a>    <span class="k">def</span> <span class="nf">process_block</span><span class="p">(</span><span class="n">coord_block</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-2442"><a href="#L-2442"><span class="linenos">2442</span></a>      <span class="k">return</span> <span class="n">resample</span><span class="p">(</span>
</span><span id="L-2443"><a href="#L-2443"><span class="linenos">2443</span></a>          <span class="n">array</span><span class="p">,</span> <span class="n">coord_block</span><span class="p">,</span> <span class="n">gridtype</span><span class="o">=</span><span class="n">gridtype2</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="n">boundary2</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">cval</span><span class="p">,</span>
</span><span id="L-2444"><a href="#L-2444"><span class="linenos">2444</span></a>          <span class="nb">filter</span><span class="o">=</span><span class="n">filter2</span><span class="p">,</span> <span class="n">prefilter</span><span class="o">=</span><span class="n">prefilter2</span><span class="p">,</span> <span class="n">src_gamma</span><span class="o">=</span><span class="s1">&#39;identity&#39;</span><span class="p">,</span> <span class="n">dst_gamma</span><span class="o">=</span><span class="n">dst_gamma2</span><span class="p">,</span>
</span><span id="L-2445"><a href="#L-2445"><span class="linenos">2445</span></a>          <span class="n">jacobian</span><span class="o">=</span><span class="n">jacobian</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
</span><span id="L-2446"><a href="#L-2446"><span class="linenos">2446</span></a>          <span class="n">max_block_size</span><span class="o">=</span><span class="n">_MAX_BLOCK_SIZE_RECURSING</span><span class="p">)</span>
</span><span id="L-2447"><a href="#L-2447"><span class="linenos">2447</span></a>
</span><span id="L-2448"><a href="#L-2448"><span class="linenos">2448</span></a>    <span class="n">result_blocks</span> <span class="o">=</span> <span class="n">_map_function_over_blocks</span><span class="p">(</span><span class="n">coord_blocks</span><span class="p">,</span> <span class="n">process_block</span><span class="p">)</span>
</span><span id="L-2449"><a href="#L-2449"><span class="linenos">2449</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">_merge_array_from_blocks</span><span class="p">(</span><span class="n">result_blocks</span><span class="p">)</span>
</span><span id="L-2450"><a href="#L-2450"><span class="linenos">2450</span></a>    <span class="k">return</span> <span class="n">array</span>
</span><span id="L-2451"><a href="#L-2451"><span class="linenos">2451</span></a>
</span><span id="L-2452"><a href="#L-2452"><span class="linenos">2452</span></a>  <span class="c1"># A concrete example of upsampling:</span>
</span><span id="L-2453"><a href="#L-2453"><span class="linenos">2453</span></a>  <span class="c1">#   array = np.ones((5, 7, 3))  # source RGB image has height=5 width=7</span>
</span><span id="L-2454"><a href="#L-2454"><span class="linenos">2454</span></a>  <span class="c1">#   coords = np.random.rand(8, 9, 2)  # output RGB image has height=8 width=9</span>
</span><span id="L-2455"><a href="#L-2455"><span class="linenos">2455</span></a>  <span class="c1">#   resample(array, coords, filter=(&#39;cubic&#39;, &#39;lanczos3&#39;))</span>
</span><span id="L-2456"><a href="#L-2456"><span class="linenos">2456</span></a>  <span class="c1">#   grid_shape = 5, 7  grid_ndim = 2</span>
</span><span id="L-2457"><a href="#L-2457"><span class="linenos">2457</span></a>  <span class="c1">#   resampled_shape = 8, 9  resampled_ndim = 2</span>
</span><span id="L-2458"><a href="#L-2458"><span class="linenos">2458</span></a>  <span class="c1">#   sample_shape = (3,)</span>
</span><span id="L-2459"><a href="#L-2459"><span class="linenos">2459</span></a>  <span class="c1">#   src_float_index.shape = 8, 9</span>
</span><span id="L-2460"><a href="#L-2460"><span class="linenos">2460</span></a>  <span class="c1">#   src_first_index.shape = 8, 9</span>
</span><span id="L-2461"><a href="#L-2461"><span class="linenos">2461</span></a>  <span class="c1">#   sample_index.shape = (4,) for dim == 0, then (6,) for dim == 1</span>
</span><span id="L-2462"><a href="#L-2462"><span class="linenos">2462</span></a>  <span class="c1">#   weight = [shape(8, 9, 4), shape(8, 9, 6)]</span>
</span><span id="L-2463"><a href="#L-2463"><span class="linenos">2463</span></a>  <span class="c1">#   src_index = [shape(8, 9, 4), shape(8, 9, 6)]</span>
</span><span id="L-2464"><a href="#L-2464"><span class="linenos">2464</span></a>
</span><span id="L-2465"><a href="#L-2465"><span class="linenos">2465</span></a>  <span class="c1"># Both:[shape(8, 9, 4), shape(8, 9, 6)]</span>
</span><span id="L-2466"><a href="#L-2466"><span class="linenos">2466</span></a>  <span class="n">weight</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_ndim</span><span class="p">)]</span>
</span><span id="L-2467"><a href="#L-2467"><span class="linenos">2467</span></a>  <span class="n">src_index</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_ndim</span><span class="p">)]</span>
</span><span id="L-2468"><a href="#L-2468"><span class="linenos">2468</span></a>  <span class="n">uses_cval</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2469"><a href="#L-2469"><span class="linenos">2469</span></a>  <span class="n">all_num_samples</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># will be [4, 6]</span>
</span><span id="L-2470"><a href="#L-2470"><span class="linenos">2470</span></a>
</span><span id="L-2471"><a href="#L-2471"><span class="linenos">2471</span></a>  <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_ndim</span><span class="p">):</span>
</span><span id="L-2472"><a href="#L-2472"><span class="linenos">2472</span></a>    <span class="n">src_size</span> <span class="o">=</span> <span class="n">grid_shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>  <span class="c1"># scalar</span>
</span><span id="L-2473"><a href="#L-2473"><span class="linenos">2473</span></a>    <span class="n">coords_dim</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">dim</span><span class="p">]</span>  <span class="c1"># (8, 9)</span>
</span><span id="L-2474"><a href="#L-2474"><span class="linenos">2474</span></a>    <span class="n">radius</span> <span class="o">=</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">radius</span>  <span class="c1"># scalar</span>
</span><span id="L-2475"><a href="#L-2475"><span class="linenos">2475</span></a>    <span class="n">num_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># scalar</span>
</span><span id="L-2476"><a href="#L-2476"><span class="linenos">2476</span></a>    <span class="n">all_num_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)</span>
</span><span id="L-2477"><a href="#L-2477"><span class="linenos">2477</span></a>
</span><span id="L-2478"><a href="#L-2478"><span class="linenos">2478</span></a>    <span class="n">boundary_dim</span> <span class="o">=</span> <span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
</span><span id="L-2479"><a href="#L-2479"><span class="linenos">2479</span></a>    <span class="n">coords_dim</span> <span class="o">=</span> <span class="n">boundary_dim</span><span class="o">.</span><span class="n">preprocess_coordinates</span><span class="p">(</span><span class="n">coords_dim</span><span class="p">)</span>
</span><span id="L-2480"><a href="#L-2480"><span class="linenos">2480</span></a>
</span><span id="L-2481"><a href="#L-2481"><span class="linenos">2481</span></a>    <span class="c1"># Sample positions mapped back to source unit domain [0, 1].</span>
</span><span id="L-2482"><a href="#L-2482"><span class="linenos">2482</span></a>    <span class="n">src_float_index</span> <span class="o">=</span> <span class="n">gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">index_from_point</span><span class="p">(</span><span class="n">coords_dim</span><span class="p">,</span> <span class="n">src_size</span><span class="p">)</span>  <span class="c1"># (8, 9)</span>
</span><span id="L-2483"><a href="#L-2483"><span class="linenos">2483</span></a>    <span class="n">src_first_index</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-2484"><a href="#L-2484"><span class="linenos">2484</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">src_float_index</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span> <span class="k">if</span> <span class="n">num_samples</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="L-2485"><a href="#L-2485"><span class="linenos">2485</span></a>        <span class="o">-</span> <span class="p">(</span><span class="n">num_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># (8, 9)</span>
</span><span id="L-2486"><a href="#L-2486"><span class="linenos">2486</span></a>
</span><span id="L-2487"><a href="#L-2487"><span class="linenos">2487</span></a>    <span class="n">sample_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>  <span class="c1"># (4,) then (6,)</span>
</span><span id="L-2488"><a href="#L-2488"><span class="linenos">2488</span></a>    <span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">src_first_index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">sample_index</span>  <span class="c1"># (8, 9, 4) then (8, 9, 6)</span>
</span><span id="L-2489"><a href="#L-2489"><span class="linenos">2489</span></a>    <span class="k">if</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;trapezoid&#39;</span><span class="p">:</span>
</span><span id="L-2490"><a href="#L-2490"><span class="linenos">2490</span></a>      <span class="c1"># (It might require changing the filter radius at every sample.)</span>
</span><span id="L-2491"><a href="#L-2491"><span class="linenos">2491</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;resample() cannot use adaptive `trapezoid` filter.&#39;</span><span class="p">)</span>
</span><span id="L-2492"><a href="#L-2492"><span class="linenos">2492</span></a>    <span class="k">if</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;impulse&#39;</span><span class="p">:</span>
</span><span id="L-2493"><a href="#L-2493"><span class="linenos">2493</span></a>      <span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">weight_precision</span><span class="p">)</span>
</span><span id="L-2494"><a href="#L-2494"><span class="linenos">2494</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2495"><a href="#L-2495"><span class="linenos">2495</span></a>      <span class="n">x</span> <span class="o">=</span> <span class="n">src_float_index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">weight_precision</span><span class="p">)</span>
</span><span id="L-2496"><a href="#L-2496"><span class="linenos">2496</span></a>      <span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">](</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">weight_precision</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-2497"><a href="#L-2497"><span class="linenos">2497</span></a>      <span class="k">if</span> <span class="p">(</span><span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;narrowbox&#39;</span> <span class="ow">and</span>
</span><span id="L-2498"><a href="#L-2498"><span class="linenos">2498</span></a>          <span class="p">(</span><span class="n">is_minification</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">partition_of_unity</span><span class="p">)):</span>
</span><span id="L-2499"><a href="#L-2499"><span class="linenos">2499</span></a>        <span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">/</span> <span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="L-2500"><a href="#L-2500"><span class="linenos">2500</span></a>
</span><span id="L-2501"><a href="#L-2501"><span class="linenos">2501</span></a>    <span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">boundary_dim</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="L-2502"><a href="#L-2502"><span class="linenos">2502</span></a>        <span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">coords_dim</span><span class="p">,</span> <span class="n">src_size</span><span class="p">,</span> <span class="n">gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
</span><span id="L-2503"><a href="#L-2503"><span class="linenos">2503</span></a>    <span class="k">if</span> <span class="n">boundary_dim</span><span class="o">.</span><span class="n">uses_cval</span> <span class="ow">or</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;narrowbox&#39;</span><span class="p">:</span>
</span><span id="L-2504"><a href="#L-2504"><span class="linenos">2504</span></a>      <span class="n">uses_cval</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2505"><a href="#L-2505"><span class="linenos">2505</span></a>
</span><span id="L-2506"><a href="#L-2506"><span class="linenos">2506</span></a>  <span class="c1"># match arraylib:</span>
</span><span id="L-2507"><a href="#L-2507"><span class="linenos">2507</span></a>  <span class="k">if</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;tensorflow&#39;</span><span class="p">:</span>
</span><span id="L-2508"><a href="#L-2508"><span class="linenos">2508</span></a>    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-2509"><a href="#L-2509"><span class="linenos">2509</span></a>    <span class="c1"># Recall that src_index = [shape(8, 9, 4), shape(8, 9, 6)].</span>
</span><span id="L-2510"><a href="#L-2510"><span class="linenos">2510</span></a>    <span class="n">gather_shape</span> <span class="o">=</span> <span class="n">resampled_shape</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">src_index</span><span class="p">)</span>  <span class="c1"># (8, 9, 4, 6)</span>
</span><span id="L-2511"><a href="#L-2511"><span class="linenos">2511</span></a>    <span class="n">src_index_expanded</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2512"><a href="#L-2512"><span class="linenos">2512</span></a>    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_ndim</span><span class="p">):</span>
</span><span id="L-2513"><a href="#L-2513"><span class="linenos">2513</span></a>      <span class="n">src_index_dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span>
</span><span id="L-2514"><a href="#L-2514"><span class="linenos">2514</span></a>          <span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="p">(</span><span class="n">grid_ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
</span><span id="L-2515"><a href="#L-2515"><span class="linenos">2515</span></a>          <span class="n">resampled_ndim</span><span class="p">,</span> <span class="n">resampled_ndim</span> <span class="o">+</span> <span class="n">dim</span><span class="p">)</span>
</span><span id="L-2516"><a href="#L-2516"><span class="linenos">2516</span></a>      <span class="n">src_index_expanded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">src_index_dim</span><span class="p">,</span> <span class="n">gather_shape</span><span class="p">))</span>
</span><span id="L-2517"><a href="#L-2517"><span class="linenos">2517</span></a>    <span class="c1"># Unfortunately, broadcast expansion seems unavoidable for tf.gather_nd().</span>
</span><span id="L-2518"><a href="#L-2518"><span class="linenos">2518</span></a>    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">src_index_expanded</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (8, 9, 4, 6, 2)</span>
</span><span id="L-2519"><a href="#L-2519"><span class="linenos">2519</span></a>    <span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather_nd</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>  <span class="c1"># (8, 9, 4, 6, 3)</span>
</span><span id="L-2520"><a href="#L-2520"><span class="linenos">2520</span></a>
</span><span id="L-2521"><a href="#L-2521"><span class="linenos">2521</span></a>  <span class="k">else</span><span class="p">:</span>  <span class="c1"># &#39;numpy&#39;, &#39;torch&#39;.</span>
</span><span id="L-2522"><a href="#L-2522"><span class="linenos">2522</span></a>    <span class="c1"># Recall that src_index = [shape(8, 9, 4), shape(8, 9, 6)].</span>
</span><span id="L-2523"><a href="#L-2523"><span class="linenos">2523</span></a>    <span class="n">src_index_expanded</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># [(8, 9, 4, 1), (8, 9, 1, 6)]</span>
</span><span id="L-2524"><a href="#L-2524"><span class="linenos">2524</span></a>    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_ndim</span><span class="p">):</span>
</span><span id="L-2525"><a href="#L-2525"><span class="linenos">2525</span></a>      <span class="n">src_index_expanded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span>
</span><span id="L-2526"><a href="#L-2526"><span class="linenos">2526</span></a>          <span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="p">(</span><span class="n">grid_ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
</span><span id="L-2527"><a href="#L-2527"><span class="linenos">2527</span></a>          <span class="n">resampled_ndim</span><span class="p">,</span> <span class="n">resampled_ndim</span> <span class="o">+</span> <span class="n">dim</span><span class="p">))</span>
</span><span id="L-2528"><a href="#L-2528"><span class="linenos">2528</span></a>    <span class="c1"># Unfortunately, gathering &#39;samples&#39; is the memory bottleneck.  It would be ideal if we could</span>
</span><span id="L-2529"><a href="#L-2529"><span class="linenos">2529</span></a>    <span class="c1"># defer the array reads until inside the np.einsum() call.</span>
</span><span id="L-2530"><a href="#L-2530"><span class="linenos">2530</span></a>    <span class="c1"># For large outputs, splitting the evaluation over output tiles helps a bit.</span>
</span><span id="L-2531"><a href="#L-2531"><span class="linenos">2531</span></a>    <span class="n">samples</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">src_index_expanded</span><span class="p">)]</span>  <span class="c1"># (8, 9, 4, 6, 3)</span>
</span><span id="L-2532"><a href="#L-2532"><span class="linenos">2532</span></a>
</span><span id="L-2533"><a href="#L-2533"><span class="linenos">2533</span></a>  <span class="n">samples_ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2534"><a href="#L-2534"><span class="linenos">2534</span></a>
</span><span id="L-2535"><a href="#L-2535"><span class="linenos">2535</span></a>  <span class="c1"># Compute an Einstein summation over the samples and each of the</span>
</span><span id="L-2536"><a href="#L-2536"><span class="linenos">2536</span></a>  <span class="c1"># per-dimension weights.</span>
</span><span id="L-2537"><a href="#L-2537"><span class="linenos">2537</span></a>
</span><span id="L-2538"><a href="#L-2538"><span class="linenos">2538</span></a>  <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="n">dims</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="L-2539"><a href="#L-2539"><span class="linenos">2539</span></a>    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">)</span>
</span><span id="L-2540"><a href="#L-2540"><span class="linenos">2540</span></a>
</span><span id="L-2541"><a href="#L-2541"><span class="linenos">2541</span></a>  <span class="n">operands</span> <span class="o">=</span> <span class="p">[</span><span class="n">samples</span><span class="p">]</span>  <span class="c1"># (8, 9, 4, 6, 3)</span>
</span><span id="L-2542"><a href="#L-2542"><span class="linenos">2542</span></a>  <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">samples_ndim</span><span class="p">))]</span>  <span class="c1"># [&#39;abcde&#39;]</span>
</span><span id="L-2543"><a href="#L-2543"><span class="linenos">2543</span></a>  <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_ndim</span><span class="p">):</span>
</span><span id="L-2544"><a href="#L-2544"><span class="linenos">2544</span></a>    <span class="n">operands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>  <span class="c1"># (8, 9, 4), then (8, 9, 6)</span>
</span><span id="L-2545"><a href="#L-2545"><span class="linenos">2545</span></a>    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">resampled_ndim</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="n">resampled_ndim</span> <span class="o">+</span> <span class="n">dim</span><span class="p">]))</span>  <span class="c1"># &#39;abc&#39; then &#39;abd&#39;</span>
</span><span id="L-2546"><a href="#L-2546"><span class="linenos">2546</span></a>  <span class="n">output_label</span> <span class="o">=</span> <span class="n">label</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">resampled_ndim</span><span class="p">))</span> <span class="o">+</span>
</span><span id="L-2547"><a href="#L-2547"><span class="linenos">2547</span></a>                       <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">resampled_ndim</span> <span class="o">+</span> <span class="n">grid_ndim</span><span class="p">,</span> <span class="n">samples_ndim</span><span class="p">)))</span>  <span class="c1"># &#39;abe&#39;</span>
</span><span id="L-2548"><a href="#L-2548"><span class="linenos">2548</span></a>  <span class="n">subscripts</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&gt;&#39;</span> <span class="o">+</span> <span class="n">output_label</span>  <span class="c1"># &#39;abcde,abc,abd-&gt;abe&#39;</span>
</span><span id="L-2549"><a href="#L-2549"><span class="linenos">2549</span></a>
</span><span id="L-2550"><a href="#L-2550"><span class="linenos">2550</span></a>  <span class="k">if</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;numpy&#39;</span><span class="p">:</span>
</span><span id="L-2551"><a href="#L-2551"><span class="linenos">2551</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="n">subscripts</span><span class="p">,</span> <span class="o">*</span><span class="n">operands</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># (8, 9, 3)</span>
</span><span id="L-2552"><a href="#L-2552"><span class="linenos">2552</span></a>
</span><span id="L-2553"><a href="#L-2553"><span class="linenos">2553</span></a>  <span class="k">elif</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;tensorflow&#39;</span><span class="p">:</span>
</span><span id="L-2554"><a href="#L-2554"><span class="linenos">2554</span></a>    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-2555"><a href="#L-2555"><span class="linenos">2555</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="n">subscripts</span><span class="p">,</span> <span class="o">*</span><span class="n">operands</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="s1">&#39;greedy&#39;</span><span class="p">)</span>  <span class="c1"># (8, 9, 3)</span>
</span><span id="L-2556"><a href="#L-2556"><span class="linenos">2556</span></a>
</span><span id="L-2557"><a href="#L-2557"><span class="linenos">2557</span></a>  <span class="k">elif</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;torch&#39;</span><span class="p">:</span>
</span><span id="L-2558"><a href="#L-2558"><span class="linenos">2558</span></a>    <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-2559"><a href="#L-2559"><span class="linenos">2559</span></a>    <span class="n">operands</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">operand</span><span class="p">)</span> <span class="k">for</span> <span class="n">operand</span> <span class="ow">in</span> <span class="n">operands</span><span class="p">]</span>
</span><span id="L-2560"><a href="#L-2560"><span class="linenos">2560</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="n">subscripts</span><span class="p">,</span> <span class="o">*</span><span class="n">operands</span><span class="p">)</span>  <span class="c1"># (8, 9, 3)</span>
</span><span id="L-2561"><a href="#L-2561"><span class="linenos">2561</span></a>
</span><span id="L-2562"><a href="#L-2562"><span class="linenos">2562</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="L-2563"><a href="#L-2563"><span class="linenos">2563</span></a>    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">arraylib</span><span class="si">}</span><span class="s1"> is unrecognized.&#39;</span><span class="p">)</span>
</span><span id="L-2564"><a href="#L-2564"><span class="linenos">2564</span></a>
</span><span id="L-2565"><a href="#L-2565"><span class="linenos">2565</span></a>  <span class="k">if</span> <span class="n">uses_cval</span><span class="p">:</span>
</span><span id="L-2566"><a href="#L-2566"><span class="linenos">2566</span></a>    <span class="n">cval_weight</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span>
</span><span id="L-2567"><a href="#L-2567"><span class="linenos">2567</span></a>        <span class="p">[</span><span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">resampled_ndim</span><span class="p">)])</span>  <span class="c1"># (8, 9)</span>
</span><span id="L-2568"><a href="#L-2568"><span class="linenos">2568</span></a>    <span class="n">cval_weight_reshaped</span> <span class="o">=</span> <span class="n">cval_weight</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">cval_weight</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_shape</span><span class="p">))</span>
</span><span id="L-2569"><a href="#L-2569"><span class="linenos">2569</span></a>    <span class="n">array</span> <span class="o">+=</span> <span class="n">_make_array</span><span class="p">((</span><span class="n">cval_weight_reshaped</span> <span class="o">*</span> <span class="n">cval</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">arraylib</span><span class="p">)</span>
</span><span id="L-2570"><a href="#L-2570"><span class="linenos">2570</span></a>
</span><span id="L-2571"><a href="#L-2571"><span class="linenos">2571</span></a>  <span class="k">if</span> <span class="n">max_block_size</span> <span class="o">!=</span> <span class="n">_MAX_BLOCK_SIZE_RECURSING</span><span class="p">:</span>
</span><span id="L-2572"><a href="#L-2572"><span class="linenos">2572</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">dst_gamma2</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-2573"><a href="#L-2573"><span class="linenos">2573</span></a>
</span><span id="L-2574"><a href="#L-2574"><span class="linenos">2574</span></a>  <span class="k">return</span> <span class="n">array</span>
</span><span id="L-2575"><a href="#L-2575"><span class="linenos">2575</span></a>
</span><span id="L-2576"><a href="#L-2576"><span class="linenos">2576</span></a>
</span><span id="L-2577"><a href="#L-2577"><span class="linenos">2577</span></a><span class="k">def</span> <span class="nf">resample_affine</span><span class="p">(</span>
</span><span id="L-2578"><a href="#L-2578"><span class="linenos">2578</span></a>    <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span>
</span><span id="L-2579"><a href="#L-2579"><span class="linenos">2579</span></a>    <span class="n">shape</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="L-2580"><a href="#L-2580"><span class="linenos">2580</span></a>    <span class="n">matrix</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-2581"><a href="#L-2581"><span class="linenos">2581</span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="L-2582"><a href="#L-2582"><span class="linenos">2582</span></a>    <span class="n">gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2583"><a href="#L-2583"><span class="linenos">2583</span></a>    <span class="n">src_gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2584"><a href="#L-2584"><span class="linenos">2584</span></a>    <span class="n">dst_gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2585"><a href="#L-2585"><span class="linenos">2585</span></a>    <span class="nb">filter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;lanczos3&#39;</span><span class="p">,</span>
</span><span id="L-2586"><a href="#L-2586"><span class="linenos">2586</span></a>    <span class="n">prefilter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2587"><a href="#L-2587"><span class="linenos">2587</span></a>    <span class="n">precision</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2588"><a href="#L-2588"><span class="linenos">2588</span></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2589"><a href="#L-2589"><span class="linenos">2589</span></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-2590"><a href="#L-2590"><span class="linenos">2590</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-2591"><a href="#L-2591"><span class="linenos">2591</span></a>  <span class="sd">&quot;&quot;&quot;Resample a source array using an affinely transformed grid of given shape.</span>
</span><span id="L-2592"><a href="#L-2592"><span class="linenos">2592</span></a>
</span><span id="L-2593"><a href="#L-2593"><span class="linenos">2593</span></a><span class="sd">  The `matrix` transformation can be linear:</span>
</span><span id="L-2594"><a href="#L-2594"><span class="linenos">2594</span></a><span class="sd">    source_point = matrix @ destination_point.</span>
</span><span id="L-2595"><a href="#L-2595"><span class="linenos">2595</span></a><span class="sd">  or it can be affine where the last matrix column is an offset vector:</span>
</span><span id="L-2596"><a href="#L-2596"><span class="linenos">2596</span></a><span class="sd">    source_point = matrix @ (destination_point, 1.0)</span>
</span><span id="L-2597"><a href="#L-2597"><span class="linenos">2597</span></a>
</span><span id="L-2598"><a href="#L-2598"><span class="linenos">2598</span></a><span class="sd">  Args:</span>
</span><span id="L-2599"><a href="#L-2599"><span class="linenos">2599</span></a><span class="sd">    array: Regular grid of source sample values.  The array must have numeric type.  The number of</span>
</span><span id="L-2600"><a href="#L-2600"><span class="linenos">2600</span></a><span class="sd">      grid dimensions is determined from `matrix.shape[0]`; the remaining dimensions are for each</span>
</span><span id="L-2601"><a href="#L-2601"><span class="linenos">2601</span></a><span class="sd">      sample value and are all linearly interpolated.</span>
</span><span id="L-2602"><a href="#L-2602"><span class="linenos">2602</span></a><span class="sd">    shape: Dimensions of the desired destination grid.  The number of destination grid dimensions</span>
</span><span id="L-2603"><a href="#L-2603"><span class="linenos">2603</span></a><span class="sd">      may be different from that of the source grid.</span>
</span><span id="L-2604"><a href="#L-2604"><span class="linenos">2604</span></a><span class="sd">    matrix: 2D array for a linear or affine transform from unit-domain destination points</span>
</span><span id="L-2605"><a href="#L-2605"><span class="linenos">2605</span></a><span class="sd">      (in a space with `len(shape)` dimensions) into unit-domain source points (in a space with</span>
</span><span id="L-2606"><a href="#L-2606"><span class="linenos">2606</span></a><span class="sd">      `matrix.shape[0]` dimensions).  If the matrix has `len(shape) + 1` columns, the last column</span>
</span><span id="L-2607"><a href="#L-2607"><span class="linenos">2607</span></a><span class="sd">      is the affine offset (i.e., translation).</span>
</span><span id="L-2608"><a href="#L-2608"><span class="linenos">2608</span></a><span class="sd">    gridtype: Placement of samples on both the source and output domain grids, specified as either</span>
</span><span id="L-2609"><a href="#L-2609"><span class="linenos">2609</span></a><span class="sd">      a name in `GRIDTYPES` or a `Gridtype` instance.  The default is &#39;dual&#39;.</span>
</span><span id="L-2610"><a href="#L-2610"><span class="linenos">2610</span></a><span class="sd">    src_gridtype: Placement of samples in the source domain grid for each dimension.</span>
</span><span id="L-2611"><a href="#L-2611"><span class="linenos">2611</span></a><span class="sd">      Parameters `gridtype` and `src_gridtype` cannot both be set.</span>
</span><span id="L-2612"><a href="#L-2612"><span class="linenos">2612</span></a><span class="sd">    dst_gridtype: Placement of samples in the output domain grid for each dimension.</span>
</span><span id="L-2613"><a href="#L-2613"><span class="linenos">2613</span></a><span class="sd">      Parameters `gridtype` and `dst_gridtype` cannot both be set.</span>
</span><span id="L-2614"><a href="#L-2614"><span class="linenos">2614</span></a><span class="sd">    filter: The reconstruction kernel for each dimension in `matrix.shape[0]`, specified as either</span>
</span><span id="L-2615"><a href="#L-2615"><span class="linenos">2615</span></a><span class="sd">      a filter name in `FILTERS` or a `Filter` instance.</span>
</span><span id="L-2616"><a href="#L-2616"><span class="linenos">2616</span></a><span class="sd">    prefilter: The prefilter kernel for each dimension in `len(shape)`, specified as either</span>
</span><span id="L-2617"><a href="#L-2617"><span class="linenos">2617</span></a><span class="sd">      a filter name in `FILTERS` or a `Filter` instance.  It is used during downsampling</span>
</span><span id="L-2618"><a href="#L-2618"><span class="linenos">2618</span></a><span class="sd">      (i.e., minification).  If None, it inherits the value of `filter`.</span>
</span><span id="L-2619"><a href="#L-2619"><span class="linenos">2619</span></a><span class="sd">    precision: Inexact precision of intermediate computations.  If None, it is determined based</span>
</span><span id="L-2620"><a href="#L-2620"><span class="linenos">2620</span></a><span class="sd">      on `array.dtype` and `dtype`.</span>
</span><span id="L-2621"><a href="#L-2621"><span class="linenos">2621</span></a><span class="sd">    dtype: Desired data type of the output array.  If None, it is taken to be `array.dtype`.</span>
</span><span id="L-2622"><a href="#L-2622"><span class="linenos">2622</span></a><span class="sd">      If it is a uint type, the intermediate float values are rescaled from the [0.0, 1.0] range</span>
</span><span id="L-2623"><a href="#L-2623"><span class="linenos">2623</span></a><span class="sd">      to the uint range.</span>
</span><span id="L-2624"><a href="#L-2624"><span class="linenos">2624</span></a><span class="sd">    **kwargs: Additional parameters for `resample` function.</span>
</span><span id="L-2625"><a href="#L-2625"><span class="linenos">2625</span></a>
</span><span id="L-2626"><a href="#L-2626"><span class="linenos">2626</span></a><span class="sd">  Returns:</span>
</span><span id="L-2627"><a href="#L-2627"><span class="linenos">2627</span></a><span class="sd">    An array of the same class (`np.ndarray`, `tf.Tensor`, or `torch.Tensor`) as the source `array`,</span>
</span><span id="L-2628"><a href="#L-2628"><span class="linenos">2628</span></a><span class="sd">    representing a grid with specified `shape`, where each grid value is resampled from `array`.</span>
</span><span id="L-2629"><a href="#L-2629"><span class="linenos">2629</span></a><span class="sd">    Thus the shape of the returned array is `shape + array.shape[matrix.shape[0]:]`.</span>
</span><span id="L-2630"><a href="#L-2630"><span class="linenos">2630</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-2631"><a href="#L-2631"><span class="linenos">2631</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span><span id="L-2632"><a href="#L-2632"><span class="linenos">2632</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-2633"><a href="#L-2633"><span class="linenos">2633</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2634"><a href="#L-2634"><span class="linenos">2634</span></a>  <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
</span><span id="L-2635"><a href="#L-2635"><span class="linenos">2635</span></a>  <span class="n">dst_ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2636"><a href="#L-2636"><span class="linenos">2636</span></a>  <span class="k">if</span> <span class="n">matrix</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-2637"><a href="#L-2637"><span class="linenos">2637</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Array </span><span class="si">{</span><span class="n">matrix</span><span class="si">}</span><span class="s1"> is not 2D matrix.&#39;</span><span class="p">)</span>
</span><span id="L-2638"><a href="#L-2638"><span class="linenos">2638</span></a>  <span class="n">src_ndim</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2639"><a href="#L-2639"><span class="linenos">2639</span></a>  <span class="c1"># grid_shape = array.shape[:src_ndim]</span>
</span><span id="L-2640"><a href="#L-2640"><span class="linenos">2640</span></a>  <span class="n">is_affine</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">dst_ndim</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="L-2641"><a href="#L-2641"><span class="linenos">2641</span></a>  <span class="k">if</span> <span class="n">src_ndim</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
</span><span id="L-2642"><a href="#L-2642"><span class="linenos">2642</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Matrix </span><span class="si">{</span><span class="n">matrix</span><span class="si">}</span><span class="s1"> has more rows (</span><span class="si">{</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">) than&#39;</span>
</span><span id="L-2643"><a href="#L-2643"><span class="linenos">2643</span></a>                     <span class="sa">f</span><span class="s1">&#39; ndim in array.shape=</span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="L-2644"><a href="#L-2644"><span class="linenos">2644</span></a>  <span class="k">if</span> <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">dst_ndim</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_affine</span><span class="p">:</span>
</span><span id="L-2645"><a href="#L-2645"><span class="linenos">2645</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Matrix has shape </span><span class="si">{</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">, but we expect either&#39;</span>
</span><span id="L-2646"><a href="#L-2646"><span class="linenos">2646</span></a>                     <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">dst_ndim</span><span class="si">}</span><span class="s1"> or </span><span class="si">{</span><span class="n">dst_ndim</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s1"> columns.&#39;</span><span class="p">)</span>
</span><span id="L-2647"><a href="#L-2647"><span class="linenos">2647</span></a>  <span class="n">src_gridtype2</span><span class="p">,</span> <span class="n">dst_gridtype2</span> <span class="o">=</span> <span class="n">_get_gridtypes</span><span class="p">(</span>
</span><span id="L-2648"><a href="#L-2648"><span class="linenos">2648</span></a>    <span class="n">gridtype</span><span class="p">,</span> <span class="n">src_gridtype</span><span class="p">,</span> <span class="n">dst_gridtype</span><span class="p">,</span> <span class="n">src_ndim</span><span class="p">,</span> <span class="n">dst_ndim</span><span class="p">)</span>
</span><span id="L-2649"><a href="#L-2649"><span class="linenos">2649</span></a>  <span class="n">prefilter</span> <span class="o">=</span> <span class="nb">filter</span> <span class="k">if</span> <span class="n">prefilter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">prefilter</span>
</span><span id="L-2650"><a href="#L-2650"><span class="linenos">2650</span></a>  <span class="n">filter2</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_filter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">filter</span><span class="p">),</span> <span class="n">src_ndim</span><span class="p">)]</span>
</span><span id="L-2651"><a href="#L-2651"><span class="linenos">2651</span></a>  <span class="n">prefilter2</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_filter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">prefilter</span><span class="p">),</span> <span class="n">dst_ndim</span><span class="p">)]</span>
</span><span id="L-2652"><a href="#L-2652"><span class="linenos">2652</span></a>  <span class="k">del</span> <span class="n">src_gridtype</span><span class="p">,</span> <span class="n">dst_gridtype</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">prefilter</span>
</span><span id="L-2653"><a href="#L-2653"><span class="linenos">2653</span></a>  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-2654"><a href="#L-2654"><span class="linenos">2654</span></a>  <span class="n">precision</span> <span class="o">=</span> <span class="n">_get_precision</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="p">[</span><span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">dtype</span><span class="p">],</span> <span class="p">[])</span>
</span><span id="L-2655"><a href="#L-2655"><span class="linenos">2655</span></a>  <span class="n">weight_precision</span> <span class="o">=</span> <span class="n">_real_precision</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span>
</span><span id="L-2656"><a href="#L-2656"><span class="linenos">2656</span></a>
</span><span id="L-2657"><a href="#L-2657"><span class="linenos">2657</span></a>  <span class="n">dst_position_list</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># per dimension</span>
</span><span id="L-2658"><a href="#L-2658"><span class="linenos">2658</span></a>  <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dst_ndim</span><span class="p">):</span>
</span><span id="L-2659"><a href="#L-2659"><span class="linenos">2659</span></a>    <span class="n">dst_size</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
</span><span id="L-2660"><a href="#L-2660"><span class="linenos">2660</span></a>    <span class="n">dst_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dst_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">weight_precision</span><span class="p">)</span>
</span><span id="L-2661"><a href="#L-2661"><span class="linenos">2661</span></a>    <span class="n">dst_position_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dst_gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">point_from_index</span><span class="p">(</span><span class="n">dst_index</span><span class="p">,</span> <span class="n">dst_size</span><span class="p">))</span>
</span><span id="L-2662"><a href="#L-2662"><span class="linenos">2662</span></a>  <span class="n">dst_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">dst_position_list</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
</span><span id="L-2663"><a href="#L-2663"><span class="linenos">2663</span></a>
</span><span id="L-2664"><a href="#L-2664"><span class="linenos">2664</span></a>  <span class="n">linear_matrix</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">is_affine</span> <span class="k">else</span> <span class="n">matrix</span>
</span><span id="L-2665"><a href="#L-2665"><span class="linenos">2665</span></a>  <span class="n">src_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tensordot</span><span class="p">(</span><span class="n">linear_matrix</span><span class="p">,</span> <span class="n">dst_position</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2666"><a href="#L-2666"><span class="linenos">2666</span></a>  <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">src_position</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2667"><a href="#L-2667"><span class="linenos">2667</span></a>  <span class="k">if</span> <span class="n">is_affine</span><span class="p">:</span>
</span><span id="L-2668"><a href="#L-2668"><span class="linenos">2668</span></a>    <span class="n">coords</span> <span class="o">+=</span> <span class="n">matrix</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2669"><a href="#L-2669"><span class="linenos">2669</span></a>
</span><span id="L-2670"><a href="#L-2670"><span class="linenos">2670</span></a>  <span class="c1"># TODO: Based on grid_shape, shape, linear_matrix, and prefilter, determine a</span>
</span><span id="L-2671"><a href="#L-2671"><span class="linenos">2671</span></a>  <span class="c1"># convolution prefilter and apply it to bandlimit &#39;array&#39;, using boundary for padding.</span>
</span><span id="L-2672"><a href="#L-2672"><span class="linenos">2672</span></a>
</span><span id="L-2673"><a href="#L-2673"><span class="linenos">2673</span></a>  <span class="k">return</span> <span class="n">resample</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">gridtype</span><span class="o">=</span><span class="n">src_gridtype2</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="n">filter2</span><span class="p">,</span> <span class="n">prefilter</span><span class="o">=</span><span class="n">prefilter2</span><span class="p">,</span>
</span><span id="L-2674"><a href="#L-2674"><span class="linenos">2674</span></a>                  <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-2675"><a href="#L-2675"><span class="linenos">2675</span></a>
</span><span id="L-2676"><a href="#L-2676"><span class="linenos">2676</span></a>
</span><span id="L-2677"><a href="#L-2677"><span class="linenos">2677</span></a><span class="k">def</span> <span class="nf">resize_using_resample</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span>
</span><span id="L-2678"><a href="#L-2678"><span class="linenos">2678</span></a>                          <span class="n">scale</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">translate</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">fallback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-2679"><a href="#L-2679"><span class="linenos">2679</span></a>                          <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="L-2680"><a href="#L-2680"><span class="linenos">2680</span></a>  <span class="sd">&quot;&quot;&quot;Use the more general `resample` operation for `resize`, as a debug tool.&quot;&quot;&quot;</span>
</span><span id="L-2681"><a href="#L-2681"><span class="linenos">2681</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span><span id="L-2682"><a href="#L-2682"><span class="linenos">2682</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-2683"><a href="#L-2683"><span class="linenos">2683</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2684"><a href="#L-2684"><span class="linenos">2684</span></a>  <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
</span><span id="L-2685"><a href="#L-2685"><span class="linenos">2685</span></a>  <span class="n">translate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">translate</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
</span><span id="L-2686"><a href="#L-2686"><span class="linenos">2686</span></a>  <span class="c1"># TODO: let resample() do prefiltering for proper downsampling.</span>
</span><span id="L-2687"><a href="#L-2687"><span class="linenos">2687</span></a>  <span class="n">has_minification</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)])</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">scale</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="L-2688"><a href="#L-2688"><span class="linenos">2688</span></a>  <span class="k">if</span> <span class="n">fallback</span> <span class="ow">and</span> <span class="n">has_minification</span><span class="p">:</span>
</span><span id="L-2689"><a href="#L-2689"><span class="linenos">2689</span></a>    <span class="k">return</span> <span class="n">_original_resize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="n">translate</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-2690"><a href="#L-2690"><span class="linenos">2690</span></a>  <span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="n">translate</span> <span class="o">/</span> <span class="n">scale</span>
</span><span id="L-2691"><a href="#L-2691"><span class="linenos">2691</span></a>  <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">scale</span><span class="p">),</span> <span class="n">offset</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2692"><a href="#L-2692"><span class="linenos">2692</span></a>  <span class="k">return</span> <span class="n">resample_affine</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-2693"><a href="#L-2693"><span class="linenos">2693</span></a>
</span><span id="L-2694"><a href="#L-2694"><span class="linenos">2694</span></a>
</span><span id="L-2695"><a href="#L-2695"><span class="linenos">2695</span></a><span class="k">def</span> <span class="nf">rotation_about_center_in_2d</span><span class="p">(</span><span class="n">src_shape</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="L-2696"><a href="#L-2696"><span class="linenos">2696</span></a>                                <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2697"><a href="#L-2697"><span class="linenos">2697</span></a>                                <span class="n">dst_shape</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2698"><a href="#L-2698"><span class="linenos">2698</span></a>                                <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-2699"><a href="#L-2699"><span class="linenos">2699</span></a>  <span class="sd">&quot;&quot;&quot;Return the 3x3 matrix mapping destination into a source unit domain.</span>
</span><span id="L-2700"><a href="#L-2700"><span class="linenos">2700</span></a>
</span><span id="L-2701"><a href="#L-2701"><span class="linenos">2701</span></a><span class="sd">  The returned matrix accounts for the possibly non-square domain shapes.</span>
</span><span id="L-2702"><a href="#L-2702"><span class="linenos">2702</span></a>
</span><span id="L-2703"><a href="#L-2703"><span class="linenos">2703</span></a><span class="sd">  Args:</span>
</span><span id="L-2704"><a href="#L-2704"><span class="linenos">2704</span></a><span class="sd">    src_shape: Resolution (ny, nx) of the source domain grid.</span>
</span><span id="L-2705"><a href="#L-2705"><span class="linenos">2705</span></a><span class="sd">    angle: Angle in radians (positive from x to y axis) applied when mapping the source domain</span>
</span><span id="L-2706"><a href="#L-2706"><span class="linenos">2706</span></a><span class="sd">      onto the destination domain.</span>
</span><span id="L-2707"><a href="#L-2707"><span class="linenos">2707</span></a><span class="sd">    dst_shape: Resolution (ny, nx) of the destination domain grid; it defaults to `src_shape`.</span>
</span><span id="L-2708"><a href="#L-2708"><span class="linenos">2708</span></a><span class="sd">    scale: Scaling factor applied when mapping the source domain onto the destination domain.</span>
</span><span id="L-2709"><a href="#L-2709"><span class="linenos">2709</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-2710"><a href="#L-2710"><span class="linenos">2710</span></a>
</span><span id="L-2711"><a href="#L-2711"><span class="linenos">2711</span></a>  <span class="k">def</span> <span class="nf">translation_matrix</span><span class="p">(</span><span class="n">vector</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-2712"><a href="#L-2712"><span class="linenos">2712</span></a>    <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2713"><a href="#L-2713"><span class="linenos">2713</span></a>    <span class="n">matrix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vector</span>
</span><span id="L-2714"><a href="#L-2714"><span class="linenos">2714</span></a>    <span class="k">return</span> <span class="n">matrix</span>
</span><span id="L-2715"><a href="#L-2715"><span class="linenos">2715</span></a>
</span><span id="L-2716"><a href="#L-2716"><span class="linenos">2716</span></a>  <span class="k">def</span> <span class="nf">scaling_matrix</span><span class="p">(</span><span class="n">scale</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-2717"><a href="#L-2717"><span class="linenos">2717</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,))</span>
</span><span id="L-2718"><a href="#L-2718"><span class="linenos">2718</span></a>
</span><span id="L-2719"><a href="#L-2719"><span class="linenos">2719</span></a>  <span class="k">def</span> <span class="nf">rotation_matrix_2d</span><span class="p">(</span><span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-2720"><a href="#L-2720"><span class="linenos">2720</span></a>    <span class="n">c</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
</span><span id="L-2721"><a href="#L-2721"><span class="linenos">2721</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
</span><span id="L-2722"><a href="#L-2722"><span class="linenos">2722</span></a>
</span><span id="L-2723"><a href="#L-2723"><span class="linenos">2723</span></a>  <span class="n">src_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">src_shape</span><span class="p">)</span>
</span><span id="L-2724"><a href="#L-2724"><span class="linenos">2724</span></a>  <span class="n">dst_shape</span> <span class="o">=</span> <span class="n">src_shape</span> <span class="k">if</span> <span class="n">dst_shape</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dst_shape</span><span class="p">)</span>
</span><span id="L-2725"><a href="#L-2725"><span class="linenos">2725</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="n">src_shape</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
</span><span id="L-2726"><a href="#L-2726"><span class="linenos">2726</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="n">dst_shape</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
</span><span id="L-2727"><a href="#L-2727"><span class="linenos">2727</span></a>  <span class="n">half</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
</span><span id="L-2728"><a href="#L-2728"><span class="linenos">2728</span></a>  <span class="n">matrix</span> <span class="o">=</span> <span class="p">(</span><span class="n">translation_matrix</span><span class="p">(</span><span class="n">half</span><span class="p">)</span> <span class="o">@</span>
</span><span id="L-2729"><a href="#L-2729"><span class="linenos">2729</span></a>            <span class="n">scaling_matrix</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">src_shape</span><span class="p">)</span> <span class="o">/</span> <span class="n">src_shape</span><span class="p">)</span> <span class="o">@</span>
</span><span id="L-2730"><a href="#L-2730"><span class="linenos">2730</span></a>            <span class="n">rotation_matrix_2d</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">@</span>
</span><span id="L-2731"><a href="#L-2731"><span class="linenos">2731</span></a>            <span class="n">scaling_matrix</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">dst_shape</span> <span class="o">/</span> <span class="nb">min</span><span class="p">(</span><span class="n">dst_shape</span><span class="p">))</span> <span class="o">@</span>
</span><span id="L-2732"><a href="#L-2732"><span class="linenos">2732</span></a>            <span class="n">translation_matrix</span><span class="p">(</span><span class="o">-</span><span class="n">half</span><span class="p">))</span>
</span><span id="L-2733"><a href="#L-2733"><span class="linenos">2733</span></a>  <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">matrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
</span><span id="L-2734"><a href="#L-2734"><span class="linenos">2734</span></a>  <span class="k">return</span> <span class="n">matrix</span>
</span><span id="L-2735"><a href="#L-2735"><span class="linenos">2735</span></a>
</span><span id="L-2736"><a href="#L-2736"><span class="linenos">2736</span></a>
</span><span id="L-2737"><a href="#L-2737"><span class="linenos">2737</span></a><span class="k">def</span> <span class="nf">rotate_image_about_center</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span>
</span><span id="L-2738"><a href="#L-2738"><span class="linenos">2738</span></a>                              <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="L-2739"><a href="#L-2739"><span class="linenos">2739</span></a>                              <span class="n">new_shape</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2740"><a href="#L-2740"><span class="linenos">2740</span></a>                              <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="L-2741"><a href="#L-2741"><span class="linenos">2741</span></a>                              <span class="n">num_rotations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-2742"><a href="#L-2742"><span class="linenos">2742</span></a>                              <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-2743"><a href="#L-2743"><span class="linenos">2743</span></a>  <span class="sd">&quot;&quot;&quot;Return a copy of `image` rotated about its center.</span>
</span><span id="L-2744"><a href="#L-2744"><span class="linenos">2744</span></a>
</span><span id="L-2745"><a href="#L-2745"><span class="linenos">2745</span></a><span class="sd">  Args:</span>
</span><span id="L-2746"><a href="#L-2746"><span class="linenos">2746</span></a><span class="sd">    image: Source grid samples; the first two dimensions are spatial (ny, nx).</span>
</span><span id="L-2747"><a href="#L-2747"><span class="linenos">2747</span></a><span class="sd">    angle: Angle in radians (positive from x to y axis) applied when mapping the source domain</span>
</span><span id="L-2748"><a href="#L-2748"><span class="linenos">2748</span></a><span class="sd">      onto the destination domain.</span>
</span><span id="L-2749"><a href="#L-2749"><span class="linenos">2749</span></a><span class="sd">    new_shape: Resolution (ny, nx) of the output grid; it defaults to `image.shape[:2]`.</span>
</span><span id="L-2750"><a href="#L-2750"><span class="linenos">2750</span></a><span class="sd">    scale: Scaling factor applied when mapping the source domain onto the destination domain.</span>
</span><span id="L-2751"><a href="#L-2751"><span class="linenos">2751</span></a><span class="sd">    num_rotations: Number of rotations (each by `angle`).  Successive resamplings are useful in</span>
</span><span id="L-2752"><a href="#L-2752"><span class="linenos">2752</span></a><span class="sd">      analyzing the filtering quality.</span>
</span><span id="L-2753"><a href="#L-2753"><span class="linenos">2753</span></a><span class="sd">    **kwargs: Additional parameters for `resample_affine`.</span>
</span><span id="L-2754"><a href="#L-2754"><span class="linenos">2754</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="L-2755"><a href="#L-2755"><span class="linenos">2755</span></a>  <span class="n">new_shape</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">new_shape</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">new_shape</span><span class="p">)</span>
</span><span id="L-2756"><a href="#L-2756"><span class="linenos">2756</span></a>  <span class="n">matrix</span> <span class="o">=</span> <span class="n">rotation_about_center_in_2d</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">angle</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
</span><span id="L-2757"><a href="#L-2757"><span class="linenos">2757</span></a>  <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_rotations</span><span class="p">):</span>
</span><span id="L-2758"><a href="#L-2758"><span class="linenos">2758</span></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">resample_affine</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">,</span> <span class="n">matrix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-2759"><a href="#L-2759"><span class="linenos">2759</span></a>  <span class="k">return</span> <span class="n">image</span>
</span><span id="L-2760"><a href="#L-2760"><span class="linenos">2760</span></a>
</span><span id="L-2761"><a href="#L-2761"><span class="linenos">2761</span></a>
</span><span id="L-2762"><a href="#L-2762"><span class="linenos">2762</span></a><span class="k">def</span> <span class="nf">pil_image_resize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-2763"><a href="#L-2763"><span class="linenos">2763</span></a>  <span class="sd">&quot;&quot;&quot;Invoke `PIL.Image.resize` using the same parameters as `resize`.&quot;&quot;&quot;</span>
</span><span id="L-2764"><a href="#L-2764"><span class="linenos">2764</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-2765"><a href="#L-2765"><span class="linenos">2765</span></a>  <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">3</span>
</span><span id="L-2766"><a href="#L-2766"><span class="linenos">2766</span></a>  <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)</span>
</span><span id="L-2767"><a href="#L-2767"><span class="linenos">2767</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2768"><a href="#L-2768"><span class="linenos">2768</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2769"><a href="#L-2769"><span class="linenos">2769</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2770"><a href="#L-2770"><span class="linenos">2770</span></a>    <span class="k">return</span> <span class="n">pil_image_resize</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">),</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)</span>
</span><span id="L-2771"><a href="#L-2771"><span class="linenos">2771</span></a>  <span class="kn">import</span> <span class="nn">PIL.Image</span>
</span><span id="L-2772"><a href="#L-2772"><span class="linenos">2772</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="s1">&#39;Resampling&#39;</span><span class="p">):</span>  <span class="c1"># Pillow&lt;9.0</span>
</span><span id="L-2773"><a href="#L-2773"><span class="linenos">2773</span></a>    <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span> <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span>
</span><span id="L-2774"><a href="#L-2774"><span class="linenos">2774</span></a>  <span class="n">pil_resample</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2775"><a href="#L-2775"><span class="linenos">2775</span></a>      <span class="s1">&#39;impulse&#39;</span><span class="p">:</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">NEAREST</span><span class="p">,</span>
</span><span id="L-2776"><a href="#L-2776"><span class="linenos">2776</span></a>      <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">BOX</span><span class="p">,</span>
</span><span id="L-2777"><a href="#L-2777"><span class="linenos">2777</span></a>      <span class="s1">&#39;triangle&#39;</span><span class="p">:</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">BILINEAR</span><span class="p">,</span>
</span><span id="L-2778"><a href="#L-2778"><span class="linenos">2778</span></a>      <span class="s1">&#39;hamming1&#39;</span><span class="p">:</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">HAMMING</span><span class="p">,</span>  <span class="c1"># GeneralizedHammingFilter(1, a0=0.54)</span>
</span><span id="L-2779"><a href="#L-2779"><span class="linenos">2779</span></a>      <span class="s1">&#39;cubic&#39;</span><span class="p">:</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">BICUBIC</span><span class="p">,</span>
</span><span id="L-2780"><a href="#L-2780"><span class="linenos">2780</span></a>      <span class="s1">&#39;lanczos3&#39;</span><span class="p">:</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">,</span>
</span><span id="L-2781"><a href="#L-2781"><span class="linenos">2781</span></a>  <span class="p">}[</span><span class="nb">filter</span><span class="p">]</span>
</span><span id="L-2782"><a href="#L-2782"><span class="linenos">2782</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-2783"><a href="#L-2783"><span class="linenos">2783</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span>
</span><span id="L-2784"><a href="#L-2784"><span class="linenos">2784</span></a>        <span class="n">shape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">resample</span><span class="o">=</span><span class="n">pil_resample</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-2785"><a href="#L-2785"><span class="linenos">2785</span></a>  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
</span><span id="L-2786"><a href="#L-2786"><span class="linenos">2786</span></a>      <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span>
</span><span id="L-2787"><a href="#L-2787"><span class="linenos">2787</span></a>          <span class="n">shape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">resample</span><span class="o">=</span><span class="n">pil_resample</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-2788"><a href="#L-2788"><span class="linenos">2788</span></a>       <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>
</span><span id="L-2789"><a href="#L-2789"><span class="linenos">2789</span></a>
</span><span id="L-2790"><a href="#L-2790"><span class="linenos">2790</span></a>
</span><span id="L-2791"><a href="#L-2791"><span class="linenos">2791</span></a><span class="k">def</span> <span class="nf">cv_resize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="L-2792"><a href="#L-2792"><span class="linenos">2792</span></a>  <span class="sd">&quot;&quot;&quot;Invoke `cv.resize` using the same parameters as `resize`.&quot;&quot;&quot;</span>
</span><span id="L-2793"><a href="#L-2793"><span class="linenos">2793</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-2794"><a href="#L-2794"><span class="linenos">2794</span></a>  <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">3</span>
</span><span id="L-2795"><a href="#L-2795"><span class="linenos">2795</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2796"><a href="#L-2796"><span class="linenos">2796</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2797"><a href="#L-2797"><span class="linenos">2797</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2798"><a href="#L-2798"><span class="linenos">2798</span></a>    <span class="k">return</span> <span class="n">cv_resize</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">),</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2799"><a href="#L-2799"><span class="linenos">2799</span></a>  <span class="kn">import</span> <span class="nn">cv2</span> <span class="k">as</span> <span class="nn">cv</span>
</span><span id="L-2800"><a href="#L-2800"><span class="linenos">2800</span></a>  <span class="n">interpolation</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2801"><a href="#L-2801"><span class="linenos">2801</span></a>      <span class="s1">&#39;impulse&#39;</span><span class="p">:</span> <span class="n">cv</span><span class="o">.</span><span class="n">INTER_NEAREST</span><span class="p">,</span>  <span class="c1"># Consider cv.INTER_NEAREST_EXACT?</span>
</span><span id="L-2802"><a href="#L-2802"><span class="linenos">2802</span></a>      <span class="s1">&#39;triangle&#39;</span><span class="p">:</span> <span class="n">cv</span><span class="o">.</span><span class="n">INTER_LINEAR_EXACT</span><span class="p">,</span>  <span class="c1"># Or just cv.INTER_LINEAR?</span>
</span><span id="L-2803"><a href="#L-2803"><span class="linenos">2803</span></a>      <span class="s1">&#39;trapezoid&#39;</span><span class="p">:</span> <span class="n">cv</span><span class="o">.</span><span class="n">INTER_AREA</span><span class="p">,</span>
</span><span id="L-2804"><a href="#L-2804"><span class="linenos">2804</span></a>      <span class="s1">&#39;sharpcubic&#39;</span><span class="p">:</span> <span class="n">cv</span><span class="o">.</span><span class="n">INTER_CUBIC</span><span class="p">,</span>
</span><span id="L-2805"><a href="#L-2805"><span class="linenos">2805</span></a>      <span class="s1">&#39;lanczos4&#39;</span><span class="p">:</span> <span class="n">cv</span><span class="o">.</span><span class="n">INTER_LANCZOS4</span><span class="p">,</span>
</span><span id="L-2806"><a href="#L-2806"><span class="linenos">2806</span></a>  <span class="p">}[</span><span class="nb">filter</span><span class="p">]</span>
</span><span id="L-2807"><a href="#L-2807"><span class="linenos">2807</span></a>  <span class="k">return</span> <span class="n">cv</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">shape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>
</span><span id="L-2808"><a href="#L-2808"><span class="linenos">2808</span></a>
</span><span id="L-2809"><a href="#L-2809"><span class="linenos">2809</span></a>
</span><span id="L-2810"><a href="#L-2810"><span class="linenos">2810</span></a><span class="n">_TENSORFLOW_IMAGE_RESIZE_METHOD_FROM_FILTER</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2811"><a href="#L-2811"><span class="linenos">2811</span></a>    <span class="s1">&#39;impulse&#39;</span><span class="p">:</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
</span><span id="L-2812"><a href="#L-2812"><span class="linenos">2812</span></a>    <span class="s1">&#39;trapezoid&#39;</span><span class="p">:</span> <span class="s1">&#39;area&#39;</span><span class="p">,</span>
</span><span id="L-2813"><a href="#L-2813"><span class="linenos">2813</span></a>    <span class="s1">&#39;triangle&#39;</span><span class="p">:</span> <span class="s1">&#39;bilinear&#39;</span><span class="p">,</span>
</span><span id="L-2814"><a href="#L-2814"><span class="linenos">2814</span></a>    <span class="s1">&#39;mitchell&#39;</span><span class="p">:</span> <span class="s1">&#39;mitchellcubic&#39;</span><span class="p">,</span>
</span><span id="L-2815"><a href="#L-2815"><span class="linenos">2815</span></a>    <span class="s1">&#39;cubic&#39;</span><span class="p">:</span> <span class="s1">&#39;bicubic&#39;</span><span class="p">,</span>
</span><span id="L-2816"><a href="#L-2816"><span class="linenos">2816</span></a>    <span class="s1">&#39;lanczos3&#39;</span><span class="p">:</span> <span class="s1">&#39;lanczos3&#39;</span><span class="p">,</span>
</span><span id="L-2817"><a href="#L-2817"><span class="linenos">2817</span></a>    <span class="s1">&#39;lanczos5&#39;</span><span class="p">:</span> <span class="s1">&#39;lanczos5&#39;</span><span class="p">,</span>
</span><span id="L-2818"><a href="#L-2818"><span class="linenos">2818</span></a>    <span class="c1"># GaussianFilter(0.5): &#39;gaussian&#39;,  # radius_4 &gt; desired_radius_3.</span>
</span><span id="L-2819"><a href="#L-2819"><span class="linenos">2819</span></a><span class="p">}</span>
</span><span id="L-2820"><a href="#L-2820"><span class="linenos">2820</span></a>
</span><span id="L-2821"><a href="#L-2821"><span class="linenos">2821</span></a><span class="k">def</span> <span class="nf">tf_image_resize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;lanczos3&#39;</span><span class="p">,</span>
</span><span id="L-2822"><a href="#L-2822"><span class="linenos">2822</span></a>                    <span class="n">antialias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TensorflowTensor</span><span class="p">:</span>
</span><span id="L-2823"><a href="#L-2823"><span class="linenos">2823</span></a>  <span class="sd">&quot;&quot;&quot;Invoke `tf.image.resize` using the same parameters as `resize`.&quot;&quot;&quot;</span>
</span><span id="L-2824"><a href="#L-2824"><span class="linenos">2824</span></a>  <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="L-2825"><a href="#L-2825"><span class="linenos">2825</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-2826"><a href="#L-2826"><span class="linenos">2826</span></a>  <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">3</span>
</span><span id="L-2827"><a href="#L-2827"><span class="linenos">2827</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2828"><a href="#L-2828"><span class="linenos">2828</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2829"><a href="#L-2829"><span class="linenos">2829</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2830"><a href="#L-2830"><span class="linenos">2830</span></a>    <span class="k">return</span> <span class="n">tf_image_resize</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">),</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span> <span class="n">antialias</span><span class="o">=</span><span class="n">antialias</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2831"><a href="#L-2831"><span class="linenos">2831</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-2832"><a href="#L-2832"><span class="linenos">2832</span></a>    <span class="k">return</span> <span class="n">tf_image_resize</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">shape</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span> <span class="n">antialias</span><span class="o">=</span><span class="n">antialias</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-2833"><a href="#L-2833"><span class="linenos">2833</span></a>  <span class="n">method</span> <span class="o">=</span> <span class="n">_TENSORFLOW_IMAGE_RESIZE_METHOD_FROM_FILTER</span><span class="p">[</span><span class="nb">filter</span><span class="p">]</span>
</span><span id="L-2834"><a href="#L-2834"><span class="linenos">2834</span></a>  <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">antialias</span><span class="o">=</span><span class="n">antialias</span><span class="p">)</span>
</span><span id="L-2835"><a href="#L-2835"><span class="linenos">2835</span></a>
</span><span id="L-2836"><a href="#L-2836"><span class="linenos">2836</span></a>
</span><span id="L-2837"><a href="#L-2837"><span class="linenos">2837</span></a><span class="n">_TORCH_INTERPOLATE_MODE_FROM_FILTER</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2838"><a href="#L-2838"><span class="linenos">2838</span></a>    <span class="s1">&#39;impulse&#39;</span><span class="p">:</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
</span><span id="L-2839"><a href="#L-2839"><span class="linenos">2839</span></a>    <span class="s1">&#39;trapezoid&#39;</span><span class="p">:</span> <span class="s1">&#39;area&#39;</span><span class="p">,</span>
</span><span id="L-2840"><a href="#L-2840"><span class="linenos">2840</span></a>    <span class="s1">&#39;triangle&#39;</span><span class="p">:</span> <span class="s1">&#39;bilinear&#39;</span><span class="p">,</span>
</span><span id="L-2841"><a href="#L-2841"><span class="linenos">2841</span></a>    <span class="s1">&#39;sharpcubic&#39;</span><span class="p">:</span> <span class="s1">&#39;bicubic&#39;</span><span class="p">,</span>
</span><span id="L-2842"><a href="#L-2842"><span class="linenos">2842</span></a><span class="p">}</span>
</span><span id="L-2843"><a href="#L-2843"><span class="linenos">2843</span></a>
</span><span id="L-2844"><a href="#L-2844"><span class="linenos">2844</span></a><span class="k">def</span> <span class="nf">torch_nn_resize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2845"><a href="#L-2845"><span class="linenos">2845</span></a>                    <span class="n">antialias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TorchTensor</span><span class="p">:</span>
</span><span id="L-2846"><a href="#L-2846"><span class="linenos">2846</span></a>  <span class="sd">&quot;&quot;&quot;Invoke `torch.nn.functional.interpolate` using the same parameters as `resize`.&quot;&quot;&quot;</span>
</span><span id="L-2847"><a href="#L-2847"><span class="linenos">2847</span></a>  <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-2848"><a href="#L-2848"><span class="linenos">2848</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-2849"><a href="#L-2849"><span class="linenos">2849</span></a>  <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">3</span>
</span><span id="L-2850"><a href="#L-2850"><span class="linenos">2850</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2851"><a href="#L-2851"><span class="linenos">2851</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2852"><a href="#L-2852"><span class="linenos">2852</span></a>  <span class="n">mode</span> <span class="o">=</span> <span class="n">_TORCH_INTERPOLATE_MODE_FROM_FILTER</span><span class="p">[</span><span class="nb">filter</span><span class="p">]</span>
</span><span id="L-2853"><a href="#L-2853"><span class="linenos">2853</span></a>
</span><span id="L-2854"><a href="#L-2854"><span class="linenos">2854</span></a>  <span class="k">def</span> <span class="nf">local_resize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_TorchTensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TorchTensor</span><span class="p">:</span>
</span><span id="L-2855"><a href="#L-2855"><span class="linenos">2855</span></a>    <span class="c1"># For upsampling, BILINEAR antialias is same PSNR and slower,</span>
</span><span id="L-2856"><a href="#L-2856"><span class="linenos">2856</span></a>    <span class="c1">#  and BICUBIC antialias is worse PSNR and faster.</span>
</span><span id="L-2857"><a href="#L-2857"><span class="linenos">2857</span></a>    <span class="c1"># For downsampling, antialias improves PSNR for both BILINEAR and BICUBIC.</span>
</span><span id="L-2858"><a href="#L-2858"><span class="linenos">2858</span></a>    <span class="n">align_corners</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="nb">filter</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;cubic&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="L-2859"><a href="#L-2859"><span class="linenos">2859</span></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
</span><span id="L-2860"><a href="#L-2860"><span class="linenos">2860</span></a>        <span class="n">array</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">align_corners</span><span class="o">=</span><span class="n">align_corners</span><span class="p">,</span> <span class="n">antialias</span><span class="o">=</span><span class="n">antialias</span><span class="p">)</span>
</span><span id="L-2861"><a href="#L-2861"><span class="linenos">2861</span></a>
</span><span id="L-2862"><a href="#L-2862"><span class="linenos">2862</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2863"><a href="#L-2863"><span class="linenos">2863</span></a>    <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2864"><a href="#L-2864"><span class="linenos">2864</span></a>    <span class="k">return</span> <span class="n">local_resize</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-2865"><a href="#L-2865"><span class="linenos">2865</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-2866"><a href="#L-2866"><span class="linenos">2866</span></a>    <span class="k">return</span> <span class="n">local_resize</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-2867"><a href="#L-2867"><span class="linenos">2867</span></a>  <span class="k">return</span> <span class="n">local_resize</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)[</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2868"><a href="#L-2868"><span class="linenos">2868</span></a>
</span><span id="L-2869"><a href="#L-2869"><span class="linenos">2869</span></a>
</span><span id="L-2870"><a href="#L-2870"><span class="linenos">2870</span></a><span class="k">def</span> <span class="nf">torchvision_resize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="L-2871"><a href="#L-2871"><span class="linenos">2871</span></a>                       <span class="n">antialias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TorchTensor</span><span class="p">:</span>
</span><span id="L-2872"><a href="#L-2872"><span class="linenos">2872</span></a>  <span class="sd">&quot;&quot;&quot;Invoke `torchvision.transforms.functional.resize` using the same parameters as `resize`.&quot;&quot;&quot;</span>
</span><span id="L-2873"><a href="#L-2873"><span class="linenos">2873</span></a>  <span class="c1"># The results appear to be identical to torch.nn.functional.interpolate() and slightly slower.</span>
</span><span id="L-2874"><a href="#L-2874"><span class="linenos">2874</span></a>  <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="L-2875"><a href="#L-2875"><span class="linenos">2875</span></a>  <span class="kn">import</span> <span class="nn">torchvision</span>
</span><span id="L-2876"><a href="#L-2876"><span class="linenos">2876</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="L-2877"><a href="#L-2877"><span class="linenos">2877</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2878"><a href="#L-2878"><span class="linenos">2878</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-2879"><a href="#L-2879"><span class="linenos">2879</span></a>  <span class="n">torchvision_interpolation_from_filter</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2880"><a href="#L-2880"><span class="linenos">2880</span></a>      <span class="s1">&#39;impulse&#39;</span><span class="p">:</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">InterpolationMode</span><span class="o">.</span><span class="n">NEAREST</span><span class="p">,</span>
</span><span id="L-2881"><a href="#L-2881"><span class="linenos">2881</span></a>      <span class="s1">&#39;triangle&#39;</span><span class="p">:</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">InterpolationMode</span><span class="o">.</span><span class="n">BILINEAR</span><span class="p">,</span>
</span><span id="L-2882"><a href="#L-2882"><span class="linenos">2882</span></a>      <span class="s1">&#39;sharpcubic&#39;</span><span class="p">:</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">InterpolationMode</span><span class="o">.</span><span class="n">BICUBIC</span><span class="p">,</span>
</span><span id="L-2883"><a href="#L-2883"><span class="linenos">2883</span></a>      <span class="c1"># Only the 3 modes above are supported when `array` is a torch.Tensor.</span>
</span><span id="L-2884"><a href="#L-2884"><span class="linenos">2884</span></a>      <span class="c1"># &#39;box&#39;: torchvision.transforms.InterpolationMode.BOX,</span>
</span><span id="L-2885"><a href="#L-2885"><span class="linenos">2885</span></a>  <span class="p">}</span>
</span><span id="L-2886"><a href="#L-2886"><span class="linenos">2886</span></a>  <span class="n">interpolation</span> <span class="o">=</span> <span class="n">torchvision_interpolation_from_filter</span><span class="p">[</span><span class="nb">filter</span><span class="p">]</span>
</span><span id="L-2887"><a href="#L-2887"><span class="linenos">2887</span></a>
</span><span id="L-2888"><a href="#L-2888"><span class="linenos">2888</span></a>  <span class="k">def</span> <span class="nf">local_resize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_TorchTensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TorchTensor</span><span class="p">:</span>
</span><span id="L-2889"><a href="#L-2889"><span class="linenos">2889</span></a>    <span class="k">return</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span>
</span><span id="L-2890"><a href="#L-2890"><span class="linenos">2890</span></a>        <span class="n">array</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">antialias</span><span class="o">=</span><span class="n">antialias</span><span class="p">)</span>
</span><span id="L-2891"><a href="#L-2891"><span class="linenos">2891</span></a>
</span><span id="L-2892"><a href="#L-2892"><span class="linenos">2892</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-2893"><a href="#L-2893"><span class="linenos">2893</span></a>    <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-2894"><a href="#L-2894"><span class="linenos">2894</span></a>    <span class="k">return</span> <span class="n">local_resize</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="L-2895"><a href="#L-2895"><span class="linenos">2895</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-2896"><a href="#L-2896"><span class="linenos">2896</span></a>    <span class="k">return</span> <span class="n">local_resize</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2897"><a href="#L-2897"><span class="linenos">2897</span></a>  <span class="k">return</span> <span class="n">local_resize</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="L-2898"><a href="#L-2898"><span class="linenos">2898</span></a>
</span><span id="L-2899"><a href="#L-2899"><span class="linenos">2899</span></a>
</span><span id="L-2900"><a href="#L-2900"><span class="linenos">2900</span></a><span class="c1"># For Emacs:</span>
</span><span id="L-2901"><a href="#L-2901"><span class="linenos">2901</span></a><span class="c1"># Local Variables: *</span>
</span><span id="L-2902"><a href="#L-2902"><span class="linenos">2902</span></a><span class="c1"># fill-column: 100 *</span>
</span><span id="L-2903"><a href="#L-2903"><span class="linenos">2903</span></a><span class="c1"># End: *</span>
</span></pre></div>


            </section>
                <section id="ARRAYLIBS">
                    <div class="attr variable">
            <span class="name">ARRAYLIBS</span><span class="default_value"> = {&#39;numpy&#39;: &lt;class &#39;resampler._NumpyArraylib&#39;&gt;, &#39;tensorflow&#39;: &lt;class &#39;resampler._TensorflowArraylib&#39;&gt;, &#39;torch&#39;: &lt;class &#39;resampler._TorchArraylib&#39;&gt;}</span>

        
    </div>
    <a class="headerlink" href="#ARRAYLIBS"></a>
    
            <div class="docstring"><p>Supported array libraries ('numpy', 'tensorflow', and 'torch').</p>
</div>


                </section>
                <section id="Gridtype">
                            <input id="Gridtype-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclasses.dataclass</div>

    <span class="def">class</span>
    <span class="name">Gridtype</span>:

                <label class="view-source-button" for="Gridtype-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Gridtype"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Gridtype-585"><a href="#Gridtype-585"><span class="linenos">585</span></a><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
</span><span id="Gridtype-586"><a href="#Gridtype-586"><span class="linenos">586</span></a><span class="k">class</span> <span class="nc">Gridtype</span><span class="p">:</span>
</span><span id="Gridtype-587"><a href="#Gridtype-587"><span class="linenos">587</span></a>  <span class="sd">&quot;&quot;&quot;Abstract base class for grid-types such as &#39;dual&#39; and &#39;primal&#39;.</span>
</span><span id="Gridtype-588"><a href="#Gridtype-588"><span class="linenos">588</span></a>
</span><span id="Gridtype-589"><a href="#Gridtype-589"><span class="linenos">589</span></a><span class="sd">  In resampling operations, the grid-type may be specified separately as `src_gridtype` for the</span>
</span><span id="Gridtype-590"><a href="#Gridtype-590"><span class="linenos">590</span></a><span class="sd">  source domain and `dst_gridtype` for the destination domain.  Moreover, the grid-type may be</span>
</span><span id="Gridtype-591"><a href="#Gridtype-591"><span class="linenos">591</span></a><span class="sd">  specified per domain dimension.</span>
</span><span id="Gridtype-592"><a href="#Gridtype-592"><span class="linenos">592</span></a>
</span><span id="Gridtype-593"><a href="#Gridtype-593"><span class="linenos">593</span></a><span class="sd">  Examples:</span>
</span><span id="Gridtype-594"><a href="#Gridtype-594"><span class="linenos">594</span></a><span class="sd">    `resize(source, shape, gridtype=&#39;primal&#39;)`  # Sets both src and dst.</span>
</span><span id="Gridtype-595"><a href="#Gridtype-595"><span class="linenos">595</span></a>
</span><span id="Gridtype-596"><a href="#Gridtype-596"><span class="linenos">596</span></a><span class="sd">    `resize(source, shape, src_gridtype=[&#39;dual&#39;, &#39;primal&#39;],</span>
</span><span id="Gridtype-597"><a href="#Gridtype-597"><span class="linenos">597</span></a><span class="sd">           dst_gridtype=&#39;dual&#39;)`  # Source is dual in dim0 and primal in dim1.</span>
</span><span id="Gridtype-598"><a href="#Gridtype-598"><span class="linenos">598</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="Gridtype-599"><a href="#Gridtype-599"><span class="linenos">599</span></a>
</span><span id="Gridtype-600"><a href="#Gridtype-600"><span class="linenos">600</span></a>  <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Gridtype-601"><a href="#Gridtype-601"><span class="linenos">601</span></a>  <span class="sd">&quot;&quot;&quot;Gridtype name.&quot;&quot;&quot;</span>
</span><span id="Gridtype-602"><a href="#Gridtype-602"><span class="linenos">602</span></a>
</span><span id="Gridtype-603"><a href="#Gridtype-603"><span class="linenos">603</span></a>  <span class="k">def</span> <span class="nf">min_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Gridtype-604"><a href="#Gridtype-604"><span class="linenos">604</span></a>    <span class="sd">&quot;&quot;&quot;Return the necessary minimum number of grid samples.&quot;&quot;&quot;</span>
</span><span id="Gridtype-605"><a href="#Gridtype-605"><span class="linenos">605</span></a>
</span><span id="Gridtype-606"><a href="#Gridtype-606"><span class="linenos">606</span></a>  <span class="k">def</span> <span class="nf">size_in_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="Gridtype-607"><a href="#Gridtype-607"><span class="linenos">607</span></a>    <span class="sd">&quot;&quot;&quot;Return the size of the domain in units of inter-sample spacing.&quot;&quot;&quot;</span>
</span><span id="Gridtype-608"><a href="#Gridtype-608"><span class="linenos">608</span></a>
</span><span id="Gridtype-609"><a href="#Gridtype-609"><span class="linenos">609</span></a>  <span class="k">def</span> <span class="nf">point_from_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="Gridtype-610"><a href="#Gridtype-610"><span class="linenos">610</span></a>    <span class="sd">&quot;&quot;&quot;Return [0.0, 1.0] coordinates given [0, size - 1] indices.&quot;&quot;&quot;</span>
</span><span id="Gridtype-611"><a href="#Gridtype-611"><span class="linenos">611</span></a>
</span><span id="Gridtype-612"><a href="#Gridtype-612"><span class="linenos">612</span></a>  <span class="k">def</span> <span class="nf">index_from_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="Gridtype-613"><a href="#Gridtype-613"><span class="linenos">613</span></a>    <span class="sd">&quot;&quot;&quot;Return location x given coordinates [0.0, 1.0], where x == 0.0 is the</span>
</span><span id="Gridtype-614"><a href="#Gridtype-614"><span class="linenos">614</span></a><span class="sd">    first grid sample and x == size - 1.0 is the last grid sample.&quot;&quot;&quot;</span>
</span><span id="Gridtype-615"><a href="#Gridtype-615"><span class="linenos">615</span></a>
</span><span id="Gridtype-616"><a href="#Gridtype-616"><span class="linenos">616</span></a>  <span class="k">def</span> <span class="nf">reflect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="Gridtype-617"><a href="#Gridtype-617"><span class="linenos">617</span></a>    <span class="sd">&quot;&quot;&quot;Map integer sample indices to interior ones using boundary reflection.&quot;&quot;&quot;</span>
</span><span id="Gridtype-618"><a href="#Gridtype-618"><span class="linenos">618</span></a>
</span><span id="Gridtype-619"><a href="#Gridtype-619"><span class="linenos">619</span></a>  <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="Gridtype-620"><a href="#Gridtype-620"><span class="linenos">620</span></a>    <span class="sd">&quot;&quot;&quot;Map integer sample indices to interior ones using wrapping.&quot;&quot;&quot;</span>
</span><span id="Gridtype-621"><a href="#Gridtype-621"><span class="linenos">621</span></a>
</span><span id="Gridtype-622"><a href="#Gridtype-622"><span class="linenos">622</span></a>  <span class="k">def</span> <span class="nf">reflect_clamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="Gridtype-623"><a href="#Gridtype-623"><span class="linenos">623</span></a>    <span class="sd">&quot;&quot;&quot;Map integer sample indices to interior ones using reflect-clamp.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Abstract base class for grid-types such as 'dual' and 'primal'.</p>

<p>In resampling operations, the grid-type may be specified separately as <code>src_gridtype</code> for the
source domain and <code>dst_gridtype</code> for the destination domain.  Moreover, the grid-type may be
specified per domain dimension.</p>

<h6 id="examples">Examples</h6>

<blockquote>
  <p><code>resize(source, shape, gridtype='primal')</code>  # Sets both src and dst.</p>
  
  <p><code>resize(source, shape, src_gridtype=['dual', 'primal'],
       dst_gridtype='dual')</code>  # Source is dual in dim0 and primal in dim1.</p>
</blockquote>
</div>


                </section>
                <section id="DualGridtype">
                            <input id="DualGridtype-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">DualGridtype</span><wbr>(<span class="base"><a href="#Gridtype">Gridtype</a></span>):

                <label class="view-source-button" for="DualGridtype-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#DualGridtype"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="DualGridtype-626"><a href="#DualGridtype-626"><span class="linenos">626</span></a><span class="k">class</span> <span class="nc">DualGridtype</span><span class="p">(</span><span class="n">Gridtype</span><span class="p">):</span>
</span><span id="DualGridtype-627"><a href="#DualGridtype-627"><span class="linenos">627</span></a>  <span class="sd">&quot;&quot;&quot;Samples are at the center of cells in a uniform partition of the domain.</span>
</span><span id="DualGridtype-628"><a href="#DualGridtype-628"><span class="linenos">628</span></a>
</span><span id="DualGridtype-629"><a href="#DualGridtype-629"><span class="linenos">629</span></a><span class="sd">  For a unit-domain dimension with N samples, each sample 0 &lt;= i &lt;= N has position (i + 0.5) / N,</span>
</span><span id="DualGridtype-630"><a href="#DualGridtype-630"><span class="linenos">630</span></a><span class="sd">  e.g., [0.125, 0.375, 0.625, 0.875] for N = 4.</span>
</span><span id="DualGridtype-631"><a href="#DualGridtype-631"><span class="linenos">631</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="DualGridtype-632"><a href="#DualGridtype-632"><span class="linenos">632</span></a>
</span><span id="DualGridtype-633"><a href="#DualGridtype-633"><span class="linenos">633</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="DualGridtype-634"><a href="#DualGridtype-634"><span class="linenos">634</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;dual&#39;</span><span class="p">)</span>
</span><span id="DualGridtype-635"><a href="#DualGridtype-635"><span class="linenos">635</span></a>
</span><span id="DualGridtype-636"><a href="#DualGridtype-636"><span class="linenos">636</span></a>  <span class="k">def</span> <span class="nf">min_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="DualGridtype-637"><a href="#DualGridtype-637"><span class="linenos">637</span></a>    <span class="k">return</span> <span class="mi">1</span>
</span><span id="DualGridtype-638"><a href="#DualGridtype-638"><span class="linenos">638</span></a>
</span><span id="DualGridtype-639"><a href="#DualGridtype-639"><span class="linenos">639</span></a>  <span class="k">def</span> <span class="nf">size_in_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="DualGridtype-640"><a href="#DualGridtype-640"><span class="linenos">640</span></a>    <span class="k">return</span> <span class="n">size</span>
</span><span id="DualGridtype-641"><a href="#DualGridtype-641"><span class="linenos">641</span></a>
</span><span id="DualGridtype-642"><a href="#DualGridtype-642"><span class="linenos">642</span></a>  <span class="k">def</span> <span class="nf">point_from_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="DualGridtype-643"><a href="#DualGridtype-643"><span class="linenos">643</span></a>    <span class="k">return</span> <span class="p">(</span><span class="n">index</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="n">size</span>
</span><span id="DualGridtype-644"><a href="#DualGridtype-644"><span class="linenos">644</span></a>
</span><span id="DualGridtype-645"><a href="#DualGridtype-645"><span class="linenos">645</span></a>  <span class="k">def</span> <span class="nf">index_from_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="DualGridtype-646"><a href="#DualGridtype-646"><span class="linenos">646</span></a>    <span class="k">return</span> <span class="n">point</span> <span class="o">*</span> <span class="n">size</span> <span class="o">-</span> <span class="mf">0.5</span>
</span><span id="DualGridtype-647"><a href="#DualGridtype-647"><span class="linenos">647</span></a>
</span><span id="DualGridtype-648"><a href="#DualGridtype-648"><span class="linenos">648</span></a>  <span class="k">def</span> <span class="nf">reflect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="DualGridtype-649"><a href="#DualGridtype-649"><span class="linenos">649</span></a>    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="DualGridtype-650"><a href="#DualGridtype-650"><span class="linenos">650</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">index</span><span class="p">)</span>
</span><span id="DualGridtype-651"><a href="#DualGridtype-651"><span class="linenos">651</span></a>
</span><span id="DualGridtype-652"><a href="#DualGridtype-652"><span class="linenos">652</span></a>  <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="DualGridtype-653"><a href="#DualGridtype-653"><span class="linenos">653</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span><span class="p">)</span>
</span><span id="DualGridtype-654"><a href="#DualGridtype-654"><span class="linenos">654</span></a>
</span><span id="DualGridtype-655"><a href="#DualGridtype-655"><span class="linenos">655</span></a>  <span class="k">def</span> <span class="nf">reflect_clamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="DualGridtype-656"><a href="#DualGridtype-656"><span class="linenos">656</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">-</span> <span class="n">index</span><span class="p">,</span> <span class="n">index</span><span class="p">),</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Samples are at the center of cells in a uniform partition of the domain.</p>

<p>For a unit-domain dimension with N samples, each sample 0 &lt;= i &lt;= N has position (i + 0.5) / N,
e.g., [0.125, 0.375, 0.625, 0.875] for N = 4.</p>
</div>


                </section>
                <section id="PrimalGridtype">
                            <input id="PrimalGridtype-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PrimalGridtype</span><wbr>(<span class="base"><a href="#Gridtype">Gridtype</a></span>):

                <label class="view-source-button" for="PrimalGridtype-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PrimalGridtype"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PrimalGridtype-659"><a href="#PrimalGridtype-659"><span class="linenos">659</span></a><span class="k">class</span> <span class="nc">PrimalGridtype</span><span class="p">(</span><span class="n">Gridtype</span><span class="p">):</span>
</span><span id="PrimalGridtype-660"><a href="#PrimalGridtype-660"><span class="linenos">660</span></a>  <span class="sd">&quot;&quot;&quot;Samples are at the vertices of cells in a uniform partition of the domain.</span>
</span><span id="PrimalGridtype-661"><a href="#PrimalGridtype-661"><span class="linenos">661</span></a>
</span><span id="PrimalGridtype-662"><a href="#PrimalGridtype-662"><span class="linenos">662</span></a><span class="sd">  For a unit-domain dimension with N samples, each sample 0 &lt;= i &lt;= N has position i / (N - 1),</span>
</span><span id="PrimalGridtype-663"><a href="#PrimalGridtype-663"><span class="linenos">663</span></a><span class="sd">  e.g., [0, 1/3, 2/3, 1] for N = 4.</span>
</span><span id="PrimalGridtype-664"><a href="#PrimalGridtype-664"><span class="linenos">664</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="PrimalGridtype-665"><a href="#PrimalGridtype-665"><span class="linenos">665</span></a>
</span><span id="PrimalGridtype-666"><a href="#PrimalGridtype-666"><span class="linenos">666</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PrimalGridtype-667"><a href="#PrimalGridtype-667"><span class="linenos">667</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;primal&#39;</span><span class="p">)</span>
</span><span id="PrimalGridtype-668"><a href="#PrimalGridtype-668"><span class="linenos">668</span></a>
</span><span id="PrimalGridtype-669"><a href="#PrimalGridtype-669"><span class="linenos">669</span></a>  <span class="k">def</span> <span class="nf">min_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="PrimalGridtype-670"><a href="#PrimalGridtype-670"><span class="linenos">670</span></a>    <span class="k">return</span> <span class="mi">2</span>
</span><span id="PrimalGridtype-671"><a href="#PrimalGridtype-671"><span class="linenos">671</span></a>
</span><span id="PrimalGridtype-672"><a href="#PrimalGridtype-672"><span class="linenos">672</span></a>  <span class="k">def</span> <span class="nf">size_in_samples</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="PrimalGridtype-673"><a href="#PrimalGridtype-673"><span class="linenos">673</span></a>    <span class="k">return</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="PrimalGridtype-674"><a href="#PrimalGridtype-674"><span class="linenos">674</span></a>
</span><span id="PrimalGridtype-675"><a href="#PrimalGridtype-675"><span class="linenos">675</span></a>  <span class="k">def</span> <span class="nf">point_from_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="PrimalGridtype-676"><a href="#PrimalGridtype-676"><span class="linenos">676</span></a>    <span class="k">return</span> <span class="n">index</span> <span class="o">/</span> <span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="PrimalGridtype-677"><a href="#PrimalGridtype-677"><span class="linenos">677</span></a>
</span><span id="PrimalGridtype-678"><a href="#PrimalGridtype-678"><span class="linenos">678</span></a>  <span class="k">def</span> <span class="nf">index_from_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="PrimalGridtype-679"><a href="#PrimalGridtype-679"><span class="linenos">679</span></a>    <span class="k">return</span> <span class="n">point</span> <span class="o">*</span> <span class="p">(</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="PrimalGridtype-680"><a href="#PrimalGridtype-680"><span class="linenos">680</span></a>
</span><span id="PrimalGridtype-681"><a href="#PrimalGridtype-681"><span class="linenos">681</span></a>  <span class="k">def</span> <span class="nf">reflect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="PrimalGridtype-682"><a href="#PrimalGridtype-682"><span class="linenos">682</span></a>    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="PrimalGridtype-683"><a href="#PrimalGridtype-683"><span class="linenos">683</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">index</span><span class="p">)</span>
</span><span id="PrimalGridtype-684"><a href="#PrimalGridtype-684"><span class="linenos">684</span></a>
</span><span id="PrimalGridtype-685"><a href="#PrimalGridtype-685"><span class="linenos">685</span></a>  <span class="k">def</span> <span class="nf">wrap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="PrimalGridtype-686"><a href="#PrimalGridtype-686"><span class="linenos">686</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="PrimalGridtype-687"><a href="#PrimalGridtype-687"><span class="linenos">687</span></a>
</span><span id="PrimalGridtype-688"><a href="#PrimalGridtype-688"><span class="linenos">688</span></a>  <span class="k">def</span> <span class="nf">reflect_clamp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="PrimalGridtype-689"><a href="#PrimalGridtype-689"><span class="linenos">689</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">minimum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Samples are at the vertices of cells in a uniform partition of the domain.</p>

<p>For a unit-domain dimension with N samples, each sample 0 &lt;= i &lt;= N has position i / (N - 1),
e.g., [0, 1/3, 2/3, 1] for N = 4.</p>
</div>


                </section>
                <section id="GRIDTYPES">
                    <div class="attr variable">
            <span class="name">GRIDTYPES</span><span class="annotation">: Dict[str, <a href="#Gridtype">resampler.Gridtype</a>]</span><span class="default_value"> = {&#39;dual&#39;: DualGridtype(name=&#39;dual&#39;), &#39;primal&#39;: PrimalGridtype(name=&#39;primal&#39;)}</span>

        
    </div>
    <a class="headerlink" href="#GRIDTYPES"></a>
    
            <div class="docstring"><p>Shortcut names for some predefined grid types, specified per dimension.
The two entries are 'dual' and 'primal'.</p>
</div>


                </section>
                <section id="Boundary">
                            <input id="Boundary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclasses.dataclass</div>

    <span class="def">class</span>
    <span class="name">Boundary</span>:

                <label class="view-source-button" for="Boundary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Boundary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Boundary-979"><a href="#Boundary-979"><span class="linenos"> 979</span></a><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
</span><span id="Boundary-980"><a href="#Boundary-980"><span class="linenos"> 980</span></a><span class="k">class</span> <span class="nc">Boundary</span><span class="p">:</span>
</span><span id="Boundary-981"><a href="#Boundary-981"><span class="linenos"> 981</span></a>  <span class="sd">&quot;&quot;&quot;Domain boundary rules.  These define the reconstruction over the source domain near and beyond</span>
</span><span id="Boundary-982"><a href="#Boundary-982"><span class="linenos"> 982</span></a><span class="sd">  the domain boundaries.  The rules may be specified separately for each domain dimension.&quot;&quot;&quot;</span>
</span><span id="Boundary-983"><a href="#Boundary-983"><span class="linenos"> 983</span></a>
</span><span id="Boundary-984"><a href="#Boundary-984"><span class="linenos"> 984</span></a>  <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
</span><span id="Boundary-985"><a href="#Boundary-985"><span class="linenos"> 985</span></a>  <span class="sd">&quot;&quot;&quot;Boundary rule name.&quot;&quot;&quot;</span>
</span><span id="Boundary-986"><a href="#Boundary-986"><span class="linenos"> 986</span></a>
</span><span id="Boundary-987"><a href="#Boundary-987"><span class="linenos"> 987</span></a>  <span class="n">coord_remap</span><span class="p">:</span> <span class="n">RemapCoordinates</span> <span class="o">=</span> <span class="n">NoRemapCoordinates</span><span class="p">()</span>
</span><span id="Boundary-988"><a href="#Boundary-988"><span class="linenos"> 988</span></a>  <span class="sd">&quot;&quot;&quot;Modify specified coordinates prior to evaluating the reconstruction kernels.&quot;&quot;&quot;</span>
</span><span id="Boundary-989"><a href="#Boundary-989"><span class="linenos"> 989</span></a>
</span><span id="Boundary-990"><a href="#Boundary-990"><span class="linenos"> 990</span></a>  <span class="n">extend_samples</span><span class="p">:</span> <span class="n">ExtendSamples</span> <span class="o">=</span> <span class="n">ReflectExtendSamples</span><span class="p">()</span>
</span><span id="Boundary-991"><a href="#Boundary-991"><span class="linenos"> 991</span></a>  <span class="sd">&quot;&quot;&quot;Define the value of each grid sample outside the unit domain as an affine combination of</span>
</span><span id="Boundary-992"><a href="#Boundary-992"><span class="linenos"> 992</span></a><span class="sd">  interior sample(s) and possibly the constant value (cval).&quot;&quot;&quot;</span>
</span><span id="Boundary-993"><a href="#Boundary-993"><span class="linenos"> 993</span></a>
</span><span id="Boundary-994"><a href="#Boundary-994"><span class="linenos"> 994</span></a>  <span class="n">override_value</span><span class="p">:</span> <span class="n">OverrideExteriorValue</span> <span class="o">=</span> <span class="n">NoOverrideExteriorValue</span><span class="p">()</span>
</span><span id="Boundary-995"><a href="#Boundary-995"><span class="linenos"> 995</span></a>  <span class="sd">&quot;&quot;&quot;Set the value outside some extent to a constant value (cval).&quot;&quot;&quot;</span>
</span><span id="Boundary-996"><a href="#Boundary-996"><span class="linenos"> 996</span></a>
</span><span id="Boundary-997"><a href="#Boundary-997"><span class="linenos"> 997</span></a>  <span class="n">uses_cval</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">field</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="Boundary-998"><a href="#Boundary-998"><span class="linenos"> 998</span></a>  <span class="sd">&quot;&quot;&quot;True if weights may be non-affine, involving the constant value (cval).&quot;&quot;&quot;</span>
</span><span id="Boundary-999"><a href="#Boundary-999"><span class="linenos"> 999</span></a>
</span><span id="Boundary-1000"><a href="#Boundary-1000"><span class="linenos">1000</span></a>  <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Boundary-1001"><a href="#Boundary-1001"><span class="linenos">1001</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">uses_cval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extend_samples</span><span class="o">.</span><span class="n">uses_cval</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">override_value</span><span class="o">.</span><span class="n">uses_cval</span>
</span><span id="Boundary-1002"><a href="#Boundary-1002"><span class="linenos">1002</span></a>
</span><span id="Boundary-1003"><a href="#Boundary-1003"><span class="linenos">1003</span></a>  <span class="k">def</span> <span class="nf">preprocess_coordinates</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="Boundary-1004"><a href="#Boundary-1004"><span class="linenos">1004</span></a>    <span class="sd">&quot;&quot;&quot;Modify coordinates prior to evaluating the filter kernels.&quot;&quot;&quot;</span>
</span><span id="Boundary-1005"><a href="#Boundary-1005"><span class="linenos">1005</span></a>    <span class="c1"># Antialiasing across the tile boundaries may be feasible but seems hard.</span>
</span><span id="Boundary-1006"><a href="#Boundary-1006"><span class="linenos">1006</span></a>    <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">coord_remap</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>
</span><span id="Boundary-1007"><a href="#Boundary-1007"><span class="linenos">1007</span></a>    <span class="k">return</span> <span class="n">point</span>
</span><span id="Boundary-1008"><a href="#Boundary-1008"><span class="linenos">1008</span></a>
</span><span id="Boundary-1009"><a href="#Boundary-1009"><span class="linenos">1009</span></a>  <span class="k">def</span> <span class="nf">apply</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span>
</span><span id="Boundary-1010"><a href="#Boundary-1010"><span class="linenos">1010</span></a>            <span class="n">size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">gridtype</span><span class="p">:</span> <span class="n">Gridtype</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">_NDArray</span><span class="p">,</span> <span class="n">_NDArray</span><span class="p">]:</span>
</span><span id="Boundary-1011"><a href="#Boundary-1011"><span class="linenos">1011</span></a>    <span class="sd">&quot;&quot;&quot;Replace exterior samples by combinations of interior samples.&quot;&quot;&quot;</span>
</span><span id="Boundary-1012"><a href="#Boundary-1012"><span class="linenos">1012</span></a>    <span class="n">index</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extend_samples</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">gridtype</span><span class="p">)</span>
</span><span id="Boundary-1013"><a href="#Boundary-1013"><span class="linenos">1013</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">override_reconstruction</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
</span><span id="Boundary-1014"><a href="#Boundary-1014"><span class="linenos">1014</span></a>    <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="n">weight</span>
</span><span id="Boundary-1015"><a href="#Boundary-1015"><span class="linenos">1015</span></a>
</span><span id="Boundary-1016"><a href="#Boundary-1016"><span class="linenos">1016</span></a>  <span class="k">def</span> <span class="nf">override_reconstruction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">weight</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="n">point</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Boundary-1017"><a href="#Boundary-1017"><span class="linenos">1017</span></a>    <span class="sd">&quot;&quot;&quot;For points outside an extent, modify weight to zero to assign `cval`.&quot;&quot;&quot;</span>
</span><span id="Boundary-1018"><a href="#Boundary-1018"><span class="linenos">1018</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">override_value</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">point</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Domain boundary rules.  These define the reconstruction over the source domain near and beyond
the domain boundaries.  The rules may be specified separately for each domain dimension.</p>
</div>


                </section>
                <section id="BOUNDARIES">
                    <div class="attr variable">
            <span class="name">BOUNDARIES</span><span class="annotation">: Dict[str, <a href="#Boundary">resampler.Boundary</a>]</span><span class="default_value"> = {&#39;reflect&#39;: Boundary(name=&#39;reflect&#39;, coord_remap=&lt;resampler.NoRemapCoordinates object&gt;, extend_samples=ReflectExtendSamples(uses_cval=False), override_value=NoOverrideExteriorValue(boundary_antialiasing=True, uses_cval=False), uses_cval=False), &#39;wrap&#39;: Boundary(name=&#39;wrap&#39;, coord_remap=&lt;resampler.NoRemapCoordinates object&gt;, extend_samples=WrapExtendSamples(uses_cval=False), override_value=NoOverrideExteriorValue(boundary_antialiasing=True, uses_cval=False), uses_cval=False), &#39;tile&#39;: Boundary(name=&#39;title&#39;, coord_remap=&lt;resampler.TileRemapCoordinates object&gt;, extend_samples=ReflectExtendSamples(uses_cval=False), override_value=NoOverrideExteriorValue(boundary_antialiasing=True, uses_cval=False), uses_cval=False), &#39;clamp&#39;: Boundary(name=&#39;clamp&#39;, coord_remap=&lt;resampler.NoRemapCoordinates object&gt;, extend_samples=ClampExtendSamples(uses_cval=False), override_value=NoOverrideExteriorValue(boundary_antialiasing=True, uses_cval=False), uses_cval=False), &#39;border&#39;: Boundary(name=&#39;border&#39;, coord_remap=&lt;resampler.NoRemapCoordinates object&gt;, extend_samples=BorderExtendSamples(uses_cval=True), override_value=NoOverrideExteriorValue(boundary_antialiasing=True, uses_cval=False), uses_cval=True), &#39;natural&#39;: Boundary(name=&#39;natural&#39;, coord_remap=&lt;resampler.NoRemapCoordinates object&gt;, extend_samples=ValidExtendSamples(uses_cval=True), override_value=UnitDomainOverrideExteriorValue(boundary_antialiasing=True, uses_cval=True), uses_cval=True), &#39;linear_constant&#39;: Boundary(name=&#39;linear_constant&#39;, coord_remap=&lt;resampler.NoRemapCoordinates object&gt;, extend_samples=LinearExtendSamples(uses_cval=False), override_value=UnitDomainOverrideExteriorValue(boundary_antialiasing=True, uses_cval=True), uses_cval=True), &#39;quadratic_constant&#39;: Boundary(name=&#39;quadratic_constant&#39;, coord_remap=&lt;resampler.NoRemapCoordinates object&gt;, extend_samples=QuadraticExtendSamples(uses_cval=False), override_value=UnitDomainOverrideExteriorValue(boundary_antialiasing=True, uses_cval=True), uses_cval=True), &#39;reflect_clamp&#39;: Boundary(name=&#39;reflect_clamp&#39;, coord_remap=&lt;resampler.NoRemapCoordinates object&gt;, extend_samples=ReflectClampExtendSamples(uses_cval=False), override_value=NoOverrideExteriorValue(boundary_antialiasing=True, uses_cval=False), uses_cval=False), &#39;constant&#39;: Boundary(name=&#39;constant&#39;, coord_remap=&lt;resampler.NoRemapCoordinates object&gt;, extend_samples=ReflectExtendSamples(uses_cval=False), override_value=UnitDomainOverrideExteriorValue(boundary_antialiasing=True, uses_cval=True), uses_cval=True), &#39;linear&#39;: Boundary(name=&#39;linear&#39;, coord_remap=&lt;resampler.NoRemapCoordinates object&gt;, extend_samples=LinearExtendSamples(uses_cval=False), override_value=NoOverrideExteriorValue(boundary_antialiasing=True, uses_cval=False), uses_cval=False), &#39;quadratic&#39;: Boundary(name=&#39;quadratic&#39;, coord_remap=&lt;resampler.NoRemapCoordinates object&gt;, extend_samples=QuadraticExtendSamples(uses_cval=False), override_value=NoOverrideExteriorValue(boundary_antialiasing=True, uses_cval=False), uses_cval=False)}</span>

        
    </div>
    <a class="headerlink" href="#BOUNDARIES"></a>
    
            <div class="docstring"><p>Shortcut names for some predefined boundary rules.
Examples include: 'reflect', 'wrap', 'tile', 'clamp', 'border', etc.</p>
</div>


                </section>
                <section id="Filter">
                            <input id="Filter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclasses.dataclass</div>

    <span class="def">class</span>
    <span class="name">Filter</span>:

                <label class="view-source-button" for="Filter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Filter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Filter-1062"><a href="#Filter-1062"><span class="linenos">1062</span></a><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
</span><span id="Filter-1063"><a href="#Filter-1063"><span class="linenos">1063</span></a><span class="k">class</span> <span class="nc">Filter</span><span class="p">:</span>
</span><span id="Filter-1064"><a href="#Filter-1064"><span class="linenos">1064</span></a>  <span class="sd">&quot;&quot;&quot;Abstract base class for filter kernel functions.</span>
</span><span id="Filter-1065"><a href="#Filter-1065"><span class="linenos">1065</span></a>
</span><span id="Filter-1066"><a href="#Filter-1066"><span class="linenos">1066</span></a><span class="sd">  Each kernel is assumed to be zero-phase filter, i.e., to be symmetric in a support</span>
</span><span id="Filter-1067"><a href="#Filter-1067"><span class="linenos">1067</span></a><span class="sd">  interval [-radius, radius].  (Some sites instead define kernels over the interval [0, N]</span>
</span><span id="Filter-1068"><a href="#Filter-1068"><span class="linenos">1068</span></a><span class="sd">  where N = 2 * radius.)</span>
</span><span id="Filter-1069"><a href="#Filter-1069"><span class="linenos">1069</span></a>
</span><span id="Filter-1070"><a href="#Filter-1070"><span class="linenos">1070</span></a><span class="sd">  Portions of this code are adapted from the C++ library in</span>
</span><span id="Filter-1071"><a href="#Filter-1071"><span class="linenos">1071</span></a><span class="sd">  https://github.com/hhoppe/Mesh-processing-library/blob/master/libHh/Filter.cpp</span>
</span><span id="Filter-1072"><a href="#Filter-1072"><span class="linenos">1072</span></a>
</span><span id="Filter-1073"><a href="#Filter-1073"><span class="linenos">1073</span></a><span class="sd">  See also http://hhoppe.com/proj/filtering/.</span>
</span><span id="Filter-1074"><a href="#Filter-1074"><span class="linenos">1074</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="Filter-1075"><a href="#Filter-1075"><span class="linenos">1075</span></a>
</span><span id="Filter-1076"><a href="#Filter-1076"><span class="linenos">1076</span></a>  <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Filter-1077"><a href="#Filter-1077"><span class="linenos">1077</span></a>  <span class="sd">&quot;&quot;&quot;Filter kernel name.&quot;&quot;&quot;</span>
</span><span id="Filter-1078"><a href="#Filter-1078"><span class="linenos">1078</span></a>
</span><span id="Filter-1079"><a href="#Filter-1079"><span class="linenos">1079</span></a>  <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span>
</span><span id="Filter-1080"><a href="#Filter-1080"><span class="linenos">1080</span></a>  <span class="sd">&quot;&quot;&quot;Max absolute value of x for which self(x) is nonzero.&quot;&quot;&quot;</span>
</span><span id="Filter-1081"><a href="#Filter-1081"><span class="linenos">1081</span></a>
</span><span id="Filter-1082"><a href="#Filter-1082"><span class="linenos">1082</span></a>  <span class="n">interpolating</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Filter-1083"><a href="#Filter-1083"><span class="linenos">1083</span></a>  <span class="sd">&quot;&quot;&quot;True if self(0) == 1.0 and self(i) == 0.0 for all nonzero integers i.&quot;&quot;&quot;</span>
</span><span id="Filter-1084"><a href="#Filter-1084"><span class="linenos">1084</span></a>
</span><span id="Filter-1085"><a href="#Filter-1085"><span class="linenos">1085</span></a>  <span class="n">continuous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Filter-1086"><a href="#Filter-1086"><span class="linenos">1086</span></a>  <span class="sd">&quot;&quot;&quot;True if the kernel function has C^0 continuity.&quot;&quot;&quot;</span>
</span><span id="Filter-1087"><a href="#Filter-1087"><span class="linenos">1087</span></a>
</span><span id="Filter-1088"><a href="#Filter-1088"><span class="linenos">1088</span></a>  <span class="n">partition_of_unity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Filter-1089"><a href="#Filter-1089"><span class="linenos">1089</span></a>  <span class="sd">&quot;&quot;&quot;True if the convolution of the kernel with a Dirac comb reproduces the</span>
</span><span id="Filter-1090"><a href="#Filter-1090"><span class="linenos">1090</span></a><span class="sd">  unity function.&quot;&quot;&quot;</span>
</span><span id="Filter-1091"><a href="#Filter-1091"><span class="linenos">1091</span></a>
</span><span id="Filter-1092"><a href="#Filter-1092"><span class="linenos">1092</span></a>  <span class="n">unit_integral</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="Filter-1093"><a href="#Filter-1093"><span class="linenos">1093</span></a>  <span class="sd">&quot;&quot;&quot;True if the integral of the kernel function is 1.&quot;&quot;&quot;</span>
</span><span id="Filter-1094"><a href="#Filter-1094"><span class="linenos">1094</span></a>
</span><span id="Filter-1095"><a href="#Filter-1095"><span class="linenos">1095</span></a>  <span class="n">requires_digital_filter</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Filter-1096"><a href="#Filter-1096"><span class="linenos">1096</span></a>  <span class="sd">&quot;&quot;&quot;True if the filter needs a pre/post digital filter for interpolation.&quot;&quot;&quot;</span>
</span><span id="Filter-1097"><a href="#Filter-1097"><span class="linenos">1097</span></a>
</span><span id="Filter-1098"><a href="#Filter-1098"><span class="linenos">1098</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="Filter-1099"><a href="#Filter-1099"><span class="linenos">1099</span></a>    <span class="sd">&quot;&quot;&quot;Return evaluation of filter kernel at locations x.&quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Abstract base class for filter kernel functions.</p>

<p>Each kernel is assumed to be zero-phase filter, i.e., to be symmetric in a support
interval [-radius, radius].  (Some sites instead define kernels over the interval [0, N]
where N = 2 * radius.)</p>

<p>Portions of this code are adapted from the C++ library in
<a href="https://github.com/hhoppe/Mesh-processing-library/blob/master/libHh/Filter.cpp">https://github.com/hhoppe/Mesh-processing-library/blob/master/libHh/Filter.cpp</a></p>

<p>See also <a href="http://hhoppe.com/proj/filtering/">http://hhoppe.com/proj/filtering/</a>.</p>
</div>


                </section>
                <section id="ImpulseFilter">
                            <input id="ImpulseFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">ImpulseFilter</span><wbr>(<span class="base"><a href="#Filter">Filter</a></span>):

                <label class="view-source-button" for="ImpulseFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ImpulseFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ImpulseFilter-1102"><a href="#ImpulseFilter-1102"><span class="linenos">1102</span></a><span class="k">class</span> <span class="nc">ImpulseFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="ImpulseFilter-1103"><a href="#ImpulseFilter-1103"><span class="linenos">1103</span></a>  <span class="sd">&quot;&quot;&quot;See https://en.wikipedia.org/wiki/Dirac_delta_function.&quot;&quot;&quot;</span>
</span><span id="ImpulseFilter-1104"><a href="#ImpulseFilter-1104"><span class="linenos">1104</span></a>
</span><span id="ImpulseFilter-1105"><a href="#ImpulseFilter-1105"><span class="linenos">1105</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="ImpulseFilter-1106"><a href="#ImpulseFilter-1106"><span class="linenos">1106</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;impulse&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1e-20</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">partition_of_unity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="ImpulseFilter-1107"><a href="#ImpulseFilter-1107"><span class="linenos">1107</span></a>
</span><span id="ImpulseFilter-1108"><a href="#ImpulseFilter-1108"><span class="linenos">1108</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="ImpulseFilter-1109"><a href="#ImpulseFilter-1109"><span class="linenos">1109</span></a>    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="s1">&#39;The Impulse is infinitely narrow, so cannot be directly evaluated.&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>See <a href="https://en.wikipedia.org/wiki/Dirac_delta_function">https://en.wikipedia.org/wiki/Dirac_delta_function</a>.</p>
</div>


                </section>
                <section id="BoxFilter">
                            <input id="BoxFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BoxFilter</span><wbr>(<span class="base"><a href="#Filter">Filter</a></span>):

                <label class="view-source-button" for="BoxFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BoxFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BoxFilter-1112"><a href="#BoxFilter-1112"><span class="linenos">1112</span></a><span class="k">class</span> <span class="nc">BoxFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="BoxFilter-1113"><a href="#BoxFilter-1113"><span class="linenos">1113</span></a>  <span class="sd">&quot;&quot;&quot;See https://en.wikipedia.org/wiki/Box_function.</span>
</span><span id="BoxFilter-1114"><a href="#BoxFilter-1114"><span class="linenos">1114</span></a>
</span><span id="BoxFilter-1115"><a href="#BoxFilter-1115"><span class="linenos">1115</span></a><span class="sd">  The kernel function has value 1.0 over the half-open interval [-.5, .5).</span>
</span><span id="BoxFilter-1116"><a href="#BoxFilter-1116"><span class="linenos">1116</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="BoxFilter-1117"><a href="#BoxFilter-1117"><span class="linenos">1117</span></a>
</span><span id="BoxFilter-1118"><a href="#BoxFilter-1118"><span class="linenos">1118</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BoxFilter-1119"><a href="#BoxFilter-1119"><span class="linenos">1119</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="BoxFilter-1120"><a href="#BoxFilter-1120"><span class="linenos">1120</span></a>
</span><span id="BoxFilter-1121"><a href="#BoxFilter-1121"><span class="linenos">1121</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="BoxFilter-1122"><a href="#BoxFilter-1122"><span class="linenos">1122</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="o">-</span><span class="mf">0.5</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">),</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="BoxFilter-1123"><a href="#BoxFilter-1123"><span class="linenos">1123</span></a>    <span class="c1"># An alternative definition is symmetric with values 0.5 at the endpoints:</span>
</span><span id="BoxFilter-1124"><a href="#BoxFilter-1124"><span class="linenos">1124</span></a>    <span class="c1"># x = np.abs(x)</span>
</span><span id="BoxFilter-1125"><a href="#BoxFilter-1125"><span class="linenos">1125</span></a>    <span class="c1"># return np.where(x &lt; 0.5, 1.0, np.where(x == 0.5, 0.5, 0.0))</span>
</span></pre></div>


            <div class="docstring"><p>See <a href="https://en.wikipedia.org/wiki/Box_function">https://en.wikipedia.org/wiki/Box_function</a>.</p>

<p>The kernel function has value 1.0 over the half-open interval [-.5, .5).</p>
</div>


                </section>
                <section id="TrapezoidFilter">
                            <input id="TrapezoidFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TrapezoidFilter</span><wbr>(<span class="base"><a href="#Filter">Filter</a></span>):

                <label class="view-source-button" for="TrapezoidFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TrapezoidFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TrapezoidFilter-1128"><a href="#TrapezoidFilter-1128"><span class="linenos">1128</span></a><span class="k">class</span> <span class="nc">TrapezoidFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="TrapezoidFilter-1129"><a href="#TrapezoidFilter-1129"><span class="linenos">1129</span></a>  <span class="sd">&quot;&quot;&quot;Filter for antialiased &quot;area-based&quot; filtering.</span>
</span><span id="TrapezoidFilter-1130"><a href="#TrapezoidFilter-1130"><span class="linenos">1130</span></a>
</span><span id="TrapezoidFilter-1131"><a href="#TrapezoidFilter-1131"><span class="linenos">1131</span></a><span class="sd">  Args:</span>
</span><span id="TrapezoidFilter-1132"><a href="#TrapezoidFilter-1132"><span class="linenos">1132</span></a><span class="sd">    radius: Specifies the support [-radius, radius] of filter, where 0.5 &lt; radius &lt;= 1.0.</span>
</span><span id="TrapezoidFilter-1133"><a href="#TrapezoidFilter-1133"><span class="linenos">1133</span></a><span class="sd">      The special case `radius = None` is a placeholder that indicates that the filter will be</span>
</span><span id="TrapezoidFilter-1134"><a href="#TrapezoidFilter-1134"><span class="linenos">1134</span></a><span class="sd">      replaced by a trapezoid of the appropriate radius (based on scaling) for correct</span>
</span><span id="TrapezoidFilter-1135"><a href="#TrapezoidFilter-1135"><span class="linenos">1135</span></a><span class="sd">      antialiasing in both minification and magnification.</span>
</span><span id="TrapezoidFilter-1136"><a href="#TrapezoidFilter-1136"><span class="linenos">1136</span></a>
</span><span id="TrapezoidFilter-1137"><a href="#TrapezoidFilter-1137"><span class="linenos">1137</span></a><span class="sd">  This filter is similar to the BoxFilter but with linearly sloped sides.  It has value 1.0</span>
</span><span id="TrapezoidFilter-1138"><a href="#TrapezoidFilter-1138"><span class="linenos">1138</span></a><span class="sd">  in the interval abs(x) &lt;= 1.0 - radius and decreases linearly to value 0.0 in the interval</span>
</span><span id="TrapezoidFilter-1139"><a href="#TrapezoidFilter-1139"><span class="linenos">1139</span></a><span class="sd">  1.0 - radius &lt;= abs(x) &lt;= radius, always with value 0.5 at x = 0.5.</span>
</span><span id="TrapezoidFilter-1140"><a href="#TrapezoidFilter-1140"><span class="linenos">1140</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="TrapezoidFilter-1141"><a href="#TrapezoidFilter-1141"><span class="linenos">1141</span></a>
</span><span id="TrapezoidFilter-1142"><a href="#TrapezoidFilter-1142"><span class="linenos">1142</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TrapezoidFilter-1143"><a href="#TrapezoidFilter-1143"><span class="linenos">1143</span></a>    <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TrapezoidFilter-1144"><a href="#TrapezoidFilter-1144"><span class="linenos">1144</span></a>      <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;trapezoid&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
</span><span id="TrapezoidFilter-1145"><a href="#TrapezoidFilter-1145"><span class="linenos">1145</span></a>      <span class="k">return</span>
</span><span id="TrapezoidFilter-1146"><a href="#TrapezoidFilter-1146"><span class="linenos">1146</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="mf">0.5</span> <span class="o">&lt;</span> <span class="n">radius</span> <span class="o">&lt;=</span> <span class="mf">1.0</span><span class="p">:</span>
</span><span id="TrapezoidFilter-1147"><a href="#TrapezoidFilter-1147"><span class="linenos">1147</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Radius </span><span class="si">{</span><span class="n">radius</span><span class="si">}</span><span class="s1"> is outside the range (0.5, 1.0].&#39;</span><span class="p">)</span>
</span><span id="TrapezoidFilter-1148"><a href="#TrapezoidFilter-1148"><span class="linenos">1148</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;trapezoid_</span><span class="si">{</span><span class="n">radius</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">)</span>
</span><span id="TrapezoidFilter-1149"><a href="#TrapezoidFilter-1149"><span class="linenos">1149</span></a>
</span><span id="TrapezoidFilter-1150"><a href="#TrapezoidFilter-1150"><span class="linenos">1150</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="TrapezoidFilter-1151"><a href="#TrapezoidFilter-1151"><span class="linenos">1151</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="TrapezoidFilter-1152"><a href="#TrapezoidFilter-1152"><span class="linenos">1152</span></a>    <span class="k">assert</span> <span class="mf">0.5</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">&lt;=</span> <span class="mf">1.0</span>
</span><span id="TrapezoidFilter-1153"><a href="#TrapezoidFilter-1153"><span class="linenos">1153</span></a>    <span class="k">return</span> <span class="p">((</span><span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.25</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">))</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Filter for antialiased "area-based" filtering.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>radius:</strong>  Specifies the support [-radius, radius] of filter, where 0.5 &lt; radius &lt;= 1.0.
The special case <code>radius = None</code> is a placeholder that indicates that the filter will be
replaced by a trapezoid of the appropriate radius (based on scaling) for correct
antialiasing in both minification and magnification.</li>
</ul>

<p>This filter is similar to the BoxFilter but with linearly sloped sides.  It has value 1.0
in the interval abs(x) &lt;= 1.0 - radius and decreases linearly to value 0.0 in the interval
1.0 - radius &lt;= abs(x) &lt;= radius, always with value 0.5 at x = 0.5.</p>
</div>


                </section>
                <section id="TriangleFilter">
                            <input id="TriangleFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">TriangleFilter</span><wbr>(<span class="base"><a href="#Filter">Filter</a></span>):

                <label class="view-source-button" for="TriangleFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#TriangleFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="TriangleFilter-1156"><a href="#TriangleFilter-1156"><span class="linenos">1156</span></a><span class="k">class</span> <span class="nc">TriangleFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="TriangleFilter-1157"><a href="#TriangleFilter-1157"><span class="linenos">1157</span></a>  <span class="sd">&quot;&quot;&quot;See https://en.wikipedia.org/wiki/Triangle_function.</span>
</span><span id="TriangleFilter-1158"><a href="#TriangleFilter-1158"><span class="linenos">1158</span></a>
</span><span id="TriangleFilter-1159"><a href="#TriangleFilter-1159"><span class="linenos">1159</span></a><span class="sd">  Also known as the hat or tent function.  It is used for piecewise-linear</span>
</span><span id="TriangleFilter-1160"><a href="#TriangleFilter-1160"><span class="linenos">1160</span></a><span class="sd">  (or bilinear, or trilinear, ...) interpolation.</span>
</span><span id="TriangleFilter-1161"><a href="#TriangleFilter-1161"><span class="linenos">1161</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="TriangleFilter-1162"><a href="#TriangleFilter-1162"><span class="linenos">1162</span></a>
</span><span id="TriangleFilter-1163"><a href="#TriangleFilter-1163"><span class="linenos">1163</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="TriangleFilter-1164"><a href="#TriangleFilter-1164"><span class="linenos">1164</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;triangle&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</span><span id="TriangleFilter-1165"><a href="#TriangleFilter-1165"><span class="linenos">1165</span></a>
</span><span id="TriangleFilter-1166"><a href="#TriangleFilter-1166"><span class="linenos">1166</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="TriangleFilter-1167"><a href="#TriangleFilter-1167"><span class="linenos">1167</span></a>    <span class="k">return</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>See <a href="https://en.wikipedia.org/wiki/Triangle_function">https://en.wikipedia.org/wiki/Triangle_function</a>.</p>

<p>Also known as the hat or tent function.  It is used for piecewise-linear
(or bilinear, or trilinear, ...) interpolation.</p>
</div>


                </section>
                <section id="CubicFilter">
                            <input id="CubicFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CubicFilter</span><wbr>(<span class="base"><a href="#Filter">Filter</a></span>):

                <label class="view-source-button" for="CubicFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CubicFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CubicFilter-1170"><a href="#CubicFilter-1170"><span class="linenos">1170</span></a><span class="k">class</span> <span class="nc">CubicFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="CubicFilter-1171"><a href="#CubicFilter-1171"><span class="linenos">1171</span></a>  <span class="sd">&quot;&quot;&quot;Family of cubic filters parameterized by two scalar parameters.</span>
</span><span id="CubicFilter-1172"><a href="#CubicFilter-1172"><span class="linenos">1172</span></a>
</span><span id="CubicFilter-1173"><a href="#CubicFilter-1173"><span class="linenos">1173</span></a><span class="sd">  Args:</span>
</span><span id="CubicFilter-1174"><a href="#CubicFilter-1174"><span class="linenos">1174</span></a><span class="sd">    b: first scalar parameter.</span>
</span><span id="CubicFilter-1175"><a href="#CubicFilter-1175"><span class="linenos">1175</span></a><span class="sd">    c: second scalar parameter.</span>
</span><span id="CubicFilter-1176"><a href="#CubicFilter-1176"><span class="linenos">1176</span></a>
</span><span id="CubicFilter-1177"><a href="#CubicFilter-1177"><span class="linenos">1177</span></a><span class="sd">  See https://en.wikipedia.org/wiki/Mitchell%E2%80%93Netravali_filters and</span>
</span><span id="CubicFilter-1178"><a href="#CubicFilter-1178"><span class="linenos">1178</span></a><span class="sd">  https://doi.org/10.1145/378456.378514.</span>
</span><span id="CubicFilter-1179"><a href="#CubicFilter-1179"><span class="linenos">1179</span></a>
</span><span id="CubicFilter-1180"><a href="#CubicFilter-1180"><span class="linenos">1180</span></a><span class="sd">  [D. P. Mitchell and A. N. Netravali. Reconstruction filters in computer graphics.</span>
</span><span id="CubicFilter-1181"><a href="#CubicFilter-1181"><span class="linenos">1181</span></a><span class="sd">  Computer Graphics (Proceedings of ACM SIGGRAPH 1988), 22(4):221-228, 1988.]</span>
</span><span id="CubicFilter-1182"><a href="#CubicFilter-1182"><span class="linenos">1182</span></a>
</span><span id="CubicFilter-1183"><a href="#CubicFilter-1183"><span class="linenos">1183</span></a><span class="sd">  - The filter has quadratic precision iff b + 2 * c == 1.</span>
</span><span id="CubicFilter-1184"><a href="#CubicFilter-1184"><span class="linenos">1184</span></a><span class="sd">  - The filter is interpolating iff b == 0.</span>
</span><span id="CubicFilter-1185"><a href="#CubicFilter-1185"><span class="linenos">1185</span></a><span class="sd">  - (b=1, c=0) is the (non-interpolating) cubic B-spline basis;</span>
</span><span id="CubicFilter-1186"><a href="#CubicFilter-1186"><span class="linenos">1186</span></a><span class="sd">  - (b=1/3, c=1/3) is the Mitchell filter;</span>
</span><span id="CubicFilter-1187"><a href="#CubicFilter-1187"><span class="linenos">1187</span></a><span class="sd">  - (b=0, c=0.5) is the Catmull-Rom spline (which has cubic precision);</span>
</span><span id="CubicFilter-1188"><a href="#CubicFilter-1188"><span class="linenos">1188</span></a><span class="sd">  - (b=0, c=0.75) is the &quot;sharper cubic&quot; used in Photoshop and OpenCV.</span>
</span><span id="CubicFilter-1189"><a href="#CubicFilter-1189"><span class="linenos">1189</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="CubicFilter-1190"><a href="#CubicFilter-1190"><span class="linenos">1190</span></a>
</span><span id="CubicFilter-1191"><a href="#CubicFilter-1191"><span class="linenos">1191</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">c</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CubicFilter-1192"><a href="#CubicFilter-1192"><span class="linenos">1192</span></a>    <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;cubic_b</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1">_c</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">name</span>
</span><span id="CubicFilter-1193"><a href="#CubicFilter-1193"><span class="linenos">1193</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">interpolating</span><span class="o">=</span><span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span>
</span><span id="CubicFilter-1194"><a href="#CubicFilter-1194"><span class="linenos">1194</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">=</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span>
</span><span id="CubicFilter-1195"><a href="#CubicFilter-1195"><span class="linenos">1195</span></a>
</span><span id="CubicFilter-1196"><a href="#CubicFilter-1196"><span class="linenos">1196</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="CubicFilter-1197"><a href="#CubicFilter-1197"><span class="linenos">1197</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="CubicFilter-1198"><a href="#CubicFilter-1198"><span class="linenos">1198</span></a>    <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">b</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span>
</span><span id="CubicFilter-1199"><a href="#CubicFilter-1199"><span class="linenos">1199</span></a>    <span class="n">f3</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f0</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">9</span><span class="o">/</span><span class="mi">6</span><span class="o">*</span><span class="n">b</span> <span class="o">-</span> <span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">b</span>
</span><span id="CubicFilter-1200"><a href="#CubicFilter-1200"><span class="linenos">1200</span></a>    <span class="n">g3</span><span class="p">,</span> <span class="n">g2</span><span class="p">,</span> <span class="n">g1</span><span class="p">,</span> <span class="n">g0</span> <span class="o">=</span> <span class="o">-</span><span class="n">b</span><span class="o">/</span><span class="mi">6</span> <span class="o">-</span> <span class="n">c</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">5</span><span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">b</span> <span class="o">-</span> <span class="mi">8</span><span class="o">*</span><span class="n">c</span><span class="p">,</span> <span class="mi">8</span><span class="o">/</span><span class="mi">6</span><span class="o">*</span><span class="n">b</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">c</span>
</span><span id="CubicFilter-1201"><a href="#CubicFilter-1201"><span class="linenos">1201</span></a>    <span class="c1"># (np.polynomial.polynomial.polyval(x, [f0, 0, f2, f3]) is almost</span>
</span><span id="CubicFilter-1202"><a href="#CubicFilter-1202"><span class="linenos">1202</span></a>    <span class="c1"># twice as slow; see also https://stackoverflow.com/questions/24065904)</span>
</span><span id="CubicFilter-1203"><a href="#CubicFilter-1203"><span class="linenos">1203</span></a>    <span class="n">v01</span> <span class="o">=</span> <span class="p">((</span><span class="n">f3</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">f2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">f0</span>
</span><span id="CubicFilter-1204"><a href="#CubicFilter-1204"><span class="linenos">1204</span></a>    <span class="n">v12</span> <span class="o">=</span> <span class="p">((</span><span class="n">g3</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">g2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">g1</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">g0</span>
</span><span id="CubicFilter-1205"><a href="#CubicFilter-1205"><span class="linenos">1205</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">v01</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">v12</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Family of cubic filters parameterized by two scalar parameters.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>b:</strong>  first scalar parameter.</li>
<li><strong>c:</strong>  second scalar parameter.</li>
</ul>

<p>See <a href="https://en.wikipedia.org/wiki/Mitchell%E2%80%93Netravali_filters">https://en.wikipedia.org/wiki/Mitchell%E2%80%93Netravali_filters</a> and
<a href="https://doi.org/10.1145/378456.378514">https://doi.org/10.1145/378456.378514</a>.</p>

<p>[D. P. Mitchell and A. N. Netravali. Reconstruction filters in computer graphics.
Computer Graphics (Proceedings of ACM SIGGRAPH 1988), 22(4):221-228, 1988.]</p>

<ul>
<li>The filter has quadratic precision iff b + 2 * c == 1.</li>
<li>The filter is interpolating iff b == 0.</li>
<li>(b=1, c=0) is the (non-interpolating) cubic B-spline basis;</li>
<li>(b=1/3, c=1/3) is the Mitchell filter;</li>
<li>(b=0, c=0.5) is the Catmull-Rom spline (which has cubic precision);</li>
<li>(b=0, c=0.75) is the "sharper cubic" used in Photoshop and OpenCV.</li>
</ul>
</div>


                </section>
                <section id="CatmullRomFilter">
                            <input id="CatmullRomFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CatmullRomFilter</span><wbr>(<span class="base"><a href="#CubicFilter">CubicFilter</a></span>):

                <label class="view-source-button" for="CatmullRomFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CatmullRomFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CatmullRomFilter-1208"><a href="#CatmullRomFilter-1208"><span class="linenos">1208</span></a><span class="k">class</span> <span class="nc">CatmullRomFilter</span><span class="p">(</span><span class="n">CubicFilter</span><span class="p">):</span>
</span><span id="CatmullRomFilter-1209"><a href="#CatmullRomFilter-1209"><span class="linenos">1209</span></a>  <span class="sd">&quot;&quot;&quot;Cubic filter with cubic precision.  Also known as Keys filter.</span>
</span><span id="CatmullRomFilter-1210"><a href="#CatmullRomFilter-1210"><span class="linenos">1210</span></a>
</span><span id="CatmullRomFilter-1211"><a href="#CatmullRomFilter-1211"><span class="linenos">1211</span></a><span class="sd">  [E. Catmull, R. Rom.  A class of local interpolating splines.  Computer aided geometric</span>
</span><span id="CatmullRomFilter-1212"><a href="#CatmullRomFilter-1212"><span class="linenos">1212</span></a><span class="sd">  design, 1974]</span>
</span><span id="CatmullRomFilter-1213"><a href="#CatmullRomFilter-1213"><span class="linenos">1213</span></a><span class="sd">  [Wikipedia](https://en.wikipedia.org/wiki/Cubic_Hermite_spline#Catmull%E2%80%93Rom_spline)</span>
</span><span id="CatmullRomFilter-1214"><a href="#CatmullRomFilter-1214"><span class="linenos">1214</span></a>
</span><span id="CatmullRomFilter-1215"><a href="#CatmullRomFilter-1215"><span class="linenos">1215</span></a><span class="sd">  [R. G. Keys.  Cubic convolution interpolation for digital image processing.</span>
</span><span id="CatmullRomFilter-1216"><a href="#CatmullRomFilter-1216"><span class="linenos">1216</span></a><span class="sd">  IEEE Trans. on Acoustics, Speech, and Signal Processing, 29(6), 1981.]</span>
</span><span id="CatmullRomFilter-1217"><a href="#CatmullRomFilter-1217"><span class="linenos">1217</span></a><span class="sd">  https://ieeexplore.ieee.org/document/1163711/.</span>
</span><span id="CatmullRomFilter-1218"><a href="#CatmullRomFilter-1218"><span class="linenos">1218</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="CatmullRomFilter-1219"><a href="#CatmullRomFilter-1219"><span class="linenos">1219</span></a>
</span><span id="CatmullRomFilter-1220"><a href="#CatmullRomFilter-1220"><span class="linenos">1220</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CatmullRomFilter-1221"><a href="#CatmullRomFilter-1221"><span class="linenos">1221</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Cubic filter with cubic precision.  Also known as Keys filter.</p>

<p>[E. Catmull, R. Rom.  A class of local interpolating splines.  Computer aided geometric
design, 1974]
[Wikipedia](https://en.wikipedia.org/wiki/Cubic_Hermite_spline#Catmull%E2%80%93Rom_spline)</p>

<p>[R. G. Keys.  Cubic convolution interpolation for digital image processing.
IEEE Trans. on Acoustics, Speech, and Signal Processing, 29(6), 1981.]
<a href="https://ieeexplore.ieee.org/document/1163711/">https://ieeexplore.ieee.org/document/1163711/</a>.</p>
</div>


                </section>
                <section id="MitchellFilter">
                            <input id="MitchellFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MitchellFilter</span><wbr>(<span class="base"><a href="#CubicFilter">CubicFilter</a></span>):

                <label class="view-source-button" for="MitchellFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MitchellFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MitchellFilter-1224"><a href="#MitchellFilter-1224"><span class="linenos">1224</span></a><span class="k">class</span> <span class="nc">MitchellFilter</span><span class="p">(</span><span class="n">CubicFilter</span><span class="p">):</span>
</span><span id="MitchellFilter-1225"><a href="#MitchellFilter-1225"><span class="linenos">1225</span></a>  <span class="sd">&quot;&quot;&quot;See https://doi.org/10.1145/378456.378514.</span>
</span><span id="MitchellFilter-1226"><a href="#MitchellFilter-1226"><span class="linenos">1226</span></a>
</span><span id="MitchellFilter-1227"><a href="#MitchellFilter-1227"><span class="linenos">1227</span></a><span class="sd">  [D. P. Mitchell and A. N. Netravali.  Reconstruction filters in computer graphics.  Computer</span>
</span><span id="MitchellFilter-1228"><a href="#MitchellFilter-1228"><span class="linenos">1228</span></a><span class="sd">  Graphics (Proceedings of ACM SIGGRAPH 1988), 22(4):221-228, 1988.]</span>
</span><span id="MitchellFilter-1229"><a href="#MitchellFilter-1229"><span class="linenos">1229</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="MitchellFilter-1230"><a href="#MitchellFilter-1230"><span class="linenos">1230</span></a>
</span><span id="MitchellFilter-1231"><a href="#MitchellFilter-1231"><span class="linenos">1231</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MitchellFilter-1232"><a href="#MitchellFilter-1232"><span class="linenos">1232</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;mitchell&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>See <a href="https://doi.org/10.1145/378456.378514">https://doi.org/10.1145/378456.378514</a>.</p>

<p>[D. P. Mitchell and A. N. Netravali.  Reconstruction filters in computer graphics.  Computer
Graphics (Proceedings of ACM SIGGRAPH 1988), 22(4):221-228, 1988.]</p>
</div>


                </section>
                <section id="SharpCubicFilter">
                            <input id="SharpCubicFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SharpCubicFilter</span><wbr>(<span class="base"><a href="#CubicFilter">CubicFilter</a></span>):

                <label class="view-source-button" for="SharpCubicFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SharpCubicFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SharpCubicFilter-1235"><a href="#SharpCubicFilter-1235"><span class="linenos">1235</span></a><span class="k">class</span> <span class="nc">SharpCubicFilter</span><span class="p">(</span><span class="n">CubicFilter</span><span class="p">):</span>
</span><span id="SharpCubicFilter-1236"><a href="#SharpCubicFilter-1236"><span class="linenos">1236</span></a>  <span class="sd">&quot;&quot;&quot;Cubic filter that is sharper than Catmull-Rom filter.</span>
</span><span id="SharpCubicFilter-1237"><a href="#SharpCubicFilter-1237"><span class="linenos">1237</span></a>
</span><span id="SharpCubicFilter-1238"><a href="#SharpCubicFilter-1238"><span class="linenos">1238</span></a><span class="sd">  Used by some tools including OpenCV and Photoshop.</span>
</span><span id="SharpCubicFilter-1239"><a href="#SharpCubicFilter-1239"><span class="linenos">1239</span></a>
</span><span id="SharpCubicFilter-1240"><a href="#SharpCubicFilter-1240"><span class="linenos">1240</span></a><span class="sd">  See https://en.wikipedia.org/wiki/Mitchell%E2%80%93Netravali_filters and</span>
</span><span id="SharpCubicFilter-1241"><a href="#SharpCubicFilter-1241"><span class="linenos">1241</span></a><span class="sd">  http://entropymine.com/resamplescope/notes/photoshop/.</span>
</span><span id="SharpCubicFilter-1242"><a href="#SharpCubicFilter-1242"><span class="linenos">1242</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="SharpCubicFilter-1243"><a href="#SharpCubicFilter-1243"><span class="linenos">1243</span></a>
</span><span id="SharpCubicFilter-1244"><a href="#SharpCubicFilter-1244"><span class="linenos">1244</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SharpCubicFilter-1245"><a href="#SharpCubicFilter-1245"><span class="linenos">1245</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sharpcubic&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Cubic filter that is sharper than Catmull-Rom filter.</p>

<p>Used by some tools including OpenCV and Photoshop.</p>

<p>See <a href="https://en.wikipedia.org/wiki/Mitchell%E2%80%93Netravali_filters">https://en.wikipedia.org/wiki/Mitchell%E2%80%93Netravali_filters</a> and
<a href="http://entropymine.com/resamplescope/notes/photoshop/">http://entropymine.com/resamplescope/notes/photoshop/</a>.</p>
</div>


                </section>
                <section id="LanczosFilter">
                            <input id="LanczosFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">LanczosFilter</span><wbr>(<span class="base"><a href="#Filter">Filter</a></span>):

                <label class="view-source-button" for="LanczosFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LanczosFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LanczosFilter-1248"><a href="#LanczosFilter-1248"><span class="linenos">1248</span></a><span class="k">class</span> <span class="nc">LanczosFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="LanczosFilter-1249"><a href="#LanczosFilter-1249"><span class="linenos">1249</span></a>  <span class="sd">&quot;&quot;&quot;High-quality filter: sinc function modulated by a sinc window.</span>
</span><span id="LanczosFilter-1250"><a href="#LanczosFilter-1250"><span class="linenos">1250</span></a>
</span><span id="LanczosFilter-1251"><a href="#LanczosFilter-1251"><span class="linenos">1251</span></a><span class="sd">  Args:</span>
</span><span id="LanczosFilter-1252"><a href="#LanczosFilter-1252"><span class="linenos">1252</span></a><span class="sd">    radius: Specifies support window [-radius, radius] over which filter is nonzero.</span>
</span><span id="LanczosFilter-1253"><a href="#LanczosFilter-1253"><span class="linenos">1253</span></a><span class="sd">    sampled: If True, use a discretized approximation for improved speed.</span>
</span><span id="LanczosFilter-1254"><a href="#LanczosFilter-1254"><span class="linenos">1254</span></a>
</span><span id="LanczosFilter-1255"><a href="#LanczosFilter-1255"><span class="linenos">1255</span></a><span class="sd">  See https://en.wikipedia.org/wiki/Lanczos_kernel.</span>
</span><span id="LanczosFilter-1256"><a href="#LanczosFilter-1256"><span class="linenos">1256</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="LanczosFilter-1257"><a href="#LanczosFilter-1257"><span class="linenos">1257</span></a>
</span><span id="LanczosFilter-1258"><a href="#LanczosFilter-1258"><span class="linenos">1258</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sampled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="LanczosFilter-1259"><a href="#LanczosFilter-1259"><span class="linenos">1259</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;lanczos_</span><span class="si">{</span><span class="n">radius</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">partition_of_unity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="LanczosFilter-1260"><a href="#LanczosFilter-1260"><span class="linenos">1260</span></a>                     <span class="n">unit_integral</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="LanczosFilter-1261"><a href="#LanczosFilter-1261"><span class="linenos">1261</span></a>
</span><span id="LanczosFilter-1262"><a href="#LanczosFilter-1262"><span class="linenos">1262</span></a>    <span class="nd">@_cache_sampled_1d_function</span><span class="p">(</span><span class="n">xmin</span><span class="o">=-</span><span class="n">radius</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="n">sampled</span><span class="p">)</span>
</span><span id="LanczosFilter-1263"><a href="#LanczosFilter-1263"><span class="linenos">1263</span></a>    <span class="k">def</span> <span class="nf">_eval</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="LanczosFilter-1264"><a href="#LanczosFilter-1264"><span class="linenos">1264</span></a>      <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="LanczosFilter-1265"><a href="#LanczosFilter-1265"><span class="linenos">1265</span></a>      <span class="c1"># Note that window[n] = sinc(2*n/N - 1), with 0 &lt;= n &lt;= N.</span>
</span><span id="LanczosFilter-1266"><a href="#LanczosFilter-1266"><span class="linenos">1266</span></a>      <span class="c1"># But, x = n - N/2, or equivalently, n = x + N/2, with -N/2 &lt;= x &lt;= N/2.</span>
</span><span id="LanczosFilter-1267"><a href="#LanczosFilter-1267"><span class="linenos">1267</span></a>      <span class="n">window</span> <span class="o">=</span> <span class="n">_sinc</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">radius</span><span class="p">)</span>  <span class="c1"># Zero-phase function w_0(x).</span>
</span><span id="LanczosFilter-1268"><a href="#LanczosFilter-1268"><span class="linenos">1268</span></a>      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">radius</span><span class="p">,</span> <span class="n">_sinc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">window</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="LanczosFilter-1269"><a href="#LanczosFilter-1269"><span class="linenos">1269</span></a>
</span><span id="LanczosFilter-1270"><a href="#LanczosFilter-1270"><span class="linenos">1270</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">_eval</span>
</span><span id="LanczosFilter-1271"><a href="#LanczosFilter-1271"><span class="linenos">1271</span></a>
</span><span id="LanczosFilter-1272"><a href="#LanczosFilter-1272"><span class="linenos">1272</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="LanczosFilter-1273"><a href="#LanczosFilter-1273"><span class="linenos">1273</span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>High-quality filter: sinc function modulated by a sinc window.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>radius:</strong>  Specifies support window [-radius, radius] over which filter is nonzero.</li>
<li><strong>sampled:</strong>  If True, use a discretized approximation for improved speed.</li>
</ul>

<p>See <a href="https://en.wikipedia.org/wiki/Lanczos_kernel">https://en.wikipedia.org/wiki/Lanczos_kernel</a>.</p>
</div>


                </section>
                <section id="GeneralizedHammingFilter">
                            <input id="GeneralizedHammingFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GeneralizedHammingFilter</span><wbr>(<span class="base"><a href="#Filter">Filter</a></span>):

                <label class="view-source-button" for="GeneralizedHammingFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GeneralizedHammingFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GeneralizedHammingFilter-1276"><a href="#GeneralizedHammingFilter-1276"><span class="linenos">1276</span></a><span class="k">class</span> <span class="nc">GeneralizedHammingFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="GeneralizedHammingFilter-1277"><a href="#GeneralizedHammingFilter-1277"><span class="linenos">1277</span></a>  <span class="sd">&quot;&quot;&quot;Sinc function modulated by a Hamming window.</span>
</span><span id="GeneralizedHammingFilter-1278"><a href="#GeneralizedHammingFilter-1278"><span class="linenos">1278</span></a>
</span><span id="GeneralizedHammingFilter-1279"><a href="#GeneralizedHammingFilter-1279"><span class="linenos">1279</span></a><span class="sd">  Args:</span>
</span><span id="GeneralizedHammingFilter-1280"><a href="#GeneralizedHammingFilter-1280"><span class="linenos">1280</span></a><span class="sd">    radius: Specifies support window [-radius, radius] over which filter is nonzero.</span>
</span><span id="GeneralizedHammingFilter-1281"><a href="#GeneralizedHammingFilter-1281"><span class="linenos">1281</span></a><span class="sd">    a0: Scalar parameter, where 0.0 &lt; a0 &lt; 1.0.  The case of a0=0.5 is the Hann filter.</span>
</span><span id="GeneralizedHammingFilter-1282"><a href="#GeneralizedHammingFilter-1282"><span class="linenos">1282</span></a>
</span><span id="GeneralizedHammingFilter-1283"><a href="#GeneralizedHammingFilter-1283"><span class="linenos">1283</span></a><span class="sd">  See https://en.wikipedia.org/wiki/Window_function#Hann_and_Hamming_windows,</span>
</span><span id="GeneralizedHammingFilter-1284"><a href="#GeneralizedHammingFilter-1284"><span class="linenos">1284</span></a><span class="sd">  and hamming() in https://github.com/scipy/scipy/blob/master/scipy/signal/windows/windows.py.</span>
</span><span id="GeneralizedHammingFilter-1285"><a href="#GeneralizedHammingFilter-1285"><span class="linenos">1285</span></a>
</span><span id="GeneralizedHammingFilter-1286"><a href="#GeneralizedHammingFilter-1286"><span class="linenos">1286</span></a><span class="sd">  Generalized version of np.hamming() and np.hanning().</span>
</span><span id="GeneralizedHammingFilter-1287"><a href="#GeneralizedHammingFilter-1287"><span class="linenos">1287</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="GeneralizedHammingFilter-1288"><a href="#GeneralizedHammingFilter-1288"><span class="linenos">1288</span></a>
</span><span id="GeneralizedHammingFilter-1289"><a href="#GeneralizedHammingFilter-1289"><span class="linenos">1289</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">a0</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GeneralizedHammingFilter-1290"><a href="#GeneralizedHammingFilter-1290"><span class="linenos">1290</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
</span><span id="GeneralizedHammingFilter-1291"><a href="#GeneralizedHammingFilter-1291"><span class="linenos">1291</span></a>        <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;hamming_</span><span class="si">{</span><span class="n">radius</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="GeneralizedHammingFilter-1292"><a href="#GeneralizedHammingFilter-1292"><span class="linenos">1292</span></a>        <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span>
</span><span id="GeneralizedHammingFilter-1293"><a href="#GeneralizedHammingFilter-1293"><span class="linenos">1293</span></a>        <span class="n">partition_of_unity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># 1:1.00242  av=1.00188  sd=0.00052909</span>
</span><span id="GeneralizedHammingFilter-1294"><a href="#GeneralizedHammingFilter-1294"><span class="linenos">1294</span></a>        <span class="n">unit_integral</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>       <span class="c1"># 1.00188</span>
</span><span id="GeneralizedHammingFilter-1295"><a href="#GeneralizedHammingFilter-1295"><span class="linenos">1295</span></a>    <span class="p">)</span>
</span><span id="GeneralizedHammingFilter-1296"><a href="#GeneralizedHammingFilter-1296"><span class="linenos">1296</span></a>    <span class="k">assert</span> <span class="mf">0.0</span> <span class="o">&lt;</span> <span class="n">a0</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
</span><span id="GeneralizedHammingFilter-1297"><a href="#GeneralizedHammingFilter-1297"><span class="linenos">1297</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">a0</span> <span class="o">=</span> <span class="n">a0</span>
</span><span id="GeneralizedHammingFilter-1298"><a href="#GeneralizedHammingFilter-1298"><span class="linenos">1298</span></a>
</span><span id="GeneralizedHammingFilter-1299"><a href="#GeneralizedHammingFilter-1299"><span class="linenos">1299</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="GeneralizedHammingFilter-1300"><a href="#GeneralizedHammingFilter-1300"><span class="linenos">1300</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="GeneralizedHammingFilter-1301"><a href="#GeneralizedHammingFilter-1301"><span class="linenos">1301</span></a>    <span class="c1"># Note that window[n] = a0 - (1 - a0) * cos(2 * pi * n / N), 0 &lt;= n &lt;= N.</span>
</span><span id="GeneralizedHammingFilter-1302"><a href="#GeneralizedHammingFilter-1302"><span class="linenos">1302</span></a>    <span class="c1"># With n = x + N/2, we get the zero-phase function w_0(x):</span>
</span><span id="GeneralizedHammingFilter-1303"><a href="#GeneralizedHammingFilter-1303"><span class="linenos">1303</span></a>    <span class="n">window</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a0</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">a0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
</span><span id="GeneralizedHammingFilter-1304"><a href="#GeneralizedHammingFilter-1304"><span class="linenos">1304</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">_sinc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">window</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sinc function modulated by a Hamming window.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>radius:</strong>  Specifies support window [-radius, radius] over which filter is nonzero.</li>
<li><strong>a0:</strong>  Scalar parameter, where 0.0 &lt; a0 &lt; 1.0.  The case of a0=0.5 is the Hann filter.</li>
</ul>

<p>See <a href="https://en.wikipedia.org/wiki/Window_function#Hann_and_Hamming_windows">https://en.wikipedia.org/wiki/Window_function#Hann_and_Hamming_windows</a>,
and hamming() in <a href="https://github.com/scipy/scipy/blob/master/scipy/signal/windows/windows.py">https://github.com/scipy/scipy/blob/master/scipy/signal/windows/windows.py</a>.</p>

<p>Generalized version of np.hamming() and np.hanning().</p>
</div>


                </section>
                <section id="KaiserFilter">
                            <input id="KaiserFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">KaiserFilter</span><wbr>(<span class="base"><a href="#Filter">Filter</a></span>):

                <label class="view-source-button" for="KaiserFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#KaiserFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="KaiserFilter-1307"><a href="#KaiserFilter-1307"><span class="linenos">1307</span></a><span class="k">class</span> <span class="nc">KaiserFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="KaiserFilter-1308"><a href="#KaiserFilter-1308"><span class="linenos">1308</span></a>  <span class="sd">&quot;&quot;&quot;Sinc function modulated by a Kaiser-Bessel window.</span>
</span><span id="KaiserFilter-1309"><a href="#KaiserFilter-1309"><span class="linenos">1309</span></a>
</span><span id="KaiserFilter-1310"><a href="#KaiserFilter-1310"><span class="linenos">1310</span></a><span class="sd">  See https://en.wikipedia.org/wiki/Kaiser_window, and example use in:</span>
</span><span id="KaiserFilter-1311"><a href="#KaiserFilter-1311"><span class="linenos">1311</span></a><span class="sd">  [Karras et al. 20201.  Alias-free generative adversarial networks.</span>
</span><span id="KaiserFilter-1312"><a href="#KaiserFilter-1312"><span class="linenos">1312</span></a><span class="sd">  https://arxiv.org/pdf/2106.12423.pdf].</span>
</span><span id="KaiserFilter-1313"><a href="#KaiserFilter-1313"><span class="linenos">1313</span></a>
</span><span id="KaiserFilter-1314"><a href="#KaiserFilter-1314"><span class="linenos">1314</span></a><span class="sd">  Use np.kaiser()?</span>
</span><span id="KaiserFilter-1315"><a href="#KaiserFilter-1315"><span class="linenos">1315</span></a>
</span><span id="KaiserFilter-1316"><a href="#KaiserFilter-1316"><span class="linenos">1316</span></a><span class="sd">  Args:</span>
</span><span id="KaiserFilter-1317"><a href="#KaiserFilter-1317"><span class="linenos">1317</span></a><span class="sd">    radius: Value L/2 in the definition.  It may be fractional for a (digital) resizing filter</span>
</span><span id="KaiserFilter-1318"><a href="#KaiserFilter-1318"><span class="linenos">1318</span></a><span class="sd">      (sample spacing s != 1) with an even number of samples (dual grid), e.g., Eq. (6)</span>
</span><span id="KaiserFilter-1319"><a href="#KaiserFilter-1319"><span class="linenos">1319</span></a><span class="sd">      in [Karras et al. 2021] --- this effects the precise shape of the window function.</span>
</span><span id="KaiserFilter-1320"><a href="#KaiserFilter-1320"><span class="linenos">1320</span></a><span class="sd">    beta: Determines the trade-off between main-lobe width and side-lobe level.</span>
</span><span id="KaiserFilter-1321"><a href="#KaiserFilter-1321"><span class="linenos">1321</span></a><span class="sd">    sampled: If True, use a discretized approximation for improved speed.</span>
</span><span id="KaiserFilter-1322"><a href="#KaiserFilter-1322"><span class="linenos">1322</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="KaiserFilter-1323"><a href="#KaiserFilter-1323"><span class="linenos">1323</span></a>
</span><span id="KaiserFilter-1324"><a href="#KaiserFilter-1324"><span class="linenos">1324</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">beta</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">sampled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="KaiserFilter-1325"><a href="#KaiserFilter-1325"><span class="linenos">1325</span></a>    <span class="k">assert</span> <span class="n">beta</span> <span class="o">&gt;=</span> <span class="mf">0.0</span>
</span><span id="KaiserFilter-1326"><a href="#KaiserFilter-1326"><span class="linenos">1326</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;kaiser_</span><span class="si">{</span><span class="n">radius</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">beta</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">partition_of_unity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="KaiserFilter-1327"><a href="#KaiserFilter-1327"><span class="linenos">1327</span></a>                     <span class="n">unit_integral</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="KaiserFilter-1328"><a href="#KaiserFilter-1328"><span class="linenos">1328</span></a>
</span><span id="KaiserFilter-1329"><a href="#KaiserFilter-1329"><span class="linenos">1329</span></a>    <span class="nd">@_cache_sampled_1d_function</span><span class="p">(</span><span class="n">xmin</span><span class="o">=-</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">radius</span><span class="p">),</span> <span class="n">xmax</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">radius</span><span class="p">),</span> <span class="n">enable</span><span class="o">=</span><span class="n">sampled</span><span class="p">)</span>
</span><span id="KaiserFilter-1330"><a href="#KaiserFilter-1330"><span class="linenos">1330</span></a>    <span class="k">def</span> <span class="nf">_eval</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="KaiserFilter-1331"><a href="#KaiserFilter-1331"><span class="linenos">1331</span></a>      <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="KaiserFilter-1332"><a href="#KaiserFilter-1332"><span class="linenos">1332</span></a>      <span class="n">window</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">i0</span><span class="p">(</span><span class="n">beta</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">radius</span><span class="p">))</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">i0</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span>
</span><span id="KaiserFilter-1333"><a href="#KaiserFilter-1333"><span class="linenos">1333</span></a>      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">radius</span> <span class="o">+</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">_sinc</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">window</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="KaiserFilter-1334"><a href="#KaiserFilter-1334"><span class="linenos">1334</span></a>
</span><span id="KaiserFilter-1335"><a href="#KaiserFilter-1335"><span class="linenos">1335</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">_eval</span>
</span><span id="KaiserFilter-1336"><a href="#KaiserFilter-1336"><span class="linenos">1336</span></a>
</span><span id="KaiserFilter-1337"><a href="#KaiserFilter-1337"><span class="linenos">1337</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="KaiserFilter-1338"><a href="#KaiserFilter-1338"><span class="linenos">1338</span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sinc function modulated by a Kaiser-Bessel window.</p>

<p>See <a href="https://en.wikipedia.org/wiki/Kaiser_window">https://en.wikipedia.org/wiki/Kaiser_window</a>, and example use in:
[Karras et al. 20201.  Alias-free generative adversarial networks.
<a href="https://arxiv.org/pdf/2106.12423.pdf]">https://arxiv.org/pdf/2106.12423.pdf]</a>.</p>

<p>Use np.kaiser()?</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>radius:</strong>  Value L/2 in the definition.  It may be fractional for a (digital) resizing filter
(sample spacing s != 1) with an even number of samples (dual grid), e.g., Eq. (6)
in [Karras et al. 2021] --- this effects the precise shape of the window function.</li>
<li><strong>beta:</strong>  Determines the trade-off between main-lobe width and side-lobe level.</li>
<li><strong>sampled:</strong>  If True, use a discretized approximation for improved speed.</li>
</ul>
</div>


                </section>
                <section id="BsplineFilter">
                            <input id="BsplineFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">BsplineFilter</span><wbr>(<span class="base"><a href="#Filter">Filter</a></span>):

                <label class="view-source-button" for="BsplineFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#BsplineFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="BsplineFilter-1341"><a href="#BsplineFilter-1341"><span class="linenos">1341</span></a><span class="k">class</span> <span class="nc">BsplineFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="BsplineFilter-1342"><a href="#BsplineFilter-1342"><span class="linenos">1342</span></a>  <span class="sd">&quot;&quot;&quot;B-spline of a non-negative degree.</span>
</span><span id="BsplineFilter-1343"><a href="#BsplineFilter-1343"><span class="linenos">1343</span></a>
</span><span id="BsplineFilter-1344"><a href="#BsplineFilter-1344"><span class="linenos">1344</span></a><span class="sd">  Args:</span>
</span><span id="BsplineFilter-1345"><a href="#BsplineFilter-1345"><span class="linenos">1345</span></a><span class="sd">    degree: The polynomial degree of the B-spline segments.</span>
</span><span id="BsplineFilter-1346"><a href="#BsplineFilter-1346"><span class="linenos">1346</span></a><span class="sd">      - With `degree=0`, it is like `BoxFilter` except with f(0.5) = f(-0.5) = 0.</span>
</span><span id="BsplineFilter-1347"><a href="#BsplineFilter-1347"><span class="linenos">1347</span></a><span class="sd">      - With `degree=1`, it is identical to `TriangleFilter`.</span>
</span><span id="BsplineFilter-1348"><a href="#BsplineFilter-1348"><span class="linenos">1348</span></a><span class="sd">      - With `degree &gt;= 2`, it is no longer interpolating.</span>
</span><span id="BsplineFilter-1349"><a href="#BsplineFilter-1349"><span class="linenos">1349</span></a>
</span><span id="BsplineFilter-1350"><a href="#BsplineFilter-1350"><span class="linenos">1350</span></a><span class="sd">  See [Carl de Boor.  A practical guide to splines.  Springer, 2001.]</span>
</span><span id="BsplineFilter-1351"><a href="#BsplineFilter-1351"><span class="linenos">1351</span></a><span class="sd">  https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.BSpline.html</span>
</span><span id="BsplineFilter-1352"><a href="#BsplineFilter-1352"><span class="linenos">1352</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="BsplineFilter-1353"><a href="#BsplineFilter-1353"><span class="linenos">1353</span></a>
</span><span id="BsplineFilter-1354"><a href="#BsplineFilter-1354"><span class="linenos">1354</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">degree</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="BsplineFilter-1355"><a href="#BsplineFilter-1355"><span class="linenos">1355</span></a>    <span class="k">if</span> <span class="n">degree</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="BsplineFilter-1356"><a href="#BsplineFilter-1356"><span class="linenos">1356</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Bspline of degree </span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s1"> is invalid.&#39;</span><span class="p">)</span>
</span><span id="BsplineFilter-1357"><a href="#BsplineFilter-1357"><span class="linenos">1357</span></a>    <span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="BsplineFilter-1358"><a href="#BsplineFilter-1358"><span class="linenos">1358</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;bspline</span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">interpolating</span><span class="o">=</span><span class="p">(</span><span class="n">degree</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="BsplineFilter-1359"><a href="#BsplineFilter-1359"><span class="linenos">1359</span></a>    <span class="n">t</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="BsplineFilter-1360"><a href="#BsplineFilter-1360"><span class="linenos">1360</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">bspline</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">BSpline</span><span class="o">.</span><span class="n">basis_element</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="BsplineFilter-1361"><a href="#BsplineFilter-1361"><span class="linenos">1361</span></a>
</span><span id="BsplineFilter-1362"><a href="#BsplineFilter-1362"><span class="linenos">1362</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="BsplineFilter-1363"><a href="#BsplineFilter-1363"><span class="linenos">1363</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="BsplineFilter-1364"><a href="#BsplineFilter-1364"><span class="linenos">1364</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bspline</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>B-spline of a non-negative degree.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>degree:</strong>  The polynomial degree of the B-spline segments.
<ul>
<li>With <code>degree=0</code>, it is like <code><a href="#BoxFilter">BoxFilter</a></code> except with f(0.5) = f(-0.5) = 0.</li>
<li>With <code>degree=1</code>, it is identical to <code><a href="#TriangleFilter">TriangleFilter</a></code>.</li>
<li>With <code>degree &gt;= 2</code>, it is no longer interpolating.</li>
</ul></li>
</ul>

<p>See [Carl de Boor.  A practical guide to splines.  Springer, 2001.]
<a href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.BSpline.html">https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.BSpline.html</a></p>
</div>


                </section>
                <section id="CardinalBsplineFilter">
                            <input id="CardinalBsplineFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">CardinalBsplineFilter</span><wbr>(<span class="base"><a href="#Filter">Filter</a></span>):

                <label class="view-source-button" for="CardinalBsplineFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#CardinalBsplineFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="CardinalBsplineFilter-1367"><a href="#CardinalBsplineFilter-1367"><span class="linenos">1367</span></a><span class="k">class</span> <span class="nc">CardinalBsplineFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="CardinalBsplineFilter-1368"><a href="#CardinalBsplineFilter-1368"><span class="linenos">1368</span></a>  <span class="sd">&quot;&quot;&quot;Interpolating B-spline, achieved with aid of digital pre or post filter.</span>
</span><span id="CardinalBsplineFilter-1369"><a href="#CardinalBsplineFilter-1369"><span class="linenos">1369</span></a>
</span><span id="CardinalBsplineFilter-1370"><a href="#CardinalBsplineFilter-1370"><span class="linenos">1370</span></a><span class="sd">  Args:</span>
</span><span id="CardinalBsplineFilter-1371"><a href="#CardinalBsplineFilter-1371"><span class="linenos">1371</span></a><span class="sd">    degree: The polynomial degree of the B-spline segments.</span>
</span><span id="CardinalBsplineFilter-1372"><a href="#CardinalBsplineFilter-1372"><span class="linenos">1372</span></a><span class="sd">    sampled: If True, use a discretized approximation for improved speed.</span>
</span><span id="CardinalBsplineFilter-1373"><a href="#CardinalBsplineFilter-1373"><span class="linenos">1373</span></a>
</span><span id="CardinalBsplineFilter-1374"><a href="#CardinalBsplineFilter-1374"><span class="linenos">1374</span></a><span class="sd">  See [Hou and Andrews.  Cubic splines for image interpolation and digital filtering, 1978] and</span>
</span><span id="CardinalBsplineFilter-1375"><a href="#CardinalBsplineFilter-1375"><span class="linenos">1375</span></a><span class="sd">  [Unser et al.  Fast B-spline transforms for continuous image representation and interpolation,</span>
</span><span id="CardinalBsplineFilter-1376"><a href="#CardinalBsplineFilter-1376"><span class="linenos">1376</span></a><span class="sd">  1991].</span>
</span><span id="CardinalBsplineFilter-1377"><a href="#CardinalBsplineFilter-1377"><span class="linenos">1377</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="CardinalBsplineFilter-1378"><a href="#CardinalBsplineFilter-1378"><span class="linenos">1378</span></a>
</span><span id="CardinalBsplineFilter-1379"><a href="#CardinalBsplineFilter-1379"><span class="linenos">1379</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">degree</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">sampled</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="CardinalBsplineFilter-1380"><a href="#CardinalBsplineFilter-1380"><span class="linenos">1380</span></a>    <span class="k">if</span> <span class="n">degree</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="CardinalBsplineFilter-1381"><a href="#CardinalBsplineFilter-1381"><span class="linenos">1381</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Bspline of degree </span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s1"> is invalid.&#39;</span><span class="p">)</span>
</span><span id="CardinalBsplineFilter-1382"><a href="#CardinalBsplineFilter-1382"><span class="linenos">1382</span></a>    <span class="n">radius</span> <span class="o">=</span> <span class="p">(</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span><span id="CardinalBsplineFilter-1383"><a href="#CardinalBsplineFilter-1383"><span class="linenos">1383</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;cardinal</span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">requires_digital_filter</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="CardinalBsplineFilter-1384"><a href="#CardinalBsplineFilter-1384"><span class="linenos">1384</span></a>    <span class="n">t</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="CardinalBsplineFilter-1385"><a href="#CardinalBsplineFilter-1385"><span class="linenos">1385</span></a>    <span class="n">bspline</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">BSpline</span><span class="o">.</span><span class="n">basis_element</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
</span><span id="CardinalBsplineFilter-1386"><a href="#CardinalBsplineFilter-1386"><span class="linenos">1386</span></a>
</span><span id="CardinalBsplineFilter-1387"><a href="#CardinalBsplineFilter-1387"><span class="linenos">1387</span></a>    <span class="nd">@_cache_sampled_1d_function</span><span class="p">(</span><span class="n">xmin</span><span class="o">=-</span><span class="n">radius</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">enable</span><span class="o">=</span><span class="n">sampled</span><span class="p">)</span>
</span><span id="CardinalBsplineFilter-1388"><a href="#CardinalBsplineFilter-1388"><span class="linenos">1388</span></a>    <span class="k">def</span> <span class="nf">_eval</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="CardinalBsplineFilter-1389"><a href="#CardinalBsplineFilter-1389"><span class="linenos">1389</span></a>      <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="CardinalBsplineFilter-1390"><a href="#CardinalBsplineFilter-1390"><span class="linenos">1390</span></a>      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">radius</span><span class="p">,</span> <span class="n">bspline</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">radius</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">)</span>
</span><span id="CardinalBsplineFilter-1391"><a href="#CardinalBsplineFilter-1391"><span class="linenos">1391</span></a>
</span><span id="CardinalBsplineFilter-1392"><a href="#CardinalBsplineFilter-1392"><span class="linenos">1392</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">_eval</span>
</span><span id="CardinalBsplineFilter-1393"><a href="#CardinalBsplineFilter-1393"><span class="linenos">1393</span></a>
</span><span id="CardinalBsplineFilter-1394"><a href="#CardinalBsplineFilter-1394"><span class="linenos">1394</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="CardinalBsplineFilter-1395"><a href="#CardinalBsplineFilter-1395"><span class="linenos">1395</span></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Interpolating B-spline, achieved with aid of digital pre or post filter.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>degree:</strong>  The polynomial degree of the B-spline segments.</li>
<li><strong>sampled:</strong>  If True, use a discretized approximation for improved speed.</li>
</ul>

<p>See [Hou and Andrews.  Cubic splines for image interpolation and digital filtering, 1978] and
[Unser et al.  Fast B-spline transforms for continuous image representation and interpolation,
1991].</p>
</div>


                </section>
                <section id="OmomsFilter">
                            <input id="OmomsFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">OmomsFilter</span><wbr>(<span class="base"><a href="#Filter">Filter</a></span>):

                <label class="view-source-button" for="OmomsFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#OmomsFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="OmomsFilter-1398"><a href="#OmomsFilter-1398"><span class="linenos">1398</span></a><span class="k">class</span> <span class="nc">OmomsFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="OmomsFilter-1399"><a href="#OmomsFilter-1399"><span class="linenos">1399</span></a>  <span class="sd">&quot;&quot;&quot;OMOMS interpolating filter, with aid of digital pre or post filter.</span>
</span><span id="OmomsFilter-1400"><a href="#OmomsFilter-1400"><span class="linenos">1400</span></a>
</span><span id="OmomsFilter-1401"><a href="#OmomsFilter-1401"><span class="linenos">1401</span></a><span class="sd">  Args:</span>
</span><span id="OmomsFilter-1402"><a href="#OmomsFilter-1402"><span class="linenos">1402</span></a><span class="sd">    degree: The polynomial degree of the filter segments.</span>
</span><span id="OmomsFilter-1403"><a href="#OmomsFilter-1403"><span class="linenos">1403</span></a>
</span><span id="OmomsFilter-1404"><a href="#OmomsFilter-1404"><span class="linenos">1404</span></a><span class="sd">  Optimal MOMS (maximal-order-minimal-support) function; see [Blu and Thevenaz, MOMS: Maximal-order</span>
</span><span id="OmomsFilter-1405"><a href="#OmomsFilter-1405"><span class="linenos">1405</span></a><span class="sd">  interpolation of minimal support, 2001].</span>
</span><span id="OmomsFilter-1406"><a href="#OmomsFilter-1406"><span class="linenos">1406</span></a><span class="sd">  https://infoscience.epfl.ch/record/63074/files/blu0101.pdf</span>
</span><span id="OmomsFilter-1407"><a href="#OmomsFilter-1407"><span class="linenos">1407</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="OmomsFilter-1408"><a href="#OmomsFilter-1408"><span class="linenos">1408</span></a>
</span><span id="OmomsFilter-1409"><a href="#OmomsFilter-1409"><span class="linenos">1409</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">degree</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="OmomsFilter-1410"><a href="#OmomsFilter-1410"><span class="linenos">1410</span></a>    <span class="k">if</span> <span class="n">degree</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">):</span>
</span><span id="OmomsFilter-1411"><a href="#OmomsFilter-1411"><span class="linenos">1411</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Degree </span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s1"> not supported.&#39;</span><span class="p">)</span>
</span><span id="OmomsFilter-1412"><a href="#OmomsFilter-1412"><span class="linenos">1412</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;omoms</span><span class="si">{</span><span class="n">degree</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="p">(</span><span class="n">degree</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">requires_digital_filter</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="OmomsFilter-1413"><a href="#OmomsFilter-1413"><span class="linenos">1413</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">=</span> <span class="n">degree</span>
</span><span id="OmomsFilter-1414"><a href="#OmomsFilter-1414"><span class="linenos">1414</span></a>
</span><span id="OmomsFilter-1415"><a href="#OmomsFilter-1415"><span class="linenos">1415</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="OmomsFilter-1416"><a href="#OmomsFilter-1416"><span class="linenos">1416</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="OmomsFilter-1417"><a href="#OmomsFilter-1417"><span class="linenos">1417</span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="OmomsFilter-1418"><a href="#OmomsFilter-1418"><span class="linenos">1418</span></a>      <span class="n">v01</span> <span class="o">=</span> <span class="p">((</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">3</span><span class="o">/</span><span class="mi">42</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">26</span><span class="o">/</span><span class="mi">42</span>
</span><span id="OmomsFilter-1419"><a href="#OmomsFilter-1419"><span class="linenos">1419</span></a>      <span class="n">v12</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="mi">7</span><span class="o">/</span><span class="mi">42</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">85</span><span class="o">/</span><span class="mi">42</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">58</span><span class="o">/</span><span class="mi">42</span>
</span><span id="OmomsFilter-1420"><a href="#OmomsFilter-1420"><span class="linenos">1420</span></a>      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">v01</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">v12</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>
</span><span id="OmomsFilter-1421"><a href="#OmomsFilter-1421"><span class="linenos">1421</span></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">degree</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
</span><span id="OmomsFilter-1422"><a href="#OmomsFilter-1422"><span class="linenos">1422</span></a>      <span class="n">v01</span> <span class="o">=</span> <span class="p">((((</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">12</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">5</span><span class="o">/</span><span class="mi">99</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">9</span><span class="o">/</span><span class="mi">22</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">1</span><span class="o">/</span><span class="mi">792</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">229</span><span class="o">/</span><span class="mi">440</span>
</span><span id="OmomsFilter-1423"><a href="#OmomsFilter-1423"><span class="linenos">1423</span></a>      <span class="n">v12</span> <span class="o">=</span> <span class="p">((((</span><span class="mi">1</span><span class="o">/</span><span class="mi">24</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">3</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">505</span><span class="o">/</span><span class="mi">396</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">83</span><span class="o">/</span><span class="mi">44</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1351</span><span class="o">/</span><span class="mi">1584</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">839</span><span class="o">/</span><span class="mi">2640</span>
</span><span id="OmomsFilter-1424"><a href="#OmomsFilter-1424"><span class="linenos">1424</span></a>      <span class="n">v23</span> <span class="o">=</span> <span class="p">((((</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="mi">120</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">299</span><span class="o">/</span><span class="mi">396</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">101</span><span class="o">/</span><span class="mi">44</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">27811</span><span class="o">/</span><span class="mi">7920</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">5707</span><span class="o">/</span><span class="mi">2640</span>
</span><span id="OmomsFilter-1425"><a href="#OmomsFilter-1425"><span class="linenos">1425</span></a>      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">v01</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">v12</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">v23</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)))</span>
</span><span id="OmomsFilter-1426"><a href="#OmomsFilter-1426"><span class="linenos">1426</span></a>    <span class="k">raise</span> <span class="ne">AssertionError</span>
</span></pre></div>


            <div class="docstring"><p>OMOMS interpolating filter, with aid of digital pre or post filter.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>degree:</strong>  The polynomial degree of the filter segments.</li>
</ul>

<p>Optimal MOMS (maximal-order-minimal-support) function; see [Blu and Thevenaz, MOMS: Maximal-order
interpolation of minimal support, 2001].
<a href="https://infoscience.epfl.ch/record/63074/files/blu0101.pdf">https://infoscience.epfl.ch/record/63074/files/blu0101.pdf</a></p>
</div>


                </section>
                <section id="GaussianFilter">
                            <input id="GaussianFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">GaussianFilter</span><wbr>(<span class="base"><a href="#Filter">Filter</a></span>):

                <label class="view-source-button" for="GaussianFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#GaussianFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="GaussianFilter-1429"><a href="#GaussianFilter-1429"><span class="linenos">1429</span></a><span class="k">class</span> <span class="nc">GaussianFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="GaussianFilter-1430"><a href="#GaussianFilter-1430"><span class="linenos">1430</span></a>  <span class="sd">&quot;&quot;&quot;See https://en.wikipedia.org/wiki/Gaussian_function.</span>
</span><span id="GaussianFilter-1431"><a href="#GaussianFilter-1431"><span class="linenos">1431</span></a>
</span><span id="GaussianFilter-1432"><a href="#GaussianFilter-1432"><span class="linenos">1432</span></a><span class="sd">  Args:</span>
</span><span id="GaussianFilter-1433"><a href="#GaussianFilter-1433"><span class="linenos">1433</span></a><span class="sd">    standard_deviation: Sets the Gaussian $\sigma$.  The default value is 1.25/3.0, which</span>
</span><span id="GaussianFilter-1434"><a href="#GaussianFilter-1434"><span class="linenos">1434</span></a><span class="sd">      creates a kernel that is as-close-as-possible to a partition of unity.</span>
</span><span id="GaussianFilter-1435"><a href="#GaussianFilter-1435"><span class="linenos">1435</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="GaussianFilter-1436"><a href="#GaussianFilter-1436"><span class="linenos">1436</span></a>
</span><span id="GaussianFilter-1437"><a href="#GaussianFilter-1437"><span class="linenos">1437</span></a>  <span class="n">DEFAULT_STANDARD_DEVIATION</span> <span class="o">=</span> <span class="mf">1.25</span> <span class="o">/</span> <span class="mf">3.0</span>
</span><span id="GaussianFilter-1438"><a href="#GaussianFilter-1438"><span class="linenos">1438</span></a>  <span class="sd">&quot;&quot;&quot;This value creates a kernel that is as-close-as-possible to a partition of unity; see</span>
</span><span id="GaussianFilter-1439"><a href="#GaussianFilter-1439"><span class="linenos">1439</span></a><span class="sd">  mesh_processing/test/GridOp_test.cpp: `0.93503:1.06497     av=1           sd=0.0459424`.</span>
</span><span id="GaussianFilter-1440"><a href="#GaussianFilter-1440"><span class="linenos">1440</span></a><span class="sd">  Another possibility is 0.5, as suggested on p. 4 of [Ken Turkowski.  Filters for common</span>
</span><span id="GaussianFilter-1441"><a href="#GaussianFilter-1441"><span class="linenos">1441</span></a><span class="sd">  resampling tasks, 1990] for kernels with a support of 3 pixels.</span>
</span><span id="GaussianFilter-1442"><a href="#GaussianFilter-1442"><span class="linenos">1442</span></a><span class="sd">  https://cadxfem.org/inf/ResamplingFilters.pdf</span>
</span><span id="GaussianFilter-1443"><a href="#GaussianFilter-1443"><span class="linenos">1443</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="GaussianFilter-1444"><a href="#GaussianFilter-1444"><span class="linenos">1444</span></a>
</span><span id="GaussianFilter-1445"><a href="#GaussianFilter-1445"><span class="linenos">1445</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">standard_deviation</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">DEFAULT_STANDARD_DEVIATION</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="GaussianFilter-1446"><a href="#GaussianFilter-1446"><span class="linenos">1446</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;gaussian_</span><span class="si">{</span><span class="n">standard_deviation</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="GaussianFilter-1447"><a href="#GaussianFilter-1447"><span class="linenos">1447</span></a>                     <span class="n">radius</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mf">8.0</span> <span class="o">*</span> <span class="n">standard_deviation</span><span class="p">),</span>  <span class="c1"># Sufficiently large.</span>
</span><span id="GaussianFilter-1448"><a href="#GaussianFilter-1448"><span class="linenos">1448</span></a>                     <span class="n">interpolating</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="GaussianFilter-1449"><a href="#GaussianFilter-1449"><span class="linenos">1449</span></a>                     <span class="n">partition_of_unity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="GaussianFilter-1450"><a href="#GaussianFilter-1450"><span class="linenos">1450</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">standard_deviation</span> <span class="o">=</span> <span class="n">standard_deviation</span>
</span><span id="GaussianFilter-1451"><a href="#GaussianFilter-1451"><span class="linenos">1451</span></a>
</span><span id="GaussianFilter-1452"><a href="#GaussianFilter-1452"><span class="linenos">1452</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="GaussianFilter-1453"><a href="#GaussianFilter-1453"><span class="linenos">1453</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span id="GaussianFilter-1454"><a href="#GaussianFilter-1454"><span class="linenos">1454</span></a>    <span class="n">sdv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">standard_deviation</span>
</span><span id="GaussianFilter-1455"><a href="#GaussianFilter-1455"><span class="linenos">1455</span></a>    <span class="n">v0r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">sdv</span><span class="p">)</span> <span class="o">/</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">tau</span><span class="p">)</span> <span class="o">*</span> <span class="n">sdv</span><span class="p">)</span>
</span><span id="GaussianFilter-1456"><a href="#GaussianFilter-1456"><span class="linenos">1456</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">v0r</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>See <a href="https://en.wikipedia.org/wiki/Gaussian_function">https://en.wikipedia.org/wiki/Gaussian_function</a>.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>standard_deviation:</strong>  Sets the Gaussian $\sigma$.  The default value is 1.25/3.0, which
creates a kernel that is as-close-as-possible to a partition of unity.</li>
</ul>
</div>


                </section>
                <section id="NarrowBoxFilter">
                            <input id="NarrowBoxFilter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">NarrowBoxFilter</span><wbr>(<span class="base"><a href="#Filter">Filter</a></span>):

                <label class="view-source-button" for="NarrowBoxFilter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#NarrowBoxFilter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="NarrowBoxFilter-1459"><a href="#NarrowBoxFilter-1459"><span class="linenos">1459</span></a><span class="k">class</span> <span class="nc">NarrowBoxFilter</span><span class="p">(</span><span class="n">Filter</span><span class="p">):</span>
</span><span id="NarrowBoxFilter-1460"><a href="#NarrowBoxFilter-1460"><span class="linenos">1460</span></a>  <span class="sd">&quot;&quot;&quot;Compact footprint, used for visualization of grid sample location.</span>
</span><span id="NarrowBoxFilter-1461"><a href="#NarrowBoxFilter-1461"><span class="linenos">1461</span></a>
</span><span id="NarrowBoxFilter-1462"><a href="#NarrowBoxFilter-1462"><span class="linenos">1462</span></a><span class="sd">  Args:</span>
</span><span id="NarrowBoxFilter-1463"><a href="#NarrowBoxFilter-1463"><span class="linenos">1463</span></a><span class="sd">    radius: Support [-radius, radius] of the narrow box function, with default value 0.199.</span>
</span><span id="NarrowBoxFilter-1464"><a href="#NarrowBoxFilter-1464"><span class="linenos">1464</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="NarrowBoxFilter-1465"><a href="#NarrowBoxFilter-1465"><span class="linenos">1465</span></a>
</span><span id="NarrowBoxFilter-1466"><a href="#NarrowBoxFilter-1466"><span class="linenos">1466</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.199</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="NarrowBoxFilter-1467"><a href="#NarrowBoxFilter-1467"><span class="linenos">1467</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;narrowbox&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">continuous</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">unit_integral</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="NarrowBoxFilter-1468"><a href="#NarrowBoxFilter-1468"><span class="linenos">1468</span></a>                     <span class="n">partition_of_unity</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="NarrowBoxFilter-1469"><a href="#NarrowBoxFilter-1469"><span class="linenos">1469</span></a>
</span><span id="NarrowBoxFilter-1470"><a href="#NarrowBoxFilter-1470"><span class="linenos">1470</span></a>  <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="NarrowBoxFilter-1471"><a href="#NarrowBoxFilter-1471"><span class="linenos">1471</span></a>    <span class="n">radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span>
</span><span id="NarrowBoxFilter-1472"><a href="#NarrowBoxFilter-1472"><span class="linenos">1472</span></a>    <span class="n">magnitude</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="NarrowBoxFilter-1473"><a href="#NarrowBoxFilter-1473"><span class="linenos">1473</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="o">-</span><span class="n">radius</span> <span class="o">&lt;=</span> <span class="n">x</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">radius</span><span class="p">),</span> <span class="n">magnitude</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compact footprint, used for visualization of grid sample location.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>radius:</strong>  Support [-radius, radius] of the narrow box function, with default value 0.199.</li>
</ul>
</div>


                </section>
                <section id="FILTERS">
                    <div class="attr variable">
            <span class="name">FILTERS</span><span class="annotation">: Dict[str, <a href="#Filter">resampler.Filter</a>]</span><span class="default_value"> = {&#39;impulse&#39;: ImpulseFilter(name=&#39;impulse&#39;, radius=1e-20, interpolating=True, continuous=False, partition_of_unity=False, unit_integral=True, requires_digital_filter=False), &#39;box&#39;: BoxFilter(name=&#39;box&#39;, radius=0.5, interpolating=True, continuous=False, partition_of_unity=True, unit_integral=True, requires_digital_filter=False), &#39;trapezoid&#39;: TrapezoidFilter(name=&#39;trapezoid&#39;, radius=0.0, interpolating=True, continuous=True, partition_of_unity=True, unit_integral=True, requires_digital_filter=False), &#39;triangle&#39;: TriangleFilter(name=&#39;triangle&#39;, radius=1.0, interpolating=True, continuous=True, partition_of_unity=True, unit_integral=True, requires_digital_filter=False), &#39;cubic&#39;: CatmullRomFilter(name=&#39;cubic&#39;, radius=2.0, interpolating=True, continuous=True, partition_of_unity=True, unit_integral=True, requires_digital_filter=False), &#39;sharpcubic&#39;: SharpCubicFilter(name=&#39;sharpcubic&#39;, radius=2.0, interpolating=True, continuous=True, partition_of_unity=True, unit_integral=True, requires_digital_filter=False), &#39;lanczos3&#39;: LanczosFilter(name=&#39;lanczos_3&#39;, radius=3, interpolating=True, continuous=True, partition_of_unity=False, unit_integral=False, requires_digital_filter=False), &#39;lanczos5&#39;: LanczosFilter(name=&#39;lanczos_5&#39;, radius=5, interpolating=True, continuous=True, partition_of_unity=False, unit_integral=False, requires_digital_filter=False), &#39;lanczos10&#39;: LanczosFilter(name=&#39;lanczos_10&#39;, radius=10, interpolating=True, continuous=True, partition_of_unity=False, unit_integral=False, requires_digital_filter=False), &#39;cardinal3&#39;: CardinalBsplineFilter(name=&#39;cardinal3&#39;, radius=2.0, interpolating=True, continuous=True, partition_of_unity=True, unit_integral=True, requires_digital_filter=True), &#39;cardinal5&#39;: CardinalBsplineFilter(name=&#39;cardinal5&#39;, radius=3.0, interpolating=True, continuous=True, partition_of_unity=True, unit_integral=True, requires_digital_filter=True), &#39;omoms3&#39;: OmomsFilter(name=&#39;omoms3&#39;, radius=2.0, interpolating=True, continuous=True, partition_of_unity=True, unit_integral=True, requires_digital_filter=True), &#39;omoms5&#39;: OmomsFilter(name=&#39;omoms5&#39;, radius=3.0, interpolating=True, continuous=True, partition_of_unity=True, unit_integral=True, requires_digital_filter=True), &#39;hamming3&#39;: GeneralizedHammingFilter(name=&#39;hamming_3&#39;, radius=3, interpolating=True, continuous=True, partition_of_unity=False, unit_integral=False, requires_digital_filter=False), &#39;kaiser3&#39;: KaiserFilter(name=&#39;kaiser_3.0_7.12&#39;, radius=3.0, interpolating=True, continuous=True, partition_of_unity=False, unit_integral=False, requires_digital_filter=False), &#39;gaussian&#39;: GaussianFilter(name=&#39;gaussian_0.417&#39;, radius=4.0, interpolating=False, continuous=True, partition_of_unity=False, unit_integral=True, requires_digital_filter=False), &#39;bspline3&#39;: BsplineFilter(name=&#39;bspline3&#39;, radius=2.0, interpolating=False, continuous=True, partition_of_unity=True, unit_integral=True, requires_digital_filter=False), &#39;mitchell&#39;: MitchellFilter(name=&#39;mitchell&#39;, radius=2.0, interpolating=False, continuous=True, partition_of_unity=True, unit_integral=True, requires_digital_filter=False), &#39;narrowbox&#39;: NarrowBoxFilter(name=&#39;narrowbox&#39;, radius=0.199, interpolating=True, continuous=False, partition_of_unity=False, unit_integral=False, requires_digital_filter=False)}</span>

        
    </div>
    <a class="headerlink" href="#FILTERS"></a>
    
            <div class="docstring"><p>Shortcut names for some predefined filter kernels.  These include 'impulse', 'box', 'trapezoid',
'triangle', 'cubic', 'lanczos3', 'lanczos5', etc.</p>
</div>


                </section>
                <section id="Gamma">
                            <input id="Gamma-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
                    <div class="decorator">@dataclasses.dataclass</div>

    <span class="def">class</span>
    <span class="name">Gamma</span>:

                <label class="view-source-button" for="Gamma-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Gamma"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Gamma-1536"><a href="#Gamma-1536"><span class="linenos">1536</span></a><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
</span><span id="Gamma-1537"><a href="#Gamma-1537"><span class="linenos">1537</span></a><span class="k">class</span> <span class="nc">Gamma</span><span class="p">:</span>
</span><span id="Gamma-1538"><a href="#Gamma-1538"><span class="linenos">1538</span></a>  <span class="sd">&quot;&quot;&quot;Abstract base class for transfer functions on sample values.</span>
</span><span id="Gamma-1539"><a href="#Gamma-1539"><span class="linenos">1539</span></a>
</span><span id="Gamma-1540"><a href="#Gamma-1540"><span class="linenos">1540</span></a><span class="sd">  Image/video content is often stored using a color component transfer function.</span>
</span><span id="Gamma-1541"><a href="#Gamma-1541"><span class="linenos">1541</span></a><span class="sd">  See https://en.wikipedia.org/wiki/Gamma_correction.</span>
</span><span id="Gamma-1542"><a href="#Gamma-1542"><span class="linenos">1542</span></a>
</span><span id="Gamma-1543"><a href="#Gamma-1543"><span class="linenos">1543</span></a><span class="sd">  Converts between integer types and [0.0, 1.0] internal value range.</span>
</span><span id="Gamma-1544"><a href="#Gamma-1544"><span class="linenos">1544</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="Gamma-1545"><a href="#Gamma-1545"><span class="linenos">1545</span></a>
</span><span id="Gamma-1546"><a href="#Gamma-1546"><span class="linenos">1546</span></a>  <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
</span><span id="Gamma-1547"><a href="#Gamma-1547"><span class="linenos">1547</span></a>  <span class="sd">&quot;&quot;&quot;Name of component transfer function.&quot;&quot;&quot;</span>
</span><span id="Gamma-1548"><a href="#Gamma-1548"><span class="linenos">1548</span></a>
</span><span id="Gamma-1549"><a href="#Gamma-1549"><span class="linenos">1549</span></a>  <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="Gamma-1550"><a href="#Gamma-1550"><span class="linenos">1550</span></a>    <span class="sd">&quot;&quot;&quot;Decode source sample values into floating-point, possibly nonlinearly.</span>
</span><span id="Gamma-1551"><a href="#Gamma-1551"><span class="linenos">1551</span></a>
</span><span id="Gamma-1552"><a href="#Gamma-1552"><span class="linenos">1552</span></a><span class="sd">    Uint source values are mapped to the range [0.0, 1.0].</span>
</span><span id="Gamma-1553"><a href="#Gamma-1553"><span class="linenos">1553</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="Gamma-1554"><a href="#Gamma-1554"><span class="linenos">1554</span></a>
</span><span id="Gamma-1555"><a href="#Gamma-1555"><span class="linenos">1555</span></a>  <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="Gamma-1556"><a href="#Gamma-1556"><span class="linenos">1556</span></a>    <span class="sd">&quot;&quot;&quot;Encode float signal into destination samples, possibly nonlinearly.</span>
</span><span id="Gamma-1557"><a href="#Gamma-1557"><span class="linenos">1557</span></a>
</span><span id="Gamma-1558"><a href="#Gamma-1558"><span class="linenos">1558</span></a><span class="sd">    Uint destination values are mapped from the range [0.0, 1.0].</span>
</span><span id="Gamma-1559"><a href="#Gamma-1559"><span class="linenos">1559</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Abstract base class for transfer functions on sample values.</p>

<p>Image/video content is often stored using a color component transfer function.
See <a href="https://en.wikipedia.org/wiki/Gamma_correction">https://en.wikipedia.org/wiki/Gamma_correction</a>.</p>

<p>Converts between integer types and [0.0, 1.0] internal value range.</p>
</div>


                </section>
                <section id="IdentityGamma">
                            <input id="IdentityGamma-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">IdentityGamma</span><wbr>(<span class="base"><a href="#Gamma">Gamma</a></span>):

                <label class="view-source-button" for="IdentityGamma-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#IdentityGamma"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="IdentityGamma-1562"><a href="#IdentityGamma-1562"><span class="linenos">1562</span></a><span class="k">class</span> <span class="nc">IdentityGamma</span><span class="p">(</span><span class="n">Gamma</span><span class="p">):</span>
</span><span id="IdentityGamma-1563"><a href="#IdentityGamma-1563"><span class="linenos">1563</span></a>  <span class="sd">&quot;&quot;&quot;Identity component transfer function.&quot;&quot;&quot;</span>
</span><span id="IdentityGamma-1564"><a href="#IdentityGamma-1564"><span class="linenos">1564</span></a>
</span><span id="IdentityGamma-1565"><a href="#IdentityGamma-1565"><span class="linenos">1565</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="IdentityGamma-1566"><a href="#IdentityGamma-1566"><span class="linenos">1566</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;identity&#39;</span><span class="p">)</span>
</span><span id="IdentityGamma-1567"><a href="#IdentityGamma-1567"><span class="linenos">1567</span></a>
</span><span id="IdentityGamma-1568"><a href="#IdentityGamma-1568"><span class="linenos">1568</span></a>  <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="IdentityGamma-1569"><a href="#IdentityGamma-1569"><span class="linenos">1569</span></a>    <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="IdentityGamma-1570"><a href="#IdentityGamma-1570"><span class="linenos">1570</span></a>    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inexact</span><span class="p">)</span>
</span><span id="IdentityGamma-1571"><a href="#IdentityGamma-1571"><span class="linenos">1571</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">unsignedinteger</span><span class="p">):</span>
</span><span id="IdentityGamma-1572"><a href="#IdentityGamma-1572"><span class="linenos">1572</span></a>      <span class="k">return</span> <span class="n">_to_float_01</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="IdentityGamma-1573"><a href="#IdentityGamma-1573"><span class="linenos">1573</span></a>    <span class="k">return</span> <span class="n">_arr_astype</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="IdentityGamma-1574"><a href="#IdentityGamma-1574"><span class="linenos">1574</span></a>
</span><span id="IdentityGamma-1575"><a href="#IdentityGamma-1575"><span class="linenos">1575</span></a>  <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="IdentityGamma-1576"><a href="#IdentityGamma-1576"><span class="linenos">1576</span></a>    <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="IdentityGamma-1577"><a href="#IdentityGamma-1577"><span class="linenos">1577</span></a>    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">)</span>
</span><span id="IdentityGamma-1578"><a href="#IdentityGamma-1578"><span class="linenos">1578</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">unsignedinteger</span><span class="p">):</span>
</span><span id="IdentityGamma-1579"><a href="#IdentityGamma-1579"><span class="linenos">1579</span></a>      <span class="k">return</span> <span class="n">_from_float</span><span class="p">(</span><span class="n">_arr_clip</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">),</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="IdentityGamma-1580"><a href="#IdentityGamma-1580"><span class="linenos">1580</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
</span><span id="IdentityGamma-1581"><a href="#IdentityGamma-1581"><span class="linenos">1581</span></a>      <span class="k">return</span> <span class="n">_arr_astype</span><span class="p">(</span><span class="n">array</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="IdentityGamma-1582"><a href="#IdentityGamma-1582"><span class="linenos">1582</span></a>    <span class="k">return</span> <span class="n">_arr_astype</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Identity component transfer function.</p>
</div>


                </section>
                <section id="PowerGamma">
                            <input id="PowerGamma-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">PowerGamma</span><wbr>(<span class="base"><a href="#Gamma">Gamma</a></span>):

                <label class="view-source-button" for="PowerGamma-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#PowerGamma"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="PowerGamma-1585"><a href="#PowerGamma-1585"><span class="linenos">1585</span></a><span class="k">class</span> <span class="nc">PowerGamma</span><span class="p">(</span><span class="n">Gamma</span><span class="p">):</span>
</span><span id="PowerGamma-1586"><a href="#PowerGamma-1586"><span class="linenos">1586</span></a>  <span class="sd">&quot;&quot;&quot;Gamma correction using a power function.&quot;&quot;&quot;</span>
</span><span id="PowerGamma-1587"><a href="#PowerGamma-1587"><span class="linenos">1587</span></a>
</span><span id="PowerGamma-1588"><a href="#PowerGamma-1588"><span class="linenos">1588</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">power</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="PowerGamma-1589"><a href="#PowerGamma-1589"><span class="linenos">1589</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;power_</span><span class="si">{</span><span class="n">power</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="PowerGamma-1590"><a href="#PowerGamma-1590"><span class="linenos">1590</span></a>    <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">=</span> <span class="n">power</span>
</span><span id="PowerGamma-1591"><a href="#PowerGamma-1591"><span class="linenos">1591</span></a>
</span><span id="PowerGamma-1592"><a href="#PowerGamma-1592"><span class="linenos">1592</span></a>  <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="PowerGamma-1593"><a href="#PowerGamma-1593"><span class="linenos">1593</span></a>    <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="PowerGamma-1594"><a href="#PowerGamma-1594"><span class="linenos">1594</span></a>    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)</span>
</span><span id="PowerGamma-1595"><a href="#PowerGamma-1595"><span class="linenos">1595</span></a>    <span class="k">if</span> <span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="PowerGamma-1596"><a href="#PowerGamma-1596"><span class="linenos">1596</span></a>      <span class="n">decode_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="PowerGamma-1597"><a href="#PowerGamma-1597"><span class="linenos">1597</span></a>      <span class="k">return</span> <span class="n">_arr_gather</span><span class="p">(</span><span class="n">decode_table</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
</span><span id="PowerGamma-1598"><a href="#PowerGamma-1598"><span class="linenos">1598</span></a>
</span><span id="PowerGamma-1599"><a href="#PowerGamma-1599"><span class="linenos">1599</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">_to_float_01</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="PowerGamma-1600"><a href="#PowerGamma-1600"><span class="linenos">1600</span></a>    <span class="k">return</span> <span class="n">_arr_square</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">array</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">power</span>
</span><span id="PowerGamma-1601"><a href="#PowerGamma-1601"><span class="linenos">1601</span></a>
</span><span id="PowerGamma-1602"><a href="#PowerGamma-1602"><span class="linenos">1602</span></a>  <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="PowerGamma-1603"><a href="#PowerGamma-1603"><span class="linenos">1603</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">_arr_clip</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="PowerGamma-1604"><a href="#PowerGamma-1604"><span class="linenos">1604</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">_arr_sqrt</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span> <span class="o">==</span> <span class="mi">2</span> <span class="k">else</span> <span class="n">array</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">power</span><span class="p">)</span>
</span><span id="PowerGamma-1605"><a href="#PowerGamma-1605"><span class="linenos">1605</span></a>    <span class="k">return</span> <span class="n">_from_float</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Gamma correction using a power function.</p>
</div>


                </section>
                <section id="SrgbGamma">
                            <input id="SrgbGamma-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">SrgbGamma</span><wbr>(<span class="base"><a href="#Gamma">Gamma</a></span>):

                <label class="view-source-button" for="SrgbGamma-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#SrgbGamma"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="SrgbGamma-1608"><a href="#SrgbGamma-1608"><span class="linenos">1608</span></a><span class="k">class</span> <span class="nc">SrgbGamma</span><span class="p">(</span><span class="n">Gamma</span><span class="p">):</span>
</span><span id="SrgbGamma-1609"><a href="#SrgbGamma-1609"><span class="linenos">1609</span></a>  <span class="sd">&quot;&quot;&quot;Gamma correction using sRGB; see https://en.wikipedia.org/wiki/SRGB.&quot;&quot;&quot;</span>
</span><span id="SrgbGamma-1610"><a href="#SrgbGamma-1610"><span class="linenos">1610</span></a>
</span><span id="SrgbGamma-1611"><a href="#SrgbGamma-1611"><span class="linenos">1611</span></a>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="SrgbGamma-1612"><a href="#SrgbGamma-1612"><span class="linenos">1612</span></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;srgb&#39;</span><span class="p">)</span>
</span><span id="SrgbGamma-1613"><a href="#SrgbGamma-1613"><span class="linenos">1613</span></a>
</span><span id="SrgbGamma-1614"><a href="#SrgbGamma-1614"><span class="linenos">1614</span></a>  <span class="k">def</span> <span class="nf">decode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="SrgbGamma-1615"><a href="#SrgbGamma-1615"><span class="linenos">1615</span></a>    <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="SrgbGamma-1616"><a href="#SrgbGamma-1616"><span class="linenos">1616</span></a>    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)</span>
</span><span id="SrgbGamma-1617"><a href="#SrgbGamma-1617"><span class="linenos">1617</span></a>    <span class="k">if</span> <span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
</span><span id="SrgbGamma-1618"><a href="#SrgbGamma-1618"><span class="linenos">1618</span></a>      <span class="n">decode_table</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">256</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span> <span class="o">/</span> <span class="mi">255</span><span class="p">)</span>
</span><span id="SrgbGamma-1619"><a href="#SrgbGamma-1619"><span class="linenos">1619</span></a>      <span class="k">return</span> <span class="n">_arr_gather</span><span class="p">(</span><span class="n">decode_table</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
</span><span id="SrgbGamma-1620"><a href="#SrgbGamma-1620"><span class="linenos">1620</span></a>
</span><span id="SrgbGamma-1621"><a href="#SrgbGamma-1621"><span class="linenos">1621</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">_to_float_01</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="SrgbGamma-1622"><a href="#SrgbGamma-1622"><span class="linenos">1622</span></a>    <span class="k">return</span> <span class="n">_arr_where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.04045</span><span class="p">,</span> <span class="p">((</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.055</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.055</span><span class="p">)</span><span class="o">**</span><span class="mf">2.4</span><span class="p">,</span> <span class="n">x</span> <span class="o">/</span> <span class="mf">12.92</span><span class="p">)</span>
</span><span id="SrgbGamma-1623"><a href="#SrgbGamma-1623"><span class="linenos">1623</span></a>
</span><span id="SrgbGamma-1624"><a href="#SrgbGamma-1624"><span class="linenos">1624</span></a>  <span class="k">def</span> <span class="nf">encode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="SrgbGamma-1625"><a href="#SrgbGamma-1625"><span class="linenos">1625</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">_arr_clip</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="SrgbGamma-1626"><a href="#SrgbGamma-1626"><span class="linenos">1626</span></a>    <span class="c1"># Unfortunately, exponentiation is slow, and np.digitize() is even slower.</span>
</span><span id="SrgbGamma-1627"><a href="#SrgbGamma-1627"><span class="linenos">1627</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">_arr_where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0031308</span><span class="p">,</span> <span class="n">x</span><span class="o">**</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">2.4</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.055</span> <span class="o">-</span> <span class="p">(</span><span class="mf">0.055</span> <span class="o">-</span> <span class="mf">1e-17</span><span class="p">),</span> <span class="n">x</span> <span class="o">*</span> <span class="mf">12.92</span><span class="p">)</span>
</span><span id="SrgbGamma-1628"><a href="#SrgbGamma-1628"><span class="linenos">1628</span></a>    <span class="k">return</span> <span class="n">_from_float</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Gamma correction using sRGB; see <a href="https://en.wikipedia.org/wiki/SRGB">https://en.wikipedia.org/wiki/SRGB</a>.</p>
</div>


                </section>
                <section id="GAMMAS">
                    <div class="attr variable">
            <span class="name">GAMMAS</span><span class="annotation">: Dict[str, <a href="#Gamma">resampler.Gamma</a>]</span><span class="default_value"> = {&#39;identity&#39;: IdentityGamma(name=&#39;identity&#39;), &#39;power2&#39;: PowerGamma(name=&#39;power_2.0&#39;), &#39;power22&#39;: PowerGamma(name=&#39;power_2.2&#39;), &#39;srgb&#39;: SrgbGamma(name=&#39;srgb&#39;)}</span>

        
    </div>
    <a class="headerlink" href="#GAMMAS"></a>
    
            <div class="docstring"><p>Shortcut names for some predefined gamma-correction schemes.  These include 'identity',
'power2', 'power22', and 'srgb'.</p>
</div>


                </section>
                <section id="resize">
                            <input id="resize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">resize</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">array</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">shape</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gridtype">resampler.Gridtype</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">src_gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gridtype">resampler.Gridtype</a></span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gridtype">resampler.Gridtype</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dst_gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gridtype">resampler.Gridtype</a></span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gridtype">resampler.Gridtype</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">boundary</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Boundary">resampler.Boundary</a></span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Boundary">resampler.Boundary</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>,</span><span class="param">	<span class="n">cval</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="nb">filter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Filter">resampler.Filter</a></span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Filter">resampler.Filter</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;lanczos3&#39;</span>,</span><span class="param">	<span class="n">prefilter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Filter">resampler.Filter</a></span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Filter">resampler.Filter</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gamma">resampler.Gamma</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">src_gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gamma">resampler.Gamma</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dst_gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gamma">resampler.Gamma</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">scale</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">translate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">precision</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dim_order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">internal_torch_contiguous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="resize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#resize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="resize-1969"><a href="#resize-1969"><span class="linenos">1969</span></a><span class="k">def</span> <span class="nf">resize</span><span class="p">(</span>                     <span class="c1"># pylint: disable=too-many-branches disable=too-many-statements</span>
</span><span id="resize-1970"><a href="#resize-1970"><span class="linenos">1970</span></a>    <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span>
</span><span id="resize-1971"><a href="#resize-1971"><span class="linenos">1971</span></a>    <span class="n">shape</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="resize-1972"><a href="#resize-1972"><span class="linenos">1972</span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="resize-1973"><a href="#resize-1973"><span class="linenos">1973</span></a>    <span class="n">gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resize-1974"><a href="#resize-1974"><span class="linenos">1974</span></a>    <span class="n">src_gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resize-1975"><a href="#resize-1975"><span class="linenos">1975</span></a>    <span class="n">dst_gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resize-1976"><a href="#resize-1976"><span class="linenos">1976</span></a>    <span class="n">boundary</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Boundary</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Boundary</span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
</span><span id="resize-1977"><a href="#resize-1977"><span class="linenos">1977</span></a>    <span class="n">cval</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="resize-1978"><a href="#resize-1978"><span class="linenos">1978</span></a>    <span class="nb">filter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;lanczos3&#39;</span><span class="p">,</span>
</span><span id="resize-1979"><a href="#resize-1979"><span class="linenos">1979</span></a>    <span class="n">prefilter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resize-1980"><a href="#resize-1980"><span class="linenos">1980</span></a>    <span class="n">gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resize-1981"><a href="#resize-1981"><span class="linenos">1981</span></a>    <span class="n">src_gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resize-1982"><a href="#resize-1982"><span class="linenos">1982</span></a>    <span class="n">dst_gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resize-1983"><a href="#resize-1983"><span class="linenos">1983</span></a>    <span class="n">scale</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="resize-1984"><a href="#resize-1984"><span class="linenos">1984</span></a>    <span class="n">translate</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="resize-1985"><a href="#resize-1985"><span class="linenos">1985</span></a>    <span class="n">precision</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resize-1986"><a href="#resize-1986"><span class="linenos">1986</span></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resize-1987"><a href="#resize-1987"><span class="linenos">1987</span></a>    <span class="n">dim_order</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resize-1988"><a href="#resize-1988"><span class="linenos">1988</span></a>    <span class="n">internal_torch_contiguous</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="resize-1989"><a href="#resize-1989"><span class="linenos">1989</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="resize-1990"><a href="#resize-1990"><span class="linenos">1990</span></a>  <span class="sd">&quot;&quot;&quot;Resample a grid of sample values onto a grid of different resolution.</span>
</span><span id="resize-1991"><a href="#resize-1991"><span class="linenos">1991</span></a>
</span><span id="resize-1992"><a href="#resize-1992"><span class="linenos">1992</span></a><span class="sd">  The source `array` may be an array-like, `np.ndarray`, `tf.Tensor`, or `torch.Tensor`.  The</span>
</span><span id="resize-1993"><a href="#resize-1993"><span class="linenos">1993</span></a><span class="sd">  array is interpreted as a grid with `len(shape)` domain coordinate dimensions, where each</span>
</span><span id="resize-1994"><a href="#resize-1994"><span class="linenos">1994</span></a><span class="sd">  grid sample value has shape `array.shape[len(shape):]`.</span>
</span><span id="resize-1995"><a href="#resize-1995"><span class="linenos">1995</span></a>
</span><span id="resize-1996"><a href="#resize-1996"><span class="linenos">1996</span></a><span class="sd">  For example:</span>
</span><span id="resize-1997"><a href="#resize-1997"><span class="linenos">1997</span></a>
</span><span id="resize-1998"><a href="#resize-1998"><span class="linenos">1998</span></a><span class="sd">  - A grayscale image has `array.shape = height, width` and resizing it with `len(shape) == 2`</span>
</span><span id="resize-1999"><a href="#resize-1999"><span class="linenos">1999</span></a><span class="sd">    produces a new image of scalar values.</span>
</span><span id="resize-2000"><a href="#resize-2000"><span class="linenos">2000</span></a><span class="sd">  - An RGB image has `array.shape = height, width, 3` and resizing it with `len(shape) == 2`</span>
</span><span id="resize-2001"><a href="#resize-2001"><span class="linenos">2001</span></a><span class="sd">    produces a new image of RGB values.</span>
</span><span id="resize-2002"><a href="#resize-2002"><span class="linenos">2002</span></a><span class="sd">  - An 3D grid of 3x3 Jacobians has `array.shape = Z, Y, X, 3, 3` and resizing it with</span>
</span><span id="resize-2003"><a href="#resize-2003"><span class="linenos">2003</span></a><span class="sd">    `len(shape) == 3` produces a new 3D grid of Jacobians.</span>
</span><span id="resize-2004"><a href="#resize-2004"><span class="linenos">2004</span></a>
</span><span id="resize-2005"><a href="#resize-2005"><span class="linenos">2005</span></a><span class="sd">  This function also allows scaling and translation from the source domain to the output domain</span>
</span><span id="resize-2006"><a href="#resize-2006"><span class="linenos">2006</span></a><span class="sd">  through the parameters `scale` and `translate`.  For more general transforms, see `resample`.</span>
</span><span id="resize-2007"><a href="#resize-2007"><span class="linenos">2007</span></a>
</span><span id="resize-2008"><a href="#resize-2008"><span class="linenos">2008</span></a><span class="sd">  Args:</span>
</span><span id="resize-2009"><a href="#resize-2009"><span class="linenos">2009</span></a><span class="sd">    array: Grid of source sample values.  It must be an array-like object from a library in</span>
</span><span id="resize-2010"><a href="#resize-2010"><span class="linenos">2010</span></a><span class="sd">      `ARRAYLIBS`.  The array must have numeric type.  Its first `len(shape)` dimensions are the</span>
</span><span id="resize-2011"><a href="#resize-2011"><span class="linenos">2011</span></a><span class="sd">      domain coordinate dimensions.  Each grid dimension must be at least 1 for a `dual` grid or</span>
</span><span id="resize-2012"><a href="#resize-2012"><span class="linenos">2012</span></a><span class="sd">      at least 2 for a `primal` grid.</span>
</span><span id="resize-2013"><a href="#resize-2013"><span class="linenos">2013</span></a><span class="sd">    shape: The number of grid samples in each coordinate dimension of the output array.  The source</span>
</span><span id="resize-2014"><a href="#resize-2014"><span class="linenos">2014</span></a><span class="sd">      `array` must have at least as many dimensions as `len(shape)`.</span>
</span><span id="resize-2015"><a href="#resize-2015"><span class="linenos">2015</span></a><span class="sd">    gridtype: Placement of samples on both the source and output domain grids, specified as either</span>
</span><span id="resize-2016"><a href="#resize-2016"><span class="linenos">2016</span></a><span class="sd">      a name in `GRIDTYPES` or a `Gridtype` instance.  The default is &#39;dual&#39;.</span>
</span><span id="resize-2017"><a href="#resize-2017"><span class="linenos">2017</span></a><span class="sd">    src_gridtype: Placement of the samples in the source domain grid for each dimension.</span>
</span><span id="resize-2018"><a href="#resize-2018"><span class="linenos">2018</span></a><span class="sd">      Parameters `gridtype` and `src_gridtype` cannot both be set.</span>
</span><span id="resize-2019"><a href="#resize-2019"><span class="linenos">2019</span></a><span class="sd">    dst_gridtype: Placement of the samples in the output domain grid for each dimension.</span>
</span><span id="resize-2020"><a href="#resize-2020"><span class="linenos">2020</span></a><span class="sd">      Parameters `gridtype` and `dst_gridtype` cannot both be set.</span>
</span><span id="resize-2021"><a href="#resize-2021"><span class="linenos">2021</span></a><span class="sd">    boundary: The reconstruction boundary rule for each dimension in `shape`, specified as either</span>
</span><span id="resize-2022"><a href="#resize-2022"><span class="linenos">2022</span></a><span class="sd">      a name in `BOUNDARIES` or a `Boundary` instance.  The special value &#39;auto&#39; uses &#39;reflect&#39;</span>
</span><span id="resize-2023"><a href="#resize-2023"><span class="linenos">2023</span></a><span class="sd">      for upsampling and &#39;clamp&#39; for downsampling.</span>
</span><span id="resize-2024"><a href="#resize-2024"><span class="linenos">2024</span></a><span class="sd">    cval: Constant value used beyond the samples by some boundary rules.  It must be broadcastable</span>
</span><span id="resize-2025"><a href="#resize-2025"><span class="linenos">2025</span></a><span class="sd">      onto `array.shape[len(shape):]`.</span>
</span><span id="resize-2026"><a href="#resize-2026"><span class="linenos">2026</span></a><span class="sd">    filter: The reconstruction kernel for each dimension in `shape`, specified as either a filter</span>
</span><span id="resize-2027"><a href="#resize-2027"><span class="linenos">2027</span></a><span class="sd">      name in `FILTERS` or a `Filter` instance.  It is used during upsampling (i.e., magnification).</span>
</span><span id="resize-2028"><a href="#resize-2028"><span class="linenos">2028</span></a><span class="sd">    prefilter: The prefilter kernel for each dimension in `shape`, specified as either a filter</span>
</span><span id="resize-2029"><a href="#resize-2029"><span class="linenos">2029</span></a><span class="sd">      name in `FILTERS` or a `Filter` instance.  It is used during downsampling</span>
</span><span id="resize-2030"><a href="#resize-2030"><span class="linenos">2030</span></a><span class="sd">      (i.e., minification).  If None, it inherits the value of `filter`.</span>
</span><span id="resize-2031"><a href="#resize-2031"><span class="linenos">2031</span></a><span class="sd">    gamma: Component transfer functions (e.g., gamma correction) applied when reading samples from</span>
</span><span id="resize-2032"><a href="#resize-2032"><span class="linenos">2032</span></a><span class="sd">      `array` and when creating output grid samples.  It is specified as either a name in `GAMMAS`</span>
</span><span id="resize-2033"><a href="#resize-2033"><span class="linenos">2033</span></a><span class="sd">      or a `Gamma` instance.  If both `array.dtype` and `dtype` are `uint`, the default is `power2`.</span>
</span><span id="resize-2034"><a href="#resize-2034"><span class="linenos">2034</span></a><span class="sd">      If both are non-`uint`, the default is `identity`.  Otherwise, `gamma` or</span>
</span><span id="resize-2035"><a href="#resize-2035"><span class="linenos">2035</span></a><span class="sd">      `src_gamma`/`dst_gamma` must be set.   Gamma correction assumes that float values are in the</span>
</span><span id="resize-2036"><a href="#resize-2036"><span class="linenos">2036</span></a><span class="sd">      range [0.0, 1.0].</span>
</span><span id="resize-2037"><a href="#resize-2037"><span class="linenos">2037</span></a><span class="sd">    src_gamma: Component transfer function used to &quot;decode&quot; `array` samples.</span>
</span><span id="resize-2038"><a href="#resize-2038"><span class="linenos">2038</span></a><span class="sd">      Parameters `gamma` and `src_gamma` cannot both be set.</span>
</span><span id="resize-2039"><a href="#resize-2039"><span class="linenos">2039</span></a><span class="sd">    dst_gamma: Component transfer function used to &quot;encode&quot; the output samples.</span>
</span><span id="resize-2040"><a href="#resize-2040"><span class="linenos">2040</span></a><span class="sd">      Parameters `gamma` and `dst_gamma` cannot both be set.</span>
</span><span id="resize-2041"><a href="#resize-2041"><span class="linenos">2041</span></a><span class="sd">    scale: Scaling factor applied to each dimension of the source domain when it is mapped onto</span>
</span><span id="resize-2042"><a href="#resize-2042"><span class="linenos">2042</span></a><span class="sd">      the destination domain.</span>
</span><span id="resize-2043"><a href="#resize-2043"><span class="linenos">2043</span></a><span class="sd">    translate: Offset applied to each dimension of the scaled source domain when it is mapped onto</span>
</span><span id="resize-2044"><a href="#resize-2044"><span class="linenos">2044</span></a><span class="sd">      the destination domain.</span>
</span><span id="resize-2045"><a href="#resize-2045"><span class="linenos">2045</span></a><span class="sd">    precision: Inexact precision of intermediate computations.  If None, it is determined based</span>
</span><span id="resize-2046"><a href="#resize-2046"><span class="linenos">2046</span></a><span class="sd">      on `array.dtype` and `dtype`.</span>
</span><span id="resize-2047"><a href="#resize-2047"><span class="linenos">2047</span></a><span class="sd">    dtype: Desired data type of the output array.  If None, it is taken to be `array.dtype`.</span>
</span><span id="resize-2048"><a href="#resize-2048"><span class="linenos">2048</span></a><span class="sd">      If it is a uint type, the intermediate float values are rescaled from the [0.0, 1.0] range</span>
</span><span id="resize-2049"><a href="#resize-2049"><span class="linenos">2049</span></a><span class="sd">      to the uint range.</span>
</span><span id="resize-2050"><a href="#resize-2050"><span class="linenos">2050</span></a><span class="sd">    dim_order: Override the automatically selected order in which the grid dimensions are resized.</span>
</span><span id="resize-2051"><a href="#resize-2051"><span class="linenos">2051</span></a><span class="sd">      Must contain a permutation of `range(len(shape))`.</span>
</span><span id="resize-2052"><a href="#resize-2052"><span class="linenos">2052</span></a>
</span><span id="resize-2053"><a href="#resize-2053"><span class="linenos">2053</span></a><span class="sd">  Returns:</span>
</span><span id="resize-2054"><a href="#resize-2054"><span class="linenos">2054</span></a><span class="sd">    An array of the same class (`np.ndarray`, `tf.Tensor`, or `torch.Tensor`) as the source `array`,</span>
</span><span id="resize-2055"><a href="#resize-2055"><span class="linenos">2055</span></a><span class="sd">    with shape `shape + array.shape[len(shape):]` and data type `dtype`.</span>
</span><span id="resize-2056"><a href="#resize-2056"><span class="linenos">2056</span></a>
</span><span id="resize-2057"><a href="#resize-2057"><span class="linenos">2057</span></a><span class="sd">  &gt;&gt;&gt; result = resize([1.0, 4.0, 5.0], shape=(4,))</span>
</span><span id="resize-2058"><a href="#resize-2058"><span class="linenos">2058</span></a><span class="sd">  &gt;&gt;&gt; assert np.allclose(result, [0.74240461, 2.88088827, 4.68647155, 5.02641199])</span>
</span><span id="resize-2059"><a href="#resize-2059"><span class="linenos">2059</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="resize-2060"><a href="#resize-2060"><span class="linenos">2060</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span><span id="resize-2061"><a href="#resize-2061"><span class="linenos">2061</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="resize-2062"><a href="#resize-2062"><span class="linenos">2062</span></a>  <span class="n">arraylib</span> <span class="o">=</span> <span class="n">_arr_arraylib</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="resize-2063"><a href="#resize-2063"><span class="linenos">2063</span></a>  <span class="n">array_dtype</span> <span class="o">=</span> <span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="resize-2064"><a href="#resize-2064"><span class="linenos">2064</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">array_dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
</span><span id="resize-2065"><a href="#resize-2065"><span class="linenos">2065</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Type </span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s1"> is not numeric.&#39;</span><span class="p">)</span>
</span><span id="resize-2066"><a href="#resize-2066"><span class="linenos">2066</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="resize-2067"><a href="#resize-2067"><span class="linenos">2067</span></a>  <span class="n">array_ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="resize-2068"><a href="#resize-2068"><span class="linenos">2068</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">array_ndim</span><span class="p">:</span>
</span><span id="resize-2069"><a href="#resize-2069"><span class="linenos">2069</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Shape </span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1"> cannot be resized to </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="resize-2070"><a href="#resize-2070"><span class="linenos">2070</span></a>  <span class="n">src_shape</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)]</span>
</span><span id="resize-2071"><a href="#resize-2071"><span class="linenos">2071</span></a>  <span class="n">src_gridtype2</span><span class="p">,</span> <span class="n">dst_gridtype2</span> <span class="o">=</span> <span class="n">_get_gridtypes</span><span class="p">(</span>
</span><span id="resize-2072"><a href="#resize-2072"><span class="linenos">2072</span></a>      <span class="n">gridtype</span><span class="p">,</span> <span class="n">src_gridtype</span><span class="p">,</span> <span class="n">dst_gridtype</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
</span><span id="resize-2073"><a href="#resize-2073"><span class="linenos">2073</span></a>  <span class="n">boundary2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">boundary</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
</span><span id="resize-2074"><a href="#resize-2074"><span class="linenos">2074</span></a>  <span class="n">cval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">cval</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">):])</span>
</span><span id="resize-2075"><a href="#resize-2075"><span class="linenos">2075</span></a>  <span class="n">prefilter</span> <span class="o">=</span> <span class="nb">filter</span> <span class="k">if</span> <span class="n">prefilter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">prefilter</span>
</span><span id="resize-2076"><a href="#resize-2076"><span class="linenos">2076</span></a>  <span class="n">filter2</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_filter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">filter</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))]</span>
</span><span id="resize-2077"><a href="#resize-2077"><span class="linenos">2077</span></a>  <span class="n">prefilter2</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_filter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">prefilter</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))]</span>
</span><span id="resize-2078"><a href="#resize-2078"><span class="linenos">2078</span></a>  <span class="n">dtype</span> <span class="o">=</span> <span class="n">array_dtype</span> <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="resize-2079"><a href="#resize-2079"><span class="linenos">2079</span></a>  <span class="n">src_gamma2</span><span class="p">,</span> <span class="n">dst_gamma2</span> <span class="o">=</span> <span class="n">_get_src_dst_gamma</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">src_gamma</span><span class="p">,</span> <span class="n">dst_gamma</span><span class="p">,</span> <span class="n">array_dtype</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="resize-2080"><a href="#resize-2080"><span class="linenos">2080</span></a>  <span class="n">scale2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">scale</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
</span><span id="resize-2081"><a href="#resize-2081"><span class="linenos">2081</span></a>  <span class="n">translate2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">translate</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
</span><span id="resize-2082"><a href="#resize-2082"><span class="linenos">2082</span></a>  <span class="k">del</span> <span class="n">src_gridtype</span><span class="p">,</span> <span class="n">dst_gridtype</span><span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">prefilter</span>
</span><span id="resize-2083"><a href="#resize-2083"><span class="linenos">2083</span></a>  <span class="k">del</span> <span class="n">src_gamma</span><span class="p">,</span> <span class="n">dst_gamma</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">translate</span>
</span><span id="resize-2084"><a href="#resize-2084"><span class="linenos">2084</span></a>  <span class="n">precision</span> <span class="o">=</span> <span class="n">_get_precision</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="p">[</span><span class="n">array_dtype</span><span class="p">,</span> <span class="n">dtype</span><span class="p">],</span> <span class="p">[])</span>
</span><span id="resize-2085"><a href="#resize-2085"><span class="linenos">2085</span></a>  <span class="n">weight_precision</span> <span class="o">=</span> <span class="n">_real_precision</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span>
</span><span id="resize-2086"><a href="#resize-2086"><span class="linenos">2086</span></a>  <span class="k">if</span> <span class="n">dim_order</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="resize-2087"><a href="#resize-2087"><span class="linenos">2087</span></a>    <span class="n">dim_order</span> <span class="o">=</span> <span class="n">_best_order_in_which_to_process_dimensions</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
</span><span id="resize-2088"><a href="#resize-2088"><span class="linenos">2088</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="resize-2089"><a href="#resize-2089"><span class="linenos">2089</span></a>    <span class="n">dim_order</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">dim_order</span><span class="p">)</span>
</span><span id="resize-2090"><a href="#resize-2090"><span class="linenos">2090</span></a>    <span class="k">if</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dim_order</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))):</span>
</span><span id="resize-2091"><a href="#resize-2091"><span class="linenos">2091</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">dim_order</span><span class="si">}</span><span class="s1"> not a permutation of </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)))</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="resize-2092"><a href="#resize-2092"><span class="linenos">2092</span></a>
</span><span id="resize-2093"><a href="#resize-2093"><span class="linenos">2093</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">src_gamma2</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
</span><span id="resize-2094"><a href="#resize-2094"><span class="linenos">2094</span></a>
</span><span id="resize-2095"><a href="#resize-2095"><span class="linenos">2095</span></a>  <span class="n">can_use_fast_box_downsampling</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="resize-2096"><a href="#resize-2096"><span class="linenos">2096</span></a>      <span class="s1">&#39;numba&#39;</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span> <span class="ow">and</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;numpy&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">array_ndim</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="resize-2097"><a href="#resize-2097"><span class="linenos">2097</span></a>      <span class="nb">all</span><span class="p">(</span><span class="n">src</span> <span class="o">&gt;</span> <span class="n">dst</span> <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">src_shape</span><span class="p">,</span> <span class="n">shape</span><span class="p">))</span> <span class="ow">and</span>
</span><span id="resize-2098"><a href="#resize-2098"><span class="linenos">2098</span></a>      <span class="nb">all</span><span class="p">(</span><span class="n">src</span> <span class="o">%</span> <span class="n">dst</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">dst</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">src_shape</span><span class="p">,</span> <span class="n">shape</span><span class="p">))</span> <span class="ow">and</span>
</span><span id="resize-2099"><a href="#resize-2099"><span class="linenos">2099</span></a>      <span class="nb">all</span><span class="p">(</span><span class="n">gridtype</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dual&#39;</span> <span class="k">for</span> <span class="n">gridtype</span> <span class="ow">in</span> <span class="n">src_gridtype2</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="resize-2100"><a href="#resize-2100"><span class="linenos">2100</span></a>      <span class="nb">all</span><span class="p">(</span><span class="n">gridtype</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;dual&#39;</span> <span class="k">for</span> <span class="n">gridtype</span> <span class="ow">in</span> <span class="n">dst_gridtype2</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="resize-2101"><a href="#resize-2101"><span class="linenos">2101</span></a>      <span class="nb">all</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;box&#39;</span><span class="p">,</span> <span class="s1">&#39;trapezoid&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">prefilter2</span><span class="p">)</span> <span class="ow">and</span>
</span><span id="resize-2102"><a href="#resize-2102"><span class="linenos">2102</span></a>      <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">scale2</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">translate2</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">))</span>
</span><span id="resize-2103"><a href="#resize-2103"><span class="linenos">2103</span></a>  <span class="k">if</span> <span class="n">can_use_fast_box_downsampling</span><span class="p">:</span>
</span><span id="resize-2104"><a href="#resize-2104"><span class="linenos">2104</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">_downsample_in_2d_using_box_filter</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">typing</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">shape</span><span class="p">))</span>
</span><span id="resize-2105"><a href="#resize-2105"><span class="linenos">2105</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">dst_gamma2</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="resize-2106"><a href="#resize-2106"><span class="linenos">2106</span></a>    <span class="k">return</span> <span class="n">array</span>
</span><span id="resize-2107"><a href="#resize-2107"><span class="linenos">2107</span></a>
</span><span id="resize-2108"><a href="#resize-2108"><span class="linenos">2108</span></a>  <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">dim_order</span><span class="p">:</span>
</span><span id="resize-2109"><a href="#resize-2109"><span class="linenos">2109</span></a>    <span class="n">skip_resize_on_this_dim</span> <span class="o">=</span> <span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">==</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="ow">and</span> <span class="n">scale2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">==</span> <span class="mf">1.0</span> <span class="ow">and</span>
</span><span id="resize-2110"><a href="#resize-2110"><span class="linenos">2110</span></a>                               <span class="n">translate2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">interpolating</span><span class="p">)</span>
</span><span id="resize-2111"><a href="#resize-2111"><span class="linenos">2111</span></a>    <span class="k">if</span> <span class="n">skip_resize_on_this_dim</span><span class="p">:</span>
</span><span id="resize-2112"><a href="#resize-2112"><span class="linenos">2112</span></a>      <span class="k">continue</span>
</span><span id="resize-2113"><a href="#resize-2113"><span class="linenos">2113</span></a>
</span><span id="resize-2114"><a href="#resize-2114"><span class="linenos">2114</span></a>    <span class="n">is_minification</span> <span class="o">=</span> <span class="p">(</span><span class="n">dst_gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">size_in_samples</span><span class="p">(</span><span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span> <span class="o">/</span>
</span><span id="resize-2115"><a href="#resize-2115"><span class="linenos">2115</span></a>                       <span class="n">src_gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">size_in_samples</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]))</span> <span class="o">*</span> <span class="n">scale2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0</span>
</span><span id="resize-2116"><a href="#resize-2116"><span class="linenos">2116</span></a>    <span class="n">boundary_dim</span> <span class="o">=</span> <span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
</span><span id="resize-2117"><a href="#resize-2117"><span class="linenos">2117</span></a>    <span class="k">if</span> <span class="n">boundary_dim</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
</span><span id="resize-2118"><a href="#resize-2118"><span class="linenos">2118</span></a>      <span class="n">boundary_dim</span> <span class="o">=</span> <span class="s1">&#39;clamp&#39;</span> <span class="k">if</span> <span class="n">is_minification</span> <span class="k">else</span> <span class="s1">&#39;reflect&#39;</span>
</span><span id="resize-2119"><a href="#resize-2119"><span class="linenos">2119</span></a>    <span class="n">boundary_dim</span> <span class="o">=</span> <span class="n">boundary_dim</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">boundary_dim</span><span class="p">,</span> <span class="n">Boundary</span><span class="p">)</span> <span class="k">else</span> <span class="n">BOUNDARIES</span><span class="p">[</span><span class="n">boundary_dim</span><span class="p">]</span>
</span><span id="resize-2120"><a href="#resize-2120"><span class="linenos">2120</span></a>    <span class="n">resize_matrix</span><span class="p">,</span> <span class="n">cval_weight</span> <span class="o">=</span> <span class="n">_create_resize_matrix</span><span class="p">(</span>
</span><span id="resize-2121"><a href="#resize-2121"><span class="linenos">2121</span></a>        <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
</span><span id="resize-2122"><a href="#resize-2122"><span class="linenos">2122</span></a>        <span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
</span><span id="resize-2123"><a href="#resize-2123"><span class="linenos">2123</span></a>        <span class="n">src_gridtype</span><span class="o">=</span><span class="n">src_gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
</span><span id="resize-2124"><a href="#resize-2124"><span class="linenos">2124</span></a>        <span class="n">dst_gridtype</span><span class="o">=</span><span class="n">dst_gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
</span><span id="resize-2125"><a href="#resize-2125"><span class="linenos">2125</span></a>        <span class="n">boundary</span><span class="o">=</span><span class="n">boundary_dim</span><span class="p">,</span>
</span><span id="resize-2126"><a href="#resize-2126"><span class="linenos">2126</span></a>        <span class="nb">filter</span><span class="o">=</span><span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
</span><span id="resize-2127"><a href="#resize-2127"><span class="linenos">2127</span></a>        <span class="n">prefilter</span><span class="o">=</span><span class="n">prefilter2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
</span><span id="resize-2128"><a href="#resize-2128"><span class="linenos">2128</span></a>        <span class="n">scale</span><span class="o">=</span><span class="n">scale2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
</span><span id="resize-2129"><a href="#resize-2129"><span class="linenos">2129</span></a>        <span class="n">translate</span><span class="o">=</span><span class="n">translate2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
</span><span id="resize-2130"><a href="#resize-2130"><span class="linenos">2130</span></a>        <span class="n">dtype</span><span class="o">=</span><span class="n">weight_precision</span><span class="p">,</span>
</span><span id="resize-2131"><a href="#resize-2131"><span class="linenos">2131</span></a>        <span class="n">arraylib</span><span class="o">=</span><span class="n">arraylib</span><span class="p">)</span>
</span><span id="resize-2132"><a href="#resize-2132"><span class="linenos">2132</span></a>
</span><span id="resize-2133"><a href="#resize-2133"><span class="linenos">2133</span></a>    <span class="k">def</span> <span class="nf">potential_pre_digital_filter</span><span class="p">(</span><span class="n">array_flat</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="resize-2134"><a href="#resize-2134"><span class="linenos">2134</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">is_minification</span><span class="p">:</span>
</span><span id="resize-2135"><a href="#resize-2135"><span class="linenos">2135</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">_apply_potential_digital_filter_1d</span><span class="p">(</span>
</span><span id="resize-2136"><a href="#resize-2136"><span class="linenos">2136</span></a>            <span class="n">array_flat</span><span class="p">,</span> <span class="n">src_gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">boundary_dim</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
</span><span id="resize-2137"><a href="#resize-2137"><span class="linenos">2137</span></a>      <span class="k">return</span> <span class="n">array_flat</span>
</span><span id="resize-2138"><a href="#resize-2138"><span class="linenos">2138</span></a>
</span><span id="resize-2139"><a href="#resize-2139"><span class="linenos">2139</span></a>    <span class="k">def</span> <span class="nf">potential_post_digital_filter</span><span class="p">(</span><span class="n">array_flat</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="resize-2140"><a href="#resize-2140"><span class="linenos">2140</span></a>      <span class="k">if</span> <span class="n">is_minification</span><span class="p">:</span>  <span class="c1"># use prefilter2[dim]?</span>
</span><span id="resize-2141"><a href="#resize-2141"><span class="linenos">2141</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">_apply_potential_digital_filter_1d</span><span class="p">(</span>
</span><span id="resize-2142"><a href="#resize-2142"><span class="linenos">2142</span></a>            <span class="n">array_flat</span><span class="p">,</span> <span class="n">dst_gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">boundary_dim</span><span class="p">,</span> <span class="n">cval</span><span class="p">,</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
</span><span id="resize-2143"><a href="#resize-2143"><span class="linenos">2143</span></a>      <span class="k">return</span> <span class="n">array_flat</span>
</span><span id="resize-2144"><a href="#resize-2144"><span class="linenos">2144</span></a>
</span><span id="resize-2145"><a href="#resize-2145"><span class="linenos">2145</span></a>    <span class="k">if</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;numpy&#39;</span><span class="p">:</span>
</span><span id="resize-2146"><a href="#resize-2146"><span class="linenos">2146</span></a>
</span><span id="resize-2147"><a href="#resize-2147"><span class="linenos">2147</span></a>      <span class="k">def</span> <span class="nf">resize_numpy_dim</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="resize-2148"><a href="#resize-2148"><span class="linenos">2148</span></a>        <span class="c1"># Because np.ndarray supports strides, np.moveaxis() and np.permute() are constant-time.</span>
</span><span id="resize-2149"><a href="#resize-2149"><span class="linenos">2149</span></a>        <span class="c1"># However, ndarray.reshape() often creates a copy of the array if the data is</span>
</span><span id="resize-2150"><a href="#resize-2150"><span class="linenos">2150</span></a>        <span class="c1"># non-contiguous, e.g. dim=1 in an RGB image.</span>
</span><span id="resize-2151"><a href="#resize-2151"><span class="linenos">2151</span></a>        <span class="n">array_dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dim</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="resize-2152"><a href="#resize-2152"><span class="linenos">2152</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">array_dim</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="resize-2153"><a href="#resize-2153"><span class="linenos">2153</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">potential_pre_digital_filter</span><span class="p">(</span><span class="n">array_flat</span><span class="p">)</span>
</span><span id="resize-2154"><a href="#resize-2154"><span class="linenos">2154</span></a>
</span><span id="resize-2155"><a href="#resize-2155"><span class="linenos">2155</span></a>        <span class="c1"># The dot() calls scipy.sparse._sparsetools.csr_matvecs() in</span>
</span><span id="resize-2156"><a href="#resize-2156"><span class="linenos">2156</span></a>        <span class="c1"># https://github.com/scipy/scipy/blob/master/scipy/sparse/sparsetools/csr.h</span>
</span><span id="resize-2157"><a href="#resize-2157"><span class="linenos">2157</span></a>        <span class="c1"># which iteratively calls the LEVEL 1 BLAS function axpy().</span>
</span><span id="resize-2158"><a href="#resize-2158"><span class="linenos">2158</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">resize_matrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">array_flat</span><span class="p">)</span>
</span><span id="resize-2159"><a href="#resize-2159"><span class="linenos">2159</span></a>        <span class="k">if</span> <span class="n">cval_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="resize-2160"><a href="#resize-2160"><span class="linenos">2160</span></a>          <span class="n">cval_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">cval</span><span class="p">,</span> <span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="resize-2161"><a href="#resize-2161"><span class="linenos">2161</span></a>          <span class="n">array_flat</span> <span class="o">+=</span> <span class="n">cval_weight</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">cval_flat</span>
</span><span id="resize-2162"><a href="#resize-2162"><span class="linenos">2162</span></a>
</span><span id="resize-2163"><a href="#resize-2163"><span class="linenos">2163</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">potential_post_digital_filter</span><span class="p">(</span><span class="n">array_flat</span><span class="p">)</span>
</span><span id="resize-2164"><a href="#resize-2164"><span class="linenos">2164</span></a>        <span class="n">array_dim</span> <span class="o">=</span> <span class="n">array_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array_flat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="resize-2165"><a href="#resize-2165"><span class="linenos">2165</span></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">array_dim</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
</span><span id="resize-2166"><a href="#resize-2166"><span class="linenos">2166</span></a>
</span><span id="resize-2167"><a href="#resize-2167"><span class="linenos">2167</span></a>      <span class="n">array</span> <span class="o">=</span> <span class="n">resize_numpy_dim</span><span class="p">()</span>
</span><span id="resize-2168"><a href="#resize-2168"><span class="linenos">2168</span></a>
</span><span id="resize-2169"><a href="#resize-2169"><span class="linenos">2169</span></a>    <span class="k">elif</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;tensorflow&#39;</span><span class="p">:</span>
</span><span id="resize-2170"><a href="#resize-2170"><span class="linenos">2170</span></a>
</span><span id="resize-2171"><a href="#resize-2171"><span class="linenos">2171</span></a>      <span class="k">def</span> <span class="nf">resize_tensorflow_dim</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">_TensorflowTensor</span><span class="p">:</span>
</span><span id="resize-2172"><a href="#resize-2172"><span class="linenos">2172</span></a>        <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="resize-2173"><a href="#resize-2173"><span class="linenos">2173</span></a>        <span class="c1"># Because tf.Tensor does not support strides, tf.transpose() returns a</span>
</span><span id="resize-2174"><a href="#resize-2174"><span class="linenos">2174</span></a>        <span class="c1"># new permuted tensor.  However, tf.reshape() is always efficient.</span>
</span><span id="resize-2175"><a href="#resize-2175"><span class="linenos">2175</span></a>        <span class="n">perm</span> <span class="o">=</span> <span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">dim</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">array_ndim</span><span class="p">))</span>
</span><span id="resize-2176"><a href="#resize-2176"><span class="linenos">2176</span></a>        <span class="n">array_dim</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span>
</span><span id="resize-2177"><a href="#resize-2177"><span class="linenos">2177</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array_dim</span><span class="p">,</span> <span class="p">[</span><span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="resize-2178"><a href="#resize-2178"><span class="linenos">2178</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">potential_pre_digital_filter</span><span class="p">(</span><span class="n">array_flat</span><span class="p">)</span>
</span><span id="resize-2179"><a href="#resize-2179"><span class="linenos">2179</span></a>
</span><span id="resize-2180"><a href="#resize-2180"><span class="linenos">2180</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">sparse</span><span class="o">.</span><span class="n">sparse_dense_matmul</span><span class="p">(</span><span class="n">resize_matrix</span><span class="p">,</span> <span class="n">array_flat</span><span class="p">)</span>
</span><span id="resize-2181"><a href="#resize-2181"><span class="linenos">2181</span></a>        <span class="k">if</span> <span class="n">cval_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="resize-2182"><a href="#resize-2182"><span class="linenos">2182</span></a>          <span class="n">cval_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">cval</span><span class="p">,</span> <span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="resize-2183"><a href="#resize-2183"><span class="linenos">2183</span></a>          <span class="n">array_flat</span> <span class="o">+=</span> <span class="n">cval_weight</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">cval_flat</span>
</span><span id="resize-2184"><a href="#resize-2184"><span class="linenos">2184</span></a>
</span><span id="resize-2185"><a href="#resize-2185"><span class="linenos">2185</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">potential_post_digital_filter</span><span class="p">(</span><span class="n">array_flat</span><span class="p">)</span>
</span><span id="resize-2186"><a href="#resize-2186"><span class="linenos">2186</span></a>        <span class="n">array_dim</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array_flat</span><span class="p">,</span> <span class="p">[</span><span class="n">array_flat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:]])</span>
</span><span id="resize-2187"><a href="#resize-2187"><span class="linenos">2187</span></a>        <span class="n">perm</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">dim</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">array_ndim</span><span class="p">))</span>
</span><span id="resize-2188"><a href="#resize-2188"><span class="linenos">2188</span></a>        <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">array_dim</span><span class="p">,</span> <span class="n">perm</span><span class="p">)</span>
</span><span id="resize-2189"><a href="#resize-2189"><span class="linenos">2189</span></a>
</span><span id="resize-2190"><a href="#resize-2190"><span class="linenos">2190</span></a>      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">array_dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complexfloating</span><span class="p">):</span>
</span><span id="resize-2191"><a href="#resize-2191"><span class="linenos">2191</span></a>        <span class="n">resize_matrix</span> <span class="o">=</span> <span class="n">resize_matrix</span><span class="o">.</span><span class="n">with_values</span><span class="p">(</span><span class="n">_arr_astype</span><span class="p">(</span><span class="n">resize_matrix</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">array_dtype</span><span class="p">))</span>
</span><span id="resize-2192"><a href="#resize-2192"><span class="linenos">2192</span></a>        <span class="k">if</span> <span class="n">cval_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="resize-2193"><a href="#resize-2193"><span class="linenos">2193</span></a>          <span class="n">cval_weight</span> <span class="o">=</span> <span class="n">_arr_astype</span><span class="p">(</span><span class="n">cval_weight</span><span class="p">,</span> <span class="n">array_dtype</span><span class="p">)</span>
</span><span id="resize-2194"><a href="#resize-2194"><span class="linenos">2194</span></a>      <span class="n">array</span> <span class="o">=</span> <span class="n">resize_tensorflow_dim</span><span class="p">()</span>
</span><span id="resize-2195"><a href="#resize-2195"><span class="linenos">2195</span></a>
</span><span id="resize-2196"><a href="#resize-2196"><span class="linenos">2196</span></a>    <span class="k">elif</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;torch&#39;</span><span class="p">:</span>
</span><span id="resize-2197"><a href="#resize-2197"><span class="linenos">2197</span></a>
</span><span id="resize-2198"><a href="#resize-2198"><span class="linenos">2198</span></a>      <span class="k">def</span> <span class="nf">resize_torch_dim</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">_TorchTensor</span><span class="p">:</span>
</span><span id="resize-2199"><a href="#resize-2199"><span class="linenos">2199</span></a>        <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="resize-2200"><a href="#resize-2200"><span class="linenos">2200</span></a>        <span class="c1"># No sparse complex: https://github.com/pytorch/pytorch/issues/50690.</span>
</span><span id="resize-2201"><a href="#resize-2201"><span class="linenos">2201</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">array_dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complexfloating</span><span class="p">)</span>
</span><span id="resize-2202"><a href="#resize-2202"><span class="linenos">2202</span></a>        <span class="n">array_dim</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="resize-2203"><a href="#resize-2203"><span class="linenos">2203</span></a>        <span class="n">array_flat</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">Tensor</span> <span class="o">=</span> <span class="n">array_dim</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="resize-2204"><a href="#resize-2204"><span class="linenos">2204</span></a>        <span class="k">if</span> <span class="n">internal_torch_contiguous</span><span class="p">:</span>  <span class="c1"># Greatly improves timings in some cases.</span>
</span><span id="resize-2205"><a href="#resize-2205"><span class="linenos">2205</span></a>          <span class="n">array_flat</span> <span class="o">=</span> <span class="n">array_flat</span><span class="o">.</span><span class="n">contiguous</span><span class="p">()</span>
</span><span id="resize-2206"><a href="#resize-2206"><span class="linenos">2206</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">potential_pre_digital_filter</span><span class="p">(</span><span class="n">array_flat</span><span class="p">)</span>
</span><span id="resize-2207"><a href="#resize-2207"><span class="linenos">2207</span></a>
</span><span id="resize-2208"><a href="#resize-2208"><span class="linenos">2208</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">mm</span><span class="p">(</span><span class="n">resize_matrix</span><span class="p">,</span> <span class="n">array_flat</span><span class="p">)</span>
</span><span id="resize-2209"><a href="#resize-2209"><span class="linenos">2209</span></a>        <span class="k">if</span> <span class="n">cval_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="resize-2210"><a href="#resize-2210"><span class="linenos">2210</span></a>          <span class="n">cval_flat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">cval</span><span class="p">,</span> <span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="resize-2211"><a href="#resize-2211"><span class="linenos">2211</span></a>          <span class="n">array_flat</span> <span class="o">+=</span> <span class="n">cval_weight</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">*</span> <span class="n">cval_flat</span>
</span><span id="resize-2212"><a href="#resize-2212"><span class="linenos">2212</span></a>
</span><span id="resize-2213"><a href="#resize-2213"><span class="linenos">2213</span></a>        <span class="n">array_flat</span> <span class="o">=</span> <span class="n">potential_post_digital_filter</span><span class="p">(</span><span class="n">array_flat</span><span class="p">)</span>
</span><span id="resize-2214"><a href="#resize-2214"><span class="linenos">2214</span></a>        <span class="n">array_dim</span> <span class="o">=</span> <span class="n">array_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">array_flat</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">*</span><span class="n">array_dim</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="resize-2215"><a href="#resize-2215"><span class="linenos">2215</span></a>        <span class="k">return</span> <span class="n">array_dim</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dim</span><span class="p">)</span>
</span><span id="resize-2216"><a href="#resize-2216"><span class="linenos">2216</span></a>
</span><span id="resize-2217"><a href="#resize-2217"><span class="linenos">2217</span></a>      <span class="n">array</span> <span class="o">=</span> <span class="n">resize_torch_dim</span><span class="p">()</span>
</span><span id="resize-2218"><a href="#resize-2218"><span class="linenos">2218</span></a>
</span><span id="resize-2219"><a href="#resize-2219"><span class="linenos">2219</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="resize-2220"><a href="#resize-2220"><span class="linenos">2220</span></a>      <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">arraylib</span><span class="si">}</span><span class="s1"> is unrecognized.&#39;</span><span class="p">)</span>
</span><span id="resize-2221"><a href="#resize-2221"><span class="linenos">2221</span></a>
</span><span id="resize-2222"><a href="#resize-2222"><span class="linenos">2222</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">dst_gamma2</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="resize-2223"><a href="#resize-2223"><span class="linenos">2223</span></a>  <span class="k">return</span> <span class="n">array</span>
</span></pre></div>


            <div class="docstring"><p>Resample a grid of sample values onto a grid of different resolution.</p>

<p>The source <code>array</code> may be an array-like, <code>np.ndarray</code>, <code>tf.Tensor</code>, or <code>torch.Tensor</code>.  The
array is interpreted as a grid with <code>len(shape)</code> domain coordinate dimensions, where each
grid sample value has shape <code>array.shape[len(shape):]</code>.</p>

<p>For example:</p>

<ul>
<li>A grayscale image has <code>array.shape = height, width</code> and resizing it with <code>len(shape) == 2</code>
produces a new image of scalar values.</li>
<li>An RGB image has <code>array.shape = height, width, 3</code> and resizing it with <code>len(shape) == 2</code>
produces a new image of RGB values.</li>
<li>An 3D grid of 3x3 Jacobians has <code>array.shape = Z, Y, X, 3, 3</code> and resizing it with
<code>len(shape) == 3</code> produces a new 3D grid of Jacobians.</li>
</ul>

<p>This function also allows scaling and translation from the source domain to the output domain
through the parameters <code>scale</code> and <code>translate</code>.  For more general transforms, see <code><a href="#resample">resample</a></code>.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>array:</strong>  Grid of source sample values.  It must be an array-like object from a library in
<code><a href="#ARRAYLIBS">ARRAYLIBS</a></code>.  The array must have numeric type.  Its first <code>len(shape)</code> dimensions are the
domain coordinate dimensions.  Each grid dimension must be at least 1 for a <code>dual</code> grid or
at least 2 for a <code>primal</code> grid.</li>
<li><strong>shape:</strong>  The number of grid samples in each coordinate dimension of the output array.  The source
<code>array</code> must have at least as many dimensions as <code>len(shape)</code>.</li>
<li><strong>gridtype:</strong>  Placement of samples on both the source and output domain grids, specified as either
a name in <code><a href="#GRIDTYPES">GRIDTYPES</a></code> or a <code><a href="#Gridtype">Gridtype</a></code> instance.  The default is 'dual'.</li>
<li><strong>src_gridtype:</strong>  Placement of the samples in the source domain grid for each dimension.
Parameters <code>gridtype</code> and <code>src_gridtype</code> cannot both be set.</li>
<li><strong>dst_gridtype:</strong>  Placement of the samples in the output domain grid for each dimension.
Parameters <code>gridtype</code> and <code>dst_gridtype</code> cannot both be set.</li>
<li><strong>boundary:</strong>  The reconstruction boundary rule for each dimension in <code>shape</code>, specified as either
a name in <code><a href="#BOUNDARIES">BOUNDARIES</a></code> or a <code><a href="#Boundary">Boundary</a></code> instance.  The special value 'auto' uses 'reflect'
for upsampling and 'clamp' for downsampling.</li>
<li><strong>cval:</strong>  Constant value used beyond the samples by some boundary rules.  It must be broadcastable
onto <code>array.shape[len(shape):]</code>.</li>
<li><strong>filter:</strong>  The reconstruction kernel for each dimension in <code>shape</code>, specified as either a filter
name in <code><a href="#FILTERS">FILTERS</a></code> or a <code><a href="#Filter">Filter</a></code> instance.  It is used during upsampling (i.e., magnification).</li>
<li><strong>prefilter:</strong>  The prefilter kernel for each dimension in <code>shape</code>, specified as either a filter
name in <code><a href="#FILTERS">FILTERS</a></code> or a <code><a href="#Filter">Filter</a></code> instance.  It is used during downsampling
(i.e., minification).  If None, it inherits the value of <code>filter</code>.</li>
<li><strong>gamma:</strong>  Component transfer functions (e.g., gamma correction) applied when reading samples from
<code>array</code> and when creating output grid samples.  It is specified as either a name in <code><a href="#GAMMAS">GAMMAS</a></code>
or a <code><a href="#Gamma">Gamma</a></code> instance.  If both <code>array.dtype</code> and <code>dtype</code> are <code>uint</code>, the default is <code>power2</code>.
If both are non-<code>uint</code>, the default is <code>identity</code>.  Otherwise, <code>gamma</code> or
<code>src_gamma</code>/<code>dst_gamma</code> must be set.   Gamma correction assumes that float values are in the
range [0.0, 1.0].</li>
<li><strong>src_gamma:</strong>  Component transfer function used to "decode" <code>array</code> samples.
Parameters <code>gamma</code> and <code>src_gamma</code> cannot both be set.</li>
<li><strong>dst_gamma:</strong>  Component transfer function used to "encode" the output samples.
Parameters <code>gamma</code> and <code>dst_gamma</code> cannot both be set.</li>
<li><strong>scale:</strong>  Scaling factor applied to each dimension of the source domain when it is mapped onto
the destination domain.</li>
<li><strong>translate:</strong>  Offset applied to each dimension of the scaled source domain when it is mapped onto
the destination domain.</li>
<li><strong>precision:</strong>  Inexact precision of intermediate computations.  If None, it is determined based
on <code>array.dtype</code> and <code>dtype</code>.</li>
<li><strong>dtype:</strong>  Desired data type of the output array.  If None, it is taken to be <code>array.dtype</code>.
If it is a uint type, the intermediate float values are rescaled from the [0.0, 1.0] range
to the uint range.</li>
<li><strong>dim_order:</strong>  Override the automatically selected order in which the grid dimensions are resized.
Must contain a permutation of <code>range(len(shape))</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>An array of the same class (<code>np.ndarray</code>, <code>tf.Tensor</code>, or <code>torch.Tensor</code>) as the source <code>array</code>,
  with shape <code>shape + array.shape[len(shape):]</code> and data type <code>dtype</code>.</p>
</blockquote>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="n">resize</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">4</span><span class="p">,))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.74240461</span><span class="p">,</span> <span class="mf">2.88088827</span><span class="p">,</span> <span class="mf">4.68647155</span><span class="p">,</span> <span class="mf">5.02641199</span><span class="p">])</span>
</code></pre></div>
</div>


                </section>
                <section id="resize_in_numpy">
                            <input id="resize_in_numpy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">resize_in_numpy</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">array</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="resize_in_numpy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#resize_in_numpy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="resize_in_numpy-2229"><a href="#resize_in_numpy-2229"><span class="linenos">2229</span></a><span class="k">def</span> <span class="nf">resize_in_numpy</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="resize_in_numpy-2230"><a href="#resize_in_numpy-2230"><span class="linenos">2230</span></a>  <span class="sd">&quot;&quot;&quot;Just like `resize()` but asserts that the source is a numpy array.&quot;&quot;&quot;</span>
</span><span id="resize_in_numpy-2231"><a href="#resize_in_numpy-2231"><span class="linenos">2231</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="n">_arr_arraylib</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span>
</span><span id="resize_in_numpy-2232"><a href="#resize_in_numpy-2232"><span class="linenos">2232</span></a>  <span class="k">return</span> <span class="n">_original_resize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Just like <code><a href="#resize">resize()</a></code> but asserts that the source is a numpy array.</p>
</div>


                </section>
                <section id="resize_in_tensorflow">
                            <input id="resize_in_tensorflow-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">resize_in_tensorflow</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">array</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="resize_in_tensorflow-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#resize_in_tensorflow"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="resize_in_tensorflow-2235"><a href="#resize_in_tensorflow-2235"><span class="linenos">2235</span></a><span class="k">def</span> <span class="nf">resize_in_tensorflow</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="resize_in_tensorflow-2236"><a href="#resize_in_tensorflow-2236"><span class="linenos">2236</span></a>  <span class="sd">&quot;&quot;&quot;Evaluate the `resize()` operation using Tensorflow&#39;s Tensor representation and operations.</span>
</span><span id="resize_in_tensorflow-2237"><a href="#resize_in_tensorflow-2237"><span class="linenos">2237</span></a>
</span><span id="resize_in_tensorflow-2238"><a href="#resize_in_tensorflow-2238"><span class="linenos">2238</span></a><span class="sd">  Args:</span>
</span><span id="resize_in_tensorflow-2239"><a href="#resize_in_tensorflow-2239"><span class="linenos">2239</span></a><span class="sd">    array: Grid of source samples, represented as a numpy array.</span>
</span><span id="resize_in_tensorflow-2240"><a href="#resize_in_tensorflow-2240"><span class="linenos">2240</span></a><span class="sd">    *args: Parameters for `resize()`.</span>
</span><span id="resize_in_tensorflow-2241"><a href="#resize_in_tensorflow-2241"><span class="linenos">2241</span></a><span class="sd">    **kwargs: Parameters for `resize()`.</span>
</span><span id="resize_in_tensorflow-2242"><a href="#resize_in_tensorflow-2242"><span class="linenos">2242</span></a>
</span><span id="resize_in_tensorflow-2243"><a href="#resize_in_tensorflow-2243"><span class="linenos">2243</span></a><span class="sd">  Returns:</span>
</span><span id="resize_in_tensorflow-2244"><a href="#resize_in_tensorflow-2244"><span class="linenos">2244</span></a><span class="sd">    A numpy array.</span>
</span><span id="resize_in_tensorflow-2245"><a href="#resize_in_tensorflow-2245"><span class="linenos">2245</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="resize_in_tensorflow-2246"><a href="#resize_in_tensorflow-2246"><span class="linenos">2246</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="n">_arr_arraylib</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span>
</span><span id="resize_in_tensorflow-2247"><a href="#resize_in_tensorflow-2247"><span class="linenos">2247</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">_make_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">arraylib</span><span class="o">=</span><span class="s1">&#39;tensorflow&#39;</span><span class="p">)</span>
</span><span id="resize_in_tensorflow-2248"><a href="#resize_in_tensorflow-2248"><span class="linenos">2248</span></a>  <span class="k">return</span> <span class="n">_original_resize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Evaluate the <code><a href="#resize">resize()</a></code> operation using Tensorflow's Tensor representation and operations.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>array:</strong>  Grid of source samples, represented as a numpy array.</li>
<li><strong>*args:</strong>  Parameters for <code><a href="#resize">resize()</a></code>.</li>
<li><strong>**kwargs:</strong>  Parameters for <code><a href="#resize">resize()</a></code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A numpy array.</p>
</blockquote>
</div>


                </section>
                <section id="resize_in_torch">
                            <input id="resize_in_torch-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">resize_in_torch</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">array</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="resize_in_torch-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#resize_in_torch"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="resize_in_torch-2251"><a href="#resize_in_torch-2251"><span class="linenos">2251</span></a><span class="k">def</span> <span class="nf">resize_in_torch</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="resize_in_torch-2252"><a href="#resize_in_torch-2252"><span class="linenos">2252</span></a>  <span class="sd">&quot;&quot;&quot;Evaluate the `resize()` operation using Torch&#39;s Tensor representation and operations.</span>
</span><span id="resize_in_torch-2253"><a href="#resize_in_torch-2253"><span class="linenos">2253</span></a>
</span><span id="resize_in_torch-2254"><a href="#resize_in_torch-2254"><span class="linenos">2254</span></a><span class="sd">  Args:</span>
</span><span id="resize_in_torch-2255"><a href="#resize_in_torch-2255"><span class="linenos">2255</span></a><span class="sd">    array: Grid of source samples, represented as a numpy array.</span>
</span><span id="resize_in_torch-2256"><a href="#resize_in_torch-2256"><span class="linenos">2256</span></a><span class="sd">    *args: Parameters for `resize()`.</span>
</span><span id="resize_in_torch-2257"><a href="#resize_in_torch-2257"><span class="linenos">2257</span></a><span class="sd">    **kwargs: Parameters for `resize()`.</span>
</span><span id="resize_in_torch-2258"><a href="#resize_in_torch-2258"><span class="linenos">2258</span></a>
</span><span id="resize_in_torch-2259"><a href="#resize_in_torch-2259"><span class="linenos">2259</span></a><span class="sd">  Returns:</span>
</span><span id="resize_in_torch-2260"><a href="#resize_in_torch-2260"><span class="linenos">2260</span></a><span class="sd">    A numpy array.</span>
</span><span id="resize_in_torch-2261"><a href="#resize_in_torch-2261"><span class="linenos">2261</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="resize_in_torch-2262"><a href="#resize_in_torch-2262"><span class="linenos">2262</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="n">_arr_arraylib</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="s1">&#39;numpy&#39;</span><span class="p">)</span>
</span><span id="resize_in_torch-2263"><a href="#resize_in_torch-2263"><span class="linenos">2263</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">_make_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">arraylib</span><span class="o">=</span><span class="s1">&#39;torch&#39;</span><span class="p">)</span>
</span><span id="resize_in_torch-2264"><a href="#resize_in_torch-2264"><span class="linenos">2264</span></a>  <span class="k">return</span> <span class="n">_original_resize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Evaluate the <code><a href="#resize">resize()</a></code> operation using Torch's Tensor representation and operations.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>array:</strong>  Grid of source samples, represented as a numpy array.</li>
<li><strong>*args:</strong>  Parameters for <code><a href="#resize">resize()</a></code>.</li>
<li><strong>**kwargs:</strong>  Parameters for <code><a href="#resize">resize()</a></code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A numpy array.</p>
</blockquote>
</div>


                </section>
                <section id="resample">
                            <input id="resample-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">resample</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">array</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">coords</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gridtype">resampler.Gridtype</a></span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gridtype">resampler.Gridtype</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;dual&#39;</span>,</span><span class="param">	<span class="n">boundary</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Boundary">resampler.Boundary</a></span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Boundary">resampler.Boundary</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span>,</span><span class="param">	<span class="n">cval</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="nb">filter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Filter">resampler.Filter</a></span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Filter">resampler.Filter</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;lanczos3&#39;</span>,</span><span class="param">	<span class="n">prefilter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Filter">resampler.Filter</a></span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Filter">resampler.Filter</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gamma">resampler.Gamma</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">src_gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gamma">resampler.Gamma</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dst_gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gamma">resampler.Gamma</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">jacobian</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">precision</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">max_block_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40000</span>,</span><span class="param">	<span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="resample-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#resample"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="resample-2270"><a href="#resample-2270"><span class="linenos">2270</span></a><span class="k">def</span> <span class="nf">resample</span><span class="p">(</span>                   <span class="c1"># pylint: disable=too-many-branches disable=too-many-statements</span>
</span><span id="resample-2271"><a href="#resample-2271"><span class="linenos">2271</span></a>    <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span>
</span><span id="resample-2272"><a href="#resample-2272"><span class="linenos">2272</span></a>    <span class="n">coords</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="resample-2273"><a href="#resample-2273"><span class="linenos">2273</span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="resample-2274"><a href="#resample-2274"><span class="linenos">2274</span></a>    <span class="n">gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;dual&#39;</span><span class="p">,</span>
</span><span id="resample-2275"><a href="#resample-2275"><span class="linenos">2275</span></a>    <span class="n">boundary</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Boundary</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Boundary</span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;auto&#39;</span><span class="p">,</span>
</span><span id="resample-2276"><a href="#resample-2276"><span class="linenos">2276</span></a>    <span class="n">cval</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="resample-2277"><a href="#resample-2277"><span class="linenos">2277</span></a>    <span class="nb">filter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;lanczos3&#39;</span><span class="p">,</span>
</span><span id="resample-2278"><a href="#resample-2278"><span class="linenos">2278</span></a>    <span class="n">prefilter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resample-2279"><a href="#resample-2279"><span class="linenos">2279</span></a>    <span class="n">gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resample-2280"><a href="#resample-2280"><span class="linenos">2280</span></a>    <span class="n">src_gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resample-2281"><a href="#resample-2281"><span class="linenos">2281</span></a>    <span class="n">dst_gamma</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resample-2282"><a href="#resample-2282"><span class="linenos">2282</span></a>    <span class="n">jacobian</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resample-2283"><a href="#resample-2283"><span class="linenos">2283</span></a>    <span class="n">precision</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resample-2284"><a href="#resample-2284"><span class="linenos">2284</span></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resample-2285"><a href="#resample-2285"><span class="linenos">2285</span></a>    <span class="n">max_block_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">40_000</span><span class="p">,</span>
</span><span id="resample-2286"><a href="#resample-2286"><span class="linenos">2286</span></a>    <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="resample-2287"><a href="#resample-2287"><span class="linenos">2287</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="resample-2288"><a href="#resample-2288"><span class="linenos">2288</span></a>  <span class="sd">&quot;&quot;&quot;Interpolate a grid of source samples at specified unit-domain coordinates.</span>
</span><span id="resample-2289"><a href="#resample-2289"><span class="linenos">2289</span></a>
</span><span id="resample-2290"><a href="#resample-2290"><span class="linenos">2290</span></a><span class="sd">  The last dimension of `coords` contains unit-domain coordinates at which to interpolate the</span>
</span><span id="resample-2291"><a href="#resample-2291"><span class="linenos">2291</span></a><span class="sd">  domain grid samples in `array`.</span>
</span><span id="resample-2292"><a href="#resample-2292"><span class="linenos">2292</span></a>
</span><span id="resample-2293"><a href="#resample-2293"><span class="linenos">2293</span></a><span class="sd">  The number of coordinates (`coords.shape[-1]`) determines how to interpret `array`: its first</span>
</span><span id="resample-2294"><a href="#resample-2294"><span class="linenos">2294</span></a><span class="sd">  `coords.shape[-1]` dimensions define the grid, and the remaining dimensions describe each grid</span>
</span><span id="resample-2295"><a href="#resample-2295"><span class="linenos">2295</span></a><span class="sd">  sample (scalar, vector, tensor).</span>
</span><span id="resample-2296"><a href="#resample-2296"><span class="linenos">2296</span></a>
</span><span id="resample-2297"><a href="#resample-2297"><span class="linenos">2297</span></a><span class="sd">  Concretely, the grid has shape `array.shape[:coords.shape[-1]]` and each grid sample has shape</span>
</span><span id="resample-2298"><a href="#resample-2298"><span class="linenos">2298</span></a><span class="sd">  `array.shape[coords.shape[-1]:]`.</span>
</span><span id="resample-2299"><a href="#resample-2299"><span class="linenos">2299</span></a>
</span><span id="resample-2300"><a href="#resample-2300"><span class="linenos">2300</span></a><span class="sd">  Examples include:</span>
</span><span id="resample-2301"><a href="#resample-2301"><span class="linenos">2301</span></a>
</span><span id="resample-2302"><a href="#resample-2302"><span class="linenos">2302</span></a><span class="sd">  - Resample a grayscale image with `array.shape = height, width` onto a new grayscale image with</span>
</span><span id="resample-2303"><a href="#resample-2303"><span class="linenos">2303</span></a><span class="sd">    `new.shape = height2, width2` by using `coords.shape = height2, width2, 2`.</span>
</span><span id="resample-2304"><a href="#resample-2304"><span class="linenos">2304</span></a>
</span><span id="resample-2305"><a href="#resample-2305"><span class="linenos">2305</span></a><span class="sd">  - Resample an RGB image with `array.shape = height, width, 3` onto a new RGB image with</span>
</span><span id="resample-2306"><a href="#resample-2306"><span class="linenos">2306</span></a><span class="sd">    `new.shape = height2, width2, 3` by using `coords.shape = height2, width2, 2`.</span>
</span><span id="resample-2307"><a href="#resample-2307"><span class="linenos">2307</span></a>
</span><span id="resample-2308"><a href="#resample-2308"><span class="linenos">2308</span></a><span class="sd">  - Sample an RGB image at `num` 2D points along a line segment by using `coords.shape = num, 2`.</span>
</span><span id="resample-2309"><a href="#resample-2309"><span class="linenos">2309</span></a>
</span><span id="resample-2310"><a href="#resample-2310"><span class="linenos">2310</span></a><span class="sd">  - Sample an RGB image at a single 2D point by using `coords.shape = (2,)`.</span>
</span><span id="resample-2311"><a href="#resample-2311"><span class="linenos">2311</span></a>
</span><span id="resample-2312"><a href="#resample-2312"><span class="linenos">2312</span></a><span class="sd">  - Sample a 3D grid of 3x3 Jacobians with `array.shape = nz, ny, nx, 3, 3` along a 2D plane by</span>
</span><span id="resample-2313"><a href="#resample-2313"><span class="linenos">2313</span></a><span class="sd">    using `coords.shape = height, width, 3`.</span>
</span><span id="resample-2314"><a href="#resample-2314"><span class="linenos">2314</span></a>
</span><span id="resample-2315"><a href="#resample-2315"><span class="linenos">2315</span></a><span class="sd">  - Map a grayscale image through a color map by using `array.shape = 256, 3` and</span>
</span><span id="resample-2316"><a href="#resample-2316"><span class="linenos">2316</span></a><span class="sd">    `coords.shape = height, width`.</span>
</span><span id="resample-2317"><a href="#resample-2317"><span class="linenos">2317</span></a>
</span><span id="resample-2318"><a href="#resample-2318"><span class="linenos">2318</span></a><span class="sd">  Args:</span>
</span><span id="resample-2319"><a href="#resample-2319"><span class="linenos">2319</span></a><span class="sd">    array: Grid of source sample values.  It must be an array-like object from a library in</span>
</span><span id="resample-2320"><a href="#resample-2320"><span class="linenos">2320</span></a><span class="sd">      `ARRAYLIBS`.  The array must have numeric type.  The coordinate dimensions appear first, and</span>
</span><span id="resample-2321"><a href="#resample-2321"><span class="linenos">2321</span></a><span class="sd">      each grid sample may have an arbitrary shape.  Each grid dimension must be at least 1 for</span>
</span><span id="resample-2322"><a href="#resample-2322"><span class="linenos">2322</span></a><span class="sd">      a `dual` grid or at least 2 for a `primal` grid.</span>
</span><span id="resample-2323"><a href="#resample-2323"><span class="linenos">2323</span></a><span class="sd">    coords: Grid of points at which to resample `array`.  The point coordinates are in the last</span>
</span><span id="resample-2324"><a href="#resample-2324"><span class="linenos">2324</span></a><span class="sd">      dimension of `coords`.  The domain associated with the source grid is a unit hypercube,</span>
</span><span id="resample-2325"><a href="#resample-2325"><span class="linenos">2325</span></a><span class="sd">      i.e. with a range [0, 1] on each coordinate dimension.  The output grid has shape</span>
</span><span id="resample-2326"><a href="#resample-2326"><span class="linenos">2326</span></a><span class="sd">      `coords.shape[:-1]` and each of its grid samples has shape `array.shape[coords.shape[-1]:]`.</span>
</span><span id="resample-2327"><a href="#resample-2327"><span class="linenos">2327</span></a><span class="sd">    gridtype: Placement of the samples in the source domain grid for each dimension, specified as</span>
</span><span id="resample-2328"><a href="#resample-2328"><span class="linenos">2328</span></a><span class="sd">      either a name in `GRIDTYPES` or a `Gridtype` instance.</span>
</span><span id="resample-2329"><a href="#resample-2329"><span class="linenos">2329</span></a><span class="sd">    boundary: The reconstruction boundary rule for each dimension in `coords.shape[-1]`, specified</span>
</span><span id="resample-2330"><a href="#resample-2330"><span class="linenos">2330</span></a><span class="sd">      as either a name in `BOUNDARIES` or a `Boundary` instance.  The special value &#39;auto&#39; uses</span>
</span><span id="resample-2331"><a href="#resample-2331"><span class="linenos">2331</span></a><span class="sd">      &#39;reflect&#39; for upsampling and &#39;clamp&#39; for downsampling.</span>
</span><span id="resample-2332"><a href="#resample-2332"><span class="linenos">2332</span></a><span class="sd">    cval: Constant value used beyond the samples by some boundary rules.  It must be broadcastable</span>
</span><span id="resample-2333"><a href="#resample-2333"><span class="linenos">2333</span></a><span class="sd">      onto the shape `array.shape[coords.shape[-1]:]`.</span>
</span><span id="resample-2334"><a href="#resample-2334"><span class="linenos">2334</span></a><span class="sd">    filter: The reconstruction kernel for each dimension in `coords.shape[-1]`, specified as either</span>
</span><span id="resample-2335"><a href="#resample-2335"><span class="linenos">2335</span></a><span class="sd">      a filter name in `FILTERS` or a `Filter` instance.</span>
</span><span id="resample-2336"><a href="#resample-2336"><span class="linenos">2336</span></a><span class="sd">    prefilter: The prefilter kernel for each dimension in `coords.shape[:-1]`, specified as either</span>
</span><span id="resample-2337"><a href="#resample-2337"><span class="linenos">2337</span></a><span class="sd">      a filter name in `FILTERS` or a `Filter` instance.  It is used during downsampling</span>
</span><span id="resample-2338"><a href="#resample-2338"><span class="linenos">2338</span></a><span class="sd">      (i.e., minification).  If None, it inherits the value of `filter`.</span>
</span><span id="resample-2339"><a href="#resample-2339"><span class="linenos">2339</span></a><span class="sd">    gamma: Component transfer functions (e.g., gamma correction) applied when reading samples</span>
</span><span id="resample-2340"><a href="#resample-2340"><span class="linenos">2340</span></a><span class="sd">      from `array` and when creating output grid samples.  It is specified as either a name in</span>
</span><span id="resample-2341"><a href="#resample-2341"><span class="linenos">2341</span></a><span class="sd">      `GAMMAS` or a `Gamma` instance.  If both `array.dtype` and `dtype` are `uint`, the default</span>
</span><span id="resample-2342"><a href="#resample-2342"><span class="linenos">2342</span></a><span class="sd">      is `power2`.  If both are non-`uint`, the default is `identity`.  Otherwise, `gamma` or</span>
</span><span id="resample-2343"><a href="#resample-2343"><span class="linenos">2343</span></a><span class="sd">      `src_gamma`/`dst_gamma` must be set.   Gamma correction assumes that float values are in the</span>
</span><span id="resample-2344"><a href="#resample-2344"><span class="linenos">2344</span></a><span class="sd">      range [0.0, 1.0].</span>
</span><span id="resample-2345"><a href="#resample-2345"><span class="linenos">2345</span></a><span class="sd">    src_gamma: Component transfer function used to &quot;decode&quot; `array` samples.</span>
</span><span id="resample-2346"><a href="#resample-2346"><span class="linenos">2346</span></a><span class="sd">      Parameters `gamma` and `src_gamma` cannot both be set.</span>
</span><span id="resample-2347"><a href="#resample-2347"><span class="linenos">2347</span></a><span class="sd">    dst_gamma: Component transfer function used to &quot;encode&quot; the output samples.</span>
</span><span id="resample-2348"><a href="#resample-2348"><span class="linenos">2348</span></a><span class="sd">      Parameters `gamma` and `dst_gamma` cannot both be set.</span>
</span><span id="resample-2349"><a href="#resample-2349"><span class="linenos">2349</span></a><span class="sd">    jacobian: Optional array, which must be broadcastable onto the shape</span>
</span><span id="resample-2350"><a href="#resample-2350"><span class="linenos">2350</span></a><span class="sd">      `coords.shape[:-1] + (coords.shape[-1], coords.shape[-1])`, storing for each point in the</span>
</span><span id="resample-2351"><a href="#resample-2351"><span class="linenos">2351</span></a><span class="sd">      output grid the Jacobian matrix of the map from the unit output domain to the unit source</span>
</span><span id="resample-2352"><a href="#resample-2352"><span class="linenos">2352</span></a><span class="sd">      domain.  If omitted, it is estimated by computing finite differences on `coords`.</span>
</span><span id="resample-2353"><a href="#resample-2353"><span class="linenos">2353</span></a><span class="sd">    precision: Inexact precision of intermediate computations.  If None, it is determined based on</span>
</span><span id="resample-2354"><a href="#resample-2354"><span class="linenos">2354</span></a><span class="sd">      `array.dtype`, `coords.dtype`, and `dtype`.</span>
</span><span id="resample-2355"><a href="#resample-2355"><span class="linenos">2355</span></a><span class="sd">    dtype: Desired data type of the output array.  If None, it is taken to be `array.dtype`.</span>
</span><span id="resample-2356"><a href="#resample-2356"><span class="linenos">2356</span></a><span class="sd">      If it is a uint type, the intermediate float values are rescaled from the [0.0, 1.0] range</span>
</span><span id="resample-2357"><a href="#resample-2357"><span class="linenos">2357</span></a><span class="sd">      to the uint range.</span>
</span><span id="resample-2358"><a href="#resample-2358"><span class="linenos">2358</span></a><span class="sd">    max_block_size: If nonzero, maximum number of grid points in `coords` before the resampling</span>
</span><span id="resample-2359"><a href="#resample-2359"><span class="linenos">2359</span></a><span class="sd">      evaluation gets partitioned into smaller blocks for reduced memory usage and better caching.</span>
</span><span id="resample-2360"><a href="#resample-2360"><span class="linenos">2360</span></a><span class="sd">    debug: Show internal information.</span>
</span><span id="resample-2361"><a href="#resample-2361"><span class="linenos">2361</span></a>
</span><span id="resample-2362"><a href="#resample-2362"><span class="linenos">2362</span></a><span class="sd">  Returns:</span>
</span><span id="resample-2363"><a href="#resample-2363"><span class="linenos">2363</span></a><span class="sd">    A new sample grid of shape `coords.shape[:-1]`, represented as an array of shape</span>
</span><span id="resample-2364"><a href="#resample-2364"><span class="linenos">2364</span></a><span class="sd">    `coords.shape[:-1] + array.shape[coords.shape[-1]:]`, of the same array library type as</span>
</span><span id="resample-2365"><a href="#resample-2365"><span class="linenos">2365</span></a><span class="sd">    the source array.</span>
</span><span id="resample-2366"><a href="#resample-2366"><span class="linenos">2366</span></a>
</span><span id="resample-2367"><a href="#resample-2367"><span class="linenos">2367</span></a><span class="sd">  For reference, the identity resampling for a scalar-valued grid with the default grid-type</span>
</span><span id="resample-2368"><a href="#resample-2368"><span class="linenos">2368</span></a><span class="sd">  &#39;dual&#39; is:</span>
</span><span id="resample-2369"><a href="#resample-2369"><span class="linenos">2369</span></a>
</span><span id="resample-2370"><a href="#resample-2370"><span class="linenos">2370</span></a><span class="sd">  &gt;&gt;&gt; array = np.random.rand(5, 7, 3)</span>
</span><span id="resample-2371"><a href="#resample-2371"><span class="linenos">2371</span></a><span class="sd">  &gt;&gt;&gt; coords = (np.moveaxis(np.indices(array.shape), 0, -1) + 0.5) / array.shape</span>
</span><span id="resample-2372"><a href="#resample-2372"><span class="linenos">2372</span></a><span class="sd">  &gt;&gt;&gt; new_array = resample(array, coords)</span>
</span><span id="resample-2373"><a href="#resample-2373"><span class="linenos">2373</span></a><span class="sd">  &gt;&gt;&gt; assert np.allclose(new_array, array)</span>
</span><span id="resample-2374"><a href="#resample-2374"><span class="linenos">2374</span></a>
</span><span id="resample-2375"><a href="#resample-2375"><span class="linenos">2375</span></a><span class="sd">  It is more efficient to use the function `resize` for the special case where the `coords` are</span>
</span><span id="resample-2376"><a href="#resample-2376"><span class="linenos">2376</span></a><span class="sd">  obtained as simple scaling and translation of a new regular grid over the source domain:</span>
</span><span id="resample-2377"><a href="#resample-2377"><span class="linenos">2377</span></a>
</span><span id="resample-2378"><a href="#resample-2378"><span class="linenos">2378</span></a><span class="sd">  &gt;&gt;&gt; scale, translate, new_shape = (1.1, 1.2), (0.1, -0.2), (6, 8)</span>
</span><span id="resample-2379"><a href="#resample-2379"><span class="linenos">2379</span></a><span class="sd">  &gt;&gt;&gt; coords = (np.moveaxis(np.indices(new_shape), 0, -1) + 0.5) / new_shape</span>
</span><span id="resample-2380"><a href="#resample-2380"><span class="linenos">2380</span></a><span class="sd">  &gt;&gt;&gt; coords = (coords - translate) / scale</span>
</span><span id="resample-2381"><a href="#resample-2381"><span class="linenos">2381</span></a><span class="sd">  &gt;&gt;&gt; resampled = resample(array, coords)</span>
</span><span id="resample-2382"><a href="#resample-2382"><span class="linenos">2382</span></a><span class="sd">  &gt;&gt;&gt; resized = resize(array, new_shape, scale=scale, translate=translate)</span>
</span><span id="resample-2383"><a href="#resample-2383"><span class="linenos">2383</span></a><span class="sd">  &gt;&gt;&gt; assert np.allclose(resampled, resized)</span>
</span><span id="resample-2384"><a href="#resample-2384"><span class="linenos">2384</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="resample-2385"><a href="#resample-2385"><span class="linenos">2385</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span><span id="resample-2386"><a href="#resample-2386"><span class="linenos">2386</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="resample-2387"><a href="#resample-2387"><span class="linenos">2387</span></a>  <span class="n">arraylib</span> <span class="o">=</span> <span class="n">_arr_arraylib</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="resample-2388"><a href="#resample-2388"><span class="linenos">2388</span></a>  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="resample-2389"><a href="#resample-2389"><span class="linenos">2389</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="kc">None</span><span class="p">]</span>
</span><span id="resample-2390"><a href="#resample-2390"><span class="linenos">2390</span></a>  <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
</span><span id="resample-2391"><a href="#resample-2391"><span class="linenos">2391</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">):</span>
</span><span id="resample-2392"><a href="#resample-2392"><span class="linenos">2392</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Type </span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s1"> is not numeric.&#39;</span><span class="p">)</span>
</span><span id="resample-2393"><a href="#resample-2393"><span class="linenos">2393</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">):</span>
</span><span id="resample-2394"><a href="#resample-2394"><span class="linenos">2394</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Type </span><span class="si">{</span><span class="n">coords</span><span class="o">.</span><span class="n">dtype</span><span class="si">}</span><span class="s1"> is not floating.&#39;</span><span class="p">)</span>
</span><span id="resample-2395"><a href="#resample-2395"><span class="linenos">2395</span></a>  <span class="n">array_ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="resample-2396"><a href="#resample-2396"><span class="linenos">2396</span></a>  <span class="k">if</span> <span class="n">coords</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">array_ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="resample-2397"><a href="#resample-2397"><span class="linenos">2397</span></a>    <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="resample-2398"><a href="#resample-2398"><span class="linenos">2398</span></a>  <span class="n">grid_ndim</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="resample-2399"><a href="#resample-2399"><span class="linenos">2399</span></a>  <span class="n">grid_shape</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="n">grid_ndim</span><span class="p">]</span>
</span><span id="resample-2400"><a href="#resample-2400"><span class="linenos">2400</span></a>  <span class="n">sample_shape</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">grid_ndim</span><span class="p">:]</span>
</span><span id="resample-2401"><a href="#resample-2401"><span class="linenos">2401</span></a>  <span class="n">resampled_ndim</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="resample-2402"><a href="#resample-2402"><span class="linenos">2402</span></a>  <span class="n">resampled_shape</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="resample-2403"><a href="#resample-2403"><span class="linenos">2403</span></a>  <span class="k">if</span> <span class="n">grid_ndim</span> <span class="o">&gt;</span> <span class="n">array_ndim</span><span class="p">:</span>
</span><span id="resample-2404"><a href="#resample-2404"><span class="linenos">2404</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are more coordinate dimensions (</span><span class="si">{</span><span class="n">grid_ndim</span><span class="si">}</span><span class="s1">) in&#39;</span>
</span><span id="resample-2405"><a href="#resample-2405"><span class="linenos">2405</span></a>                     <span class="sa">f</span><span class="s1">&#39; coords </span><span class="si">{</span><span class="n">coords</span><span class="si">}</span><span class="s1"> than in array.shape </span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="resample-2406"><a href="#resample-2406"><span class="linenos">2406</span></a>  <span class="n">gridtype2</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">)</span> <span class="k">else</span> <span class="n">GRIDTYPES</span><span class="p">[</span><span class="n">g</span><span class="p">]</span>
</span><span id="resample-2407"><a href="#resample-2407"><span class="linenos">2407</span></a>               <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gridtype</span><span class="p">),</span> <span class="n">grid_ndim</span><span class="p">)]</span>
</span><span id="resample-2408"><a href="#resample-2408"><span class="linenos">2408</span></a>  <span class="n">boundary2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">boundary</span><span class="p">),</span> <span class="n">grid_ndim</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="resample-2409"><a href="#resample-2409"><span class="linenos">2409</span></a>  <span class="n">cval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">cval</span><span class="p">,</span> <span class="n">sample_shape</span><span class="p">)</span>
</span><span id="resample-2410"><a href="#resample-2410"><span class="linenos">2410</span></a>  <span class="n">prefilter</span> <span class="o">=</span> <span class="nb">filter</span> <span class="k">if</span> <span class="n">prefilter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">prefilter</span>
</span><span id="resample-2411"><a href="#resample-2411"><span class="linenos">2411</span></a>  <span class="n">filter2</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_filter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">filter</span><span class="p">),</span> <span class="n">grid_ndim</span><span class="p">)]</span>
</span><span id="resample-2412"><a href="#resample-2412"><span class="linenos">2412</span></a>  <span class="n">prefilter2</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_filter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">prefilter</span><span class="p">),</span> <span class="n">resampled_ndim</span><span class="p">)]</span>
</span><span id="resample-2413"><a href="#resample-2413"><span class="linenos">2413</span></a>  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="resample-2414"><a href="#resample-2414"><span class="linenos">2414</span></a>  <span class="n">src_gamma2</span><span class="p">,</span> <span class="n">dst_gamma2</span> <span class="o">=</span> <span class="n">_get_src_dst_gamma</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span> <span class="n">src_gamma</span><span class="p">,</span> <span class="n">dst_gamma</span><span class="p">,</span> <span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="resample-2415"><a href="#resample-2415"><span class="linenos">2415</span></a>  <span class="k">del</span> <span class="n">gridtype</span><span class="p">,</span> <span class="n">boundary</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">prefilter</span><span class="p">,</span> <span class="n">src_gamma</span><span class="p">,</span> <span class="n">dst_gamma</span>
</span><span id="resample-2416"><a href="#resample-2416"><span class="linenos">2416</span></a>  <span class="k">if</span> <span class="n">jacobian</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="resample-2417"><a href="#resample-2417"><span class="linenos">2417</span></a>    <span class="n">jacobian</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">jacobian</span><span class="p">,</span> <span class="n">resampled_shape</span> <span class="o">+</span> <span class="p">(</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="resample-2418"><a href="#resample-2418"><span class="linenos">2418</span></a>  <span class="n">precision</span> <span class="o">=</span> <span class="n">_get_precision</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="p">[</span><span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">dtype</span><span class="p">],</span> <span class="p">[</span><span class="n">coords</span><span class="o">.</span><span class="n">dtype</span><span class="p">])</span>
</span><span id="resample-2419"><a href="#resample-2419"><span class="linenos">2419</span></a>  <span class="n">weight_precision</span> <span class="o">=</span> <span class="n">_real_precision</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span>
</span><span id="resample-2420"><a href="#resample-2420"><span class="linenos">2420</span></a>  <span class="n">coords</span> <span class="o">=</span> <span class="n">coords</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">weight_precision</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="resample-2421"><a href="#resample-2421"><span class="linenos">2421</span></a>  <span class="n">is_minification</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Current limitation; no prefiltering!</span>
</span><span id="resample-2422"><a href="#resample-2422"><span class="linenos">2422</span></a>  <span class="k">assert</span> <span class="n">max_block_size</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">max_block_size</span> <span class="o">==</span> <span class="n">_MAX_BLOCK_SIZE_RECURSING</span>
</span><span id="resample-2423"><a href="#resample-2423"><span class="linenos">2423</span></a>  <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_ndim</span><span class="p">):</span>
</span><span id="resample-2424"><a href="#resample-2424"><span class="linenos">2424</span></a>    <span class="k">if</span> <span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;auto&#39;</span><span class="p">:</span>
</span><span id="resample-2425"><a href="#resample-2425"><span class="linenos">2425</span></a>      <span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;clamp&#39;</span> <span class="k">if</span> <span class="n">is_minification</span> <span class="k">else</span> <span class="s1">&#39;reflect&#39;</span>
</span><span id="resample-2426"><a href="#resample-2426"><span class="linenos">2426</span></a>    <span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">Boundary</span><span class="p">)</span> <span class="k">else</span>
</span><span id="resample-2427"><a href="#resample-2427"><span class="linenos">2427</span></a>                      <span class="n">BOUNDARIES</span><span class="p">[</span><span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">]])</span>
</span><span id="resample-2428"><a href="#resample-2428"><span class="linenos">2428</span></a>
</span><span id="resample-2429"><a href="#resample-2429"><span class="linenos">2429</span></a>  <span class="k">if</span> <span class="n">max_block_size</span> <span class="o">!=</span> <span class="n">_MAX_BLOCK_SIZE_RECURSING</span><span class="p">:</span>
</span><span id="resample-2430"><a href="#resample-2430"><span class="linenos">2430</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">src_gamma2</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">precision</span><span class="p">)</span>
</span><span id="resample-2431"><a href="#resample-2431"><span class="linenos">2431</span></a>    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_ndim</span><span class="p">):</span>
</span><span id="resample-2432"><a href="#resample-2432"><span class="linenos">2432</span></a>      <span class="k">assert</span> <span class="ow">not</span> <span class="n">is_minification</span>
</span><span id="resample-2433"><a href="#resample-2433"><span class="linenos">2433</span></a>      <span class="n">array</span> <span class="o">=</span> <span class="n">_apply_potential_digital_filter_1d</span><span class="p">(</span>
</span><span id="resample-2434"><a href="#resample-2434"><span class="linenos">2434</span></a>          <span class="n">array</span><span class="p">,</span> <span class="n">gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">cval</span><span class="p">,</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="n">dim</span><span class="p">)</span>
</span><span id="resample-2435"><a href="#resample-2435"><span class="linenos">2435</span></a>
</span><span id="resample-2436"><a href="#resample-2436"><span class="linenos">2436</span></a>  <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">resampled_shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_block_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="resample-2437"><a href="#resample-2437"><span class="linenos">2437</span></a>    <span class="n">block_shape</span> <span class="o">=</span> <span class="n">_block_shape_with_min_size</span><span class="p">(</span><span class="n">resampled_shape</span><span class="p">,</span> <span class="n">max_block_size</span><span class="p">)</span>
</span><span id="resample-2438"><a href="#resample-2438"><span class="linenos">2438</span></a>    <span class="k">if</span> <span class="n">debug</span><span class="p">:</span>
</span><span id="resample-2439"><a href="#resample-2439"><span class="linenos">2439</span></a>      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;(resample: splitting coords into blocks </span><span class="si">{</span><span class="n">block_shape</span><span class="si">}</span><span class="s1">).&#39;</span><span class="p">)</span>
</span><span id="resample-2440"><a href="#resample-2440"><span class="linenos">2440</span></a>    <span class="n">coord_blocks</span> <span class="o">=</span> <span class="n">_split_array_into_blocks</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">block_shape</span><span class="p">)</span>
</span><span id="resample-2441"><a href="#resample-2441"><span class="linenos">2441</span></a>
</span><span id="resample-2442"><a href="#resample-2442"><span class="linenos">2442</span></a>    <span class="k">def</span> <span class="nf">process_block</span><span class="p">(</span><span class="n">coord_block</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="resample-2443"><a href="#resample-2443"><span class="linenos">2443</span></a>      <span class="k">return</span> <span class="n">resample</span><span class="p">(</span>
</span><span id="resample-2444"><a href="#resample-2444"><span class="linenos">2444</span></a>          <span class="n">array</span><span class="p">,</span> <span class="n">coord_block</span><span class="p">,</span> <span class="n">gridtype</span><span class="o">=</span><span class="n">gridtype2</span><span class="p">,</span> <span class="n">boundary</span><span class="o">=</span><span class="n">boundary2</span><span class="p">,</span> <span class="n">cval</span><span class="o">=</span><span class="n">cval</span><span class="p">,</span>
</span><span id="resample-2445"><a href="#resample-2445"><span class="linenos">2445</span></a>          <span class="nb">filter</span><span class="o">=</span><span class="n">filter2</span><span class="p">,</span> <span class="n">prefilter</span><span class="o">=</span><span class="n">prefilter2</span><span class="p">,</span> <span class="n">src_gamma</span><span class="o">=</span><span class="s1">&#39;identity&#39;</span><span class="p">,</span> <span class="n">dst_gamma</span><span class="o">=</span><span class="n">dst_gamma2</span><span class="p">,</span>
</span><span id="resample-2446"><a href="#resample-2446"><span class="linenos">2446</span></a>          <span class="n">jacobian</span><span class="o">=</span><span class="n">jacobian</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
</span><span id="resample-2447"><a href="#resample-2447"><span class="linenos">2447</span></a>          <span class="n">max_block_size</span><span class="o">=</span><span class="n">_MAX_BLOCK_SIZE_RECURSING</span><span class="p">)</span>
</span><span id="resample-2448"><a href="#resample-2448"><span class="linenos">2448</span></a>
</span><span id="resample-2449"><a href="#resample-2449"><span class="linenos">2449</span></a>    <span class="n">result_blocks</span> <span class="o">=</span> <span class="n">_map_function_over_blocks</span><span class="p">(</span><span class="n">coord_blocks</span><span class="p">,</span> <span class="n">process_block</span><span class="p">)</span>
</span><span id="resample-2450"><a href="#resample-2450"><span class="linenos">2450</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">_merge_array_from_blocks</span><span class="p">(</span><span class="n">result_blocks</span><span class="p">)</span>
</span><span id="resample-2451"><a href="#resample-2451"><span class="linenos">2451</span></a>    <span class="k">return</span> <span class="n">array</span>
</span><span id="resample-2452"><a href="#resample-2452"><span class="linenos">2452</span></a>
</span><span id="resample-2453"><a href="#resample-2453"><span class="linenos">2453</span></a>  <span class="c1"># A concrete example of upsampling:</span>
</span><span id="resample-2454"><a href="#resample-2454"><span class="linenos">2454</span></a>  <span class="c1">#   array = np.ones((5, 7, 3))  # source RGB image has height=5 width=7</span>
</span><span id="resample-2455"><a href="#resample-2455"><span class="linenos">2455</span></a>  <span class="c1">#   coords = np.random.rand(8, 9, 2)  # output RGB image has height=8 width=9</span>
</span><span id="resample-2456"><a href="#resample-2456"><span class="linenos">2456</span></a>  <span class="c1">#   resample(array, coords, filter=(&#39;cubic&#39;, &#39;lanczos3&#39;))</span>
</span><span id="resample-2457"><a href="#resample-2457"><span class="linenos">2457</span></a>  <span class="c1">#   grid_shape = 5, 7  grid_ndim = 2</span>
</span><span id="resample-2458"><a href="#resample-2458"><span class="linenos">2458</span></a>  <span class="c1">#   resampled_shape = 8, 9  resampled_ndim = 2</span>
</span><span id="resample-2459"><a href="#resample-2459"><span class="linenos">2459</span></a>  <span class="c1">#   sample_shape = (3,)</span>
</span><span id="resample-2460"><a href="#resample-2460"><span class="linenos">2460</span></a>  <span class="c1">#   src_float_index.shape = 8, 9</span>
</span><span id="resample-2461"><a href="#resample-2461"><span class="linenos">2461</span></a>  <span class="c1">#   src_first_index.shape = 8, 9</span>
</span><span id="resample-2462"><a href="#resample-2462"><span class="linenos">2462</span></a>  <span class="c1">#   sample_index.shape = (4,) for dim == 0, then (6,) for dim == 1</span>
</span><span id="resample-2463"><a href="#resample-2463"><span class="linenos">2463</span></a>  <span class="c1">#   weight = [shape(8, 9, 4), shape(8, 9, 6)]</span>
</span><span id="resample-2464"><a href="#resample-2464"><span class="linenos">2464</span></a>  <span class="c1">#   src_index = [shape(8, 9, 4), shape(8, 9, 6)]</span>
</span><span id="resample-2465"><a href="#resample-2465"><span class="linenos">2465</span></a>
</span><span id="resample-2466"><a href="#resample-2466"><span class="linenos">2466</span></a>  <span class="c1"># Both:[shape(8, 9, 4), shape(8, 9, 6)]</span>
</span><span id="resample-2467"><a href="#resample-2467"><span class="linenos">2467</span></a>  <span class="n">weight</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_ndim</span><span class="p">)]</span>
</span><span id="resample-2468"><a href="#resample-2468"><span class="linenos">2468</span></a>  <span class="n">src_index</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">_NDArray</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_ndim</span><span class="p">)]</span>
</span><span id="resample-2469"><a href="#resample-2469"><span class="linenos">2469</span></a>  <span class="n">uses_cval</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="resample-2470"><a href="#resample-2470"><span class="linenos">2470</span></a>  <span class="n">all_num_samples</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># will be [4, 6]</span>
</span><span id="resample-2471"><a href="#resample-2471"><span class="linenos">2471</span></a>
</span><span id="resample-2472"><a href="#resample-2472"><span class="linenos">2472</span></a>  <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_ndim</span><span class="p">):</span>
</span><span id="resample-2473"><a href="#resample-2473"><span class="linenos">2473</span></a>    <span class="n">src_size</span> <span class="o">=</span> <span class="n">grid_shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>  <span class="c1"># scalar</span>
</span><span id="resample-2474"><a href="#resample-2474"><span class="linenos">2474</span></a>    <span class="n">coords_dim</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">dim</span><span class="p">]</span>  <span class="c1"># (8, 9)</span>
</span><span id="resample-2475"><a href="#resample-2475"><span class="linenos">2475</span></a>    <span class="n">radius</span> <span class="o">=</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">radius</span>  <span class="c1"># scalar</span>
</span><span id="resample-2476"><a href="#resample-2476"><span class="linenos">2476</span></a>    <span class="n">num_samples</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">radius</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># scalar</span>
</span><span id="resample-2477"><a href="#resample-2477"><span class="linenos">2477</span></a>    <span class="n">all_num_samples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">num_samples</span><span class="p">)</span>
</span><span id="resample-2478"><a href="#resample-2478"><span class="linenos">2478</span></a>
</span><span id="resample-2479"><a href="#resample-2479"><span class="linenos">2479</span></a>    <span class="n">boundary_dim</span> <span class="o">=</span> <span class="n">boundary2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
</span><span id="resample-2480"><a href="#resample-2480"><span class="linenos">2480</span></a>    <span class="n">coords_dim</span> <span class="o">=</span> <span class="n">boundary_dim</span><span class="o">.</span><span class="n">preprocess_coordinates</span><span class="p">(</span><span class="n">coords_dim</span><span class="p">)</span>
</span><span id="resample-2481"><a href="#resample-2481"><span class="linenos">2481</span></a>
</span><span id="resample-2482"><a href="#resample-2482"><span class="linenos">2482</span></a>    <span class="c1"># Sample positions mapped back to source unit domain [0, 1].</span>
</span><span id="resample-2483"><a href="#resample-2483"><span class="linenos">2483</span></a>    <span class="n">src_float_index</span> <span class="o">=</span> <span class="n">gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">index_from_point</span><span class="p">(</span><span class="n">coords_dim</span><span class="p">,</span> <span class="n">src_size</span><span class="p">)</span>  <span class="c1"># (8, 9)</span>
</span><span id="resample-2484"><a href="#resample-2484"><span class="linenos">2484</span></a>    <span class="n">src_first_index</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="resample-2485"><a href="#resample-2485"><span class="linenos">2485</span></a>        <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">src_float_index</span> <span class="o">+</span> <span class="p">(</span><span class="mf">0.5</span> <span class="k">if</span> <span class="n">num_samples</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">0.0</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
</span><span id="resample-2486"><a href="#resample-2486"><span class="linenos">2486</span></a>        <span class="o">-</span> <span class="p">(</span><span class="n">num_samples</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># (8, 9)</span>
</span><span id="resample-2487"><a href="#resample-2487"><span class="linenos">2487</span></a>
</span><span id="resample-2488"><a href="#resample-2488"><span class="linenos">2488</span></a>    <span class="n">sample_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_samples</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>  <span class="c1"># (4,) then (6,)</span>
</span><span id="resample-2489"><a href="#resample-2489"><span class="linenos">2489</span></a>    <span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">src_first_index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">+</span> <span class="n">sample_index</span>  <span class="c1"># (8, 9, 4) then (8, 9, 6)</span>
</span><span id="resample-2490"><a href="#resample-2490"><span class="linenos">2490</span></a>    <span class="k">if</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;trapezoid&#39;</span><span class="p">:</span>
</span><span id="resample-2491"><a href="#resample-2491"><span class="linenos">2491</span></a>      <span class="c1"># (It might require changing the filter radius at every sample.)</span>
</span><span id="resample-2492"><a href="#resample-2492"><span class="linenos">2492</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;resample() cannot use adaptive `trapezoid` filter.&#39;</span><span class="p">)</span>
</span><span id="resample-2493"><a href="#resample-2493"><span class="linenos">2493</span></a>    <span class="k">if</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;impulse&#39;</span><span class="p">:</span>
</span><span id="resample-2494"><a href="#resample-2494"><span class="linenos">2494</span></a>      <span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">weight_precision</span><span class="p">)</span>
</span><span id="resample-2495"><a href="#resample-2495"><span class="linenos">2495</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="resample-2496"><a href="#resample-2496"><span class="linenos">2496</span></a>      <span class="n">x</span> <span class="o">=</span> <span class="n">src_float_index</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">weight_precision</span><span class="p">)</span>
</span><span id="resample-2497"><a href="#resample-2497"><span class="linenos">2497</span></a>      <span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">](</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">weight_precision</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="resample-2498"><a href="#resample-2498"><span class="linenos">2498</span></a>      <span class="k">if</span> <span class="p">(</span><span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">!=</span> <span class="s1">&#39;narrowbox&#39;</span> <span class="ow">and</span>
</span><span id="resample-2499"><a href="#resample-2499"><span class="linenos">2499</span></a>          <span class="p">(</span><span class="n">is_minification</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">partition_of_unity</span><span class="p">)):</span>
</span><span id="resample-2500"><a href="#resample-2500"><span class="linenos">2500</span></a>        <span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">/</span> <span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span>
</span><span id="resample-2501"><a href="#resample-2501"><span class="linenos">2501</span></a>
</span><span id="resample-2502"><a href="#resample-2502"><span class="linenos">2502</span></a>    <span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="o">=</span> <span class="n">boundary_dim</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
</span><span id="resample-2503"><a href="#resample-2503"><span class="linenos">2503</span></a>        <span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span> <span class="n">coords_dim</span><span class="p">,</span> <span class="n">src_size</span><span class="p">,</span> <span class="n">gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>
</span><span id="resample-2504"><a href="#resample-2504"><span class="linenos">2504</span></a>    <span class="k">if</span> <span class="n">boundary_dim</span><span class="o">.</span><span class="n">uses_cval</span> <span class="ow">or</span> <span class="n">filter2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;narrowbox&#39;</span><span class="p">:</span>
</span><span id="resample-2505"><a href="#resample-2505"><span class="linenos">2505</span></a>      <span class="n">uses_cval</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="resample-2506"><a href="#resample-2506"><span class="linenos">2506</span></a>
</span><span id="resample-2507"><a href="#resample-2507"><span class="linenos">2507</span></a>  <span class="c1"># match arraylib:</span>
</span><span id="resample-2508"><a href="#resample-2508"><span class="linenos">2508</span></a>  <span class="k">if</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;tensorflow&#39;</span><span class="p">:</span>
</span><span id="resample-2509"><a href="#resample-2509"><span class="linenos">2509</span></a>    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="resample-2510"><a href="#resample-2510"><span class="linenos">2510</span></a>    <span class="c1"># Recall that src_index = [shape(8, 9, 4), shape(8, 9, 6)].</span>
</span><span id="resample-2511"><a href="#resample-2511"><span class="linenos">2511</span></a>    <span class="n">gather_shape</span> <span class="o">=</span> <span class="n">resampled_shape</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">src_index</span><span class="p">)</span>  <span class="c1"># (8, 9, 4, 6)</span>
</span><span id="resample-2512"><a href="#resample-2512"><span class="linenos">2512</span></a>    <span class="n">src_index_expanded</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="resample-2513"><a href="#resample-2513"><span class="linenos">2513</span></a>    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_ndim</span><span class="p">):</span>
</span><span id="resample-2514"><a href="#resample-2514"><span class="linenos">2514</span></a>      <span class="n">src_index_dim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span>
</span><span id="resample-2515"><a href="#resample-2515"><span class="linenos">2515</span></a>          <span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="p">(</span><span class="n">grid_ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
</span><span id="resample-2516"><a href="#resample-2516"><span class="linenos">2516</span></a>          <span class="n">resampled_ndim</span><span class="p">,</span> <span class="n">resampled_ndim</span> <span class="o">+</span> <span class="n">dim</span><span class="p">)</span>
</span><span id="resample-2517"><a href="#resample-2517"><span class="linenos">2517</span></a>      <span class="n">src_index_expanded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">src_index_dim</span><span class="p">,</span> <span class="n">gather_shape</span><span class="p">))</span>
</span><span id="resample-2518"><a href="#resample-2518"><span class="linenos">2518</span></a>    <span class="c1"># Unfortunately, broadcast expansion seems unavoidable for tf.gather_nd().</span>
</span><span id="resample-2519"><a href="#resample-2519"><span class="linenos">2519</span></a>    <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">src_index_expanded</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># (8, 9, 4, 6, 2)</span>
</span><span id="resample-2520"><a href="#resample-2520"><span class="linenos">2520</span></a>    <span class="n">samples</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">gather_nd</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span>  <span class="c1"># (8, 9, 4, 6, 3)</span>
</span><span id="resample-2521"><a href="#resample-2521"><span class="linenos">2521</span></a>
</span><span id="resample-2522"><a href="#resample-2522"><span class="linenos">2522</span></a>  <span class="k">else</span><span class="p">:</span>  <span class="c1"># &#39;numpy&#39;, &#39;torch&#39;.</span>
</span><span id="resample-2523"><a href="#resample-2523"><span class="linenos">2523</span></a>    <span class="c1"># Recall that src_index = [shape(8, 9, 4), shape(8, 9, 6)].</span>
</span><span id="resample-2524"><a href="#resample-2524"><span class="linenos">2524</span></a>    <span class="n">src_index_expanded</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># [(8, 9, 4, 1), (8, 9, 1, 6)]</span>
</span><span id="resample-2525"><a href="#resample-2525"><span class="linenos">2525</span></a>    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_ndim</span><span class="p">):</span>
</span><span id="resample-2526"><a href="#resample-2526"><span class="linenos">2526</span></a>      <span class="n">src_index_expanded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span>
</span><span id="resample-2527"><a href="#resample-2527"><span class="linenos">2527</span></a>          <span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">src_index</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="p">(</span><span class="n">grid_ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)),</span>
</span><span id="resample-2528"><a href="#resample-2528"><span class="linenos">2528</span></a>          <span class="n">resampled_ndim</span><span class="p">,</span> <span class="n">resampled_ndim</span> <span class="o">+</span> <span class="n">dim</span><span class="p">))</span>
</span><span id="resample-2529"><a href="#resample-2529"><span class="linenos">2529</span></a>    <span class="c1"># Unfortunately, gathering &#39;samples&#39; is the memory bottleneck.  It would be ideal if we could</span>
</span><span id="resample-2530"><a href="#resample-2530"><span class="linenos">2530</span></a>    <span class="c1"># defer the array reads until inside the np.einsum() call.</span>
</span><span id="resample-2531"><a href="#resample-2531"><span class="linenos">2531</span></a>    <span class="c1"># For large outputs, splitting the evaluation over output tiles helps a bit.</span>
</span><span id="resample-2532"><a href="#resample-2532"><span class="linenos">2532</span></a>    <span class="n">samples</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">src_index_expanded</span><span class="p">)]</span>  <span class="c1"># (8, 9, 4, 6, 3)</span>
</span><span id="resample-2533"><a href="#resample-2533"><span class="linenos">2533</span></a>
</span><span id="resample-2534"><a href="#resample-2534"><span class="linenos">2534</span></a>  <span class="n">samples_ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="resample-2535"><a href="#resample-2535"><span class="linenos">2535</span></a>
</span><span id="resample-2536"><a href="#resample-2536"><span class="linenos">2536</span></a>  <span class="c1"># Compute an Einstein summation over the samples and each of the</span>
</span><span id="resample-2537"><a href="#resample-2537"><span class="linenos">2537</span></a>  <span class="c1"># per-dimension weights.</span>
</span><span id="resample-2538"><a href="#resample-2538"><span class="linenos">2538</span></a>
</span><span id="resample-2539"><a href="#resample-2539"><span class="linenos">2539</span></a>  <span class="k">def</span> <span class="nf">label</span><span class="p">(</span><span class="n">dims</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span id="resample-2540"><a href="#resample-2540"><span class="linenos">2540</span></a>    <span class="k">return</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">dims</span><span class="p">)</span>
</span><span id="resample-2541"><a href="#resample-2541"><span class="linenos">2541</span></a>
</span><span id="resample-2542"><a href="#resample-2542"><span class="linenos">2542</span></a>  <span class="n">operands</span> <span class="o">=</span> <span class="p">[</span><span class="n">samples</span><span class="p">]</span>  <span class="c1"># (8, 9, 4, 6, 3)</span>
</span><span id="resample-2543"><a href="#resample-2543"><span class="linenos">2543</span></a>  <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">label</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">samples_ndim</span><span class="p">))]</span>  <span class="c1"># [&#39;abcde&#39;]</span>
</span><span id="resample-2544"><a href="#resample-2544"><span class="linenos">2544</span></a>  <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">grid_ndim</span><span class="p">):</span>
</span><span id="resample-2545"><a href="#resample-2545"><span class="linenos">2545</span></a>    <span class="n">operands</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">])</span>  <span class="c1"># (8, 9, 4), then (8, 9, 6)</span>
</span><span id="resample-2546"><a href="#resample-2546"><span class="linenos">2546</span></a>    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">resampled_ndim</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="n">resampled_ndim</span> <span class="o">+</span> <span class="n">dim</span><span class="p">]))</span>  <span class="c1"># &#39;abc&#39; then &#39;abd&#39;</span>
</span><span id="resample-2547"><a href="#resample-2547"><span class="linenos">2547</span></a>  <span class="n">output_label</span> <span class="o">=</span> <span class="n">label</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">resampled_ndim</span><span class="p">))</span> <span class="o">+</span>
</span><span id="resample-2548"><a href="#resample-2548"><span class="linenos">2548</span></a>                       <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">resampled_ndim</span> <span class="o">+</span> <span class="n">grid_ndim</span><span class="p">,</span> <span class="n">samples_ndim</span><span class="p">)))</span>  <span class="c1"># &#39;abe&#39;</span>
</span><span id="resample-2549"><a href="#resample-2549"><span class="linenos">2549</span></a>  <span class="n">subscripts</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&gt;&#39;</span> <span class="o">+</span> <span class="n">output_label</span>  <span class="c1"># &#39;abcde,abc,abd-&gt;abe&#39;</span>
</span><span id="resample-2550"><a href="#resample-2550"><span class="linenos">2550</span></a>
</span><span id="resample-2551"><a href="#resample-2551"><span class="linenos">2551</span></a>  <span class="k">if</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;numpy&#39;</span><span class="p">:</span>
</span><span id="resample-2552"><a href="#resample-2552"><span class="linenos">2552</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="n">subscripts</span><span class="p">,</span> <span class="o">*</span><span class="n">operands</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># (8, 9, 3)</span>
</span><span id="resample-2553"><a href="#resample-2553"><span class="linenos">2553</span></a>
</span><span id="resample-2554"><a href="#resample-2554"><span class="linenos">2554</span></a>  <span class="k">elif</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;tensorflow&#39;</span><span class="p">:</span>
</span><span id="resample-2555"><a href="#resample-2555"><span class="linenos">2555</span></a>    <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="resample-2556"><a href="#resample-2556"><span class="linenos">2556</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="n">subscripts</span><span class="p">,</span> <span class="o">*</span><span class="n">operands</span><span class="p">,</span> <span class="n">optimize</span><span class="o">=</span><span class="s1">&#39;greedy&#39;</span><span class="p">)</span>  <span class="c1"># (8, 9, 3)</span>
</span><span id="resample-2557"><a href="#resample-2557"><span class="linenos">2557</span></a>
</span><span id="resample-2558"><a href="#resample-2558"><span class="linenos">2558</span></a>  <span class="k">elif</span> <span class="n">arraylib</span> <span class="o">==</span> <span class="s1">&#39;torch&#39;</span><span class="p">:</span>
</span><span id="resample-2559"><a href="#resample-2559"><span class="linenos">2559</span></a>    <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="resample-2560"><a href="#resample-2560"><span class="linenos">2560</span></a>    <span class="n">operands</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">operand</span><span class="p">)</span> <span class="k">for</span> <span class="n">operand</span> <span class="ow">in</span> <span class="n">operands</span><span class="p">]</span>
</span><span id="resample-2561"><a href="#resample-2561"><span class="linenos">2561</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="n">subscripts</span><span class="p">,</span> <span class="o">*</span><span class="n">operands</span><span class="p">)</span>  <span class="c1"># (8, 9, 3)</span>
</span><span id="resample-2562"><a href="#resample-2562"><span class="linenos">2562</span></a>
</span><span id="resample-2563"><a href="#resample-2563"><span class="linenos">2563</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="resample-2564"><a href="#resample-2564"><span class="linenos">2564</span></a>    <span class="k">raise</span> <span class="ne">AssertionError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">arraylib</span><span class="si">}</span><span class="s1"> is unrecognized.&#39;</span><span class="p">)</span>
</span><span id="resample-2565"><a href="#resample-2565"><span class="linenos">2565</span></a>
</span><span id="resample-2566"><a href="#resample-2566"><span class="linenos">2566</span></a>  <span class="k">if</span> <span class="n">uses_cval</span><span class="p">:</span>
</span><span id="resample-2567"><a href="#resample-2567"><span class="linenos">2567</span></a>    <span class="n">cval_weight</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span>
</span><span id="resample-2568"><a href="#resample-2568"><span class="linenos">2568</span></a>        <span class="p">[</span><span class="n">weight</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">resampled_ndim</span><span class="p">)])</span>  <span class="c1"># (8, 9)</span>
</span><span id="resample-2569"><a href="#resample-2569"><span class="linenos">2569</span></a>    <span class="n">cval_weight_reshaped</span> <span class="o">=</span> <span class="n">cval_weight</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">cval_weight</span><span class="o">.</span><span class="n">shape</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="p">,)</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">sample_shape</span><span class="p">))</span>
</span><span id="resample-2570"><a href="#resample-2570"><span class="linenos">2570</span></a>    <span class="n">array</span> <span class="o">+=</span> <span class="n">_make_array</span><span class="p">((</span><span class="n">cval_weight_reshaped</span> <span class="o">*</span> <span class="n">cval</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">arraylib</span><span class="p">)</span>
</span><span id="resample-2571"><a href="#resample-2571"><span class="linenos">2571</span></a>
</span><span id="resample-2572"><a href="#resample-2572"><span class="linenos">2572</span></a>  <span class="k">if</span> <span class="n">max_block_size</span> <span class="o">!=</span> <span class="n">_MAX_BLOCK_SIZE_RECURSING</span><span class="p">:</span>
</span><span id="resample-2573"><a href="#resample-2573"><span class="linenos">2573</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">dst_gamma2</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="resample-2574"><a href="#resample-2574"><span class="linenos">2574</span></a>
</span><span id="resample-2575"><a href="#resample-2575"><span class="linenos">2575</span></a>  <span class="k">return</span> <span class="n">array</span>
</span></pre></div>


            <div class="docstring"><p>Interpolate a grid of source samples at specified unit-domain coordinates.</p>

<p>The last dimension of <code>coords</code> contains unit-domain coordinates at which to interpolate the
domain grid samples in <code>array</code>.</p>

<p>The number of coordinates (<code>coords.shape[-1]</code>) determines how to interpret <code>array</code>: its first
<code>coords.shape[-1]</code> dimensions define the grid, and the remaining dimensions describe each grid
sample (scalar, vector, tensor).</p>

<p>Concretely, the grid has shape <code>array.shape[:coords.shape[-1]]</code> and each grid sample has shape
<code>array.shape[coords.shape[-1]:]</code>.</p>

<p>Examples include:</p>

<ul>
<li><p>Resample a grayscale image with <code>array.shape = height, width</code> onto a new grayscale image with
<code>new.shape = height2, width2</code> by using <code>coords.shape = height2, width2, 2</code>.</p></li>
<li><p>Resample an RGB image with <code>array.shape = height, width, 3</code> onto a new RGB image with
<code>new.shape = height2, width2, 3</code> by using <code>coords.shape = height2, width2, 2</code>.</p></li>
<li><p>Sample an RGB image at <code>num</code> 2D points along a line segment by using <code>coords.shape = num, 2</code>.</p></li>
<li><p>Sample an RGB image at a single 2D point by using <code>coords.shape = (2,)</code>.</p></li>
<li><p>Sample a 3D grid of 3x3 Jacobians with <code>array.shape = nz, ny, nx, 3, 3</code> along a 2D plane by
using <code>coords.shape = height, width, 3</code>.</p></li>
<li><p>Map a grayscale image through a color map by using <code>array.shape = 256, 3</code> and
<code>coords.shape = height, width</code>.</p></li>
</ul>

<h6 id="args">Args</h6>

<ul>
<li><strong>array:</strong>  Grid of source sample values.  It must be an array-like object from a library in
<code><a href="#ARRAYLIBS">ARRAYLIBS</a></code>.  The array must have numeric type.  The coordinate dimensions appear first, and
each grid sample may have an arbitrary shape.  Each grid dimension must be at least 1 for
a <code>dual</code> grid or at least 2 for a <code>primal</code> grid.</li>
<li><strong>coords:</strong>  Grid of points at which to resample <code>array</code>.  The point coordinates are in the last
dimension of <code>coords</code>.  The domain associated with the source grid is a unit hypercube,
i.e. with a range [0, 1] on each coordinate dimension.  The output grid has shape
<code>coords.shape[:-1]</code> and each of its grid samples has shape <code>array.shape[coords.shape[-1]:]</code>.</li>
<li><strong>gridtype:</strong>  Placement of the samples in the source domain grid for each dimension, specified as
either a name in <code><a href="#GRIDTYPES">GRIDTYPES</a></code> or a <code><a href="#Gridtype">Gridtype</a></code> instance.</li>
<li><strong>boundary:</strong>  The reconstruction boundary rule for each dimension in <code>coords.shape[-1]</code>, specified
as either a name in <code><a href="#BOUNDARIES">BOUNDARIES</a></code> or a <code><a href="#Boundary">Boundary</a></code> instance.  The special value 'auto' uses
'reflect' for upsampling and 'clamp' for downsampling.</li>
<li><strong>cval:</strong>  Constant value used beyond the samples by some boundary rules.  It must be broadcastable
onto the shape <code>array.shape[coords.shape[-1]:]</code>.</li>
<li><strong>filter:</strong>  The reconstruction kernel for each dimension in <code>coords.shape[-1]</code>, specified as either
a filter name in <code><a href="#FILTERS">FILTERS</a></code> or a <code><a href="#Filter">Filter</a></code> instance.</li>
<li><strong>prefilter:</strong>  The prefilter kernel for each dimension in <code>coords.shape[:-1]</code>, specified as either
a filter name in <code><a href="#FILTERS">FILTERS</a></code> or a <code><a href="#Filter">Filter</a></code> instance.  It is used during downsampling
(i.e., minification).  If None, it inherits the value of <code>filter</code>.</li>
<li><strong>gamma:</strong>  Component transfer functions (e.g., gamma correction) applied when reading samples
from <code>array</code> and when creating output grid samples.  It is specified as either a name in
<code><a href="#GAMMAS">GAMMAS</a></code> or a <code><a href="#Gamma">Gamma</a></code> instance.  If both <code>array.dtype</code> and <code>dtype</code> are <code>uint</code>, the default
is <code>power2</code>.  If both are non-<code>uint</code>, the default is <code>identity</code>.  Otherwise, <code>gamma</code> or
<code>src_gamma</code>/<code>dst_gamma</code> must be set.   Gamma correction assumes that float values are in the
range [0.0, 1.0].</li>
<li><strong>src_gamma:</strong>  Component transfer function used to "decode" <code>array</code> samples.
Parameters <code>gamma</code> and <code>src_gamma</code> cannot both be set.</li>
<li><strong>dst_gamma:</strong>  Component transfer function used to "encode" the output samples.
Parameters <code>gamma</code> and <code>dst_gamma</code> cannot both be set.</li>
<li><strong>jacobian:</strong>  Optional array, which must be broadcastable onto the shape
<code>coords.shape[:-1] + (coords.shape[-1], coords.shape[-1])</code>, storing for each point in the
output grid the Jacobian matrix of the map from the unit output domain to the unit source
domain.  If omitted, it is estimated by computing finite differences on <code>coords</code>.</li>
<li><strong>precision:</strong>  Inexact precision of intermediate computations.  If None, it is determined based on
<code>array.dtype</code>, <code>coords.dtype</code>, and <code>dtype</code>.</li>
<li><strong>dtype:</strong>  Desired data type of the output array.  If None, it is taken to be <code>array.dtype</code>.
If it is a uint type, the intermediate float values are rescaled from the [0.0, 1.0] range
to the uint range.</li>
<li><strong>max_block_size:</strong>  If nonzero, maximum number of grid points in <code>coords</code> before the resampling
evaluation gets partitioned into smaller blocks for reduced memory usage and better caching.</li>
<li><strong>debug:</strong>  Show internal information.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>A new sample grid of shape <code>coords.shape[:-1]</code>, represented as an array of shape
  <code>coords.shape[:-1] + array.shape[coords.shape[-1]:]</code>, of the same array library type as
  the source array.</p>
</blockquote>

<p>For reference, the identity resampling for a scalar-valued grid with the default grid-type
'dual' is:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_array</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">new_array</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
</code></pre></div>

<p>It is more efficient to use the function <code><a href="#resize">resize</a></code> for the special case where the <code>coords</code> are
obtained as simple scaling and translation of a new regular grid over the source domain:</p>

<div class="pdoc-code codehilite"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">scale</span><span class="p">,</span> <span class="n">translate</span><span class="p">,</span> <span class="n">new_shape</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">),</span> <span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">new_shape</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">/</span> <span class="n">new_shape</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">coords</span> <span class="o">=</span> <span class="p">(</span><span class="n">coords</span> <span class="o">-</span> <span class="n">translate</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resampled</span> <span class="o">=</span> <span class="n">resample</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">coords</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">resized</span> <span class="o">=</span> <span class="n">resize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="n">translate</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">resampled</span><span class="p">,</span> <span class="n">resized</span><span class="p">)</span>
</code></pre></div>
</div>


                </section>
                <section id="resample_affine">
                            <input id="resample_affine-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">resample_affine</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">array</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">shape</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="n">matrix</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gridtype">resampler.Gridtype</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">src_gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gridtype">resampler.Gridtype</a></span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gridtype">resampler.Gridtype</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dst_gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gridtype">resampler.Gridtype</a></span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Gridtype">resampler.Gridtype</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="nb">filter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Filter">resampler.Filter</a></span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Filter">resampler.Filter</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;lanczos3&#39;</span>,</span><span class="param">	<span class="n">prefilter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Filter">resampler.Filter</a></span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n"><a href="#Filter">resampler.Filter</a></span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">precision</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="resample_affine-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#resample_affine"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="resample_affine-2578"><a href="#resample_affine-2578"><span class="linenos">2578</span></a><span class="k">def</span> <span class="nf">resample_affine</span><span class="p">(</span>
</span><span id="resample_affine-2579"><a href="#resample_affine-2579"><span class="linenos">2579</span></a>    <span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span>
</span><span id="resample_affine-2580"><a href="#resample_affine-2580"><span class="linenos">2580</span></a>    <span class="n">shape</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="resample_affine-2581"><a href="#resample_affine-2581"><span class="linenos">2581</span></a>    <span class="n">matrix</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="resample_affine-2582"><a href="#resample_affine-2582"><span class="linenos">2582</span></a>    <span class="o">*</span><span class="p">,</span>
</span><span id="resample_affine-2583"><a href="#resample_affine-2583"><span class="linenos">2583</span></a>    <span class="n">gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resample_affine-2584"><a href="#resample_affine-2584"><span class="linenos">2584</span></a>    <span class="n">src_gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resample_affine-2585"><a href="#resample_affine-2585"><span class="linenos">2585</span></a>    <span class="n">dst_gridtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Gridtype</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resample_affine-2586"><a href="#resample_affine-2586"><span class="linenos">2586</span></a>    <span class="nb">filter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">]]]</span> <span class="o">=</span> <span class="s1">&#39;lanczos3&#39;</span><span class="p">,</span>
</span><span id="resample_affine-2587"><a href="#resample_affine-2587"><span class="linenos">2587</span></a>    <span class="n">prefilter</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Filter</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resample_affine-2588"><a href="#resample_affine-2588"><span class="linenos">2588</span></a>    <span class="n">precision</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resample_affine-2589"><a href="#resample_affine-2589"><span class="linenos">2589</span></a>    <span class="n">dtype</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="resample_affine-2590"><a href="#resample_affine-2590"><span class="linenos">2590</span></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="resample_affine-2591"><a href="#resample_affine-2591"><span class="linenos">2591</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="resample_affine-2592"><a href="#resample_affine-2592"><span class="linenos">2592</span></a>  <span class="sd">&quot;&quot;&quot;Resample a source array using an affinely transformed grid of given shape.</span>
</span><span id="resample_affine-2593"><a href="#resample_affine-2593"><span class="linenos">2593</span></a>
</span><span id="resample_affine-2594"><a href="#resample_affine-2594"><span class="linenos">2594</span></a><span class="sd">  The `matrix` transformation can be linear:</span>
</span><span id="resample_affine-2595"><a href="#resample_affine-2595"><span class="linenos">2595</span></a><span class="sd">    source_point = matrix @ destination_point.</span>
</span><span id="resample_affine-2596"><a href="#resample_affine-2596"><span class="linenos">2596</span></a><span class="sd">  or it can be affine where the last matrix column is an offset vector:</span>
</span><span id="resample_affine-2597"><a href="#resample_affine-2597"><span class="linenos">2597</span></a><span class="sd">    source_point = matrix @ (destination_point, 1.0)</span>
</span><span id="resample_affine-2598"><a href="#resample_affine-2598"><span class="linenos">2598</span></a>
</span><span id="resample_affine-2599"><a href="#resample_affine-2599"><span class="linenos">2599</span></a><span class="sd">  Args:</span>
</span><span id="resample_affine-2600"><a href="#resample_affine-2600"><span class="linenos">2600</span></a><span class="sd">    array: Regular grid of source sample values.  The array must have numeric type.  The number of</span>
</span><span id="resample_affine-2601"><a href="#resample_affine-2601"><span class="linenos">2601</span></a><span class="sd">      grid dimensions is determined from `matrix.shape[0]`; the remaining dimensions are for each</span>
</span><span id="resample_affine-2602"><a href="#resample_affine-2602"><span class="linenos">2602</span></a><span class="sd">      sample value and are all linearly interpolated.</span>
</span><span id="resample_affine-2603"><a href="#resample_affine-2603"><span class="linenos">2603</span></a><span class="sd">    shape: Dimensions of the desired destination grid.  The number of destination grid dimensions</span>
</span><span id="resample_affine-2604"><a href="#resample_affine-2604"><span class="linenos">2604</span></a><span class="sd">      may be different from that of the source grid.</span>
</span><span id="resample_affine-2605"><a href="#resample_affine-2605"><span class="linenos">2605</span></a><span class="sd">    matrix: 2D array for a linear or affine transform from unit-domain destination points</span>
</span><span id="resample_affine-2606"><a href="#resample_affine-2606"><span class="linenos">2606</span></a><span class="sd">      (in a space with `len(shape)` dimensions) into unit-domain source points (in a space with</span>
</span><span id="resample_affine-2607"><a href="#resample_affine-2607"><span class="linenos">2607</span></a><span class="sd">      `matrix.shape[0]` dimensions).  If the matrix has `len(shape) + 1` columns, the last column</span>
</span><span id="resample_affine-2608"><a href="#resample_affine-2608"><span class="linenos">2608</span></a><span class="sd">      is the affine offset (i.e., translation).</span>
</span><span id="resample_affine-2609"><a href="#resample_affine-2609"><span class="linenos">2609</span></a><span class="sd">    gridtype: Placement of samples on both the source and output domain grids, specified as either</span>
</span><span id="resample_affine-2610"><a href="#resample_affine-2610"><span class="linenos">2610</span></a><span class="sd">      a name in `GRIDTYPES` or a `Gridtype` instance.  The default is &#39;dual&#39;.</span>
</span><span id="resample_affine-2611"><a href="#resample_affine-2611"><span class="linenos">2611</span></a><span class="sd">    src_gridtype: Placement of samples in the source domain grid for each dimension.</span>
</span><span id="resample_affine-2612"><a href="#resample_affine-2612"><span class="linenos">2612</span></a><span class="sd">      Parameters `gridtype` and `src_gridtype` cannot both be set.</span>
</span><span id="resample_affine-2613"><a href="#resample_affine-2613"><span class="linenos">2613</span></a><span class="sd">    dst_gridtype: Placement of samples in the output domain grid for each dimension.</span>
</span><span id="resample_affine-2614"><a href="#resample_affine-2614"><span class="linenos">2614</span></a><span class="sd">      Parameters `gridtype` and `dst_gridtype` cannot both be set.</span>
</span><span id="resample_affine-2615"><a href="#resample_affine-2615"><span class="linenos">2615</span></a><span class="sd">    filter: The reconstruction kernel for each dimension in `matrix.shape[0]`, specified as either</span>
</span><span id="resample_affine-2616"><a href="#resample_affine-2616"><span class="linenos">2616</span></a><span class="sd">      a filter name in `FILTERS` or a `Filter` instance.</span>
</span><span id="resample_affine-2617"><a href="#resample_affine-2617"><span class="linenos">2617</span></a><span class="sd">    prefilter: The prefilter kernel for each dimension in `len(shape)`, specified as either</span>
</span><span id="resample_affine-2618"><a href="#resample_affine-2618"><span class="linenos">2618</span></a><span class="sd">      a filter name in `FILTERS` or a `Filter` instance.  It is used during downsampling</span>
</span><span id="resample_affine-2619"><a href="#resample_affine-2619"><span class="linenos">2619</span></a><span class="sd">      (i.e., minification).  If None, it inherits the value of `filter`.</span>
</span><span id="resample_affine-2620"><a href="#resample_affine-2620"><span class="linenos">2620</span></a><span class="sd">    precision: Inexact precision of intermediate computations.  If None, it is determined based</span>
</span><span id="resample_affine-2621"><a href="#resample_affine-2621"><span class="linenos">2621</span></a><span class="sd">      on `array.dtype` and `dtype`.</span>
</span><span id="resample_affine-2622"><a href="#resample_affine-2622"><span class="linenos">2622</span></a><span class="sd">    dtype: Desired data type of the output array.  If None, it is taken to be `array.dtype`.</span>
</span><span id="resample_affine-2623"><a href="#resample_affine-2623"><span class="linenos">2623</span></a><span class="sd">      If it is a uint type, the intermediate float values are rescaled from the [0.0, 1.0] range</span>
</span><span id="resample_affine-2624"><a href="#resample_affine-2624"><span class="linenos">2624</span></a><span class="sd">      to the uint range.</span>
</span><span id="resample_affine-2625"><a href="#resample_affine-2625"><span class="linenos">2625</span></a><span class="sd">    **kwargs: Additional parameters for `resample` function.</span>
</span><span id="resample_affine-2626"><a href="#resample_affine-2626"><span class="linenos">2626</span></a>
</span><span id="resample_affine-2627"><a href="#resample_affine-2627"><span class="linenos">2627</span></a><span class="sd">  Returns:</span>
</span><span id="resample_affine-2628"><a href="#resample_affine-2628"><span class="linenos">2628</span></a><span class="sd">    An array of the same class (`np.ndarray`, `tf.Tensor`, or `torch.Tensor`) as the source `array`,</span>
</span><span id="resample_affine-2629"><a href="#resample_affine-2629"><span class="linenos">2629</span></a><span class="sd">    representing a grid with specified `shape`, where each grid value is resampled from `array`.</span>
</span><span id="resample_affine-2630"><a href="#resample_affine-2630"><span class="linenos">2630</span></a><span class="sd">    Thus the shape of the returned array is `shape + array.shape[matrix.shape[0]:]`.</span>
</span><span id="resample_affine-2631"><a href="#resample_affine-2631"><span class="linenos">2631</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="resample_affine-2632"><a href="#resample_affine-2632"><span class="linenos">2632</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span><span id="resample_affine-2633"><a href="#resample_affine-2633"><span class="linenos">2633</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="resample_affine-2634"><a href="#resample_affine-2634"><span class="linenos">2634</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="resample_affine-2635"><a href="#resample_affine-2635"><span class="linenos">2635</span></a>  <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span>
</span><span id="resample_affine-2636"><a href="#resample_affine-2636"><span class="linenos">2636</span></a>  <span class="n">dst_ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="resample_affine-2637"><a href="#resample_affine-2637"><span class="linenos">2637</span></a>  <span class="k">if</span> <span class="n">matrix</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="resample_affine-2638"><a href="#resample_affine-2638"><span class="linenos">2638</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Array </span><span class="si">{</span><span class="n">matrix</span><span class="si">}</span><span class="s1"> is not 2D matrix.&#39;</span><span class="p">)</span>
</span><span id="resample_affine-2639"><a href="#resample_affine-2639"><span class="linenos">2639</span></a>  <span class="n">src_ndim</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="resample_affine-2640"><a href="#resample_affine-2640"><span class="linenos">2640</span></a>  <span class="c1"># grid_shape = array.shape[:src_ndim]</span>
</span><span id="resample_affine-2641"><a href="#resample_affine-2641"><span class="linenos">2641</span></a>  <span class="n">is_affine</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">dst_ndim</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="resample_affine-2642"><a href="#resample_affine-2642"><span class="linenos">2642</span></a>  <span class="k">if</span> <span class="n">src_ndim</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">):</span>
</span><span id="resample_affine-2643"><a href="#resample_affine-2643"><span class="linenos">2643</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Matrix </span><span class="si">{</span><span class="n">matrix</span><span class="si">}</span><span class="s1"> has more rows (</span><span class="si">{</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">) than&#39;</span>
</span><span id="resample_affine-2644"><a href="#resample_affine-2644"><span class="linenos">2644</span></a>                     <span class="sa">f</span><span class="s1">&#39; ndim in array.shape=</span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
</span><span id="resample_affine-2645"><a href="#resample_affine-2645"><span class="linenos">2645</span></a>  <span class="k">if</span> <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">dst_ndim</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">is_affine</span><span class="p">:</span>
</span><span id="resample_affine-2646"><a href="#resample_affine-2646"><span class="linenos">2646</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Matrix has shape </span><span class="si">{</span><span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">, but we expect either&#39;</span>
</span><span id="resample_affine-2647"><a href="#resample_affine-2647"><span class="linenos">2647</span></a>                     <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">dst_ndim</span><span class="si">}</span><span class="s1"> or </span><span class="si">{</span><span class="n">dst_ndim</span> <span class="o">+</span> <span class="mi">1</span><span class="si">}</span><span class="s1"> columns.&#39;</span><span class="p">)</span>
</span><span id="resample_affine-2648"><a href="#resample_affine-2648"><span class="linenos">2648</span></a>  <span class="n">src_gridtype2</span><span class="p">,</span> <span class="n">dst_gridtype2</span> <span class="o">=</span> <span class="n">_get_gridtypes</span><span class="p">(</span>
</span><span id="resample_affine-2649"><a href="#resample_affine-2649"><span class="linenos">2649</span></a>    <span class="n">gridtype</span><span class="p">,</span> <span class="n">src_gridtype</span><span class="p">,</span> <span class="n">dst_gridtype</span><span class="p">,</span> <span class="n">src_ndim</span><span class="p">,</span> <span class="n">dst_ndim</span><span class="p">)</span>
</span><span id="resample_affine-2650"><a href="#resample_affine-2650"><span class="linenos">2650</span></a>  <span class="n">prefilter</span> <span class="o">=</span> <span class="nb">filter</span> <span class="k">if</span> <span class="n">prefilter</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">prefilter</span>
</span><span id="resample_affine-2651"><a href="#resample_affine-2651"><span class="linenos">2651</span></a>  <span class="n">filter2</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_filter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">filter</span><span class="p">),</span> <span class="n">src_ndim</span><span class="p">)]</span>
</span><span id="resample_affine-2652"><a href="#resample_affine-2652"><span class="linenos">2652</span></a>  <span class="n">prefilter2</span> <span class="o">=</span> <span class="p">[</span><span class="n">_get_filter</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">prefilter</span><span class="p">),</span> <span class="n">dst_ndim</span><span class="p">)]</span>
</span><span id="resample_affine-2653"><a href="#resample_affine-2653"><span class="linenos">2653</span></a>  <span class="k">del</span> <span class="n">src_gridtype</span><span class="p">,</span> <span class="n">dst_gridtype</span><span class="p">,</span> <span class="nb">filter</span><span class="p">,</span> <span class="n">prefilter</span>
</span><span id="resample_affine-2654"><a href="#resample_affine-2654"><span class="linenos">2654</span></a>  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="resample_affine-2655"><a href="#resample_affine-2655"><span class="linenos">2655</span></a>  <span class="n">precision</span> <span class="o">=</span> <span class="n">_get_precision</span><span class="p">(</span><span class="n">precision</span><span class="p">,</span> <span class="p">[</span><span class="n">_arr_dtype</span><span class="p">(</span><span class="n">array</span><span class="p">),</span> <span class="n">dtype</span><span class="p">],</span> <span class="p">[])</span>
</span><span id="resample_affine-2656"><a href="#resample_affine-2656"><span class="linenos">2656</span></a>  <span class="n">weight_precision</span> <span class="o">=</span> <span class="n">_real_precision</span><span class="p">(</span><span class="n">precision</span><span class="p">)</span>
</span><span id="resample_affine-2657"><a href="#resample_affine-2657"><span class="linenos">2657</span></a>
</span><span id="resample_affine-2658"><a href="#resample_affine-2658"><span class="linenos">2658</span></a>  <span class="n">dst_position_list</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c1"># per dimension</span>
</span><span id="resample_affine-2659"><a href="#resample_affine-2659"><span class="linenos">2659</span></a>  <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">dst_ndim</span><span class="p">):</span>
</span><span id="resample_affine-2660"><a href="#resample_affine-2660"><span class="linenos">2660</span></a>    <span class="n">dst_size</span> <span class="o">=</span> <span class="n">shape</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span>
</span><span id="resample_affine-2661"><a href="#resample_affine-2661"><span class="linenos">2661</span></a>    <span class="n">dst_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dst_size</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">weight_precision</span><span class="p">)</span>
</span><span id="resample_affine-2662"><a href="#resample_affine-2662"><span class="linenos">2662</span></a>    <span class="n">dst_position_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dst_gridtype2</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">point_from_index</span><span class="p">(</span><span class="n">dst_index</span><span class="p">,</span> <span class="n">dst_size</span><span class="p">))</span>
</span><span id="resample_affine-2663"><a href="#resample_affine-2663"><span class="linenos">2663</span></a>  <span class="n">dst_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="o">*</span><span class="n">dst_position_list</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">)</span>
</span><span id="resample_affine-2664"><a href="#resample_affine-2664"><span class="linenos">2664</span></a>
</span><span id="resample_affine-2665"><a href="#resample_affine-2665"><span class="linenos">2665</span></a>  <span class="n">linear_matrix</span> <span class="o">=</span> <span class="n">matrix</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">is_affine</span> <span class="k">else</span> <span class="n">matrix</span>
</span><span id="resample_affine-2666"><a href="#resample_affine-2666"><span class="linenos">2666</span></a>  <span class="n">src_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tensordot</span><span class="p">(</span><span class="n">linear_matrix</span><span class="p">,</span> <span class="n">dst_position</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="resample_affine-2667"><a href="#resample_affine-2667"><span class="linenos">2667</span></a>  <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">src_position</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="resample_affine-2668"><a href="#resample_affine-2668"><span class="linenos">2668</span></a>  <span class="k">if</span> <span class="n">is_affine</span><span class="p">:</span>
</span><span id="resample_affine-2669"><a href="#resample_affine-2669"><span class="linenos">2669</span></a>    <span class="n">coords</span> <span class="o">+=</span> <span class="n">matrix</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="resample_affine-2670"><a href="#resample_affine-2670"><span class="linenos">2670</span></a>
</span><span id="resample_affine-2671"><a href="#resample_affine-2671"><span class="linenos">2671</span></a>  <span class="c1"># TODO: Based on grid_shape, shape, linear_matrix, and prefilter, determine a</span>
</span><span id="resample_affine-2672"><a href="#resample_affine-2672"><span class="linenos">2672</span></a>  <span class="c1"># convolution prefilter and apply it to bandlimit &#39;array&#39;, using boundary for padding.</span>
</span><span id="resample_affine-2673"><a href="#resample_affine-2673"><span class="linenos">2673</span></a>
</span><span id="resample_affine-2674"><a href="#resample_affine-2674"><span class="linenos">2674</span></a>  <span class="k">return</span> <span class="n">resample</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">coords</span><span class="p">,</span> <span class="n">gridtype</span><span class="o">=</span><span class="n">src_gridtype2</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="n">filter2</span><span class="p">,</span> <span class="n">prefilter</span><span class="o">=</span><span class="n">prefilter2</span><span class="p">,</span>
</span><span id="resample_affine-2675"><a href="#resample_affine-2675"><span class="linenos">2675</span></a>                  <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Resample a source array using an affinely transformed grid of given shape.</p>

<p>The <code>matrix</code> transformation can be linear:
  source_point = matrix @ destination_point.
or it can be affine where the last matrix column is an offset vector:
  source_point = matrix @ (destination_point, 1.0)</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>array:</strong>  Regular grid of source sample values.  The array must have numeric type.  The number of
grid dimensions is determined from <code>matrix.shape[0]</code>; the remaining dimensions are for each
sample value and are all linearly interpolated.</li>
<li><strong>shape:</strong>  Dimensions of the desired destination grid.  The number of destination grid dimensions
may be different from that of the source grid.</li>
<li><strong>matrix:</strong>  2D array for a linear or affine transform from unit-domain destination points
(in a space with <code>len(shape)</code> dimensions) into unit-domain source points (in a space with
<code>matrix.shape[0]</code> dimensions).  If the matrix has <code>len(shape) + 1</code> columns, the last column
is the affine offset (i.e., translation).</li>
<li><strong>gridtype:</strong>  Placement of samples on both the source and output domain grids, specified as either
a name in <code><a href="#GRIDTYPES">GRIDTYPES</a></code> or a <code><a href="#Gridtype">Gridtype</a></code> instance.  The default is 'dual'.</li>
<li><strong>src_gridtype:</strong>  Placement of samples in the source domain grid for each dimension.
Parameters <code>gridtype</code> and <code>src_gridtype</code> cannot both be set.</li>
<li><strong>dst_gridtype:</strong>  Placement of samples in the output domain grid for each dimension.
Parameters <code>gridtype</code> and <code>dst_gridtype</code> cannot both be set.</li>
<li><strong>filter:</strong>  The reconstruction kernel for each dimension in <code>matrix.shape[0]</code>, specified as either
a filter name in <code><a href="#FILTERS">FILTERS</a></code> or a <code><a href="#Filter">Filter</a></code> instance.</li>
<li><strong>prefilter:</strong>  The prefilter kernel for each dimension in <code>len(shape)</code>, specified as either
a filter name in <code><a href="#FILTERS">FILTERS</a></code> or a <code><a href="#Filter">Filter</a></code> instance.  It is used during downsampling
(i.e., minification).  If None, it inherits the value of <code>filter</code>.</li>
<li><strong>precision:</strong>  Inexact precision of intermediate computations.  If None, it is determined based
on <code>array.dtype</code> and <code>dtype</code>.</li>
<li><strong>dtype:</strong>  Desired data type of the output array.  If None, it is taken to be <code>array.dtype</code>.
If it is a uint type, the intermediate float values are rescaled from the [0.0, 1.0] range
to the uint range.</li>
<li><strong>**kwargs:</strong>  Additional parameters for <code><a href="#resample">resample</a></code> function.</li>
</ul>

<h6 id="returns">Returns</h6>

<blockquote>
  <p>An array of the same class (<code>np.ndarray</code>, <code>tf.Tensor</code>, or <code>torch.Tensor</code>) as the source <code>array</code>,
  representing a grid with specified <code>shape</code>, where each grid value is resampled from <code>array</code>.
  Thus the shape of the returned array is <code>shape + array.shape[matrix.shape[0]:]</code>.</p>
</blockquote>
</div>


                </section>
                <section id="resize_using_resample">
                            <input id="resize_using_resample-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">resize_using_resample</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">array</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">shape</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">scale</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">translate</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">fallback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="resize_using_resample-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#resize_using_resample"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="resize_using_resample-2678"><a href="#resize_using_resample-2678"><span class="linenos">2678</span></a><span class="k">def</span> <span class="nf">resize_using_resample</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_Array</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="o">*</span><span class="p">,</span>
</span><span id="resize_using_resample-2679"><a href="#resize_using_resample-2679"><span class="linenos">2679</span></a>                          <span class="n">scale</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">translate</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">fallback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="resize_using_resample-2680"><a href="#resize_using_resample-2680"><span class="linenos">2680</span></a>                          <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_Array</span><span class="p">:</span>
</span><span id="resize_using_resample-2681"><a href="#resize_using_resample-2681"><span class="linenos">2681</span></a>  <span class="sd">&quot;&quot;&quot;Use the more general `resample` operation for `resize`, as a debug tool.&quot;&quot;&quot;</span>
</span><span id="resize_using_resample-2682"><a href="#resize_using_resample-2682"><span class="linenos">2682</span></a>  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
</span><span id="resize_using_resample-2683"><a href="#resize_using_resample-2683"><span class="linenos">2683</span></a>    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="resize_using_resample-2684"><a href="#resize_using_resample-2684"><span class="linenos">2684</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="resize_using_resample-2685"><a href="#resize_using_resample-2685"><span class="linenos">2685</span></a>  <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">scale</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
</span><span id="resize_using_resample-2686"><a href="#resize_using_resample-2686"><span class="linenos">2686</span></a>  <span class="n">translate</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">translate</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>
</span><span id="resize_using_resample-2687"><a href="#resize_using_resample-2687"><span class="linenos">2687</span></a>  <span class="c1"># TODO: let resample() do prefiltering for proper downsampling.</span>
</span><span id="resize_using_resample-2688"><a href="#resize_using_resample-2688"><span class="linenos">2688</span></a>  <span class="n">has_minification</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">)])</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">scale</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">)</span>
</span><span id="resize_using_resample-2689"><a href="#resize_using_resample-2689"><span class="linenos">2689</span></a>  <span class="k">if</span> <span class="n">fallback</span> <span class="ow">and</span> <span class="n">has_minification</span><span class="p">:</span>
</span><span id="resize_using_resample-2690"><a href="#resize_using_resample-2690"><span class="linenos">2690</span></a>    <span class="k">return</span> <span class="n">_original_resize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="n">translate</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="resize_using_resample-2691"><a href="#resize_using_resample-2691"><span class="linenos">2691</span></a>  <span class="n">offset</span> <span class="o">=</span> <span class="o">-</span><span class="n">translate</span> <span class="o">/</span> <span class="n">scale</span>
</span><span id="resize_using_resample-2692"><a href="#resize_using_resample-2692"><span class="linenos">2692</span></a>  <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">scale</span><span class="p">),</span> <span class="n">offset</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="resize_using_resample-2693"><a href="#resize_using_resample-2693"><span class="linenos">2693</span></a>  <span class="k">return</span> <span class="n">resample_affine</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Use the more general <code><a href="#resample">resample</a></code> operation for <code><a href="#resize">resize</a></code>, as a debug tool.</p>
</div>


                </section>
                <section id="rotation_about_center_in_2d">
                            <input id="rotation_about_center_in_2d-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rotation_about_center_in_2d</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">src_shape</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">angle</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">dst_shape</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="rotation_about_center_in_2d-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#rotation_about_center_in_2d"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="rotation_about_center_in_2d-2696"><a href="#rotation_about_center_in_2d-2696"><span class="linenos">2696</span></a><span class="k">def</span> <span class="nf">rotation_about_center_in_2d</span><span class="p">(</span><span class="n">src_shape</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
</span><span id="rotation_about_center_in_2d-2697"><a href="#rotation_about_center_in_2d-2697"><span class="linenos">2697</span></a>                                <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="rotation_about_center_in_2d-2698"><a href="#rotation_about_center_in_2d-2698"><span class="linenos">2698</span></a>                                <span class="n">dst_shape</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="rotation_about_center_in_2d-2699"><a href="#rotation_about_center_in_2d-2699"><span class="linenos">2699</span></a>                                <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="rotation_about_center_in_2d-2700"><a href="#rotation_about_center_in_2d-2700"><span class="linenos">2700</span></a>  <span class="sd">&quot;&quot;&quot;Return the 3x3 matrix mapping destination into a source unit domain.</span>
</span><span id="rotation_about_center_in_2d-2701"><a href="#rotation_about_center_in_2d-2701"><span class="linenos">2701</span></a>
</span><span id="rotation_about_center_in_2d-2702"><a href="#rotation_about_center_in_2d-2702"><span class="linenos">2702</span></a><span class="sd">  The returned matrix accounts for the possibly non-square domain shapes.</span>
</span><span id="rotation_about_center_in_2d-2703"><a href="#rotation_about_center_in_2d-2703"><span class="linenos">2703</span></a>
</span><span id="rotation_about_center_in_2d-2704"><a href="#rotation_about_center_in_2d-2704"><span class="linenos">2704</span></a><span class="sd">  Args:</span>
</span><span id="rotation_about_center_in_2d-2705"><a href="#rotation_about_center_in_2d-2705"><span class="linenos">2705</span></a><span class="sd">    src_shape: Resolution (ny, nx) of the source domain grid.</span>
</span><span id="rotation_about_center_in_2d-2706"><a href="#rotation_about_center_in_2d-2706"><span class="linenos">2706</span></a><span class="sd">    angle: Angle in radians (positive from x to y axis) applied when mapping the source domain</span>
</span><span id="rotation_about_center_in_2d-2707"><a href="#rotation_about_center_in_2d-2707"><span class="linenos">2707</span></a><span class="sd">      onto the destination domain.</span>
</span><span id="rotation_about_center_in_2d-2708"><a href="#rotation_about_center_in_2d-2708"><span class="linenos">2708</span></a><span class="sd">    dst_shape: Resolution (ny, nx) of the destination domain grid; it defaults to `src_shape`.</span>
</span><span id="rotation_about_center_in_2d-2709"><a href="#rotation_about_center_in_2d-2709"><span class="linenos">2709</span></a><span class="sd">    scale: Scaling factor applied when mapping the source domain onto the destination domain.</span>
</span><span id="rotation_about_center_in_2d-2710"><a href="#rotation_about_center_in_2d-2710"><span class="linenos">2710</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="rotation_about_center_in_2d-2711"><a href="#rotation_about_center_in_2d-2711"><span class="linenos">2711</span></a>
</span><span id="rotation_about_center_in_2d-2712"><a href="#rotation_about_center_in_2d-2712"><span class="linenos">2712</span></a>  <span class="k">def</span> <span class="nf">translation_matrix</span><span class="p">(</span><span class="n">vector</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="rotation_about_center_in_2d-2713"><a href="#rotation_about_center_in_2d-2713"><span class="linenos">2713</span></a>    <span class="n">matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vector</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="rotation_about_center_in_2d-2714"><a href="#rotation_about_center_in_2d-2714"><span class="linenos">2714</span></a>    <span class="n">matrix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">vector</span>
</span><span id="rotation_about_center_in_2d-2715"><a href="#rotation_about_center_in_2d-2715"><span class="linenos">2715</span></a>    <span class="k">return</span> <span class="n">matrix</span>
</span><span id="rotation_about_center_in_2d-2716"><a href="#rotation_about_center_in_2d-2716"><span class="linenos">2716</span></a>
</span><span id="rotation_about_center_in_2d-2717"><a href="#rotation_about_center_in_2d-2717"><span class="linenos">2717</span></a>  <span class="k">def</span> <span class="nf">scaling_matrix</span><span class="p">(</span><span class="n">scale</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="rotation_about_center_in_2d-2718"><a href="#rotation_about_center_in_2d-2718"><span class="linenos">2718</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="nb">tuple</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.0</span><span class="p">,))</span>
</span><span id="rotation_about_center_in_2d-2719"><a href="#rotation_about_center_in_2d-2719"><span class="linenos">2719</span></a>
</span><span id="rotation_about_center_in_2d-2720"><a href="#rotation_about_center_in_2d-2720"><span class="linenos">2720</span></a>  <span class="k">def</span> <span class="nf">rotation_matrix_2d</span><span class="p">(</span><span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="rotation_about_center_in_2d-2721"><a href="#rotation_about_center_in_2d-2721"><span class="linenos">2721</span></a>    <span class="n">c</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span>
</span><span id="rotation_about_center_in_2d-2722"><a href="#rotation_about_center_in_2d-2722"><span class="linenos">2722</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="n">s</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span>
</span><span id="rotation_about_center_in_2d-2723"><a href="#rotation_about_center_in_2d-2723"><span class="linenos">2723</span></a>
</span><span id="rotation_about_center_in_2d-2724"><a href="#rotation_about_center_in_2d-2724"><span class="linenos">2724</span></a>  <span class="n">src_shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">src_shape</span><span class="p">)</span>
</span><span id="rotation_about_center_in_2d-2725"><a href="#rotation_about_center_in_2d-2725"><span class="linenos">2725</span></a>  <span class="n">dst_shape</span> <span class="o">=</span> <span class="n">src_shape</span> <span class="k">if</span> <span class="n">dst_shape</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">dst_shape</span><span class="p">)</span>
</span><span id="rotation_about_center_in_2d-2726"><a href="#rotation_about_center_in_2d-2726"><span class="linenos">2726</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="n">src_shape</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
</span><span id="rotation_about_center_in_2d-2727"><a href="#rotation_about_center_in_2d-2727"><span class="linenos">2727</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="n">dst_shape</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="mi">2</span><span class="p">,))</span>
</span><span id="rotation_about_center_in_2d-2728"><a href="#rotation_about_center_in_2d-2728"><span class="linenos">2728</span></a>  <span class="n">half</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
</span><span id="rotation_about_center_in_2d-2729"><a href="#rotation_about_center_in_2d-2729"><span class="linenos">2729</span></a>  <span class="n">matrix</span> <span class="o">=</span> <span class="p">(</span><span class="n">translation_matrix</span><span class="p">(</span><span class="n">half</span><span class="p">)</span> <span class="o">@</span>
</span><span id="rotation_about_center_in_2d-2730"><a href="#rotation_about_center_in_2d-2730"><span class="linenos">2730</span></a>            <span class="n">scaling_matrix</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">src_shape</span><span class="p">)</span> <span class="o">/</span> <span class="n">src_shape</span><span class="p">)</span> <span class="o">@</span>
</span><span id="rotation_about_center_in_2d-2731"><a href="#rotation_about_center_in_2d-2731"><span class="linenos">2731</span></a>            <span class="n">rotation_matrix_2d</span><span class="p">(</span><span class="n">angle</span><span class="p">)</span> <span class="o">@</span>
</span><span id="rotation_about_center_in_2d-2732"><a href="#rotation_about_center_in_2d-2732"><span class="linenos">2732</span></a>            <span class="n">scaling_matrix</span><span class="p">(</span><span class="n">scale</span> <span class="o">*</span> <span class="n">dst_shape</span> <span class="o">/</span> <span class="nb">min</span><span class="p">(</span><span class="n">dst_shape</span><span class="p">))</span> <span class="o">@</span>
</span><span id="rotation_about_center_in_2d-2733"><a href="#rotation_about_center_in_2d-2733"><span class="linenos">2733</span></a>            <span class="n">translation_matrix</span><span class="p">(</span><span class="o">-</span><span class="n">half</span><span class="p">))</span>
</span><span id="rotation_about_center_in_2d-2734"><a href="#rotation_about_center_in_2d-2734"><span class="linenos">2734</span></a>  <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">matrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
</span><span id="rotation_about_center_in_2d-2735"><a href="#rotation_about_center_in_2d-2735"><span class="linenos">2735</span></a>  <span class="k">return</span> <span class="n">matrix</span>
</span></pre></div>


            <div class="docstring"><p>Return the 3x3 matrix mapping destination into a source unit domain.</p>

<p>The returned matrix accounts for the possibly non-square domain shapes.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>src_shape:</strong>  Resolution (ny, nx) of the source domain grid.</li>
<li><strong>angle:</strong>  Angle in radians (positive from x to y axis) applied when mapping the source domain
onto the destination domain.</li>
<li><strong>dst_shape:</strong>  Resolution (ny, nx) of the destination domain grid; it defaults to <code>src_shape</code>.</li>
<li><strong>scale:</strong>  Scaling factor applied when mapping the source domain onto the destination domain.</li>
</ul>
</div>


                </section>
                <section id="rotate_image_about_center">
                            <input id="rotate_image_about_center-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">rotate_image_about_center</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">image</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">angle</span><span class="p">:</span> <span class="nb">float</span>,</span><span class="param">	<span class="n">new_shape</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>,</span><span class="param">	<span class="n">num_rotations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="rotate_image_about_center-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#rotate_image_about_center"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="rotate_image_about_center-2738"><a href="#rotate_image_about_center-2738"><span class="linenos">2738</span></a><span class="k">def</span> <span class="nf">rotate_image_about_center</span><span class="p">(</span><span class="n">image</span><span class="p">:</span> <span class="n">_NDArray</span><span class="p">,</span>
</span><span id="rotate_image_about_center-2739"><a href="#rotate_image_about_center-2739"><span class="linenos">2739</span></a>                              <span class="n">angle</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
</span><span id="rotate_image_about_center-2740"><a href="#rotate_image_about_center-2740"><span class="linenos">2740</span></a>                              <span class="n">new_shape</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="rotate_image_about_center-2741"><a href="#rotate_image_about_center-2741"><span class="linenos">2741</span></a>                              <span class="n">scale</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
</span><span id="rotate_image_about_center-2742"><a href="#rotate_image_about_center-2742"><span class="linenos">2742</span></a>                              <span class="n">num_rotations</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="rotate_image_about_center-2743"><a href="#rotate_image_about_center-2743"><span class="linenos">2743</span></a>                              <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="rotate_image_about_center-2744"><a href="#rotate_image_about_center-2744"><span class="linenos">2744</span></a>  <span class="sd">&quot;&quot;&quot;Return a copy of `image` rotated about its center.</span>
</span><span id="rotate_image_about_center-2745"><a href="#rotate_image_about_center-2745"><span class="linenos">2745</span></a>
</span><span id="rotate_image_about_center-2746"><a href="#rotate_image_about_center-2746"><span class="linenos">2746</span></a><span class="sd">  Args:</span>
</span><span id="rotate_image_about_center-2747"><a href="#rotate_image_about_center-2747"><span class="linenos">2747</span></a><span class="sd">    image: Source grid samples; the first two dimensions are spatial (ny, nx).</span>
</span><span id="rotate_image_about_center-2748"><a href="#rotate_image_about_center-2748"><span class="linenos">2748</span></a><span class="sd">    angle: Angle in radians (positive from x to y axis) applied when mapping the source domain</span>
</span><span id="rotate_image_about_center-2749"><a href="#rotate_image_about_center-2749"><span class="linenos">2749</span></a><span class="sd">      onto the destination domain.</span>
</span><span id="rotate_image_about_center-2750"><a href="#rotate_image_about_center-2750"><span class="linenos">2750</span></a><span class="sd">    new_shape: Resolution (ny, nx) of the output grid; it defaults to `image.shape[:2]`.</span>
</span><span id="rotate_image_about_center-2751"><a href="#rotate_image_about_center-2751"><span class="linenos">2751</span></a><span class="sd">    scale: Scaling factor applied when mapping the source domain onto the destination domain.</span>
</span><span id="rotate_image_about_center-2752"><a href="#rotate_image_about_center-2752"><span class="linenos">2752</span></a><span class="sd">    num_rotations: Number of rotations (each by `angle`).  Successive resamplings are useful in</span>
</span><span id="rotate_image_about_center-2753"><a href="#rotate_image_about_center-2753"><span class="linenos">2753</span></a><span class="sd">      analyzing the filtering quality.</span>
</span><span id="rotate_image_about_center-2754"><a href="#rotate_image_about_center-2754"><span class="linenos">2754</span></a><span class="sd">    **kwargs: Additional parameters for `resample_affine`.</span>
</span><span id="rotate_image_about_center-2755"><a href="#rotate_image_about_center-2755"><span class="linenos">2755</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="rotate_image_about_center-2756"><a href="#rotate_image_about_center-2756"><span class="linenos">2756</span></a>  <span class="n">new_shape</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="n">new_shape</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">new_shape</span><span class="p">)</span>
</span><span id="rotate_image_about_center-2757"><a href="#rotate_image_about_center-2757"><span class="linenos">2757</span></a>  <span class="n">matrix</span> <span class="o">=</span> <span class="n">rotation_about_center_in_2d</span><span class="p">(</span><span class="n">image</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">2</span><span class="p">],</span> <span class="n">angle</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
</span><span id="rotate_image_about_center-2758"><a href="#rotate_image_about_center-2758"><span class="linenos">2758</span></a>  <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_rotations</span><span class="p">):</span>
</span><span id="rotate_image_about_center-2759"><a href="#rotate_image_about_center-2759"><span class="linenos">2759</span></a>    <span class="n">image</span> <span class="o">=</span> <span class="n">resample_affine</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">new_shape</span><span class="p">,</span> <span class="n">matrix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="rotate_image_about_center-2760"><a href="#rotate_image_about_center-2760"><span class="linenos">2760</span></a>  <span class="k">return</span> <span class="n">image</span>
</span></pre></div>


            <div class="docstring"><p>Return a copy of <code>image</code> rotated about its center.</p>

<h6 id="args">Args</h6>

<ul>
<li><strong>image:</strong>  Source grid samples; the first two dimensions are spatial (ny, nx).</li>
<li><strong>angle:</strong>  Angle in radians (positive from x to y axis) applied when mapping the source domain
onto the destination domain.</li>
<li><strong>new_shape:</strong>  Resolution (ny, nx) of the output grid; it defaults to <code>image.shape[:2]</code>.</li>
<li><strong>scale:</strong>  Scaling factor applied when mapping the source domain onto the destination domain.</li>
<li><strong>num_rotations:</strong>  Number of rotations (each by <code>angle</code>).  Successive resamplings are useful in
analyzing the filtering quality.</li>
<li><strong>**kwargs:</strong>  Additional parameters for <code><a href="#resample_affine">resample_affine</a></code>.</li>
</ul>
</div>


                </section>
                <section id="pil_image_resize">
                            <input id="pil_image_resize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pil_image_resize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">array</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="n">shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>, </span><span class="param"><span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="pil_image_resize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#pil_image_resize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="pil_image_resize-2763"><a href="#pil_image_resize-2763"><span class="linenos">2763</span></a><span class="k">def</span> <span class="nf">pil_image_resize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="pil_image_resize-2764"><a href="#pil_image_resize-2764"><span class="linenos">2764</span></a>  <span class="sd">&quot;&quot;&quot;Invoke `PIL.Image.resize` using the same parameters as `resize`.&quot;&quot;&quot;</span>
</span><span id="pil_image_resize-2765"><a href="#pil_image_resize-2765"><span class="linenos">2765</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="pil_image_resize-2766"><a href="#pil_image_resize-2766"><span class="linenos">2766</span></a>  <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">3</span>
</span><span id="pil_image_resize-2767"><a href="#pil_image_resize-2767"><span class="linenos">2767</span></a>  <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">)</span>
</span><span id="pil_image_resize-2768"><a href="#pil_image_resize-2768"><span class="linenos">2768</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="pil_image_resize-2769"><a href="#pil_image_resize-2769"><span class="linenos">2769</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="pil_image_resize-2770"><a href="#pil_image_resize-2770"><span class="linenos">2770</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="pil_image_resize-2771"><a href="#pil_image_resize-2771"><span class="linenos">2771</span></a>    <span class="k">return</span> <span class="n">pil_image_resize</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">),</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)</span>
</span><span id="pil_image_resize-2772"><a href="#pil_image_resize-2772"><span class="linenos">2772</span></a>  <span class="kn">import</span> <span class="nn">PIL.Image</span>
</span><span id="pil_image_resize-2773"><a href="#pil_image_resize-2773"><span class="linenos">2773</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="p">,</span> <span class="s1">&#39;Resampling&#39;</span><span class="p">):</span>  <span class="c1"># Pillow&lt;9.0</span>
</span><span id="pil_image_resize-2774"><a href="#pil_image_resize-2774"><span class="linenos">2774</span></a>    <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span> <span class="o">=</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span>
</span><span id="pil_image_resize-2775"><a href="#pil_image_resize-2775"><span class="linenos">2775</span></a>  <span class="n">pil_resample</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="pil_image_resize-2776"><a href="#pil_image_resize-2776"><span class="linenos">2776</span></a>      <span class="s1">&#39;impulse&#39;</span><span class="p">:</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">NEAREST</span><span class="p">,</span>
</span><span id="pil_image_resize-2777"><a href="#pil_image_resize-2777"><span class="linenos">2777</span></a>      <span class="s1">&#39;box&#39;</span><span class="p">:</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">BOX</span><span class="p">,</span>
</span><span id="pil_image_resize-2778"><a href="#pil_image_resize-2778"><span class="linenos">2778</span></a>      <span class="s1">&#39;triangle&#39;</span><span class="p">:</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">BILINEAR</span><span class="p">,</span>
</span><span id="pil_image_resize-2779"><a href="#pil_image_resize-2779"><span class="linenos">2779</span></a>      <span class="s1">&#39;hamming1&#39;</span><span class="p">:</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">HAMMING</span><span class="p">,</span>  <span class="c1"># GeneralizedHammingFilter(1, a0=0.54)</span>
</span><span id="pil_image_resize-2780"><a href="#pil_image_resize-2780"><span class="linenos">2780</span></a>      <span class="s1">&#39;cubic&#39;</span><span class="p">:</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">BICUBIC</span><span class="p">,</span>
</span><span id="pil_image_resize-2781"><a href="#pil_image_resize-2781"><span class="linenos">2781</span></a>      <span class="s1">&#39;lanczos3&#39;</span><span class="p">:</span> <span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">Resampling</span><span class="o">.</span><span class="n">LANCZOS</span><span class="p">,</span>
</span><span id="pil_image_resize-2782"><a href="#pil_image_resize-2782"><span class="linenos">2782</span></a>  <span class="p">}[</span><span class="nb">filter</span><span class="p">]</span>
</span><span id="pil_image_resize-2783"><a href="#pil_image_resize-2783"><span class="linenos">2783</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="pil_image_resize-2784"><a href="#pil_image_resize-2784"><span class="linenos">2784</span></a>    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span>
</span><span id="pil_image_resize-2785"><a href="#pil_image_resize-2785"><span class="linenos">2785</span></a>        <span class="n">shape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">resample</span><span class="o">=</span><span class="n">pil_resample</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="pil_image_resize-2786"><a href="#pil_image_resize-2786"><span class="linenos">2786</span></a>  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span>
</span><span id="pil_image_resize-2787"><a href="#pil_image_resize-2787"><span class="linenos">2787</span></a>      <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">PIL</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span>
</span><span id="pil_image_resize-2788"><a href="#pil_image_resize-2788"><span class="linenos">2788</span></a>          <span class="n">shape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">resample</span><span class="o">=</span><span class="n">pil_resample</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="pil_image_resize-2789"><a href="#pil_image_resize-2789"><span class="linenos">2789</span></a>       <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>
</span></pre></div>


            <div class="docstring"><p>Invoke <code>PIL.Image.resize</code> using the same parameters as <code><a href="#resize">resize</a></code>.</p>
</div>


                </section>
                <section id="cv_resize">
                            <input id="cv_resize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cv_resize</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">array</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="n">shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>, </span><span class="param"><span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="cv_resize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#cv_resize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="cv_resize-2792"><a href="#cv_resize-2792"><span class="linenos">2792</span></a><span class="k">def</span> <span class="nf">cv_resize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_NDArray</span><span class="p">:</span>
</span><span id="cv_resize-2793"><a href="#cv_resize-2793"><span class="linenos">2793</span></a>  <span class="sd">&quot;&quot;&quot;Invoke `cv.resize` using the same parameters as `resize`.&quot;&quot;&quot;</span>
</span><span id="cv_resize-2794"><a href="#cv_resize-2794"><span class="linenos">2794</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="cv_resize-2795"><a href="#cv_resize-2795"><span class="linenos">2795</span></a>  <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">3</span>
</span><span id="cv_resize-2796"><a href="#cv_resize-2796"><span class="linenos">2796</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="cv_resize-2797"><a href="#cv_resize-2797"><span class="linenos">2797</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="cv_resize-2798"><a href="#cv_resize-2798"><span class="linenos">2798</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="cv_resize-2799"><a href="#cv_resize-2799"><span class="linenos">2799</span></a>    <span class="k">return</span> <span class="n">cv_resize</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">),</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="cv_resize-2800"><a href="#cv_resize-2800"><span class="linenos">2800</span></a>  <span class="kn">import</span> <span class="nn">cv2</span> <span class="k">as</span> <span class="nn">cv</span>
</span><span id="cv_resize-2801"><a href="#cv_resize-2801"><span class="linenos">2801</span></a>  <span class="n">interpolation</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="cv_resize-2802"><a href="#cv_resize-2802"><span class="linenos">2802</span></a>      <span class="s1">&#39;impulse&#39;</span><span class="p">:</span> <span class="n">cv</span><span class="o">.</span><span class="n">INTER_NEAREST</span><span class="p">,</span>  <span class="c1"># Consider cv.INTER_NEAREST_EXACT?</span>
</span><span id="cv_resize-2803"><a href="#cv_resize-2803"><span class="linenos">2803</span></a>      <span class="s1">&#39;triangle&#39;</span><span class="p">:</span> <span class="n">cv</span><span class="o">.</span><span class="n">INTER_LINEAR_EXACT</span><span class="p">,</span>  <span class="c1"># Or just cv.INTER_LINEAR?</span>
</span><span id="cv_resize-2804"><a href="#cv_resize-2804"><span class="linenos">2804</span></a>      <span class="s1">&#39;trapezoid&#39;</span><span class="p">:</span> <span class="n">cv</span><span class="o">.</span><span class="n">INTER_AREA</span><span class="p">,</span>
</span><span id="cv_resize-2805"><a href="#cv_resize-2805"><span class="linenos">2805</span></a>      <span class="s1">&#39;sharpcubic&#39;</span><span class="p">:</span> <span class="n">cv</span><span class="o">.</span><span class="n">INTER_CUBIC</span><span class="p">,</span>
</span><span id="cv_resize-2806"><a href="#cv_resize-2806"><span class="linenos">2806</span></a>      <span class="s1">&#39;lanczos4&#39;</span><span class="p">:</span> <span class="n">cv</span><span class="o">.</span><span class="n">INTER_LANCZOS4</span><span class="p">,</span>
</span><span id="cv_resize-2807"><a href="#cv_resize-2807"><span class="linenos">2807</span></a>  <span class="p">}[</span><span class="nb">filter</span><span class="p">]</span>
</span><span id="cv_resize-2808"><a href="#cv_resize-2808"><span class="linenos">2808</span></a>  <span class="k">return</span> <span class="n">cv</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">shape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Invoke <code>cv.resize</code> using the same parameters as <code><a href="#resize">resize</a></code>.</p>
</div>


                </section>
                <section id="tf_image_resize">
                            <input id="tf_image_resize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">tf_image_resize</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">array</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;lanczos3&#39;</span>,</span><span class="param">	<span class="n">antialias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="tf_image_resize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#tf_image_resize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="tf_image_resize-2822"><a href="#tf_image_resize-2822"><span class="linenos">2822</span></a><span class="k">def</span> <span class="nf">tf_image_resize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;lanczos3&#39;</span><span class="p">,</span>
</span><span id="tf_image_resize-2823"><a href="#tf_image_resize-2823"><span class="linenos">2823</span></a>                    <span class="n">antialias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TensorflowTensor</span><span class="p">:</span>
</span><span id="tf_image_resize-2824"><a href="#tf_image_resize-2824"><span class="linenos">2824</span></a>  <span class="sd">&quot;&quot;&quot;Invoke `tf.image.resize` using the same parameters as `resize`.&quot;&quot;&quot;</span>
</span><span id="tf_image_resize-2825"><a href="#tf_image_resize-2825"><span class="linenos">2825</span></a>  <span class="kn">import</span> <span class="nn">tensorflow</span> <span class="k">as</span> <span class="nn">tf</span>
</span><span id="tf_image_resize-2826"><a href="#tf_image_resize-2826"><span class="linenos">2826</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">convert_to_tensor</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="tf_image_resize-2827"><a href="#tf_image_resize-2827"><span class="linenos">2827</span></a>  <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">3</span>
</span><span id="tf_image_resize-2828"><a href="#tf_image_resize-2828"><span class="linenos">2828</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="tf_image_resize-2829"><a href="#tf_image_resize-2829"><span class="linenos">2829</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="tf_image_resize-2830"><a href="#tf_image_resize-2830"><span class="linenos">2830</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="tf_image_resize-2831"><a href="#tf_image_resize-2831"><span class="linenos">2831</span></a>    <span class="k">return</span> <span class="n">tf_image_resize</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">),</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span> <span class="n">antialias</span><span class="o">=</span><span class="n">antialias</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="tf_image_resize-2832"><a href="#tf_image_resize-2832"><span class="linenos">2832</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="tf_image_resize-2833"><a href="#tf_image_resize-2833"><span class="linenos">2833</span></a>    <span class="k">return</span> <span class="n">tf_image_resize</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span> <span class="n">shape</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="nb">filter</span><span class="p">,</span> <span class="n">antialias</span><span class="o">=</span><span class="n">antialias</span><span class="p">)[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="tf_image_resize-2834"><a href="#tf_image_resize-2834"><span class="linenos">2834</span></a>  <span class="n">method</span> <span class="o">=</span> <span class="n">_TENSORFLOW_IMAGE_RESIZE_METHOD_FROM_FILTER</span><span class="p">[</span><span class="nb">filter</span><span class="p">]</span>
</span><span id="tf_image_resize-2835"><a href="#tf_image_resize-2835"><span class="linenos">2835</span></a>  <span class="k">return</span> <span class="n">tf</span><span class="o">.</span><span class="n">image</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">,</span> <span class="n">antialias</span><span class="o">=</span><span class="n">antialias</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Invoke <code>tf.image.resize</code> using the same parameters as <code><a href="#resize">resize</a></code>.</p>
</div>


                </section>
                <section id="torch_nn_resize">
                            <input id="torch_nn_resize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">torch_nn_resize</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">array</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">antialias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="torch_nn_resize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#torch_nn_resize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="torch_nn_resize-2845"><a href="#torch_nn_resize-2845"><span class="linenos">2845</span></a><span class="k">def</span> <span class="nf">torch_nn_resize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="torch_nn_resize-2846"><a href="#torch_nn_resize-2846"><span class="linenos">2846</span></a>                    <span class="n">antialias</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TorchTensor</span><span class="p">:</span>
</span><span id="torch_nn_resize-2847"><a href="#torch_nn_resize-2847"><span class="linenos">2847</span></a>  <span class="sd">&quot;&quot;&quot;Invoke `torch.nn.functional.interpolate` using the same parameters as `resize`.&quot;&quot;&quot;</span>
</span><span id="torch_nn_resize-2848"><a href="#torch_nn_resize-2848"><span class="linenos">2848</span></a>  <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="torch_nn_resize-2849"><a href="#torch_nn_resize-2849"><span class="linenos">2849</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="torch_nn_resize-2850"><a href="#torch_nn_resize-2850"><span class="linenos">2850</span></a>  <span class="k">assert</span> <span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&lt;=</span> <span class="mi">3</span>
</span><span id="torch_nn_resize-2851"><a href="#torch_nn_resize-2851"><span class="linenos">2851</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="torch_nn_resize-2852"><a href="#torch_nn_resize-2852"><span class="linenos">2852</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="torch_nn_resize-2853"><a href="#torch_nn_resize-2853"><span class="linenos">2853</span></a>  <span class="n">mode</span> <span class="o">=</span> <span class="n">_TORCH_INTERPOLATE_MODE_FROM_FILTER</span><span class="p">[</span><span class="nb">filter</span><span class="p">]</span>
</span><span id="torch_nn_resize-2854"><a href="#torch_nn_resize-2854"><span class="linenos">2854</span></a>
</span><span id="torch_nn_resize-2855"><a href="#torch_nn_resize-2855"><span class="linenos">2855</span></a>  <span class="k">def</span> <span class="nf">local_resize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_TorchTensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TorchTensor</span><span class="p">:</span>
</span><span id="torch_nn_resize-2856"><a href="#torch_nn_resize-2856"><span class="linenos">2856</span></a>    <span class="c1"># For upsampling, BILINEAR antialias is same PSNR and slower,</span>
</span><span id="torch_nn_resize-2857"><a href="#torch_nn_resize-2857"><span class="linenos">2857</span></a>    <span class="c1">#  and BICUBIC antialias is worse PSNR and faster.</span>
</span><span id="torch_nn_resize-2858"><a href="#torch_nn_resize-2858"><span class="linenos">2858</span></a>    <span class="c1"># For downsampling, antialias improves PSNR for both BILINEAR and BICUBIC.</span>
</span><span id="torch_nn_resize-2859"><a href="#torch_nn_resize-2859"><span class="linenos">2859</span></a>    <span class="n">align_corners</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="nb">filter</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;cubic&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
</span><span id="torch_nn_resize-2860"><a href="#torch_nn_resize-2860"><span class="linenos">2860</span></a>    <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span>
</span><span id="torch_nn_resize-2861"><a href="#torch_nn_resize-2861"><span class="linenos">2861</span></a>        <span class="n">array</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span> <span class="n">align_corners</span><span class="o">=</span><span class="n">align_corners</span><span class="p">,</span> <span class="n">antialias</span><span class="o">=</span><span class="n">antialias</span><span class="p">)</span>
</span><span id="torch_nn_resize-2862"><a href="#torch_nn_resize-2862"><span class="linenos">2862</span></a>
</span><span id="torch_nn_resize-2863"><a href="#torch_nn_resize-2863"><span class="linenos">2863</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="torch_nn_resize-2864"><a href="#torch_nn_resize-2864"><span class="linenos">2864</span></a>    <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">)</span>
</span><span id="torch_nn_resize-2865"><a href="#torch_nn_resize-2865"><span class="linenos">2865</span></a>    <span class="k">return</span> <span class="n">local_resize</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="torch_nn_resize-2866"><a href="#torch_nn_resize-2866"><span class="linenos">2866</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="torch_nn_resize-2867"><a href="#torch_nn_resize-2867"><span class="linenos">2867</span></a>    <span class="k">return</span> <span class="n">local_resize</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="torch_nn_resize-2868"><a href="#torch_nn_resize-2868"><span class="linenos">2868</span></a>  <span class="k">return</span> <span class="n">local_resize</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)[</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Invoke <code>torch.nn.functional.interpolate</code> using the same parameters as <code><a href="#resize">resize</a></code>.</p>
</div>


                </section>
                <section id="torchvision_resize">
                            <input id="torchvision_resize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">torchvision_resize</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">array</span><span class="p">:</span> <span class="n">Any</span>,</span><span class="param">	<span class="n">shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>,</span><span class="param">	<span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span>,</span><span class="param">	<span class="n">antialias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="torchvision_resize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#torchvision_resize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="torchvision_resize-2871"><a href="#torchvision_resize-2871"><span class="linenos">2871</span></a><span class="k">def</span> <span class="nf">torchvision_resize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">shape</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
</span><span id="torchvision_resize-2872"><a href="#torchvision_resize-2872"><span class="linenos">2872</span></a>                       <span class="n">antialias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TorchTensor</span><span class="p">:</span>
</span><span id="torchvision_resize-2873"><a href="#torchvision_resize-2873"><span class="linenos">2873</span></a>  <span class="sd">&quot;&quot;&quot;Invoke `torchvision.transforms.functional.resize` using the same parameters as `resize`.&quot;&quot;&quot;</span>
</span><span id="torchvision_resize-2874"><a href="#torchvision_resize-2874"><span class="linenos">2874</span></a>  <span class="c1"># The results appear to be identical to torch.nn.functional.interpolate() and slightly slower.</span>
</span><span id="torchvision_resize-2875"><a href="#torchvision_resize-2875"><span class="linenos">2875</span></a>  <span class="kn">import</span> <span class="nn">torch</span>
</span><span id="torchvision_resize-2876"><a href="#torchvision_resize-2876"><span class="linenos">2876</span></a>  <span class="kn">import</span> <span class="nn">torchvision</span>
</span><span id="torchvision_resize-2877"><a href="#torchvision_resize-2877"><span class="linenos">2877</span></a>  <span class="n">array</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">as_tensor</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="torchvision_resize-2878"><a href="#torchvision_resize-2878"><span class="linenos">2878</span></a>  <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
</span><span id="torchvision_resize-2879"><a href="#torchvision_resize-2879"><span class="linenos">2879</span></a>  <span class="n">_check_eq</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">),</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="torchvision_resize-2880"><a href="#torchvision_resize-2880"><span class="linenos">2880</span></a>  <span class="n">torchvision_interpolation_from_filter</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="torchvision_resize-2881"><a href="#torchvision_resize-2881"><span class="linenos">2881</span></a>      <span class="s1">&#39;impulse&#39;</span><span class="p">:</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">InterpolationMode</span><span class="o">.</span><span class="n">NEAREST</span><span class="p">,</span>
</span><span id="torchvision_resize-2882"><a href="#torchvision_resize-2882"><span class="linenos">2882</span></a>      <span class="s1">&#39;triangle&#39;</span><span class="p">:</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">InterpolationMode</span><span class="o">.</span><span class="n">BILINEAR</span><span class="p">,</span>
</span><span id="torchvision_resize-2883"><a href="#torchvision_resize-2883"><span class="linenos">2883</span></a>      <span class="s1">&#39;sharpcubic&#39;</span><span class="p">:</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">InterpolationMode</span><span class="o">.</span><span class="n">BICUBIC</span><span class="p">,</span>
</span><span id="torchvision_resize-2884"><a href="#torchvision_resize-2884"><span class="linenos">2884</span></a>      <span class="c1"># Only the 3 modes above are supported when `array` is a torch.Tensor.</span>
</span><span id="torchvision_resize-2885"><a href="#torchvision_resize-2885"><span class="linenos">2885</span></a>      <span class="c1"># &#39;box&#39;: torchvision.transforms.InterpolationMode.BOX,</span>
</span><span id="torchvision_resize-2886"><a href="#torchvision_resize-2886"><span class="linenos">2886</span></a>  <span class="p">}</span>
</span><span id="torchvision_resize-2887"><a href="#torchvision_resize-2887"><span class="linenos">2887</span></a>  <span class="n">interpolation</span> <span class="o">=</span> <span class="n">torchvision_interpolation_from_filter</span><span class="p">[</span><span class="nb">filter</span><span class="p">]</span>
</span><span id="torchvision_resize-2888"><a href="#torchvision_resize-2888"><span class="linenos">2888</span></a>
</span><span id="torchvision_resize-2889"><a href="#torchvision_resize-2889"><span class="linenos">2889</span></a>  <span class="k">def</span> <span class="nf">local_resize</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">_TorchTensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TorchTensor</span><span class="p">:</span>
</span><span id="torchvision_resize-2890"><a href="#torchvision_resize-2890"><span class="linenos">2890</span></a>    <span class="k">return</span> <span class="n">torchvision</span><span class="o">.</span><span class="n">transforms</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span>
</span><span id="torchvision_resize-2891"><a href="#torchvision_resize-2891"><span class="linenos">2891</span></a>        <span class="n">array</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span> <span class="n">antialias</span><span class="o">=</span><span class="n">antialias</span><span class="p">)</span>
</span><span id="torchvision_resize-2892"><a href="#torchvision_resize-2892"><span class="linenos">2892</span></a>
</span><span id="torchvision_resize-2893"><a href="#torchvision_resize-2893"><span class="linenos">2893</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="torchvision_resize-2894"><a href="#torchvision_resize-2894"><span class="linenos">2894</span></a>    <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">shape</span><span class="p">)</span>
</span><span id="torchvision_resize-2895"><a href="#torchvision_resize-2895"><span class="linenos">2895</span></a>    <span class="k">return</span> <span class="n">local_resize</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</span><span id="torchvision_resize-2896"><a href="#torchvision_resize-2896"><span class="linenos">2896</span></a>  <span class="k">if</span> <span class="n">array</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="torchvision_resize-2897"><a href="#torchvision_resize-2897"><span class="linenos">2897</span></a>    <span class="k">return</span> <span class="n">local_resize</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="torchvision_resize-2898"><a href="#torchvision_resize-2898"><span class="linenos">2898</span></a>  <span class="k">return</span> <span class="n">local_resize</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Invoke <code>torchvision.transforms.functional.resize</code> using the same parameters as <code><a href="#resize">resize</a></code>.</p>
</div>


                </section>
    </main>
</body>
</html>